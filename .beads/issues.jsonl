{"id":"ntm-00u","title":"Implement rate limit backoff for agents","description":"Detect rate limit errors and notify users (do not auto-retry).\n\n## What This Task Does\n\nDetect when agents hit rate limits and notify users. This is simpler\nand safer than auto-retry, which can cause more problems than it solves.\n\n## Why Detection Only (No Auto-Retry)\n\nAuto-retry is complex and error-prone:\n- Can't reliably capture the 'last command' to replay\n- Agent state may be corrupted after rate limit\n- Infinite retry loops are possible\n- Users should decide if/when to retry\n\nInstead: Detect, notify, let user handle it.\n\n## Detection\n\nRate limit patterns in agent output:\n- 'rate limit exceeded'\n- 'too many requests'\n- '429'\n- 'quota exceeded'\n- 'try again in X seconds'\n\n## Response\n\nWhen rate limit detected:\n1. Mark agent as 'rate_limited' in health status\n2. Fire notification event (desktop, webhook, shell)\n3. Include wait time if parseable from error\n4. Show in 'ntm health' output with clear indicator\n\nExample notification:\n'Agent cc_1 hit rate limit. Suggested wait: 60s'\n\n## Integration\n\n- Uses health check infrastructure (ntm-239) for detection\n- Uses notification system (ntm-gcv) for alerts\n- Shows in 'ntm status' with rate_limited indicator\n\n## Configuration\n\n[resilience.rate_limit]\ndetect = true\nnotify = true\npatterns = ['rate limit', '429', 'too many requests']\n\n## Acceptance Criteria\n\n- [ ] Rate limit patterns detected in pane output\n- [ ] Notification fired when rate limit detected\n- [ ] Wait time parsed when available\n- [ ] Status shown in ntm health output\n- [ ] No auto-retry (by design)\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:48:15.213867-05:00","updated_at":"2025-12-10T02:55:40.4301-05:00","dependencies":[{"issue_id":"ntm-00u","depends_on_id":"ntm-239","type":"blocks","created_at":"2025-12-10T02:48:15.214331-05:00","created_by":"daemon"}]}
{"id":"ntm-057","title":"Implement model specifier parsing in spawn/add commands","description":"# Implement Model Specifier Parsing\n\n## Purpose\n\nParse the new count:model syntax in spawn and add commands.\n\n## Syntax Specification\n\n```\n--cc=N[:model]\n--cod=N[:model]\n--gmi=N[:model]\n```\n\nExamples:\n- `--cc=2` â†’ 2 Claude agents with default model\n- `--cc=2:opus` â†’ 2 Claude agents with Opus model\n- `--cc=1:opus --cc=2:sonnet` â†’ 1 Opus + 2 Sonnet\n\n## Parsing Logic\n\n```go\ntype AgentSpec struct {\n    Type  AgentType // cc, cod, gmi\n    Count int\n    Model string    // Optional, empty = default\n}\n\nfunc ParseAgentSpec(flag string, value string) ([]AgentSpec, error) {\n    // value format: \"N\" or \"N:model\"\n    // Can be called multiple times for same flag\n    parts := strings.SplitN(value, \":\", 2)\n    count, err := strconv.Atoi(parts[0])\n    if err != nil {\n        return nil, fmt.Errorf(\"invalid count: %s\", parts[0])\n    }\n    \n    model := \"\"\n    if len(parts) \u003e 1 {\n        model = parts[1]\n    }\n    \n    return AgentSpec{Type: flag, Count: count, Model: model}, nil\n}\n```\n\n## Flag Accumulation\n\nMultiple flags of same type should accumulate:\n```bash\nntm spawn myproject --cc=2:opus --cc=1:sonnet\n# Results in: [{Type:cc, Count:2, Model:opus}, {Type:cc, Count:1, Model:sonnet}]\n```\n\nUse Cobra's StringSlice or custom accumulator.\n\n## Model Resolution\n\nAfter parsing, resolve model alias to full model name:\n```go\nfunc ResolveModel(agentType AgentType, modelSpec string) (string, error) {\n    if modelSpec == \"\" {\n        return cfg.Agents.DefaultModel(agentType)\n    }\n    // Check aliases first\n    if fullName, ok := cfg.Models[agentType][modelSpec]; ok {\n        return fullName, nil\n    }\n    // Assume it's a full model name\n    return modelSpec, nil\n}\n```\n\n## Acceptance Criteria\n\n- [ ] spawn parses count:model syntax\n- [ ] add parses count:model syntax\n- [ ] Multiple flags of same type accumulate\n- [ ] Model aliases resolved from config\n- [ ] Error messages for invalid syntax\n- [ ] Backwards compatible with plain count","status":"closed","priority":1,"issue_type":"task","assignee":"SilverMountain","created_at":"2025-12-10T03:21:34.128111-05:00","updated_at":"2025-12-10T09:21:09.639581-05:00","closed_at":"2025-12-10T09:21:09.639581-05:00","dependencies":[{"issue_id":"ntm-057","depends_on_id":"ntm-egl","type":"blocks","created_at":"2025-12-10T03:21:53.768192-05:00","created_by":"daemon"}]}
{"id":"ntm-08r","title":"Implement ntm mail send command","description":"# Implement ntm mail send Command\n\n## Purpose\n\nAllow users to send messages between agents in a session, or broadcast coordination messages.\n\n## Command Syntax\n\n```bash\n# Send to specific agent panes\nntm mail send myproject --to cc_1 \"Please review the API changes\"\n\n# Send to all agents of a type\nntm mail send myproject --cc \"Stop current work and focus on tests\"\n\n# Send to all agents\nntm mail send myproject --all \"Checkpoint: sync and report status\"\n\n# With options\nntm mail send myproject --to cc_1 --subject \"API Review\" --urgent --ack-required \"Review needed ASAP\"\n\n# From file\nntm mail send myproject --to cc_1 --file ./message.md\n```\n\n## Flag Mapping\n\n| Flag | Agent Mail Parameter |\n|------|---------------------|\n| --to | to[] (specific agent) |\n| --cc | cc[] |\n| --subject | subject |\n| --urgent | importance=\"urgent\" |\n| --important | importance=\"high\" |\n| --ack-required | ack_required=true |\n| --thread | thread_id |\n| --file | body_md from file |\n\n## Agent Resolution\n\nThe --to flag accepts:\n1. **Pane identifiers**: cc_1, cod_2 â†’ resolve to agent names\n2. **Agent names**: GreenCastle â†’ use directly\n3. **Agent type filters**: --cc, --cod, --gmi â†’ expand to all agents of type\n\nResolution requires querying both tmux (for pane names) and Agent Mail (for registered agents).\n\n## Message Composition\n\nIf no message body provided:\n1. Open $EDITOR with template\n2. Parse subject from first line (# heading)\n3. Validate non-empty before sending\n\n## Acceptance Criteria\n\n- [ ] Can send to specific agents by pane ID or name\n- [ ] Can broadcast to agent type groups\n- [ ] Subject auto-derived or manually specified\n- [ ] Importance and ack_required flags work\n- [ ] Thread ID support for conversations\n- [ ] File input for long messages\n- [ ] Editor mode for composition","status":"closed","priority":1,"issue_type":"task","assignee":"PurpleHill","created_at":"2025-12-10T03:18:45.793913-05:00","updated_at":"2025-12-10T09:07:36.125599-05:00","closed_at":"2025-12-10T09:07:36.125599-05:00","dependencies":[{"issue_id":"ntm-08r","depends_on_id":"ntm-yxa","type":"blocks","created_at":"2025-12-10T03:19:55.852522-05:00","created_by":"daemon"}]}
{"id":"ntm-0d7","title":"Implement ntm mail ack and read commands","description":"# Implement ntm mail ack and read Commands\n\n## Purpose\n\nAllow marking messages as read or acknowledged, which signals to senders that the message was received and processed.\n\n## Command Syntax\n\n```bash\n# Mark message as read\nntm mail read myproject 42\n\n# Mark message as acknowledged\nntm mail ack myproject 42\n\n# Acknowledge all urgent messages\nntm mail ack myproject --urgent\n\n# Acknowledge all from specific agent\nntm mail ack myproject --from cc_1\n```\n\n## Semantics\n\n- **Read**: Message was seen but not necessarily acted upon\n- **Acknowledged**: Message was seen AND the recipient has taken action or committed to action\n\nAgent Mail tracks both timestamps separately:\n- read_ts: When mark_message_read was called\n- ack_ts: When acknowledge_message was called\n\n## Batch Operations\n\n```bash\n# Mark multiple messages\nntm mail read myproject 42 43 44\n\n# Mark all unread as read\nntm mail read myproject --all\n\n# Acknowledge all pending\nntm mail ack myproject --all\n```\n\n## Output\n\n```\nâœ“ Message #42 marked as read\nâœ“ Message #42 acknowledged (ack_ts: 2025-12-10T15:35:00Z)\n```\n\n## Acceptance Criteria\n\n- [ ] Single message read/ack by ID\n- [ ] Batch operations by ID list\n- [ ] Filter-based batch: --urgent, --from, --all\n- [ ] Proper error handling for already-read/acked\n- [ ] JSON output mode for scripts","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:18:49.63059-05:00","updated_at":"2025-12-10T03:18:49.63059-05:00","dependencies":[{"issue_id":"ntm-0d7","depends_on_id":"ntm-161","type":"blocks","created_at":"2025-12-10T03:19:56.022722-05:00","created_by":"daemon"}]}
{"id":"ntm-0fy","title":"Add --robot-version flag for structured version info","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T02:39:54.643701-05:00","updated_at":"2025-12-10T03:36:31.388411-05:00","closed_at":"2025-12-10T03:36:31.388411-05:00","dependencies":[{"issue_id":"ntm-0fy","depends_on_id":"ntm-517","type":"blocks","created_at":"2025-12-10T02:40:13.337393-05:00","created_by":"daemon"}]}
{"id":"ntm-0qz","title":"Unit Tests: internal/palette package (0% â†’ 60%)","description":"# Unit Tests: internal/palette Package\n\n## Current State\n- Coverage: 0.0%\n- Purpose: Command palette TUI with fuzzy search and animations\n\n## Test Approach\nBubble Tea models are tested by:\n1. Init() - verify initial state\n2. Update(msg) - verify state transitions\n3. View() - verify output contains expected elements\n\nTUI tests are harder to make deterministic - target 60% coverage.\n\n## Test Cases\n\n### model.go\n\n#### Initialization\n- [ ] TestNewModel - creates model with default state\n- [ ] TestNewModelWithCommands - loads commands correctly\n- [ ] TestInitialPhase - starts in PhaseCommand\n\n#### Phase Transitions\n- [ ] TestPhaseCommandToTarget - selecting command moves to target phase\n- [ ] TestPhaseTargetToConfirm - selecting target sends and exits\n- [ ] TestPhaseBack - Escape returns to previous phase\n\n#### Command Filtering\n- [ ] TestFilterByLabel - fuzzy match on label\n- [ ] TestFilterByKey - fuzzy match on key\n- [ ] TestFilterByCategory - fuzzy match on category\n- [ ] TestFilterClearOnBackspace - clearing filter shows all\n- [ ] TestFilterNoMatches - empty results handled\n\n#### Navigation\n- [ ] TestNavigateDown - j/down moves selection\n- [ ] TestNavigateUp - k/up moves selection\n- [ ] TestNavigateWrap - wraps at boundaries\n- [ ] TestQuickSelect - 1-9 selects item\n\n#### Target Selection\n- [ ] TestTargetAll - selects all agents\n- [ ] TestTargetClaude - selects Claude only\n- [ ] TestTargetCodex - selects Codex only\n- [ ] TestTargetGemini - selects Gemini only\n\n### Animation (lower priority)\n- [ ] TestShimmerEffect - animates on tick\n- [ ] TestAnimationTick - tick updates animation state\n\n## View Output Tests\n- [ ] TestViewContainsBanner - banner rendered\n- [ ] TestViewContainsCommands - command list rendered\n- [ ] TestViewContainsPreview - preview pane rendered\n- [ ] TestViewContainsKeyHints - keyboard hints shown\n\n## Implementation Notes\n- Use tea.Batch for message simulation\n- Capture View() output and assert contains\n- Animation tests may be flaky, mark appropriately","status":"in_progress","priority":1,"issue_type":"task","assignee":"PurpleCreek","created_at":"2025-12-10T03:20:42.477205-05:00","updated_at":"2025-12-10T04:36:42.584218-05:00","dependencies":[{"issue_id":"ntm-0qz","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:22:34.045222-05:00","created_by":"daemon"}]}
{"id":"ntm-0wf","title":"E2E Test: Robot Mode JSON Output","description":"# E2E Test: Robot Mode JSON Output\n\n## Scenario\nVerify all --robot-* flags produce valid JSON that AI agents can consume.\n\n## Test Cases\n\n### Test 1: --robot-status\n- Create various session states\n- Run ntm --robot-status\n- Parse JSON\n- Verify all fields present and accurate\n- Log full JSON output\n\n### Test 2: --robot-plan\n- Create sessions with different states\n- Run ntm --robot-plan\n- Verify suggested actions make sense\n- Log recommendations\n\n### Test 3: --robot-version\n- Run ntm --robot-version\n- Verify version/commit/date fields\n- Log version info\n\n### Test 4: --robot-help\n- Run ntm --robot-help\n- Verify documentation present\n- Log help content\n\n## Schema Validation\nDefine and validate JSON schemas:\n```json\n{\n  \"type\": \"object\",\n  \"required\": [\"generated_at\", \"sessions\", \"summary\"],\n  \"properties\": {\n    \"generated_at\": {\"type\": \"string\", \"format\": \"date-time\"},\n    \"sessions\": {\"type\": \"array\"},\n    \"summary\": {\"type\": \"object\"}\n  }\n}\n```\n\n## Logging\nInclude full JSON output in logs for debugging.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-10T03:23:59.020495-05:00","updated_at":"2025-12-10T09:22:02.884037-05:00","dependencies":[{"issue_id":"ntm-0wf","depends_on_id":"ntm-66c","type":"blocks","created_at":"2025-12-10T03:24:42.235374-05:00","created_by":"daemon"},{"issue_id":"ntm-0wf","depends_on_id":"ntm-vr2","type":"blocks","created_at":"2025-12-10T03:24:43.313959-05:00","created_by":"daemon"}]}
{"id":"ntm-160","title":"Create config for distribution preferences (agent type affinity)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:27:27.341697-05:00","updated_at":"2025-12-10T03:32:06.447631-05:00","closed_at":"2025-12-10T03:32:06.447631-05:00","dependencies":[{"issue_id":"ntm-160","depends_on_id":"ntm-xmx","type":"blocks","created_at":"2025-12-10T03:28:05.669542-05:00","created_by":"daemon"}]}
{"id":"ntm-161","title":"Implement ntm mail inbox command","description":"# Implement ntm mail inbox Command\n\n## Purpose\n\nDisplay an AGGREGATE inbox view showing messages across ALL agents in the project, not just NTM's coordinator messages.\n\n## IMPORTANT: Aggregate View\n\nThis is not just NTM's inbox. It shows:\n1. Messages TO any agent in the project (GreenCastle, BlueLake, etc.)\n2. Messages FROM any agent in the project\n3. Filtered by session agents if desired\n\nThis gives the user visibility into all agent-to-agent communication.\n\n## Command Syntax\n\n```bash\n# Show all messages in project (across all agents)\nntm mail inbox myproject\n\n# Filter to session's agents only\nntm mail inbox myproject --session-agents\n\n# Filter to specific agent\nntm mail inbox myproject --agent GreenCastle\n\n# Urgent only\nntm mail inbox myproject --urgent\n\n# JSON for scripts\nntm mail inbox myproject --json\n```\n\n## Output Format\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Project Inbox: myproject (5 agents)                         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â— #42 [URGENT] API Review Needed                            â”‚\nâ”‚   GreenCastle â†’ BlueLake                                    â”‚\nâ”‚   2 minutes ago â”‚ Thread: FEAT-123 â”‚ âš ï¸ Ack required         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â—‹ #41 Tests passing, ready for merge                        â”‚\nâ”‚   RedStone â†’ GreenCastle, BlueLake                          â”‚\nâ”‚   15 minutes ago â”‚ Thread: FEAT-123                         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â—‹ #40 Starting work on src/api/**                           â”‚\nâ”‚   ntm_myproject â†’ all                                       â”‚\nâ”‚   30 minutes ago â”‚ (coordinator announcement)               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nShowing messages involving: GreenCastle, BlueLake, RedStone, ntm_myproject\n```\n\n## Implementation\n\n1. Discover all agents in project via Agent Mail\n2. Fetch inbox for EACH agent\n3. Deduplicate (same message may appear in multiple inboxes)\n4. Sort by timestamp\n5. Display with sender â†’ recipient format\n\n## Acceptance Criteria\n\n- [ ] Shows messages across ALL project agents\n- [ ] Deduplication (message shown once even if multiple recipients)\n- [ ] Filter by --session-agents, --agent, --urgent\n- [ ] Clear indication of sender â†’ recipient\n- [ ] Coordinator messages distinguished from agent messages\n- [ ] --json output for scripts","status":"in_progress","priority":1,"issue_type":"task","assignee":"ChartreuseLake","created_at":"2025-12-10T03:18:48.350455-05:00","updated_at":"2025-12-10T04:01:19.314483-05:00","dependencies":[{"issue_id":"ntm-161","depends_on_id":"ntm-yxa","type":"blocks","created_at":"2025-12-10T03:19:55.9288-05:00","created_by":"daemon"}]}
{"id":"ntm-17s","title":"Create badge rendering functions for agents and status","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:43:01.497658-05:00","updated_at":"2025-12-10T02:43:01.497658-05:00","dependencies":[{"issue_id":"ntm-17s","depends_on_id":"ntm-81e","type":"blocks","created_at":"2025-12-10T02:43:16.208595-05:00","created_by":"daemon"}]}
{"id":"ntm-1qd","title":"Document hooks system in README and create example hooks","description":"","status":"closed","priority":2,"issue_type":"task","assignee":"BlueSnow","created_at":"2025-12-10T02:41:35.932772-05:00","updated_at":"2025-12-10T09:10:47.881985-05:00","closed_at":"2025-12-10T09:10:47.881985-05:00","dependencies":[{"issue_id":"ntm-1qd","depends_on_id":"ntm-j2c","type":"blocks","created_at":"2025-12-10T02:41:44.603791-05:00","created_by":"daemon"},{"issue_id":"ntm-1qd","depends_on_id":"ntm-qen","type":"blocks","created_at":"2025-12-10T02:41:44.656696-05:00","created_by":"daemon"}]}
{"id":"ntm-1rz","title":"Create internal/profiler package for timing instrumentation","description":"","status":"closed","priority":1,"issue_type":"task","assignee":"FuchsiaHill","created_at":"2025-12-10T02:40:35.940739-05:00","updated_at":"2025-12-10T08:55:58.754643-05:00","closed_at":"2025-12-10T08:55:58.754643-05:00"}
{"id":"ntm-1ts","title":"Implement ntm lock/unlock file reservation commands","description":"# Implement ntm lock/unlock File Reservation Commands\n\n## Purpose\n\nExpose Agent Mail's file reservation system as NTM commands, allowing agents to declare intent before editing files and avoid conflicts.\n\n## Command Syntax\n\n```bash\n# Reserve files for editing\nntm lock myproject \"src/api/**\" --reason \"Implementing user endpoints\"\n\n# Reserve multiple patterns\nntm lock myproject \"src/api/**\" \"tests/api/**\"\n\n# With TTL (default 1 hour)\nntm lock myproject \"config/*.json\" --ttl 2h\n\n# Shared (read) vs exclusive (write) lock\nntm lock myproject \"docs/**\" --shared\n\n# Release specific locks\nntm unlock myproject \"src/api/**\"\n\n# Release all locks for session\nntm unlock myproject --all\n\n# Show current locks\nntm locks myproject\nntm locks myproject --all-agents  # Include other sessions\n```\n\n## Lock Display Format\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ File Reservations: myproject                                â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ğŸ”’ src/api/**                                               â”‚\nâ”‚   Agent: ntm_myproject â”‚ Exclusive â”‚ Expires in 45m        â”‚\nâ”‚   Reason: Implementing user endpoints                       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ğŸ”’ tests/api/**                                             â”‚\nâ”‚   Agent: ntm_myproject â”‚ Exclusive â”‚ Expires in 45m        â”‚\nâ”‚   Reason: Implementing user endpoints                       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ğŸ“– docs/** (shared)                                         â”‚\nâ”‚   Agent: GreenCastle â”‚ Shared â”‚ Expires in 1h30m           â”‚\nâ”‚   Reason: Updating API documentation                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Conflict Detection\n\nWhen attempting to lock:\n```\nâš ï¸ Conflict detected:\n  Pattern: src/api/**\n  Held by: GreenCastle (cc_1)\n  Reason: Refactoring auth module\n  Expires in: 25 minutes\n\nOptions:\n  1. Wait for expiry\n  2. Request release: ntm mail send myproject --to cc_1 \"Need src/api/**\"\n  3. Force lock (dangerous): ntm lock myproject \"src/api/**\" --force\n```\n\n## Integration with spawn/add\n\nWhen spawning agents:\n```bash\n# Check for conflicts before spawning\nntm spawn myproject --cc=2 --check-locks\n\n# Auto-reserve working directory\nntm spawn myproject --cc=2 --reserve-cwd\n```\n\n## Acceptance Criteria\n\n- [ ] Lock patterns with glob support\n- [ ] TTL specification (default 1h, max 24h)\n- [ ] Exclusive vs shared locks\n- [ ] Conflict detection with helpful messages\n- [ ] ntm locks command shows current state\n- [ ] --all-agents shows all project reservations\n- [ ] Integration hooks for spawn command","status":"closed","priority":1,"issue_type":"task","assignee":"BrownCastle","created_at":"2025-12-10T03:19:42.508839-05:00","updated_at":"2025-12-10T04:39:33.733237-05:00","closed_at":"2025-12-10T04:39:33.733237-05:00","dependencies":[{"issue_id":"ntm-1ts","depends_on_id":"ntm-yxa","type":"blocks","created_at":"2025-12-10T03:19:56.109325-05:00","created_by":"daemon"}]}
{"id":"ntm-1vi","title":"Fix duplicate pane titles in 'add' command","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-10T02:29:24.573377-05:00","updated_at":"2025-12-10T02:31:07.230929-05:00","closed_at":"2025-12-10T02:31:07.230929-05:00"}
{"id":"ntm-20n","title":"Implement --robot-assign for work distribution recommendations","description":"AI-assisted work assignment suggestions based on current state.\n\n## Rationale\nWith N agents and M ready beads, optimal assignment is non-trivial. This flag analyzes current state and recommends which agent should work on what, considering:\n- Agent types and their strengths\n- Current workload balance  \n- Bead dependencies and priorities\n- Recent activity patterns\n\n## Usage\n```bash\nntm --robot-assign myproject\nntm --robot-assign myproject --beads=ntm-abc,ntm-def  # specific beads\nntm --robot-assign myproject --strategy=balanced      # or: speed, quality\n```\n\n## Output Structure\n```json\n{\n  \"session\": \"myproject\",\n  \"strategy\": \"balanced\",\n  \"recommendations\": [\n    {\n      \"agent\": \"0.1\",\n      \"agent_type\": \"claude\",\n      \"assign_bead\": \"ntm-1rz\",\n      \"confidence\": 0.85,\n      \"reasoning\": \"Profiler task matches claude's code analysis strengths\"\n    },\n    {\n      \"agent\": \"0.2\", \n      \"agent_type\": \"codex\",\n      \"assign_bead\": \"ntm-7mg\",\n      \"confidence\": 0.72,\n      \"reasoning\": \"UI/styling task, codex handles CSS well\"\n    }\n  ],\n  \"blocked_beads\": [\n    {\"id\": \"ntm-xyz\", \"blocked_by\": [\"ntm-abc\"]}\n  ],\n  \"idle_agents\": [\"0.3\"],\n  \"unassignable_beads\": [\n    {\"id\": \"ntm-qqq\", \"reason\": \"Requires human input\"}\n  ]\n}\n```\n\n## Assignment Strategies\n- balanced: distribute work evenly across agents\n- speed: assign to fastest/most active agents  \n- quality: match task types to agent strengths\n- dependency: prioritize unblocking work\n\n## Integration with Beads\nRequires parsing bd ready and bd show output to understand task graph. Consider caching bead state to avoid repeated queries.\n\n## Future Enhancement\nCould integrate with agent-mail to check agent's stated preferences or current focus.","status":"in_progress","priority":1,"issue_type":"task","assignee":"RedCat","created_at":"2025-12-10T02:51:50.71632-05:00","updated_at":"2025-12-10T04:21:29.033695-05:00"}
{"id":"ntm-22f","title":"Implement pre/post command hooks","description":"Run user scripts before and after NTM commands.\n\n## What This Task Does\n\nEnable users to define hooks that run before or after specific\nNTM commands. Hooks can log, notify, validate, or transform.\n\n## Configuration\n\n# ~/.config/ntm/config.toml\n\n[hooks]\n# Run before any send command\npre_send = \"~/.config/ntm/hooks/log-prompt.sh\"\n\n# Run after spawn completes\npost_spawn = \"notify-send 'NTM' 'Session created'\"\n\n# Run before dangerous commands\npre_kill = \"~/.config/ntm/hooks/confirm-kill.sh\"\n\n## Hook Interface\n\nHooks receive command context as JSON on stdin:\n{\n  \"command\": \"send\",\n  \"args\": [\"myproject\", \"--all\", \"hello\"],\n  \"session\": \"myproject\",\n  \"flags\": {\"all\": true},\n  \"timestamp\": \"2025-12-10T10:00:00Z\"\n}\n\nPost hooks also receive result:\n{\n  \"command\": \"spawn\",\n  \"result\": \"success\",\n  \"session\": \"myproject\",\n  \"panes_created\": 4,\n  \"duration_ms\": 1234\n}\n\n## Hook Execution\n\nPre hooks:\n- Run synchronously before command\n- Non-zero exit blocks the command\n- Stdout captured but not displayed (log only)\n- Stderr shown to user\n\nPost hooks:\n- Run asynchronously after command\n- Exit code doesn't affect NTM\n- Good for notifications, logging\n\n## Disabling Hooks\n\nFor scripting or sensitive operations:\n$ ntm send --no-hooks myproject 'message'\n\n## Example Hooks\n\nLog all prompts:\n#\\!/bin/bash\njq -c '{time: .timestamp, session: .session, prompt: .args[2]}' \u003e\u003e ~/.ntm-prompts.jsonl\n\nConfirm before kill:\n#\\!/bin/bash\nsession=$(jq -r '.session' -)\nread -p \"Really kill $session? [y/N] \" confirm\n[[ \"$confirm\" == \"y\" ]] || exit 1\n\n## Acceptance Criteria\n\n- [ ] Hooks defined in config\n- [ ] Pre hooks run before command\n- [ ] Pre hook failure blocks command\n- [ ] Post hooks run after command\n- [ ] Command context passed as JSON\n- [ ] --no-hooks flag disables hooks\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T02:50:30.364771-05:00","updated_at":"2025-12-10T02:50:30.364771-05:00","dependencies":[{"issue_id":"ntm-22f","depends_on_id":"ntm-c2b","type":"blocks","created_at":"2025-12-10T02:50:30.365276-05:00","created_by":"daemon"},{"issue_id":"ntm-22f","depends_on_id":"ntm-ws2","type":"blocks","created_at":"2025-12-10T02:50:30.366331-05:00","created_by":"daemon"}]}
{"id":"ntm-239","title":"Implement ntm health command for agent status checking","description":"Create a command to check health status of all agents in a session.\n\n## What This Task Does\n\nCreate 'ntm health' command that checks and reports agent health:\n- Process status (running/exited)\n- Activity level (active/idle/stale)\n- Error detection (rate limits, crashes)\n- Output summary with visual indicators\n\n## Command Interface\n\n$ ntm health myproject\nSession: myproject\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Pane â”‚ Agent   â”‚ Status  â”‚ Activity â”‚ Issues  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ 0    â”‚ cc_1    â”‚ âœ“ OK    â”‚ active   â”‚ -       â”‚\nâ”‚ 1    â”‚ cc_2    â”‚ âœ“ OK    â”‚ idle     â”‚ -       â”‚\nâ”‚ 2    â”‚ cod_1   â”‚ âš  WARN  â”‚ stale    â”‚ no output 5m â”‚\nâ”‚ 3    â”‚ gmi_1   â”‚ âœ— ERROR â”‚ crashed  â”‚ exit 1  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nOverall: 2 healthy, 1 warning, 1 error\n\n$ ntm health myproject --json\n{\n  \"session\": \"myproject\",\n  \"checked_at\": \"2025-12-10T10:00:00Z\",\n  \"agents\": [...],\n  \"summary\": {\"healthy\": 2, \"warning\": 1, \"error\": 1}\n}\n\n## Health Detection Logic\n\nProcess status:\n- Check if pane has running process (tmux list-panes -F '#{pane_pid}')\n- Check process state via /proc or ps\n\nActivity detection:\n- Capture pane content, compare over time\n- 'active': Content changed recently (\u003c 30s)\n- 'idle': No change, but process running (prompt visible)\n- 'stale': No change for extended period (\u003e 5m)\n\nError detection (regex patterns):\n- Rate limit: 'rate limit', '429', 'too many requests'\n- Auth error: 'authentication', 'unauthorized', '401'\n- Crash: 'error', 'exception', 'panic', exit codes\n\n## Implementation\n\n1. Create internal/health package\n2. Implement process status checker\n3. Implement activity detector\n4. Implement error pattern matcher\n5. Create ntm health command with TUI output\n6. Add --json support (depends on ntm-ws2)\n\n## Acceptance Criteria\n\n- [ ] ntm health shows all agents with status\n- [ ] Process crashes are detected\n- [ ] Rate limit patterns are detected\n- [ ] Activity level shown (active/idle/stale)\n- [ ] Exit code reflects overall health\n- [ ] --json output supported\n","status":"closed","priority":1,"issue_type":"task","assignee":"BlueBear","created_at":"2025-12-10T02:47:45.818258-05:00","updated_at":"2025-12-10T09:24:05.544229-05:00","closed_at":"2025-12-10T09:24:05.544229-05:00","dependencies":[{"issue_id":"ntm-239","depends_on_id":"ntm-laa","type":"blocks","created_at":"2025-12-10T02:47:45.818762-05:00","created_by":"daemon"}]}
{"id":"ntm-26c","title":"Feature: Context-Aware Compaction Recovery with bv","description":"","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-10T03:26:16.141944-05:00","updated_at":"2025-12-10T03:49:53.668645-05:00","closed_at":"2025-12-10T03:49:53.668645-05:00","dependencies":[{"issue_id":"ntm-26c","depends_on_id":"ntm-mxa","type":"blocks","created_at":"2025-12-10T03:26:28.526862-05:00","created_by":"daemon"}]}
{"id":"ntm-26o","title":"Feature: Unified Robot Protocol with bv Integration","description":"","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-10T03:26:05.509321-05:00","updated_at":"2025-12-10T03:41:26.142484-05:00","closed_at":"2025-12-10T03:41:26.142484-05:00","dependencies":[{"issue_id":"ntm-26o","depends_on_id":"ntm-mxa","type":"blocks","created_at":"2025-12-10T03:26:28.257343-05:00","created_by":"daemon"}]}
{"id":"ntm-2e9","title":"Implement stdin and --file support for ntm send","description":"Enable sending prompts from files and stdin pipes.\n\n## What This Task Does\n\nExtend ntm send to accept prompt content from:\n1. --file flag: Read prompt from a file\n2. stdin: When piped/redirected and no prompt argument given\n\n## Use Cases\n\nFrom file:\n$ ntm send myproject --all --file prompts/review.md\n\nFrom stdin (pipe):\n$ cat error.log | ntm send myproject --cc 'Analyze this error:'\n$ git diff | ntm send myproject --all 'Review these changes'\n\nFrom stdin (redirect):\n$ ntm send myproject --all \u003c prompt.txt\n\nCombined with prefix:\n$ cat code.py | ntm send myproject --cc --prefix 'Review this code:\\n'\n\n## Technical Details\n\nDetection logic:\n1. If --file specified, read from file\n2. Else if stdin is not a TTY, read from stdin\n3. Else use positional prompt argument\n\nImplementation:\nfunc getPromptContent(cmd *cobra.Command, args []string) (string, error) {\n    if file != \"\" {\n        content, err := os.ReadFile(file)\n        return string(content), err\n    }\n    \n    if !isatty.IsTerminal(os.Stdin.Fd()) {\n        content, err := io.ReadAll(os.Stdin)\n        return string(content), err\n    }\n    \n    if len(args) \u003e 1 {\n        return args[1], nil\n    }\n    \n    return \"\", errors.New(\"no prompt provided\")\n}\n\nNew flags:\n--file, -f    Read prompt from file\n--prefix      Text to prepend to file/stdin content\n--suffix      Text to append to file/stdin content\n\n## Edge Cases\n\n- Empty file: Error with helpful message\n- Binary file: Warning, but proceed if forced\n- Very large file: Stream rather than load all into memory? (future)\n- Encoding: Assume UTF-8\n\n## Acceptance Criteria\n\n- [ ] --file reads prompt from specified path\n- [ ] Stdin detected and read when not TTY\n- [ ] --prefix and --suffix work with file/stdin\n- [ ] Clear error messages for missing file, empty content\n- [ ] Existing behavior unchanged when neither used\n","status":"closed","priority":1,"issue_type":"task","assignee":"BlackSnow","created_at":"2025-12-10T02:47:24.408866-05:00","updated_at":"2025-12-10T09:18:13.80339-05:00","closed_at":"2025-12-10T09:18:13.80339-05:00","dependencies":[{"issue_id":"ntm-2e9","depends_on_id":"ntm-6pd","type":"blocks","created_at":"2025-12-10T02:47:24.410773-05:00","created_by":"daemon"}]}
{"id":"ntm-2ix","title":"Add dependency/blocker summary to recovery prompt","description":"","status":"closed","priority":0,"issue_type":"task","assignee":"ChartreuseLake","created_at":"2025-12-10T03:27:31.032614-05:00","updated_at":"2025-12-10T03:56:25.857441-05:00","closed_at":"2025-12-10T03:56:25.857441-05:00","dependencies":[{"issue_id":"ntm-2ix","depends_on_id":"ntm-9jj","type":"blocks","created_at":"2025-12-10T03:28:05.955438-05:00","created_by":"daemon"}]}
{"id":"ntm-2vm","title":"Add --recipe/-r flag to spawn command","description":"","status":"closed","priority":1,"issue_type":"task","assignee":"LilacMountain","created_at":"2025-12-10T02:42:21.432732-05:00","updated_at":"2025-12-10T03:57:49.78609-05:00","closed_at":"2025-12-10T03:57:49.78609-05:00","dependencies":[{"issue_id":"ntm-2vm","depends_on_id":"ntm-y93","type":"blocks","created_at":"2025-12-10T02:42:31.249555-05:00","created_by":"daemon"}]}
{"id":"ntm-33e","title":"Feature: Real-time Project Drift Monitoring","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T03:26:17.64897-05:00","updated_at":"2025-12-10T03:32:24.668456-05:00","closed_at":"2025-12-10T03:32:24.668456-05:00","dependencies":[{"issue_id":"ntm-33e","depends_on_id":"ntm-mxa","type":"blocks","created_at":"2025-12-10T03:26:28.608896-05:00","created_by":"daemon"}]}
{"id":"ntm-3bb","title":"Add graph position context (bottleneck/keystone status)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:31.589834-05:00","updated_at":"2025-12-10T03:52:10.34597-05:00","closed_at":"2025-12-10T03:52:10.34597-05:00","dependencies":[{"issue_id":"ntm-3bb","depends_on_id":"ntm-r2k","type":"blocks","created_at":"2025-12-10T03:28:06.191674-05:00","created_by":"daemon"},{"issue_id":"ntm-3bb","depends_on_id":"ntm-igpj","type":"blocks","created_at":"2025-12-10T03:32:50.829933-05:00","created_by":"daemon"}]}
{"id":"ntm-3ja0","title":"Implement checkpoint storage format","description":"# Implement checkpoint storage format\n\nDirectory structure for checkpoints.\nGit state capture (uncommitted changes as patch).\nSession state capture (agents, layout).\nPane scrollback capture.\nMetadata with timestamps and descriptions.","status":"closed","priority":1,"issue_type":"task","assignee":"ChartreuseHill","created_at":"2025-12-10T03:29:19.847613-05:00","updated_at":"2025-12-10T04:01:49.148684-05:00","closed_at":"2025-12-10T04:01:49.148684-05:00"}
{"id":"ntm-3kfx","title":"Add --robot-health for project health summary","description":"","status":"in_progress","priority":1,"issue_type":"task","assignee":"BlackLake","created_at":"2025-12-10T03:27:34.429035-05:00","updated_at":"2025-12-10T04:22:11.178572-05:00","dependencies":[{"issue_id":"ntm-3kfx","depends_on_id":"ntm-40fg","type":"blocks","created_at":"2025-12-10T03:28:07.825546-05:00","created_by":"daemon"},{"issue_id":"ntm-3kfx","depends_on_id":"ntm-igpj","type":"blocks","created_at":"2025-12-10T03:32:50.550669-05:00","created_by":"daemon"}]}
{"id":"ntm-3n9","title":"Implement agent type detection from pane content","description":"Improve agent type detection beyond pane title parsing.\n\n## Current State\ndetectAgentType() in robot.go only checks pane title. This is unreliable because:\n- Pane titles may not be set\n- Users may use custom titles\n- Agent type may not be in title\n\n## Improved Detection\n1. **Pane Title**: Check for 'claude', 'codex', 'gemini', etc.\n2. **Process Name**: Check running process (claude, codex-cli, etc.)\n3. **Pane Content**: Look for characteristic prompts/output:\n   - Claude: '\u003e' prompt, 'Claude' mentions\n   - Codex: 'codex\u003e' prompt, OpenAI references\n   - Gemini: Gemini-specific formatting\n   - Cursor: Cursor AI patterns\n   - Windsurf: Windsurf patterns\n   - Aider: 'aider\u003e' prompt\n4. **Environment**: Check for agent-specific env vars\n\n## Detection Priority\nProcess name \u003e Pane content \u003e Pane title \u003e Unknown\n\n## Caching\nCache detected type per pane to avoid repeated content parsing. Invalidate on session reload.\n\n## Output\n```go\ntype AgentDetection struct {\n    Type       string  // claude, codex, etc.\n    Confidence float64 // 0.0-1.0\n    Method     string  // how detected: process, content, title\n}\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:53:43.118071-05:00","updated_at":"2025-12-10T03:26:15.946452-05:00","closed_at":"2025-12-10T03:26:15.946452-05:00","comments":[{"id":11,"issue_id":"ntm-3n9","author":"jemanuel","text":"## Detection Strategies\n\n### Priority Order\n1. **Process-based** (highest confidence)\n   - ps aux | grep for process names: claude, codex-cli, gemini-cli\n   - Check /proc/{pid}/cmdline on Linux\n   - Most reliable but requires shell execution\n\n2. **Environment-based**\n   - Check for CLAUDE_*, OPENAI_*, GOOGLE_* env vars in pane\n   - Can infer agent type from env configuration\n\n3. **Content-based**\n   - Scan last N lines of pane output\n   - Look for characteristic patterns:\n     - Claude: '\u003e' prompt, 'Claude' in output, tool use XML\n     - Codex: 'codex\u003e' prompt, OpenAI references\n     - Gemini: 'gemini\u003e' prompt\n     - Aider: 'aider\u003e' or '/help' in prompt\n   \n4. **Title-based** (lowest confidence)\n   - Current implementation - fallback only\n\n### Caching Strategy\n```go\ntype AgentTypeCache struct {\n    cache map[string]CachedDetection // key: session:pane\n    ttl   time.Duration              // default 60s\n    mu    sync.RWMutex\n}\n\ntype CachedDetection struct {\n    Type       string\n    Confidence float64\n    Method     string\n    DetectedAt time.Time\n}\n```\n\n### Confidence Scores\n- Process match: 0.95\n- Env match: 0.85\n- Content match: 0.70\n- Title match: 0.50\n- Unknown: 0.0","created_at":"2025-12-10T07:55:48Z"}]}
{"id":"ntm-40fg","title":"Integrate bv drift detection into ntm watch mode","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:33.818218-05:00","updated_at":"2025-12-10T03:32:21.57383-05:00","closed_at":"2025-12-10T03:32:21.57383-05:00","dependencies":[{"issue_id":"ntm-40fg","depends_on_id":"ntm-33e","type":"blocks","created_at":"2025-12-10T03:28:07.409659-05:00","created_by":"daemon"},{"issue_id":"ntm-40fg","depends_on_id":"ntm-r2k","type":"blocks","created_at":"2025-12-10T03:28:07.48558-05:00","created_by":"daemon"}]}
{"id":"ntm-444","title":"Include what other agents are working on in recovery","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:31.1716-05:00","updated_at":"2025-12-10T03:57:52.406642-05:00","closed_at":"2025-12-10T03:57:52.406642-05:00","dependencies":[{"issue_id":"ntm-444","depends_on_id":"ntm-9jj","type":"blocks","created_at":"2025-12-10T03:28:06.038174-05:00","created_by":"daemon"}]}
{"id":"ntm-4cv","title":"Integration Test: CLI â†’ tmux (spawn, send, status)","description":"# Integration Test: CLI â†’ tmux\n\n## Scope\nTest that CLI commands correctly interact with tmux to create sessions, panes, and send keys.\n\n## Test Scenarios\n\n### Scenario 1: Spawn Command Integration\n```go\nfunc TestSpawnCreatesSession(t *testing.T) {\n    // Setup\n    sessionName := uniqueSessionName(t)\n    \n    // Execute\n    cmd := exec.Command(\"ntm\", \"spawn\", sessionName, \"--cc=2\", \"--cod=1\")\n    output, err := cmd.CombinedOutput()\n    require.NoError(t, err)\n    \n    // Verify\n    panes := tmux.GetPanes(sessionName)\n    assert.Len(t, panes, 4) // 3 agents + 1 user\n    assert.Contains(t, panes, \"cc_1\")\n    assert.Contains(t, panes, \"cc_2\")\n    assert.Contains(t, panes, \"cod_1\")\n}\n```\n\n### Scenario 2: Send Command Integration\n- Create session with agents\n- Send prompt via CLI\n- Verify prompt appears in pane output\n\n### Scenario 3: Status Command Integration\n- Create session with known state\n- Run ntm status --json\n- Verify JSON matches actual state\n\n### Scenario 4: Add Command Integration\n- Create session with 1 agent\n- Add 2 more via ntm add\n- Verify total pane count\n\n### Scenario 5: Kill Command Integration\n- Create session\n- Kill via CLI\n- Verify session destroyed\n\n## Implementation\n- tests/integration/cli_tmux_test.go\n- Use exec.Command to run ntm binary\n- Direct tmux calls to verify state\n- Cleanup in t.Cleanup()","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:22:36.511093-05:00","updated_at":"2025-12-10T03:22:36.511093-05:00","dependencies":[{"issue_id":"ntm-4cv","depends_on_id":"ntm-66c","type":"blocks","created_at":"2025-12-10T03:24:41.294133-05:00","created_by":"daemon"},{"issue_id":"ntm-4cv","depends_on_id":"ntm-7lk","type":"blocks","created_at":"2025-12-10T03:24:42.367483-05:00","created_by":"daemon"}]}
{"id":"ntm-4fb","title":"Unit Tests: internal/tui packages (0% â†’ 60%)","description":"# Unit Tests: internal/tui Packages\n\n## Current State\n- Coverage: 0.0% across all TUI subpackages\n- Packages: components, dashboard, icons, styles, theme\n\n## Test Approach\nTUI rendering is challenging to test deterministically. Focus on:\n1. Logic functions (non-rendering)\n2. State management\n3. View output contains expected elements\n\n## Package: internal/tui/theme (theme.go)\n\n### Theme Selection\n- [ ] TestCurrentTheme - returns current theme\n- [ ] TestSetTheme - changes theme\n- [ ] TestThemeMocha - Mocha colors correct\n- [ ] TestThemeMacchiato - Macchiato colors correct\n- [ ] TestThemeNord - Nord colors correct\n- [ ] TestThemeFromEnv - NTM_THEME env var\n\n### Color Access\n- [ ] TestAgentColor_Claude - returns Mauve\n- [ ] TestAgentColor_Codex - returns Blue\n- [ ] TestAgentColor_Gemini - returns Yellow\n- [ ] TestAgentColor_User - returns Green\n\n## Package: internal/tui/icons (icons.go)\n\n### Icon Detection\n- [ ] TestDetectIconSet - auto-detection logic\n- [ ] TestNerdFontsDetection - NERD_FONTS env\n- [ ] TestNTMIconsEnv - NTM_ICONS env\n- [ ] TestFallbackToUnicode - default behavior\n\n### Icon Access\n- [ ] TestGetIcon_Session - session icon\n- [ ] TestGetIcon_Pane - pane icon\n- [ ] TestGetIcon_AgentTypes - claude, codex, gemini\n- [ ] TestGetIcon_Status - check, cross, warning\n\n## Package: internal/tui/styles (styles.go)\n\n### Gradient Functions\n- [ ] TestGradient - linear gradient\n- [ ] TestGradientText - text with gradient\n- [ ] TestShimmer - shimmer effect\n- [ ] TestPulse - pulse effect\n- [ ] TestGlow - glow effect\n\n### Box Drawing\n- [ ] TestRenderBox_Rounded - rounded corners\n- [ ] TestRenderBox_Double - double lines\n- [ ] TestRenderBox_Heavy - heavy lines\n\n### Helper Functions\n- [ ] TestTruncate - text truncation\n- [ ] TestCenterText - centering\n- [ ] TestRightAlign - right alignment\n- [ ] TestBadge - badge rendering\n- [ ] TestKeyHint - key hint rendering\n\n## Package: internal/tui/components\n\n### banner.go\n- [ ] TestBannerRender - ASCII art banner\n- [ ] TestBannerGradient - gradient applied\n\n### box.go\n- [ ] TestBoxWithContent - content in box\n- [ ] TestBoxWithTitle - titled box\n\n### list.go\n- [ ] TestListNavigation - up/down\n- [ ] TestListSelection - item selection\n\n### preview.go\n- [ ] TestPreviewRender - preview content\n\n### progress.go\n- [ ] TestProgressBar - progress indicator\n\n### spinner.go\n- [ ] TestSpinnerFrames - animation frames\n\n## Package: internal/tui/dashboard\n\n### dashboard.go\n- [ ] TestDashboardModel - model creation\n- [ ] TestDashboardUpdate - state updates\n- [ ] TestDashboardPane - pane selection\n- [ ] TestDashboardRefresh - data refresh","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:00.228645-05:00","updated_at":"2025-12-10T03:22:00.228645-05:00","dependencies":[{"issue_id":"ntm-4fb","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:22:34.322854-05:00","created_by":"daemon"}]}
{"id":"ntm-4gi","title":"Add polling fallback for environments without fsnotify","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:43:42.678386-05:00","updated_at":"2025-12-10T02:43:42.678386-05:00","dependencies":[{"issue_id":"ntm-4gi","depends_on_id":"ntm-r1l","type":"blocks","created_at":"2025-12-10T02:44:00.044338-05:00","created_by":"daemon"}]}
{"id":"ntm-4ji","title":"Implement ntm context command","description":"# Implement ntm context Command\n\n## Purpose\n\nDisplay context window usage for all agents in a session.\n\n## Command Syntax\n\n```bash\nntm context myproject\nntm context myproject --json\nntm context myproject --watch  # Live updates\n```\n\n## Output Format\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Context Window Status: myproject                            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Pane          Model         Usage         Status            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ cc_1          opus          [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 62%  124k/200k     â”‚\nâ”‚ cc_2          sonnet        [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 89%  178k/200k âš ï¸  â”‚\nâ”‚ cod_1         gpt4          [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 31%   40k/128k     â”‚\nâ”‚ gmi_1         pro           [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  5%   50k/1M       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ âš ï¸ 1 agent above 80% threshold                              â”‚\nâ”‚ Recommendation: Consider compacting cc_2 or starting fresh  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Color Coding\n\n- Green: 0-60%\n- Yellow: 60-80%\n- Red: 80-100%\n\n## JSON Output\n\n```json\n{\n  \"session\": \"myproject\",\n  \"timestamp\": \"2025-12-10T15:30:00Z\",\n  \"agents\": [\n    {\n      \"pane\": \"cc_1\",\n      \"model\": \"opus\",\n      \"context_used\": 124000,\n      \"context_max\": 200000,\n      \"utilization_pct\": 62,\n      \"status\": \"ok\",\n      \"confidence\": 0.7\n    }\n  ],\n  \"warnings\": [\n    {\n      \"pane\": \"cc_2\",\n      \"message\": \"Context at 89%, approaching limit\",\n      \"recommendation\": \"Consider compaction or fresh start\"\n    }\n  ]\n}\n```\n\n## Watch Mode\n\n```bash\nntm context myproject --watch\n# Updates every 30s, clears and redraws\n# Ctrl+C to exit\n```\n\n## Acceptance Criteria\n\n- [ ] Command shows all agent context usage\n- [ ] Visual progress bars with color coding\n- [ ] Warning threshold at 80%\n- [ ] Recommendations for high usage\n- [ ] --json output for scripts\n- [ ] --watch mode for live monitoring\n- [ ] Confidence indicator for estimates","status":"in_progress","priority":1,"issue_type":"task","assignee":"RedStone","created_at":"2025-12-10T03:26:12.543844-05:00","updated_at":"2025-12-10T04:21:50.329458-05:00","dependencies":[{"issue_id":"ntm-4ji","depends_on_id":"ntm-jda","type":"blocks","created_at":"2025-12-10T03:26:23.414594-05:00","created_by":"daemon"}]}
{"id":"ntm-4nu","title":"EPIC: Agent Personas \u0026 Roles","description":"# Agent Personas \u0026 Roles\n\n## Background \u0026 Motivation\n\nCurrently, NTM spawns agents with identical configurations. But effective multi-agent workflows require specialization:\n\n- **Architect**: High-level design, system thinking, reviewing others' work\n- **Implementer**: Write code, follow specifications, move fast\n- **Reviewer**: Find bugs, security issues, suggest improvements\n- **Tester**: Write tests, verify edge cases, break things\n- **Documenter**: Write docs, comments, explain code\n\nEach role benefits from:\n1. **Different models**: Opus for architects, Sonnet for implementers\n2. **Different system prompts**: Prime the agent for their role\n3. **Different temperature/parameters**: Creative vs precise\n4. **Pre-loaded context**: Role-specific instructions\n\n## What Personas Provide\n\nA persona is a reusable agent configuration:\n```toml\n[personas.architect]\nagent_type = \"claude\"\nmodel = \"opus\"\nsystem_prompt = \"\"\"\nYou are a senior software architect. Focus on:\n- System design and high-level structure\n- Reviewing and guiding implementation\n- Identifying architectural risks\n- NOT writing implementation code (delegate that)\n\"\"\"\ntemperature = 0.7\ncontext_files = [\"ARCHITECTURE.md\", \"docs/design/*.md\"]\n\n[personas.implementer]\nagent_type = \"claude\"\nmodel = \"sonnet\"\nsystem_prompt = \"\"\"\nYou are an implementation engineer. Focus on:\n- Writing clean, tested code\n- Following the architect's design\n- Fast iteration and quick feedback\n- NOT architectural decisions (escalate to architect)\n\"\"\"\ntemperature = 0.3\n\n[personas.reviewer]\nagent_type = \"claude\"\nmodel = \"sonnet\"\nsystem_prompt = \"\"\"\nYou are a meticulous code reviewer. Focus on:\n- Finding bugs, edge cases, security issues\n- Suggesting improvements\n- Verifying tests exist and are comprehensive\n- Being constructive but thorough\n\"\"\"\ntemperature = 0.2\n```\n\n## Usage Syntax\n\n```bash\n# Spawn by persona\nntm spawn myproject --persona=architect --persona=implementer:2\n\n# Add persona agents\nntm add myproject --persona=reviewer\n\n# List available personas\nntm personas list\n\n# Show persona details\nntm personas show architect\n```\n\n## Relationship to Recipes\n\n- **Recipes**: Define SESSION layouts (which agents, how many)\n- **Personas**: Define AGENT configurations (model, prompt, behavior)\n\nThey complement each other:\n```toml\n[recipes.fullstack]\ndescription = \"Full-stack development team\"\nagents = [\n    { persona = \"architect\", count = 1 },\n    { persona = \"implementer\", count = 2 },\n    { persona = \"tester\", count = 1 }\n]\n```\n\n## System Prompt Injection\n\nThe persona's system_prompt prepended to agent launch:\n```bash\n# Generated command for persona=architect\nclaude --dangerously-skip-permissions --model opus \u003c\u003c 'SYSTEM_PROMPT'\nYou are a senior software architect. Focus on:\n- System design and high-level structure\n...\nSYSTEM_PROMPT\n```\n\nOr via Claude Code's prompt file mechanism if available.\n\n## Success Criteria\n\n- [ ] Persona configuration schema defined\n- [ ] spawn/add accept --persona flag\n- [ ] System prompts injected at agent launch\n- [ ] Built-in personas: architect, implementer, reviewer, tester, documenter\n- [ ] User-defined personas in config\n- [ ] Personas combinable with model specifiers\n- [ ] ntm personas list/show commands","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:22:44.942104-05:00","updated_at":"2025-12-10T03:22:44.942104-05:00","dependencies":[{"issue_id":"ntm-4nu","depends_on_id":"ntm-5zc","type":"blocks","created_at":"2025-12-10T03:29:39.047743-05:00","created_by":"daemon"}]}
{"id":"ntm-4op","title":"Unit Tests: internal/cli package (0% â†’ 80%)","description":"# Unit Tests: internal/cli Package\n\n## Current State\n- Coverage: 0.0%\n- Files: 20+ command files (spawn.go, send.go, add.go, etc.)\n\n## Test Approach\nThe CLI package uses Cobra commands. Testing without mocks requires:\n1. **Command execution tests** - Execute commands with real args, capture output\n2. **Flag parsing tests** - Verify flags are correctly parsed\n3. **Error condition tests** - Invalid args, missing dependencies\n\n## Test Cases by File\n\n### root.go\n- [ ] Test root command help output\n- [ ] Test --json flag parsing\n- [ ] Test version info exposure\n- [ ] Test config loading integration\n\n### spawn.go\n- [ ] Test session name validation\n- [ ] Test agent count flags (--cc, --cod, --gmi)\n- [ ] Test error when no agents specified\n- [ ] Test working directory handling\n- [ ] Test with real tmux (if available)\n\n### send.go\n- [ ] Test target filtering (--all, --cc, --cod, --gmi)\n- [ ] Test prompt delivery to real panes\n- [ ] Test --pane=N targeting\n- [ ] Test interrupt command\n\n### add.go\n- [ ] Test adding agents to existing session\n- [ ] Test error on non-existent session\n- [ ] Test agent numbering continuation\n\n### status.go\n- [ ] Test text output format\n- [ ] Test JSON output format\n- [ ] Test with real sessions\n\n### list.go\n- [ ] Test listing all sessions\n- [ ] Test JSON output\n\n### quick.go\n- [ ] Test directory creation\n- [ ] Test git init\n- [ ] Test template application (go, python, node, rust)\n- [ ] Test .vscode directory creation\n- [ ] Test .claude directory creation\n\n### Other commands\n- [ ] attach.go - session attachment\n- [ ] view.go - tiled layout\n- [ ] zoom.go - pane zooming\n- [ ] copy.go - output capture\n- [ ] save.go - output saving\n- [ ] bind.go - keybinding setup\n- [ ] kill.go - session termination\n- [ ] deps.go - dependency checking\n- [ ] config.go - config management\n- [ ] help.go - help rendering\n- [ ] init.go - shell integration\n- [ ] dashboard.go - dashboard launch\n- [ ] palette.go - palette launch\n- [ ] tutorial.go - tutorial launch\n- [ ] upgrade.go - self-update\n\n## Implementation Notes\n- Use t.Skip() if tmux not available\n- Create unique session names per test\n- Clean up sessions in t.Cleanup()\n- Use bytes.Buffer for output capture","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:19:33.768203-05:00","updated_at":"2025-12-10T03:41:44.485299-05:00","closed_at":"2025-12-10T03:41:44.485299-05:00","dependencies":[{"issue_id":"ntm-4op","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:22:33.513331-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp","title":"EPIC: Agent Observability \u0026 Status Monitoring","description":"Enable users to understand what their agents are doing without attaching to tmux.\n\n## Problem Statement\nCurrently, NTM users have no visibility into agent state without manually attaching to the tmux session and visually inspecting each pane. This creates friction in multi-agent workflows:\n- Can't tell if an agent is actively working, idle waiting for input, or crashed\n- No way to monitor progress without context-switching to tmux\n- Error conditions (rate limits, crashes) go unnoticed until manually discovered\n- Dashboard shows static info (pane dimensions, command) but not live activity\n\n## Goals\n1. Detect and display agent status (idle/working/error) across all NTM commands\n2. Enable real-time monitoring via enhanced dashboard and watch mode\n3. Proactively detect and alert on error conditions\n4. Reduce need to attach to tmux for routine status checks\n\n## Success Criteria\n- `ntm status` shows live agent states with visual indicators\n- Dashboard auto-refreshes and shows activity/output previews\n- `ntm watch` streams output without requiring tmux attach\n- Common errors (rate limits, crashes) are detected and surfaced\n\n## Technical Approach\n- Use tmux's pane activity detection and output capture APIs\n- Parse captured output for prompt patterns (idle) and error signatures\n- Implement polling-based updates with configurable intervals\n- Add notification hooks for error conditions\n\n## User Value\n- Faster feedback loop when orchestrating multiple agents\n- Earlier detection of problems (rate limits, crashes)\n- Reduced context switching between terminal and tmux\n- Better understanding of agent utilization","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T02:36:16.851593-05:00","updated_at":"2025-12-10T02:36:16.851593-05:00"}
{"id":"ntm-4pp.1","title":"Agent Status Detection System","description":"Core infrastructure to detect whether agents are idle, working, or in error state.\n\n## Overview\nThis is the foundational feature for all observability. It provides the ability to programmatically determine an agent's current state by analyzing tmux pane activity and output patterns.\n\n## States to Detect\n1. **IDLE** (âšª) - Agent is at a prompt, waiting for input\n   - Detection: Last line matches prompt pattern (e.g., `$ `, `\u003e `, `claude\u003e`)\n   - No output in last N seconds\n   \n2. **WORKING** (ğŸŸ¢) - Agent is actively producing output\n   - Detection: Output activity within last N seconds\n   - Scrollback is growing\n   \n3. **ERROR** (ğŸ”´) - Agent encountered a problem\n   - Detection: Output matches error patterns (rate limit, crash, etc.)\n   - Process may have exited\n   \n4. **UNKNOWN** (âš«) - Cannot determine state\n   - Fallback when detection fails\n\n## Technical Implementation\n\n### Pane Activity Detection\n```go\n// Use tmux's pane_last_activity format\nfunc GetPaneActivity(paneID string) (time.Time, error) {\n    out := tmux(\"display-message\", \"-p\", \"-t\", paneID, \n                \"#{pane_last_activity}\")\n    return time.Parse(out)\n}\n```\n\n### Prompt Pattern Matching\nDetect idle by matching last line against known prompts:\n- Claude: `claude\u003e`, `Claude\u003e`\n- Codex: `codex\u003e`, `$ `\n- Gemini: `gemini\u003e`\n- Shell: `$ `, `% `, `â¯ `\n\n### Error Pattern Database\nKnown error signatures:\n- \"rate limit\" / \"429\" / \"too many requests\"\n- \"error:\" / \"Error:\" / \"ERROR\"  \n- \"connection refused\" / \"timeout\"\n- \"panic:\" / \"fatal:\"\n\n## API Design\n```go\ntype AgentState string\nconst (\n    StateIdle    AgentState = \"idle\"\n    StateWorking AgentState = \"working\"\n    StateError   AgentState = \"error\"\n    StateUnknown AgentState = \"unknown\"\n)\n\ntype AgentStatus struct {\n    PaneID      string\n    Name        string\n    State       AgentState\n    LastActive  time.Time\n    LastOutput  string      // Last N chars of output\n    ErrorType   string      // If State==Error, what kind\n}\n\nfunc DetectAgentStatus(pane Pane) AgentStatus\n```\n\n## Files to Create/Modify\n- NEW: internal/status/detector.go - Core detection logic\n- NEW: internal/status/patterns.go - Prompt/error patterns\n- MOD: internal/tmux/session.go - Add activity queries\n\n## Testing Strategy\n- Unit tests with mock tmux output\n- Integration tests with real tmux panes\n- Edge cases: empty panes, binary output, unicode","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T02:38:32.443216-05:00","updated_at":"2025-12-10T03:47:00.505816-05:00","closed_at":"2025-12-10T03:47:00.505816-05:00","dependencies":[{"issue_id":"ntm-4pp.1","depends_on_id":"ntm-4pp","type":"parent-child","created_at":"2025-12-10T02:38:32.443583-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.1.1","title":"Create internal/status package structure","description":"Set up the new status package with core types and interfaces.\n\n## Deliverables\n1. Create internal/status/ directory\n2. Define core types in types.go\n3. Define detector interface in detector.go\n\n## Files to Create\n\n### internal/status/types.go\n```go\npackage status\n\nimport \"time\"\n\n// AgentState represents the current state of an agent\ntype AgentState string\n\nconst (\n    StateIdle    AgentState = \"idle\"     // Waiting for input\n    StateWorking AgentState = \"working\"  // Producing output\n    StateError   AgentState = \"error\"    // Error condition detected\n    StateUnknown AgentState = \"unknown\"  // Cannot determine\n)\n\n// ErrorType categorizes detected errors\ntype ErrorType string\n\nconst (\n    ErrorNone       ErrorType = \"\"\n    ErrorRateLimit  ErrorType = \"rate_limit\"\n    ErrorCrash      ErrorType = \"crash\"\n    ErrorAuth       ErrorType = \"auth\"\n    ErrorConnection ErrorType = \"connection\"\n    ErrorGeneric    ErrorType = \"error\"\n)\n\n// AgentStatus represents the full status of an agent pane\ntype AgentStatus struct {\n    PaneID     string       // tmux pane ID\n    PaneName   string       // e.g., \"myproject__cc_1\"\n    AgentType  string       // \"cc\", \"cod\", \"gmi\", \"user\"\n    State      AgentState\n    ErrorType  ErrorType    // If State == StateError\n    LastActive time.Time    // Last output activity\n    LastOutput string       // Last N chars of output (for preview)\n    UpdatedAt  time.Time    // When this status was computed\n}\n\n// StateIcon returns the visual indicator for a state\nfunc (s AgentState) Icon() string {\n    switch s {\n    case StateIdle:\n        return \"âšª\"\n    case StateWorking:\n        return \"ğŸŸ¢\"\n    case StateError:\n        return \"ğŸ”´\"\n    default:\n        return \"âš«\"\n    }\n}\n```\n\n### internal/status/detector.go\n```go\npackage status\n\n// Detector detects agent status from tmux pane state\ntype Detector interface {\n    // Detect returns the current status of a single pane\n    Detect(paneID string) (AgentStatus, error)\n    \n    // DetectAll returns status for all panes in a session\n    DetectAll(session string) ([]AgentStatus, error)\n}\n```\n\n## Acceptance Criteria\n- [ ] Package compiles without errors\n- [ ] Types are well-documented with comments\n- [ ] Icons render correctly in terminal","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:45:04.283028-05:00","updated_at":"2025-12-10T03:12:27.43847-05:00","closed_at":"2025-12-10T03:12:27.43847-05:00","dependencies":[{"issue_id":"ntm-4pp.1.1","depends_on_id":"ntm-4pp.1","type":"parent-child","created_at":"2025-12-10T02:45:04.283904-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.1.2","title":"Implement prompt pattern matching for idle detection","description":"Create pattern matchers to detect when an agent is at a prompt (idle state).\n\n## Overview\nAgents show different prompts when waiting for input. We need to detect these patterns to determine idle state.\n\n## Known Prompt Patterns\n\n### Claude Code\n- `claude\u003e` or `Claude\u003e`  \n- Sometimes shows working directory in prompt\n\n### Codex CLI\n- `codex\u003e` or `Codex\u003e`\n- `$ ` (shell prompt after command)\n\n### Gemini CLI\n- `gemini\u003e` or `Gemini\u003e`\n\n### Shell (user pane)\n- `$ ` \n- `% `\n- `â¯ `\n- May include username, hostname, path\n\n## Implementation\n\n### internal/status/patterns.go\n```go\npackage status\n\nimport (\n    \"regexp\"\n    \"strings\"\n)\n\n// PromptPattern defines a pattern for detecting idle state\ntype PromptPattern struct {\n    AgentType string         // Which agent type this applies to\n    Regex     *regexp.Regexp // Pattern to match\n    Literal   string         // Or simple literal match\n}\n\nvar promptPatterns = []PromptPattern{\n    // Claude\n    {AgentType: \"cc\", Regex: regexp.MustCompile(`(?i)claude\u003e\\s*$`)},\n    \n    // Codex\n    {AgentType: \"cod\", Regex: regexp.MustCompile(`(?i)codex\u003e\\s*$`)},\n    {AgentType: \"cod\", Literal: \"$ \"},\n    \n    // Gemini\n    {AgentType: \"gmi\", Regex: regexp.MustCompile(`(?i)gemini\u003e\\s*$`)},\n    \n    // Generic shell prompts (for user panes)\n    {AgentType: \"user\", Regex: regexp.MustCompile(`[$%â¯\u003e]\\s*$`)},\n}\n\n// IsPromptLine checks if a line looks like a prompt\nfunc IsPromptLine(line string, agentType string) bool {\n    line = strings.TrimSpace(line)\n    if line == \"\" {\n        return false\n    }\n    \n    for _, p := range promptPatterns {\n        if p.AgentType \\!= \"\" \u0026\u0026 p.AgentType \\!= agentType {\n            continue\n        }\n        \n        if p.Regex \\!= nil \u0026\u0026 p.Regex.MatchString(line) {\n            return true\n        }\n        if p.Literal \\!= \"\" \u0026\u0026 strings.HasSuffix(line, p.Literal) {\n            return true\n        }\n    }\n    \n    return false\n}\n\n// DetectIdleFromOutput analyzes output to determine if agent is idle\nfunc DetectIdleFromOutput(output string, agentType string) bool {\n    lines := strings.Split(output, \"\\n\")\n    if len(lines) == 0 {\n        return false\n    }\n    \n    // Check last non-empty line\n    for i := len(lines) - 1; i \u003e= 0; i-- {\n        line := strings.TrimSpace(lines[i])\n        if line \\!= \"\" {\n            return IsPromptLine(line, agentType)\n        }\n    }\n    \n    return false\n}\n```\n\n## Testing\nCreate test cases with actual output samples from each agent type.\n\n## Acceptance Criteria\n- [ ] Correctly detects Claude prompt\n- [ ] Correctly detects Codex prompt  \n- [ ] Correctly detects Gemini prompt\n- [ ] Correctly detects shell prompts\n- [ ] Handles edge cases (ANSI codes, partial prompts)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:45:26.069089-05:00","updated_at":"2025-12-10T03:15:03.273685-05:00","closed_at":"2025-12-10T03:15:03.273685-05:00","dependencies":[{"issue_id":"ntm-4pp.1.2","depends_on_id":"ntm-4pp.1","type":"parent-child","created_at":"2025-12-10T02:45:26.07011-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.1.2","depends_on_id":"ntm-4pp.1.1","type":"blocks","created_at":"2025-12-10T02:45:26.071646-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.1.3","title":"Implement error pattern detection","description":"Create pattern matchers to detect error conditions in agent output.\n\n## Error Categories\n\n### Rate Limiting\n```\nPatterns to match:\n- \"rate limit\" (case insensitive)\n- \"429\"\n- \"Too Many Requests\"\n- \"quota exceeded\"\n- \"try again later\"\n- \"requests per minute\"\n```\n\n### Connection Errors\n```\nPatterns:\n- \"connection refused\"\n- \"connection reset\"\n- \"connection timed out\"\n- \"ECONNREFUSED\"\n- \"ETIMEDOUT\"\n- \"network error\"\n```\n\n### Authentication Errors\n```\nPatterns:\n- \"401\"\n- \"403\"\n- \"unauthorized\"\n- \"forbidden\"\n- \"invalid.*token\"\n- \"expired.*token\"\n- \"authentication failed\"\n```\n\n### Crashes/Panics\n```\nPatterns:\n- \"panic:\"\n- \"fatal:\"\n- \"segmentation fault\"\n- \"Traceback (most recent\"\n- \"Exception:\"\n```\n\n## Implementation\n\n### internal/status/errors.go\n```go\npackage status\n\nimport (\n    \"regexp\"\n    \"strings\"\n)\n\n// ErrorPattern defines a pattern for error detection\ntype ErrorPattern struct {\n    Type    ErrorType\n    Regex   *regexp.Regexp\n    Literal string\n}\n\nvar errorPatterns = []ErrorPattern{\n    // Rate limiting\n    {Type: ErrorRateLimit, Regex: regexp.MustCompile(`(?i)rate.?limit`)},\n    {Type: ErrorRateLimit, Literal: \"429\"},\n    {Type: ErrorRateLimit, Regex: regexp.MustCompile(`(?i)too many requests`)},\n    {Type: ErrorRateLimit, Regex: regexp.MustCompile(`(?i)quota exceeded`)},\n    \n    // Connection\n    {Type: ErrorConnection, Regex: regexp.MustCompile(`(?i)connection (refused|reset|timed? ?out)`)},\n    {Type: ErrorConnection, Literal: \"ECONNREFUSED\"},\n    {Type: ErrorConnection, Regex: regexp.MustCompile(`(?i)network error`)},\n    \n    // Auth\n    {Type: ErrorAuth, Literal: \"401\"},\n    {Type: ErrorAuth, Literal: \"403\"},\n    {Type: ErrorAuth, Regex: regexp.MustCompile(`(?i)unauthorized|forbidden`)},\n    {Type: ErrorAuth, Regex: regexp.MustCompile(`(?i)(invalid|expired).{0,10}token`)},\n    \n    // Crash\n    {Type: ErrorCrash, Literal: \"panic:\"},\n    {Type: ErrorCrash, Literal: \"fatal:\"},\n    {Type: ErrorCrash, Literal: \"Traceback (most recent\"},\n}\n\n// DetectErrorInOutput scans output for known error patterns\nfunc DetectErrorInOutput(output string) ErrorType {\n    // Check recent output only (last 50 lines)\n    lines := strings.Split(output, \"\\n\")\n    start := len(lines) - 50\n    if start \u003c 0 {\n        start = 0\n    }\n    recent := strings.Join(lines[start:], \"\\n\")\n    \n    for _, p := range errorPatterns {\n        if p.Regex != nil \u0026\u0026 p.Regex.MatchString(recent) {\n            return p.Type\n        }\n        if p.Literal != \"\" \u0026\u0026 strings.Contains(recent, p.Literal) {\n            return p.Type\n        }\n    }\n    \n    return ErrorNone\n}\n\n// ErrorMessage returns a human-readable description\nfunc (e ErrorType) Message() string {\n    switch e {\n    case ErrorRateLimit:\n        return \"Rate limited - too many requests\"\n    case ErrorConnection:\n        return \"Connection error\"\n    case ErrorAuth:\n        return \"Authentication error\"\n    case ErrorCrash:\n        return \"Agent crashed\"\n    case ErrorGeneric:\n        return \"Error detected\"\n    default:\n        return \"\"\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Detects rate limit errors\n- [ ] Detects connection errors\n- [ ] Detects auth errors\n- [ ] Detects crashes/panics\n- [ ] Prioritizes most specific error type\n- [ ] Only scans recent output (performance)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:45:52.838179-05:00","updated_at":"2025-12-10T03:18:27.847402-05:00","closed_at":"2025-12-10T03:18:27.847402-05:00","dependencies":[{"issue_id":"ntm-4pp.1.3","depends_on_id":"ntm-4pp.1","type":"parent-child","created_at":"2025-12-10T02:45:52.838884-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.1.3","depends_on_id":"ntm-4pp.1.1","type":"blocks","created_at":"2025-12-10T02:45:52.839528-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.1.4","title":"Implement tmux pane activity queries","description":"Add tmux wrapper functions to query pane activity timestamps.\n\n## New Functions Needed in internal/tmux/session.go\n\n### GetPaneActivity\nQuery when a pane last had output activity.\n\n```go\n// GetPaneActivity returns the last activity time for a pane\nfunc GetPaneActivity(paneID string) (time.Time, error) {\n    // tmux display-message -p -t {paneID} '#{pane_last_activity}'\n    // Returns Unix timestamp\n    \n    out, err := runTmux(\"display-message\", \"-p\", \"-t\", paneID,\n                        \"#{pane_last_activity}\")\n    if err != nil {\n        return time.Time{}, err\n    }\n    \n    ts, err := strconv.ParseInt(strings.TrimSpace(out), 10, 64)\n    if err != nil {\n        return time.Time{}, err\n    }\n    \n    return time.Unix(ts, 0), nil\n}\n```\n\n### GetPaneDetails\nGet extended pane metadata for status detection.\n\n```go\ntype PaneDetails struct {\n    ID              string\n    Title           string\n    CurrentCommand  string    // What's running in the pane\n    LastActivity    time.Time\n    Width, Height   int\n    Active          bool      // Is this the active pane?\n}\n\nfunc GetPaneDetails(sessionName string) ([]PaneDetails, error) {\n    // Use tmux list-panes with format string to get all details in one call\n    format := \"#{pane_id}|#{pane_title}|#{pane_current_command}|\" +\n              \"#{pane_last_activity}|#{pane_width}|#{pane_height}|#{pane_active}\"\n    \n    out, err := runTmux(\"list-panes\", \"-t\", sessionName, \"-F\", format)\n    // ... parse output ...\n}\n```\n\n### IsRecentlyActive\nHelper to check if pane had activity within threshold.\n\n```go\nfunc IsRecentlyActive(paneID string, threshold time.Duration) (bool, error) {\n    lastActive, err := GetPaneActivity(paneID)\n    if err != nil {\n        return false, err\n    }\n    return time.Since(lastActive) \u003c threshold, nil\n}\n```\n\n## Testing\n- Test with real tmux session\n- Test with invalid pane IDs\n- Test edge cases (newly created pane, no activity)\n\n## Acceptance Criteria\n- [ ] GetPaneActivity returns correct timestamps\n- [ ] GetPaneDetails returns all metadata in single tmux call\n- [ ] Functions handle errors gracefully\n- [ ] Works with both pane IDs and pane targets (session:window.pane)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:46:18.502168-05:00","updated_at":"2025-12-10T03:22:27.121651-05:00","closed_at":"2025-12-10T03:22:27.121651-05:00","dependencies":[{"issue_id":"ntm-4pp.1.4","depends_on_id":"ntm-4pp.1","type":"parent-child","created_at":"2025-12-10T02:46:18.502509-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.1.4","depends_on_id":"ntm-4pp.1.1","type":"blocks","created_at":"2025-12-10T02:46:18.502986-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.1.5","title":"Implement unified status detector","description":"Combine activity, prompt, and error detection into unified detector.\n\n## Overview\nThis is the main integration point that combines all detection signals to produce a final AgentStatus.\n\n## Detection Logic\n\n```go\n// internal/status/unified.go\npackage status\n\nimport (\n    \"time\"\n    \"github.com/Dicklesworthstone/ntm/internal/tmux\"\n)\n\n// UnifiedDetector implements the Detector interface\ntype UnifiedDetector struct {\n    // Configuration\n    ActivityThreshold time.Duration // How recent is \"active\" (default: 5s)\n    OutputLines       int           // Lines to capture for analysis (default: 50)\n}\n\nfunc NewDetector() *UnifiedDetector {\n    return \u0026UnifiedDetector{\n        ActivityThreshold: 5 * time.Second,\n        OutputLines:       50,\n    }\n}\n\nfunc (d *UnifiedDetector) Detect(paneID string) (AgentStatus, error) {\n    status := AgentStatus{\n        PaneID:    paneID,\n        UpdatedAt: time.Now(),\n        State:     StateUnknown,\n    }\n    \n    // Get pane details\n    details, err := tmux.GetPaneDetails(paneID)\n    if err != nil {\n        return status, err\n    }\n    status.PaneName = details.Title\n    status.AgentType = detectAgentType(details.Title)\n    status.LastActive = details.LastActivity\n    \n    // Capture recent output\n    output, err := tmux.CapturePaneOutput(paneID, d.OutputLines)\n    if err != nil {\n        return status, err\n    }\n    status.LastOutput = truncate(output, 200)\n    \n    // Detection priority:\n    // 1. Check for errors first (most important)\n    // 2. Check for idle (at prompt)\n    // 3. Check activity recency (working vs unknown)\n    \n    // Check for errors\n    if errType := DetectErrorInOutput(output); errType != ErrorNone {\n        status.State = StateError\n        status.ErrorType = errType\n        return status, nil\n    }\n    \n    // Check if at prompt (idle)\n    if DetectIdleFromOutput(output, status.AgentType) {\n        status.State = StateIdle\n        return status, nil\n    }\n    \n    // Check recent activity\n    if time.Since(status.LastActive) \u003c d.ActivityThreshold {\n        status.State = StateWorking\n        return status, nil\n    }\n    \n    // Default to unknown if can't determine\n    status.State = StateUnknown\n    return status, nil\n}\n\nfunc (d *UnifiedDetector) DetectAll(session string) ([]AgentStatus, error) {\n    panes, err := tmux.GetPanes(session)\n    if err != nil {\n        return nil, err\n    }\n    \n    var statuses []AgentStatus\n    for _, pane := range panes {\n        s, err := d.Detect(pane.ID)\n        if err != nil {\n            // Log but continue\n            s.State = StateUnknown\n        }\n        statuses = append(statuses, s)\n    }\n    \n    return statuses, nil\n}\n\nfunc detectAgentType(paneName string) string {\n    // Parse from pane name pattern: session__type_num\n    // e.g., \"myproject__cc_1\" -\u003e \"cc\"\n    // This logic already exists in tmux package\n    return tmux.DetectAgentType(paneName)\n}\n\nfunc truncate(s string, maxLen int) string {\n    if len(s) \u003c= maxLen {\n        return s\n    }\n    return s[len(s)-maxLen:]\n}\n```\n\n## Acceptance Criteria\n- [ ] Correctly prioritizes error \u003e idle \u003e working \u003e unknown\n- [ ] Uses configurable thresholds\n- [ ] DetectAll handles errors gracefully (one bad pane doesn't fail all)\n- [ ] Performance is acceptable (\u003c 100ms for typical session)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:46:48.044289-05:00","updated_at":"2025-12-10T03:25:10.42981-05:00","closed_at":"2025-12-10T03:25:10.42981-05:00","dependencies":[{"issue_id":"ntm-4pp.1.5","depends_on_id":"ntm-4pp.1","type":"parent-child","created_at":"2025-12-10T02:46:48.044962-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.1.5","depends_on_id":"ntm-4pp.1.2","type":"blocks","created_at":"2025-12-10T02:46:48.045649-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.1.5","depends_on_id":"ntm-4pp.1.3","type":"blocks","created_at":"2025-12-10T02:46:48.046448-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.1.5","depends_on_id":"ntm-4pp.1.4","type":"blocks","created_at":"2025-12-10T02:46:48.047001-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.1.6","title":"Integrate status detection into ntm status command","description":"Update the existing `ntm status` command to display agent status indicators.\n\n## Current State\n`ntm status` shows basic session/pane info.\n\n## Enhancement\nAdd status column showing agent state: idle, working, error, rate_limited, etc.\n\n## Implementation\n```go\nfunc runStatus(cmd *cobra.Command, args []string) error {\n    sessions, err := tmux.ListSessions()\n    if err != nil {\n        return err\n    }\n    \n    for _, session := range sessions {\n        panes, err := tmux.GetPanes(session.Name)\n        if err != nil {\n            continue\n        }\n        \n        fmt.Printf(\"Session: %s\\n\", session.Name)\n        for _, pane := range panes {\n            // Get agent status\n            detector := status.NewDetector(cfg)\n            agentStatus := detector.DetectStatus(session.Name, pane.Index)\n            \n            statusIcon := agentStatus.Icon()  // âœ“, â³, âš , âœ—\n            statusColor := agentStatus.Color() // green, yellow, red\n            \n            fmt.Printf(\"  %s %s: %s\\n\", \n                statusIcon, \n                pane.Title, \n                agentStatus.String())\n        }\n    }\n    return nil\n}\n```\n\n## Output Format\n```\nSession: myproject\n  âœ“ cc_1: idle (waiting for input)\n  â³ cc_2: working (active for 2m)\n  âš  cod_1: rate_limited (retry in 45s)\n  âœ— gmi_1: error (auth failed)\n```\n\n## JSON Output (--json)\n```json\n{\n  \"sessions\": [{\n    \"name\": \"myproject\",\n    \"panes\": [\n      {\"title\": \"cc_1\", \"status\": \"idle\", \"details\": \"waiting for input\"},\n      {\"title\": \"cc_2\", \"status\": \"working\", \"active_for\": \"2m\"},\n      {\"title\": \"cod_1\", \"status\": \"rate_limited\", \"retry_in\": 45},\n      {\"title\": \"gmi_1\", \"status\": \"error\", \"error\": \"auth failed\"}\n    ]\n  }]\n}\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:55:11.927439-05:00","updated_at":"2025-12-10T03:46:45.256265-05:00","closed_at":"2025-12-10T03:46:45.256265-05:00","dependencies":[{"issue_id":"ntm-4pp.1.6","depends_on_id":"ntm-4pp.1","type":"parent-child","created_at":"2025-12-10T02:55:11.928347-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.1.6","depends_on_id":"ntm-4pp.1.5","type":"blocks","created_at":"2025-12-10T02:55:11.9305-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.2","title":"Enhanced Real-time Dashboard","description":"Upgrade the existing dashboard TUI with live updates, status indicators, and output previews.\n\n## Current State (internal/tui/dashboard/)\nThe existing dashboard shows:\n- Pane cards with title, index, dimensions, command\n- Agent type detection with colored borders\n- Stats bar with agent counts\n- Manual refresh only (press 'r')\n\n## Enhancements\n\n### 1. Live Status Indicators\nShow real-time state in each card:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ ó°—£ cc_1    ğŸŸ¢    â”‚  â† Status dot\nâ”‚ Working on...   â”‚  â† Activity hint\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚ \u003e implementing  â”‚  â† Output preview\nâ”‚   JWT tokens... â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 2. Auto-Refresh\n- Poll status every N seconds (configurable, default 2s)\n- Visual indication of last refresh time\n- Option to pause auto-refresh\n\n### 3. Output Preview\n- Show last 3-5 lines of pane output in each card\n- Truncate long lines gracefully\n- Handle ANSI color codes\n\n### 4. Activity Metrics\n- Show aggregate status: \"3 active, 2 idle, 1 error\"\n- Highlight panes with errors\n- Show time since last activity per pane\n\n## Technical Approach\n\n### Polling Architecture\n```go\nfunc (m Model) pollStatus() tea.Cmd {\n    return tea.Tick(m.refreshInterval, func(t time.Time) tea.Msg {\n        statuses := status.DetectAll(m.session)\n        return StatusUpdateMsg{Statuses: statuses, Time: t}\n    })\n}\n```\n\n### Output Capture\n```go\nfunc (m Model) capturePreview(pane Pane) string {\n    output := tmux.CapturePaneOutput(pane.ID, 5) // Last 5 lines\n    return truncateLines(output, m.cardWidth-4)\n}\n```\n\n## UI/UX Considerations\n- Don't flicker on refresh (diff-based updates)\n- Subtle animation for state transitions\n- Clear visual hierarchy (status most prominent)\n- Keyboard shortcuts for common actions\n\n## Files to Modify\n- internal/tui/dashboard/dashboard.go - Main model\n- internal/tui/dashboard/card.go - Individual pane cards (new)\n- internal/cli/dashboard.go - CLI integration\n\n## Dependencies\n- Requires: Agent Status Detection System (ntm-4pp.1)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T02:38:59.614288-05:00","updated_at":"2025-12-10T04:21:11.466877-05:00","closed_at":"2025-12-10T04:21:11.466877-05:00","dependencies":[{"issue_id":"ntm-4pp.2","depends_on_id":"ntm-4pp","type":"parent-child","created_at":"2025-12-10T02:38:59.6148-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.2","depends_on_id":"ntm-4pp.1","type":"blocks","created_at":"2025-12-10T02:38:59.615297-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.3","title":"Watch Mode - Stream Agent Output","description":"New `ntm watch` command to stream agent output to terminal without tmux attach.\n\n## Use Case\nMonitor agent activity in a separate terminal while working elsewhere.\nNo need to attach to tmux session - output streams directly.\n\n## Command Interface\n```bash\nntm watch myproject              # Stream all panes\nntm watch myproject --cc         # Only Claude agents\nntm watch myproject --cod        # Only Codex agents\nntm watch myproject --pane=cc_1  # Specific pane\nntm watch myproject --activity   # Only show when output appears\nntm watch myproject --tail=50    # Start with last 50 lines\n```\n\n## Output Format\n```\n[cc_1 10:32:15] Creating AuthService class...\n[cc_1 10:32:16] def authenticate(self, token):\n[cc_1 10:32:17]     ...\n[cod_1 10:32:18] Running tests...\n[cod_1 10:32:19] âœ“ 14 passed, 0 failed\n```\n\n## Technical Implementation\n\n### Streaming Architecture\nTwo approaches:\n\n**Option A: Polling with Diff**\n```go\nfunc watchLoop(session string, interval time.Duration) {\n    lastOutput := make(map[string]string)\n    for {\n        for _, pane := range getPanes(session) {\n            current := captureOutput(pane, 100)\n            if diff := computeDiff(lastOutput[pane.ID], current); diff \\!= \"\" {\n                printWithPrefix(pane.Name, diff)\n            }\n            lastOutput[pane.ID] = current\n        }\n        time.Sleep(interval)\n    }\n}\n```\n\n**Option B: tmux pipe-pane** (preferred)\n```bash\ntmux pipe-pane -t \"session:pane\" \"cat \u003e\u003e /tmp/pane.log\"\n# Then tail -f the log\n```\n\n### Diff Detection\nOnly show NEW output since last check:\n1. Hash previous output\n2. Find common suffix\n3. Print only the delta\n\n### Color Coding\n- Each pane gets consistent color\n- Errors highlighted in red\n- Status changes announced\n\n## Flags\n| Flag | Description |\n|------|-------------|\n| --cc, --cod, --gmi | Filter by agent type |\n| --pane | Specific pane name |\n| --activity | Only print on new output |\n| --tail N | Start with last N lines |\n| --no-color | Disable colors |\n| --timestamps | Show timestamps (default: on) |\n\n## Files to Create\n- internal/cli/watch.go - Command implementation\n- internal/watch/streamer.go - Streaming logic\n- internal/watch/diff.go - Output diffing\n\n## Exit Behavior\n- Ctrl+C gracefully stops watching\n- Clean up any pipe-pane hooks","status":"closed","priority":1,"issue_type":"feature","assignee":"WhiteStone","created_at":"2025-12-10T02:39:24.389335-05:00","updated_at":"2025-12-10T04:32:49.883698-05:00","closed_at":"2025-12-10T04:32:49.883698-05:00","dependencies":[{"issue_id":"ntm-4pp.3","depends_on_id":"ntm-4pp","type":"parent-child","created_at":"2025-12-10T02:39:24.389974-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.3","depends_on_id":"ntm-4pp.1","type":"blocks","created_at":"2025-12-10T02:39:24.390473-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.4","title":"Error Alerting \u0026 Auto-Recovery","description":"Detect common error conditions and provide alerts/notifications.\n\n## Error Types to Detect\n\n### Rate Limiting\nPatterns:\n- \"rate limit\" (case insensitive)\n- \"429\" / \"Too Many Requests\"  \n- \"quota exceeded\"\n- \"try again later\"\n\nAction: Surface in status, optionally auto-wait and retry\n\n### Crashes/Disconnects\nPatterns:\n- \"connection reset\"\n- \"connection refused\"\n- \"timeout\"\n- Process exit (tmux pane shows shell prompt unexpectedly)\n\nAction: Alert user, optionally auto-restart agent\n\n### API Errors\nPatterns:\n- \"error:\" / \"Error:\" / \"ERROR\"\n- \"exception\" / \"Exception\"\n- \"failed\" / \"Failed\"\n- Stack traces (\"at \" lines, \"Traceback\")\n\nAction: Highlight in output, surface in status\n\n### Authentication Issues\nPatterns:\n- \"unauthorized\" / \"401\"\n- \"forbidden\" / \"403\"\n- \"invalid.*token\" / \"expired.*token\"\n\nAction: Alert user - requires manual intervention\n\n## Notification Options\n\n### Terminal\n- Bell character (\\a) on error\n- Print alert to stderr\n- Colored banner in watch mode\n\n### System Notifications\n```go\n// macOS\nexec.Command(\"terminal-notifier\", \"-message\", msg).Run()\n// or osascript\n\n// Linux  \nexec.Command(\"notify-send\", \"NTM Alert\", msg).Run()\n```\n\n### Webhook (see Epic 6)\n```bash\ncurl -X POST  -d '{\"error\": \"rate_limit\", \"agent\": \"cc_1\"}'\n```\n\n## Auto-Recovery (Optional)\n\n### Rate Limit Retry\n```go\nif errorType == RateLimit {\n    waitDuration := parseRetryAfter(output) // or default 60s\n    log(\"Rate limited, waiting %v\", waitDuration)\n    time.Sleep(waitDuration)\n    resendLastPrompt(pane)\n}\n```\n\n### Agent Restart\n```go\nif errorType == Crash {\n    notify(\"Agent %s crashed, restarting...\", pane.Name)\n    restartAgent(pane) // Kill pane, recreate with same config\n}\n```\n\n## Configuration\n```toml\n[alerts]\nenabled = true\nbell = true\nsystem_notification = true\nwebhook = \"\"\n\n[recovery]\nauto_retry_rate_limit = true\nretry_wait_seconds = 60\nauto_restart_crash = false  # Dangerous, off by default\n```\n\n## Files to Create\n- internal/status/errors.go - Error pattern definitions\n- internal/status/alerts.go - Notification logic\n- internal/status/recovery.go - Auto-recovery logic","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T02:39:48.325586-05:00","updated_at":"2025-12-10T02:54:53.965293-05:00","dependencies":[{"issue_id":"ntm-4pp.4","depends_on_id":"ntm-4pp","type":"parent-child","created_at":"2025-12-10T02:39:48.325931-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.4","depends_on_id":"ntm-4pp.1","type":"blocks","created_at":"2025-12-10T02:39:48.326349-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.5","title":"Compaction Detection \u0026 Auto-Prompt","description":"# Compaction Detection \u0026 Auto-Prompt\n\n## Critical Requirement\nAfter AI agent context compaction (especially in Claude Code), NTM MUST:\n1. Detect the compaction event ASAP\n2. Immediately send a context recovery prompt to the affected agent\n\n## Default Recovery Prompt\n```\nReread AGENTS.md so it's still fresh in your mind. Use ultrathink.\n```\n\n## Detection Patterns\n\n### Claude Code Compaction\nWatch for these patterns in pane output:\n- \"context window\" + \"compacted\" / \"summarized\"\n- \"conversation was summarized\"\n- \"This session is being continued from a previous conversation\"\n- \"ran out of context\"\n\n### Codex Compaction  \n- \"context limit reached\"\n- \"conversation truncated\"\n\n### Gemini Compaction\n- \"context window exceeded\"\n- \"conversation reset\"\n\n## Implementation\n\n### Pattern Matcher\n```go\ntype CompactionPattern struct {\n    Agent    string   // \"claude\", \"codex\", \"gemini\", \"*\"\n    Patterns []string // regex patterns\n}\n\nvar compactionPatterns = []CompactionPattern{\n    {\n        Agent: \"claude\",\n        Patterns: []string{\n            `(?i)conversation.*summarized`,\n            `(?i)context.*compacted`,\n            `(?i)continued from.*previous.*conversation`,\n            `(?i)ran out of context`,\n        },\n    },\n    {\n        Agent: \"codex\",\n        Patterns: []string{\n            `(?i)context limit reached`,\n            `(?i)conversation truncated`,\n        },\n    },\n    {\n        Agent: \"gemini\", \n        Patterns: []string{\n            `(?i)context window exceeded`,\n            `(?i)conversation reset`,\n        },\n    },\n}\n```\n\n### Detection Loop\n```go\nfunc (d *Detector) checkForCompaction(paneOutput string, paneInfo PaneInfo) {\n    for _, cp := range compactionPatterns {\n        if cp.Agent != \"*\" \u0026\u0026 !strings.Contains(paneInfo.AgentType, cp.Agent) {\n            continue\n        }\n        for _, pattern := range cp.Patterns {\n            if matched, _ := regexp.MatchString(pattern, paneOutput); matched {\n                d.handleCompaction(paneInfo)\n                return\n            }\n        }\n    }\n}\n\nfunc (d *Detector) handleCompaction(pane PaneInfo) {\n    // Get recovery prompt from config (or use default)\n    prompt := d.config.CompactionRecoveryPrompt\n    if prompt == \"\" {\n        prompt = \"Reread AGENTS.md so it's still fresh in your mind. Use ultrathink.\"\n    }\n    \n    // Send immediately\n    tmux.SendKeys(pane.SessionName, pane.Index, prompt+\"\\n\")\n    \n    // Log the event\n    log.Printf(\"Compaction detected in %s, sent recovery prompt\", pane.Title)\n    \n    // Optionally notify user\n    if d.config.NotifyOnCompaction {\n        notify(\"Compaction detected in %s - recovery prompt sent\", pane.Title)\n    }\n}\n```\n\n### Integration with Watch Mode\nCompaction detection should run automatically when:\n1. `ntm watch` is active\n2. `ntm dashboard` is running  \n3. Background monitoring is enabled\n\n### Configuration\n```toml\n[compaction]\n# Enable auto-detection and recovery\nenabled = true\n\n# Custom recovery prompt (use %s for AGENTS.md path)\nrecovery_prompt = \"Reread AGENTS.md so it's still fresh in your mind. Use ultrathink.\"\n\n# Per-project override\n# [project.myproject.compaction]\n# recovery_prompt = \"Reread /path/to/custom/AGENTS.md\"\n\n# Notification on compaction\nnotify = true\n\n# Cooldown between prompts (prevent spam)\ncooldown_seconds = 30\n```\n\n## Edge Cases\n\n### False Positives\n- User discussing compaction in a prompt\n- Agent explaining what compaction is\nSolution: Look for system-generated patterns, not user text\n\n### Multiple Compactions\n- Cooldown timer to prevent sending recovery prompt repeatedly\n- Track last compaction time per pane\n\n### AGENTS.md Not Found\n- Check if file exists before referencing\n- Fall back to generic \"reread context\" prompt\n\n## Files to Create\n- internal/status/compaction.go - Detection patterns and logic\n- internal/status/recovery.go - Recovery prompt handling\n- Add to internal/config/config.go - Compaction settings\n\n## Priority: P0 (Critical)\nThis feature is essential for maintaining agent effectiveness during long sessions.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-10T02:53:13.851446-05:00","updated_at":"2025-12-10T03:53:07.368694-05:00","closed_at":"2025-12-10T03:53:07.368694-05:00","dependencies":[{"issue_id":"ntm-4pp.5","depends_on_id":"ntm-4pp","type":"parent-child","created_at":"2025-12-10T02:53:13.852861-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.5","depends_on_id":"ntm-4pp.1","type":"blocks","created_at":"2025-12-10T02:53:21.0369-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.5.1","title":"Implement compaction pattern matcher","description":"Create internal/status/compaction.go with pattern matching for all supported AI agents.\n\n## Key Claude Code Pattern\n**\"Conversation compacted\"** - This exact text appears in Claude Code after compaction.\n\n## Implementation\n```go\npackage status\n\nimport (\n    \"regexp\"\n    \"sync\"\n    \"time\"\n)\n\n// CompactionPattern defines patterns for detecting compaction events\ntype CompactionPattern struct {\n    Agent    string           // \"claude\", \"codex\", \"gemini\", \"*\"\n    Patterns []*regexp.Regexp // Compiled patterns\n}\n\n// CompactionEvent represents a detected compaction\ntype CompactionEvent struct {\n    PaneID      string\n    AgentType   string\n    DetectedAt  time.Time\n    MatchedText string\n}\n\nvar (\n    compactionPatterns []CompactionPattern\n    patternsOnce       sync.Once\n)\n\nfunc initPatterns() {\n    patternsOnce.Do(func() {\n        compactionPatterns = []CompactionPattern{\n            {\n                Agent: \"claude\",\n                Patterns: compilePatterns([]string{\n                    `Conversation compacted`,                     // EXACT match - primary\n                    `(?i)conversation.*summarized`,\n                    `(?i)context.*compacted`,\n                    `(?i)continued from.*previous.*conversation`,\n                    `(?i)ran out of context`,\n                    `(?i)session is being continued`,\n                }),\n            },\n            {\n                Agent: \"codex\",\n                Patterns: compilePatterns([]string{\n                    `(?i)context limit reached`,\n                    `(?i)conversation truncated`,\n                }),\n            },\n            {\n                Agent: \"gemini\",\n                Patterns: compilePatterns([]string{\n                    `(?i)context window exceeded`,\n                    `(?i)conversation reset`,\n                }),\n            },\n        }\n    })\n}\n\nfunc compilePatterns(patterns []string) []*regexp.Regexp {\n    result := make([]*regexp.Regexp, 0, len(patterns))\n    for _, p := range patterns {\n        if re, err := regexp.Compile(p); err == nil {\n            result = append(result, re)\n        }\n    }\n    return result\n}\n\n// DetectCompaction checks output for compaction patterns\nfunc DetectCompaction(output string, agentType string) *CompactionEvent {\n    initPatterns()\n    \n    for _, cp := range compactionPatterns {\n        if cp.Agent != \"*\" \u0026\u0026 cp.Agent != agentType {\n            continue\n        }\n        for _, pattern := range cp.Patterns {\n            if match := pattern.FindString(output); match != \"\" {\n                return \u0026CompactionEvent{\n                    AgentType:   agentType,\n                    DetectedAt:  time.Now(),\n                    MatchedText: match,\n                }\n            }\n        }\n    }\n    return nil\n}\n```\n\n## Tests\n- Test \"Conversation compacted\" exact match (Claude Code)\n- Test each pattern with known compaction messages\n- Test no false positives on normal output\n- Test agent type filtering","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T02:53:38.927453-05:00","updated_at":"2025-12-10T03:41:42.404717-05:00","closed_at":"2025-12-10T03:41:42.404717-05:00","dependencies":[{"issue_id":"ntm-4pp.5.1","depends_on_id":"ntm-4pp.5","type":"parent-child","created_at":"2025-12-10T02:53:38.927792-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.5.2","title":"Implement recovery prompt sender","description":"Create recovery prompt sending logic with cooldown protection.\n\n## Implementation\n```go\npackage status\n\nimport (\n    \"sync\"\n    \"time\"\n    \n    \"github.com/Dicklesworthstone/ntm/internal/tmux\"\n)\n\nconst (\n    DefaultRecoveryPrompt = \"Reread AGENTS.md so it's still fresh in your mind. Use ultrathink.\"\n    DefaultCooldown       = 30 * time.Second\n)\n\ntype RecoveryManager struct {\n    mu           sync.RWMutex\n    lastRecovery map[string]time.Time // paneID -\u003e last recovery time\n    cooldown     time.Duration\n    prompt       string\n}\n\nfunc NewRecoveryManager(cooldown time.Duration, prompt string) *RecoveryManager {\n    if cooldown == 0 {\n        cooldown = DefaultCooldown\n    }\n    if prompt == \"\" {\n        prompt = DefaultRecoveryPrompt\n    }\n    return \u0026RecoveryManager{\n        lastRecovery: make(map[string]time.Time),\n        cooldown:     cooldown,\n        prompt:       prompt,\n    }\n}\n\n// SendRecoveryPrompt sends the recovery prompt if cooldown has passed\nfunc (rm *RecoveryManager) SendRecoveryPrompt(sessionName string, paneIndex int, paneID string) error {\n    rm.mu.Lock()\n    defer rm.mu.Unlock()\n    \n    // Check cooldown\n    if last, ok := rm.lastRecovery[paneID]; ok {\n        if time.Since(last) \u003c rm.cooldown {\n            return nil // Still in cooldown, skip\n        }\n    }\n    \n    // Send the recovery prompt\n    err := tmux.SendKeys(sessionName, paneIndex, rm.prompt+\"\\n\")\n    if err != nil {\n        return err\n    }\n    \n    // Update last recovery time\n    rm.lastRecovery[paneID] = time.Now()\n    return nil\n}\n\n// HandleCompactionEvent processes a compaction event\nfunc (rm *RecoveryManager) HandleCompactionEvent(event *CompactionEvent, session string, paneIndex int) {\n    if event == nil {\n        return\n    }\n    \n    paneID := fmt.Sprintf(\"%s:%d\", session, paneIndex)\n    event.PaneID = paneID\n    \n    if err := rm.SendRecoveryPrompt(session, paneIndex, paneID); err != nil {\n        log.Printf(\"Failed to send recovery prompt: %v\", err)\n    } else {\n        log.Printf(\"Compaction detected in %s, recovery prompt sent\", paneID)\n    }\n}\n```\n\n## Configuration Integration\nRead prompt and cooldown from config file.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T02:54:14.205724-05:00","updated_at":"2025-12-10T03:45:49.338936-05:00","closed_at":"2025-12-10T03:45:49.338936-05:00","dependencies":[{"issue_id":"ntm-4pp.5.2","depends_on_id":"ntm-4pp.5","type":"parent-child","created_at":"2025-12-10T02:54:14.206071-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.5.2","depends_on_id":"ntm-4pp.5.1","type":"blocks","created_at":"2025-12-10T02:54:14.206619-05:00","created_by":"daemon"}]}
{"id":"ntm-4pp.5.3","title":"Integrate compaction detection into watch/dashboard","description":"Add compaction detection to the output monitoring loop.\n\n## Integration Points\n\n### Watch Mode (ntm watch)\n```go\nfunc (w *Watcher) pollOutput() {\n    for _, pane := range w.panes {\n        output := w.getNewOutput(pane)\n        \n        // Check for compaction\n        if event := status.DetectCompaction(output, pane.AgentType); event != nil {\n            w.recovery.HandleCompactionEvent(event, pane.Session, pane.Index)\n        }\n        \n        // ... existing output processing ...\n    }\n}\n```\n\n### Dashboard\nAdd compaction detection to the dashboard's output polling loop.\n\n### Background Daemon (optional)\nConsider a standalone monitoring daemon for long-running sessions.\n\n## Testing\n- Test detection triggers recovery prompt\n- Test cooldown prevents spam\n- Test integration with existing watch mode","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T02:54:25.773762-05:00","updated_at":"2025-12-10T03:51:26.368913-05:00","closed_at":"2025-12-10T03:51:26.368913-05:00","dependencies":[{"issue_id":"ntm-4pp.5.3","depends_on_id":"ntm-4pp.5","type":"parent-child","created_at":"2025-12-10T02:54:25.774221-05:00","created_by":"daemon"},{"issue_id":"ntm-4pp.5.3","depends_on_id":"ntm-4pp.5.2","type":"blocks","created_at":"2025-12-10T02:54:25.774807-05:00","created_by":"daemon"}]}
{"id":"ntm-4t3","title":"Create unified JSON schema for agent+beads+graph data","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:06.078602-05:00","updated_at":"2025-12-10T03:32:21.948026-05:00","closed_at":"2025-12-10T03:32:21.948026-05:00","dependencies":[{"issue_id":"ntm-4t3","depends_on_id":"ntm-r2k","type":"blocks","created_at":"2025-12-10T03:28:02.352742-05:00","created_by":"daemon"}]}
{"id":"ntm-517","title":"Create internal/robot package with JSON output helpers","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:39:48.723327-05:00","updated_at":"2025-12-10T02:46:57.573006-05:00","closed_at":"2025-12-10T02:46:57.573006-05:00","comments":[{"id":2,"issue_id":"ntm-517","author":"jemanuel","text":"-","created_at":"2025-12-10T07:40:13Z"}]}
{"id":"ntm-5afg","title":"Implement webview dashboard","description":"# Implement webview dashboard\n\nHTML/CSS dashboard matching NTM TUI style.\nCommunication with extension via postMessage.\nShow pane grid, context bars, mail status.\nQuick action buttons.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T03:29:22.817596-05:00","updated_at":"2025-12-10T03:29:22.817596-05:00","dependencies":[{"issue_id":"ntm-5afg","depends_on_id":"ntm-smh8","type":"blocks","created_at":"2025-12-10T03:29:38.851475-05:00","created_by":"daemon"}]}
{"id":"ntm-5b7","title":"Unit Tests: internal/tutorial, updater, watcher (0% â†’ 80%)","description":"# Unit Tests: Remaining Packages\n\n## Packages Covered\n- internal/tutorial (0%)\n- internal/updater (0%)\n- internal/watcher (0%)\n\n---\n\n## internal/tutorial (tutorial.go)\n\n### Model Tests\n- [ ] TestNewTutorialModel - initial state\n- [ ] TestTutorialSlideCount - 9 slides\n- [ ] TestTutorialNavigation_Next - right/space/enter\n- [ ] TestTutorialNavigation_Prev - left\n- [ ] TestTutorialNavigation_Jump - 1-9 keys\n\n### Animation Tests\n- [ ] TestTutorialTransitions - all transition types\n- [ ] TestTutorialTypingAnimation - text reveal\n- [ ] TestTutorialSkipAnimation - 's' key skips\n\n### Slide Content\n- [ ] TestSlideContent_Welcome - first slide\n- [ ] TestSlideContent_AllSlides - all slides have content\n\n---\n\n## internal/updater (updater.go)\n\n### Version Comparison\n- [ ] TestCompareVersions_Newer - newer version detected\n- [ ] TestCompareVersions_Same - same version\n- [ ] TestCompareVersions_Older - older version\n- [ ] TestCompareVersions_Prerelease - alpha \u003c release\n- [ ] TestCompareVersions_VPrefix - handles v prefix\n- [ ] TestCompareVersions_Invalid - invalid versions\n\n### Update Check\n- [ ] TestCheckForUpdate - API call succeeds\n- [ ] TestCheckForUpdate_NoNetwork - handles network error\n- [ ] TestCheckForUpdate_RateLimit - handles rate limit\n- [ ] TestCheckForUpdate_Timeout - respects timeout\n\n### Version Parsing\n- [ ] TestParseVersion - major.minor.patch\n- [ ] TestParseVersion_Prerelease - with -alpha suffix\n- [ ] TestParseVersion_Invalid - returns error\n\n---\n\n## internal/watcher (debouncer.go)\n\n### Debouncer\n- [ ] TestNewDebouncer - creates with duration\n- [ ] TestDebouncerTrigger_Single - single trigger fires\n- [ ] TestDebouncerTrigger_Multiple - multiple triggers debounced\n- [ ] TestDebouncerTiming - fires after delay\n- [ ] TestDebouncerConcurrent - thread-safe\n\n### File Watcher (if implemented)\n- [ ] TestWatchFile - detects file change\n- [ ] TestWatchDirectory - detects dir changes\n- [ ] TestWatcherStop - stops watching\n\n---\n\n## Implementation Notes\n- Updater tests may need to mock HTTP (acceptable exception)\n- Watcher tests use real temp files\n- Tutorial tests use tea.Msg simulation","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:22:01.856984-05:00","updated_at":"2025-12-10T03:22:01.856984-05:00","dependencies":[{"issue_id":"ntm-5b7","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:22:34.445501-05:00","created_by":"daemon"}]}
{"id":"ntm-5ujo","title":"Implement ntm changes and ntm conflicts commands","description":"# Implement ntm changes and ntm conflicts Commands\n\n## Purpose\n\nDisplay file changes attributed to agents and highlight conflicts.\n\n## Commands\n\n### ntm changes\n```bash\nntm changes myproject\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Recent File Changes                                         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ src/api/users.py        cc_1, cc_2      âš ï¸ conflict         â”‚\nâ”‚ src/api/auth.py         cc_1                                â”‚\nâ”‚ tests/test_users.py     cod_1, cod_2                        â”‚\nâ”‚ docs/api.md             cod_2                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n# With details\nntm changes myproject --details\n```\n\n### ntm conflicts\n```bash\nntm conflicts myproject\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Conflicts Detected                                          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ src/api/users.py                                            â”‚\nâ”‚   cc_1: +25 -10 lines (10 min ago)                         â”‚\nâ”‚   cc_2: +18 -8 lines (8 min ago)                           â”‚\nâ”‚                                                             â”‚\nâ”‚   Resolution options:                                       â”‚\nâ”‚   1. Keep cc_1's version: git checkout cc_1 -- src/api/... â”‚\nâ”‚   2. Keep cc_2's version: git checkout cc_2 -- src/api/... â”‚\nâ”‚   3. Manual merge needed                                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### ntm diff (optional enhancement)\n```bash\nntm diff myproject cc_1 cc_2 src/api/users.py\n# Shows diff between the two agents' versions\n```\n\n## JSON Output\n\n```bash\nntm changes myproject --json\nntm conflicts myproject --json\n```\n\n## Acceptance Criteria\n\n- [ ] ntm changes shows file attribution\n- [ ] ntm conflicts highlights multi-agent changes\n- [ ] Line count changes shown\n- [ ] Resolution suggestions provided\n- [ ] JSON output for scripts","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:14.552083-05:00","updated_at":"2025-12-10T03:40:18.540587-05:00","dependencies":[{"issue_id":"ntm-5ujo","depends_on_id":"ntm-t0ch","type":"blocks","created_at":"2025-12-10T03:29:37.812663-05:00","created_by":"daemon"}]}
{"id":"ntm-5zc","title":"EPIC: Multi-Model Support","description":"# Multi-Model Support\n\n## Background \u0026 Motivation\n\nCurrently, NTM treats agent types as monolithic:\n- `--cc` spawns Claude with a fixed command\n- `--cod` spawns Codex with a fixed command\n- `--gmi` spawns Gemini with a fixed command\n\nBut in practice, power users need model flexibility:\n- Use Claude Opus for architecture decisions (expensive, powerful)\n- Use Claude Sonnet for implementation (cheaper, fast)\n- Use GPT-4 for one task, o1 for reasoning-heavy tasks\n- Mix Gemini Pro and Flash based on complexity\n\n## The Problem\n\nReal-world multi-agent workflows look like:\n```\nArchitect (Opus) â†’ Designer (Sonnet) â†’ Implementer (Codex) â†’ Reviewer (Opus)\n```\n\nNTM should enable this naturally without manual agent configuration.\n\n## Proposed Syntax\n\n### Spawn with model specifiers\n```bash\n# Basic: 2 Opus, 1 Sonnet\nntm spawn myproject --cc=2:opus --cc=1:sonnet\n\n# Full model names\nntm spawn myproject --cc=1:claude-opus-4 --cc=2:claude-sonnet-4\n\n# Codex variants\nntm spawn myproject --cod=1:gpt4 --cod=1:o1\n\n# Gemini variants\nntm spawn myproject --gmi=1:pro --gmi=1:flash\n```\n\n### Add with model specifiers\n```bash\nntm add myproject --cc=1:haiku  # Add cheap agent for simple tasks\n```\n\n## Model Aliases\n\nShort aliases mapped to full model names in config:\n```toml\n[models.claude]\nopus = \"claude-opus-4\"\nsonnet = \"claude-sonnet-4\"\nhaiku = \"claude-haiku\"\n\n[models.codex]\ngpt4 = \"gpt-4\"\no1 = \"o1\"\n\n[models.gemini]\npro = \"gemini-pro\"\nflash = \"gemini-flash\"\n```\n\n## Pane Naming Enhancement\n\nCurrent: `myproject__cc_1`\nEnhanced: `myproject__cc_opus_1` or `myproject__cc_1_opus`\n\nThis enables filtering by model:\n```bash\nntm send myproject --cc:opus \"Architecture review needed\"\nntm send myproject --cc:sonnet \"Implement the design\"\n```\n\n## Dashboard Display\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Panes                                            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â— cc_1   Claude Opus    working                  â”‚\nâ”‚ â— cc_2   Claude Sonnet  idle                     â”‚\nâ”‚ â— cod_1  GPT-4          working                  â”‚\nâ”‚ â— cod_2  o1             thinking                 â”‚\nâ”‚ â— gmi_1  Gemini Pro     idle                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Success Criteria\n\n- [ ] spawn accepts model specifiers (--cc=N:model)\n- [ ] Model aliases configurable in config.toml\n- [ ] Pane titles include model for identification\n- [ ] send command can filter by model\n- [ ] Status and dashboard show model info\n- [ ] Robot mode includes model in agent output\n\n## Implementation Notes\n\n- Backwards compatible: `--cc=2` uses default model\n- Model specifier parsed: count:model format\n- Agent command template expanded with model variable","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:20:35.225729-05:00","updated_at":"2025-12-10T03:20:35.225729-05:00"}
{"id":"ntm-5zs","title":"Create SSH wrapper for tmux commands","description":"Enable tmux commands to execute on remote hosts via SSH.\n\n## What This Task Does\n\nCreate an abstraction layer that allows all tmux operations to run\neither locally or on a remote host via SSH.\n\n## Interface\n\n$ ntm spawn myproject --ssh devbox --cc=4\n$ ntm list --ssh devbox\n$ ntm attach myproject --ssh devbox\n\n## Technical Approach\n\nModify internal/tmux package to support remote execution:\n\ntype TmuxClient struct {\n    Remote string // empty for local, \"user@host\" for remote\n}\n\nfunc (c *TmuxClient) Run(args ...string) (string, error) {\n    if c.Remote == \"\" {\n        return exec.Command(\"tmux\", args...).Output()\n    }\n    sshArgs := append([]string{c.Remote, \"tmux\"}, args...)\n    return exec.Command(\"ssh\", sshArgs...).Output()\n}\n\n## SSH Configuration\n\nSupport SSH config hosts:\n- $ ntm list --ssh devbox   # Uses ~/.ssh/config host\n- $ ntm list --ssh user@192.168.1.100\n\nRespect SSH options:\n- ControlMaster for connection reuse\n- Identity files\n- Proxy jumps\n\n## Error Handling\n\nConnection failures:\n- Clear error message with SSH exit code\n- Suggest checking SSH connectivity\n- Timeout handling\n\nAuth failures:\n- Detect auth errors\n- Suggest ssh-add for key issues\n\n## Session Context\n\nStore remote host in tmux environment variable:\n$ tmux set-environment -t myproject NTM_REMOTE_HOST devbox\n\nWhen operating on existing session, detect remote host:\n- If --ssh provided, use it\n- Else check NTM_REMOTE_HOST\n- Else assume local\n\n## Acceptance Criteria\n\n- [ ] TmuxClient abstraction supports local and remote\n- [ ] All existing tmux functions work with remote\n- [ ] SSH config hosts supported\n- [ ] Connection errors handled gracefully\n- [ ] Remote host stored with session\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:49:44.448922-05:00","updated_at":"2025-12-10T02:49:44.448922-05:00","dependencies":[{"issue_id":"ntm-5zs","depends_on_id":"ntm-czy","type":"blocks","created_at":"2025-12-10T02:49:44.450381-05:00","created_by":"daemon"}]}
{"id":"ntm-61i","title":"EPIC: Agent Organization \u0026 Filtering","description":"Enable logical grouping and filtering of agents via tags.\n\n## Problem Statement\n\nCurrent agent organization is limited to sessions:\n- All agents in a session are treated as one group\n- Can't target subsets like 'all frontend agents' across sessions\n- Can't filter ntm list to show only certain agent types\n- No way to apply operations to logical groups\n\nAs agent counts grow, this becomes unwieldy. Users run 10+ agents across\nmultiple sessions and need better organization primitives.\n\n## Goals\n\n1. Add tagging system for agents (multiple tags per agent)\n2. Filter all operations by tag (send, list, kill, status)\n3. Tags persist across restarts (stored in pane title metadata)\n4. Support tag expressions (AND, OR, NOT)\n\n## Why This Matters\n\nTags provide a flexible, user-defined organization layer:\n- Group by concern: frontend, backend, database, tests\n- Group by purpose: refactor, bugfix, feature, research\n- Group by priority: critical, background, experimental\n- Group by lifecycle: temporary, persistent\n\nThis enables workflows like:\n- 'Send status update to all backend agents'\n- 'Kill all experimental agents'\n- 'List only agents working on the auth feature'\n\n## Success Criteria\n\n- ntm spawn myproject --cc=2 --tags=frontend,ui\n- ntm add myproject --cod=1 --tags=backend,api\n- ntm send --tag=frontend 'Update the navbar'\n- ntm list --tag=backend\n- ntm kill --tag=experimental\n- Tags visible in ntm status output\n\n## Technical Approach\n\nTags stored in tmux pane title:\n- Current format: session__cc_1\n- New format: session__cc_1[frontend,ui]\n\nTag operations:\n- Parse tags from pane title during list operations\n- Match tags using simple OR logic (any match = included)\n- Future: Support expressions like 'frontend AND NOT experimental'\n\nConfig for default tags:\n[agents.claude]\ndefault_tags = [\"ai\", \"code\"]\n\n## Interaction with Other Features\n\n- JSON Output: Tags included in --json output\n- Notifications: Can filter notifications by tag\n- Health Checks: Can check health of tagged subset\n- Remote Sessions: Tags work across remote sessions\n\n## Design Decisions\n\nWhy pane titles for storage?\n- Already using pane titles for agent type info\n- Survives session detach/reattach\n- Visible in tmux list-panes\n- No external state to sync\n\nWhy not a separate database?\n- Adds complexity\n- Requires syncing with tmux state\n- Pane titles are the source of truth anyway\n","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T02:44:24.482707-05:00","updated_at":"2025-12-10T02:44:24.482707-05:00"}
{"id":"ntm-62ji","title":"Implement auto-baseline before/after agent sessions","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:27:34.118219-05:00","updated_at":"2025-12-10T03:32:21.761045-05:00","closed_at":"2025-12-10T03:32:21.761045-05:00","dependencies":[{"issue_id":"ntm-62ji","depends_on_id":"ntm-40fg","type":"blocks","created_at":"2025-12-10T03:28:07.659296-05:00","created_by":"daemon"}]}
{"id":"ntm-66c","title":"Create Test Harness with Structured Logging","description":"# Test Harness with Structured Logging\n\n## Purpose\nFoundational infrastructure for all integration and E2E tests.\n\n## Components\n\n### 1. Test Logger\n```go\npackage testutil\n\ntype TestLogger struct {\n    w        io.Writer\n    testName string\n    startTs  time.Time\n}\n\nfunc NewTestLogger(t *testing.T, logDir string) *TestLogger {\n    filename := fmt.Sprintf(\"%s_%s.log\", t.Name(), time.Now().Format(\"20060102_150405\"))\n    f, _ := os.Create(filepath.Join(logDir, filename))\n    t.Cleanup(func() { f.Close() })\n    return \u0026TestLogger{w: f, testName: t.Name(), startTs: time.Now()}\n}\n\nfunc (l *TestLogger) Log(format string, args ...interface{}) {\n    ts := time.Now().Format(time.RFC3339)\n    fmt.Fprintf(l.w, \"[%s] %s\\n\", ts, fmt.Sprintf(format, args...))\n}\n\nfunc (l *TestLogger) Exec(cmd string, args ...string) ([]byte, error) {\n    l.Log(\"EXEC: %s %s\", cmd, strings.Join(args, \" \"))\n    out, err := exec.Command(cmd, args...).CombinedOutput()\n    l.Log(\"OUTPUT: %s\", string(out))\n    l.Log(\"EXIT: %v\", err)\n    return out, err\n}\n```\n\n### 2. Session Helper\n```go\nfunc CreateTestSession(t *testing.T, logger *TestLogger, agents map[string]int) string {\n    name := fmt.Sprintf(\"ntm_test_%d\", time.Now().UnixNano())\n    args := []string{\"spawn\", name}\n    for agentType, count := range agents {\n        args = append(args, fmt.Sprintf(\"--%s=%d\", agentType, count))\n    }\n    logger.Exec(\"ntm\", args...)\n    t.Cleanup(func() {\n        logger.Log(\"TEARDOWN: Killing session %s\", name)\n        exec.Command(\"ntm\", \"kill\", \"-f\", name).Run()\n    })\n    return name\n}\n```\n\n### 3. Assertion Helpers\n```go\nfunc AssertSessionExists(t *testing.T, logger *TestLogger, name string) {\n    logger.Log(\"VERIFY: Session %s exists\", name)\n    err := exec.Command(\"tmux\", \"has-session\", \"-t\", name).Run()\n    if err != nil {\n        logger.Log(\"FAIL: Session does not exist\")\n        t.Errorf(\"Session %s should exist\", name)\n    } else {\n        logger.Log(\"PASS: Session exists\")\n    }\n}\n```\n\n### 4. Skip Conditions\n```go\nfunc RequireTmux(t *testing.T) {\n    if _, err := exec.LookPath(\"tmux\"); err != nil {\n        t.Skip(\"tmux not installed\")\n    }\n}\n\nfunc RequireNTMBinary(t *testing.T) {\n    if _, err := exec.LookPath(\"ntm\"); err != nil {\n        t.Skip(\"ntm binary not in PATH\")\n    }\n}\n```\n\n## Files\n- tests/testutil/logger.go\n- tests/testutil/session.go\n- tests/testutil/assertions.go\n- tests/testutil/skip.go\n\n## This task BLOCKS all integration and E2E tests","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:24:23.261795-05:00","updated_at":"2025-12-10T03:34:46.395315-05:00","closed_at":"2025-12-10T03:34:46.395315-05:00","dependencies":[{"issue_id":"ntm-66c","depends_on_id":"ntm-7lk","type":"blocks","created_at":"2025-12-10T03:24:43.450648-05:00","created_by":"daemon"}]}
{"id":"ntm-6pd","title":"EPIC: Scriptability \u0026 Automation Foundation","description":"Enable NTM to be scripted, piped, and composed with other Unix tools.\n\n## Problem Statement\n\nNTM is currently a human-interactive tool. All output is formatted for human reading, and input must come from command-line arguments. This severely limits:\n\n1. **Scripting**: Can't parse ntm list output reliably in shell scripts\n2. **CI/CD Integration**: No machine-readable output for automation pipelines  \n3. **Composition**: Can't pipe NTM into jq, grep, awk, or other Unix tools\n4. **Complex Prompts**: Can't send multi-line prompts, file contents, or piped data\n5. **Reproducibility**: Hard to replay exact workflows programmatically\n\n## Goals\n\n1. Add --json flag to all commands producing structured, parseable output\n2. Support stdin and --file for prompt input to ntm send\n3. Establish consistent JSON schemas across all commands\n4. Maintain human-friendly defaults while enabling machine mode\n\n## Why This Matters\n\nThe Unix philosophy: tools should do one thing well and compose with others. NTM orchestrates agents, but without scriptability, users can't build on top of it.\n\nReal-world scenarios this enables:\n- ntm list --json | jq '.[] | select(.agents.claude \u003e 0) | .name'\n- ntm status myproject --json | jq '.panes[] | select(.status == \"idle\")'\n- cat requirements.txt | ntm send myproject --all \"Implement these features\"\n- git diff HEAD~5 | ntm send myproject --cc \"Review these changes\"\n- CI pipelines that spawn agents, send prompts, and verify outputs\n\n## Success Criteria\n\n- Every command that produces output supports --json\n- JSON schemas are documented and consistent\n- ntm send accepts --file and reads from stdin when not a TTY\n- Scripts can reliably parse NTM output without fragile text parsing\n- Exit codes are meaningful (0=success, 1=error, 2=partial)\n\n## Technical Considerations\n\n- JSON output should include all data, not just what's shown in text mode\n- Timestamps should be ISO 8601\n- Nested structures where appropriate (e.g., panes within sessions)\n- Schema versioning for future compatibility\n- Streaming JSON (JSON lines) for long-running commands\n\n## Relation to Existing Patterns\n\nAGENTS.md shows this pattern with other tools:\n- cass uses --robot and --json flags for machine output\n- bd uses --json for structured issue data\n- bv uses --robot-* commands for AI consumption\n\nNTM should follow the same pattern for ecosystem consistency.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T02:43:24.530541-05:00","updated_at":"2025-12-10T02:43:37.12434-05:00"}
{"id":"ntm-6tw","title":"EPIC: Context Window Intelligence","description":"# Context Window Intelligence\n\n## Background \u0026 Motivation\n\nAI coding agents have finite context windows. As agents work, their context fills up. When context approaches limits:\n- Agent performance degrades\n- Responses become confused or repetitive\n- Critical context may be lost\n\n**Problem**: Users have no visibility into context usage.\n\n## CRITICAL: Honest About Limitations\n\n**We cannot measure actual context usage.** The agent CLIs don't expose this data.\n\nWhat we CAN do:\n1. **Estimate** based on visible output (scrollback)\n2. **Detect patterns** that suggest context exhaustion\n3. **Show relative usage** (low/medium/high/critical)\n4. **Warn** when estimates suggest problems\n\n**What we show is an ESTIMATE, not actual usage.**\n\n## Estimation Approach\n\n### Method 1: Scrollback-Based Estimate\n- Capture pane scrollback (visible conversation)\n- Apply overhead multiplier (system prompts, tool calls, hidden context)\n- This gives a rough LOWER BOUND on usage\n\n### Method 2: Heuristic Detection\nDetect behavioral patterns suggesting context exhaustion:\n- Repeated identical tool calls\n- \"I apologize\" / confusion patterns\n- Forgetting recent context\n- Circular reasoning\n\n### Display Philosophy\nInstead of precise percentages, use qualitative indicators:\n```\ncc_1 (opus)    [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] Low      (~50k est.)\ncc_2 (sonnet)  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] Medium   (~120k est.)\ncod_1 (gpt4)   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] High     (~100k est.) âš ï¸\ngmi_1 (pro)    [â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] Low      (~100k est.)\n```\n\nThe \"est.\" suffix reminds users these are estimates.\n\n## Technical Details\n\n### Token Estimation\nUse character-based heuristic (~3.5 chars/token for English):\n```go\nfunc EstimateTokens(text string) int {\n    return len(text) * 10 / 35  // ~3.5 chars per token\n}\n```\n\nSimpler and more honest than pretending to have accurate tokenizers.\n\n### Overhead Multiplier\nVisible scrollback is only part of context. Apply 2-3x multiplier:\n- System prompts: ~2-5k tokens\n- Tool definitions: ~5-15k tokens\n- Hidden conversation: varies\n\nConservative default: 2.5x multiplier\n\n### Context Limits\n```go\nvar ApproxContextLimits = map[string]int{\n    \"opus\":   200000,\n    \"sonnet\": 200000,\n    \"haiku\":  200000,\n    \"gpt4\":   128000,\n    \"o1\":     128000,\n    \"pro\":    1000000,\n    \"flash\":  1000000,\n}\n```\n\n## Success Criteria\n\n- [ ] Scrollback-based estimation implemented\n- [ ] Qualitative display (Low/Medium/High/Critical)\n- [ ] Clear \"estimate\" labeling throughout\n- [ ] Heuristic exhaustion detection (patterns)\n- [ ] Configurable warning threshold\n- [ ] Dashboard integration with context bars\n- [ ] Honest about what we don't know","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:24:43.820362-05:00","updated_at":"2025-12-10T03:35:04.329588-05:00"}
{"id":"ntm-6x1","title":"Add session state watching to dashboard","description":"","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-10T02:43:49.808376-05:00","updated_at":"2025-12-10T02:43:49.808376-05:00","dependencies":[{"issue_id":"ntm-6x1","depends_on_id":"ntm-zcu","type":"blocks","created_at":"2025-12-10T02:44:00.294178-05:00","created_by":"daemon"}]}
{"id":"ntm-7a9","title":"Implement model-based filtering in send command","description":"# Implement Model-Based Filtering in send Command\n\n## Purpose\n\nAllow targeting specific models when sending prompts.\n\n## Current Syntax\n\n```bash\nntm send myproject --cc \"message\"     # All Claude agents\nntm send myproject --all \"message\"    # All agents\n```\n\n## Enhanced Syntax\n\n```bash\nntm send myproject --cc:opus \"message\"     # Only Opus agents\nntm send myproject --cc:sonnet \"message\"   # Only Sonnet agents\nntm send myproject --cod:gpt4 \"message\"    # Only GPT-4 agents\nntm send myproject --cc:opus --cc:sonnet \"message\"  # Opus + Sonnet\n```\n\n## Flag Parsing\n\nParse colon-separated type:model:\n```go\ntype SendTarget struct {\n    Type  AgentType\n    Model string  // Empty = all models of type\n}\n\nfunc ParseSendTarget(flag string) SendTarget {\n    parts := strings.SplitN(flag, \":\", 2)\n    target := SendTarget{Type: AgentType(parts[0])}\n    if len(parts) \u003e 1 {\n        target.Model = parts[1]\n    }\n    return target\n}\n```\n\n## Pane Matching\n\n```go\nfunc MatchesSendTarget(pane Pane, target SendTarget) bool {\n    if pane.Type != target.Type {\n        return false\n    }\n    if target.Model != \"\" \u0026\u0026 pane.Model != target.Model {\n        return false\n    }\n    return true\n}\n```\n\n## Acceptance Criteria\n\n- [ ] --cc:model syntax parsed correctly\n- [ ] Multiple model filters can be combined\n- [ ] Works with panes using new naming format\n- [ ] Error if model filter matches no panes\n- [ ] Backwards compatible with --cc (no model)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:21:45.479384-05:00","updated_at":"2025-12-10T09:57:23.19435-05:00","closed_at":"2025-12-10T09:57:23.19435-05:00","dependencies":[{"issue_id":"ntm-7a9","depends_on_id":"ntm-z2k","type":"blocks","created_at":"2025-12-10T03:21:54.061286-05:00","created_by":"daemon"}]}
{"id":"ntm-7bcj","title":"Create health trend indicators in dashboard","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:27:34.272948-05:00","updated_at":"2025-12-10T03:32:21.855645-05:00","closed_at":"2025-12-10T03:32:21.855645-05:00","dependencies":[{"issue_id":"ntm-7bcj","depends_on_id":"ntm-cnb1","type":"blocks","created_at":"2025-12-10T03:28:07.744491-05:00","created_by":"daemon"}]}
{"id":"ntm-7lh","title":"Add ntm recipes subcommand (list, show)","description":"","status":"closed","priority":2,"issue_type":"task","assignee":"BlueSnow","created_at":"2025-12-10T02:42:23.402261-05:00","updated_at":"2025-12-10T09:54:48.93412-05:00","closed_at":"2025-12-10T09:54:48.93412-05:00","dependencies":[{"issue_id":"ntm-7lh","depends_on_id":"ntm-y93","type":"blocks","created_at":"2025-12-10T02:42:31.311591-05:00","created_by":"daemon"}]}
{"id":"ntm-7lk","title":"SUB-EPIC: Integration Tests","description":"# SUB-EPIC: Integration Tests\n\n## Scope\nIntegration tests that verify component interactions across package boundaries.\n\n## Key Integration Points\n\n### 1. CLI â†’ tmux Integration\n- spawn command creates real sessions with correct pane layout\n- send command delivers prompts to correct panes\n- interrupt command sends Ctrl+C to all agent panes\n- status command reports accurate pane states\n\n### 2. CLI â†’ config Integration\n- Commands load config from correct locations\n- Config changes affect command behavior\n- Default values work correctly\n\n### 3. robot â†’ tmux Integration\n- --robot-status outputs accurate session info\n- --robot-plan suggests valid actions\n- JSON output is parseable and accurate\n\n### 4. status â†’ tmux Integration\n- Agent state detection works with real pane output\n- Error detection triggers correctly\n- Prompt detection works across agent types\n\n### 5. palette â†’ config Integration\n- Palette loads commands from config\n- Custom palette files are honored\n- Categories are properly organized\n\n### 6. output â†’ cli Integration\n- --json flag enables JSON output across commands\n- Text output formatting is consistent\n- Error output goes to correct stream\n\n## Test Approach\n- Use real tmux sessions (cleanup on test end)\n- Use temp directories for config\n- Capture and verify actual output\n- Test error conditions explicitly\n\n## Prerequisites\n- Unit tests for individual packages should pass first\n- tmux must be installed on test system","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:18:50.889846-05:00","updated_at":"2025-12-10T03:18:50.889846-05:00","dependencies":[{"issue_id":"ntm-7lk","depends_on_id":"ntm-l5h","type":"blocks","created_at":"2025-12-10T03:19:05.947564-05:00","created_by":"daemon"},{"issue_id":"ntm-7lk","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:19:06.114595-05:00","created_by":"daemon"}]}
{"id":"ntm-7mg","title":"Add design tokens (spacing constants) to styles package","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:42:58.299109-05:00","updated_at":"2025-12-10T02:42:58.299109-05:00"}
{"id":"ntm-7nk3","title":"EPIC: Checkpoint \u0026 Rollback System","description":"# Checkpoint \u0026 Rollback System\n\n## Background \u0026 Motivation\n\nAI agents sometimes go off track. By the time users notice, significant work may be wasted.\n\nCheckpoints provide quick recovery:\n1. Create named save points before risky operations\n2. Roll back to known-good state when things go wrong\n\n## What Gets Checkpointed\n\n### Captured (for restoration)\n- **Git state**: Uncommitted changes saved as patch\n- **Session layout**: Pane configuration, agent types\n\n### Captured (for reference only)\n- **Pane scrollback**: What agents were doing (NOT restored)\n- **Timestamp and description**: Human context\n\n### NOT Captured\n- Agent internal state (we can't access it)\n- API conversation history (we can't access it)\n\n## IMPORTANT: What Rollback Does\n\nRollback restores GIT STATE, not agent state.\n\n```bash\nntm rollback myproject \"before-refactor\"\n```\n\nThis will:\n1. âœ… Stash current uncommitted changes\n2. âœ… Apply checkpoint's git patch\n3. âœ… Interrupt all agents (Ctrl+C)\n4. âš ï¸ Agents restart with FRESH context (no memory of pre-rollback work)\n\n**Critical understanding**: Agents don't \"remember\" the checkpoint. They start fresh. The checkpoint restores FILES, not agent memory.\n\n## Command Interface\n\n```bash\n# Create checkpoint\nntm checkpoint myproject \"before-refactor\"\n# Captures: git diff, session layout, scrollback (for reference)\n\n# List checkpoints\nntm checkpoints myproject\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Checkpoints: myproject                                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ before-refactor    â”‚ 15 min ago â”‚ 3 files â”‚ 4 agents      â”‚\nâ”‚ api-working        â”‚ 2 hrs ago  â”‚ 1 file  â”‚ 4 agents      â”‚\nâ”‚ auto-20251210-1400 â”‚ 3 hrs ago  â”‚ 8 files â”‚ 4 agents      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n# Preview rollback\nntm rollback myproject \"before-refactor\" --dry-run\n\n# Execute rollback\nntm rollback myproject \"before-refactor\"\n# Warning: This will reset files and interrupt agents.\n# Current changes will be stashed. Continue? [y/N]\n\n# Quick rollback to last checkpoint\nntm rollback myproject --last\n```\n\n## Storage Format\n\n```\n~/.config/ntm/checkpoints/myproject/before-refactor/\nâ”œâ”€â”€ metadata.json         # Timestamp, description, session info\nâ”œâ”€â”€ git-state.patch       # git diff output\nâ”œâ”€â”€ session-layout.json   # Pane configuration\nâ””â”€â”€ scrollback/           # Reference only (not restored)\n    â”œâ”€â”€ cc_1.txt\n    â””â”€â”€ cod_1.txt\n```\n\n## Auto-Checkpoints\n\nConfigurable automatic checkpoints:\n```toml\n[checkpoints]\nauto_enabled = true\nauto_events = [\"broadcast_send\"]  # Before ntm send --all\nmax_auto_checkpoints = 10\nretention_days = 7\n```\n\n## Validation\n\nBefore rollback:\n- Check if checkpoint exists\n- Warn if checkpoint is old (\u003e24h)\n- Warn if git state has diverged significantly\n- Validate patch can apply\n\n## Success Criteria\n\n- [ ] ntm checkpoint creates named checkpoints\n- [ ] Git state (uncommitted) captured as patch\n- [ ] Session layout captured for reference\n- [ ] Scrollback captured for reference (not restored)\n- [ ] ntm rollback restores git state\n- [ ] Agents interrupted on rollback (fresh start)\n- [ ] Auto-checkpoint on configurable events\n- [ ] Retention policy with rotation\n- [ ] Clear user messaging about what rollback does/doesn't do","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:28:29.179411-05:00","updated_at":"2025-12-10T03:36:34.909996-05:00"}
{"id":"ntm-7of","title":"Add profiling recommendations based on timing data","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:40:39.506994-05:00","updated_at":"2025-12-10T02:40:39.506994-05:00","dependencies":[{"issue_id":"ntm-7of","depends_on_id":"ntm-1rz","type":"blocks","created_at":"2025-12-10T02:40:48.404725-05:00","created_by":"daemon"},{"issue_id":"ntm-7of","depends_on_id":"ntm-946","type":"blocks","created_at":"2025-12-10T02:40:48.505578-05:00","created_by":"daemon"}]}
{"id":"ntm-7pl","title":"Unit Tests: internal/status package (69.6% â†’ 85%)","description":"Unit Tests: internal/status package (70.6% â†’ 83.7%)\n\n## Final Status\n- Initial coverage: 70.6%\n- Final coverage: 83.7%\n- Target was 85%\n\n## What was added\n- Tests for AgentState.String() and ErrorType.String()\n- Tests for AddPromptPattern and AddErrorPattern\n- Tests for RecoveryManager: GetRecoveryEvents, ResetAll, pruneEvents, SendRecoveryPrompt\n- Tests for BuildContextAwarePrompt and GetBeadContext\n- Tests for IsPromptLine edge cases (literal matching, agent type filtering)\n- Tests for DetectIdleFromOutput edge cases\n- Tests for Detect and DetectAll with real tmux sessions (skip if unavailable)\n- Integration tests for CompactionRecoveryIntegration\n\n## Remaining gap (1.3%)\nFunctions requiring real tmux sessions or bv tool:\n- unified.go: Detect (14.3%), DetectAll (55.6%) - require tmux calls\n- recovery.go: GetBeadContext (68.8%) - requires bv tool installed\n\nThese are integration-level functions that cannot be fully covered in unit tests without mocks (which this project doesn't use).","status":"closed","priority":1,"issue_type":"task","assignee":"LilacMountain","created_at":"2025-12-10T03:21:21.080727-05:00","updated_at":"2025-12-10T03:53:59.507447-05:00","closed_at":"2025-12-10T03:53:59.507447-05:00","dependencies":[{"issue_id":"ntm-7pl","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:22:34.242755-05:00","created_by":"daemon"}]}
{"id":"ntm-7zx4","title":"Implement auto-checkpoint on risky operations","description":"# Implement auto-checkpoint on risky operations\n\nAuto-checkpoint before broadcast sends.\nAuto-checkpoint before adding many agents.\nConfigurable triggers in config.toml.\nRotation policy for auto-checkpoints.","status":"closed","priority":2,"issue_type":"task","assignee":"BlueSnow","created_at":"2025-12-10T03:29:20.250552-05:00","updated_at":"2025-12-10T09:23:39.052165-05:00","closed_at":"2025-12-10T09:23:39.052165-05:00","dependencies":[{"issue_id":"ntm-7zx4","depends_on_id":"ntm-tvux","type":"blocks","created_at":"2025-12-10T03:29:38.477607-05:00","created_by":"daemon"}]}
{"id":"ntm-81e","title":"Implement semantic color palette with consistent naming","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:42:59.47482-05:00","updated_at":"2025-12-10T02:42:59.47482-05:00"}
{"id":"ntm-84t","title":"Implement auto-restart for crashed agents","description":"Automatically restart agents that crash or exit unexpectedly.\n\n## What This Task Does\n\nAdd --auto-restart flag to ntm spawn that monitors agents and restarts\nthem if they crash. This builds on the health check infrastructure.\n\n## Interface\n\n$ ntm spawn myproject --cc=2 --auto-restart\nStarting agents with auto-restart enabled...\n[Agent cc_1 crashed, restarting in 30s...]\n[Agent cc_1 restarted successfully]\n\nConfiguration:\n[resilience]\nauto_restart = true\nmax_restarts = 3\nrestart_delay_seconds = 30\n\n## Technical Approach\n\nOption 1: Background goroutine\n- Spawn launches a monitor goroutine\n- Periodically checks health\n- Restarts crashed agents\n- Exits when session ends\n\nOption 2: Separate daemon\n- ntm spawn --auto-restart starts a background process\n- Process monitors and restarts\n- Survives terminal close\n\nRecommendation: Start with Option 1 (simpler), evolve to Option 2 if needed.\n\n## Restart Logic\n\n1. Detect crash via health check (exit code != 0, process gone)\n2. Check restart count for this agent\n3. If under max_restarts:\n   a. Wait restart_delay_seconds\n   b. Get agent type from pane title\n   c. Re-run agent command in same pane\n   d. Increment restart count\n4. If over max_restarts:\n   a. Log failure\n   b. Send notification (if enabled)\n   c. Stop monitoring this agent\n\n## State Tracking\n\nNeed to track per-agent:\n- Restart count since session start\n- Last restart time\n- Original agent command\n\nStore in:\n- Memory (simple, lost on ntm exit)\n- Tmux environment variable (persists)\n- File (overkill for now)\n\n## Acceptance Criteria\n\n- [ ] --auto-restart flag enables monitoring\n- [ ] Crashed agents are detected and restarted\n- [ ] Restart delay is configurable\n- [ ] Max restart limit is enforced\n- [ ] Restart count shown in health output\n- [ ] Works with existing spawn command\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T02:48:15.105137-05:00","updated_at":"2025-12-10T02:48:15.105137-05:00","dependencies":[{"issue_id":"ntm-84t","depends_on_id":"ntm-239","type":"blocks","created_at":"2025-12-10T02:48:15.107071-05:00","created_by":"daemon"},{"issue_id":"ntm-84t","depends_on_id":"ntm-gcv","type":"blocks","created_at":"2025-12-10T02:55:23.275607-05:00","created_by":"daemon"}]}
{"id":"ntm-85b","title":"Implement hook executor with timeout and error handling","description":"","status":"closed","priority":1,"issue_type":"task","assignee":"WhiteHill","created_at":"2025-12-10T02:41:30.665253-05:00","updated_at":"2025-12-10T09:01:33.048253-05:00","closed_at":"2025-12-10T09:01:33.048253-05:00","dependencies":[{"issue_id":"ntm-85b","depends_on_id":"ntm-spa","type":"blocks","created_at":"2025-12-10T02:41:44.442503-05:00","created_by":"daemon"}]}
{"id":"ntm-8h3","title":"EPIC: Automation, Pipelines \u0026 Integration","description":"Advanced automation including agent pipelines, webhooks, and external integrations.\n\n## Problem Statement\nNTM is currently manual and reactive:\n- Each prompt requires explicit user action\n- No way to chain agent outputs as inputs to other agents\n- No notifications when agents finish or error\n- No integration with external tools (CI, Slack, etc.)\n- File content must be manually copied into prompts\n\n## Goals\n1. Enable pipeline mode (chain agents sequentially)\n2. Support webhook/notification on events\n3. Easy file content injection into prompts\n4. Token/cost estimation before sending expensive prompts\n\n## Success Criteria\n- `ntm pipeline` chains agent stages with output passing\n- Config supports on_error, on_complete webhooks\n- `ntm send --file=path` injects file content\n- `ntm send --estimate` shows token/cost estimate\n\n## Pipeline Mode\n```bash\nntm pipeline myproject \\\n  --stage=\"cc: Design the authentication module\" \\\n  --stage=\"cod: Implement the design from previous stage\" \\\n  --stage=\"gmi: Write tests for the implementation\"\n```\n\nEach stage:\n1. Sends prompt to specified agent type\n2. Waits for completion (detect idle state)\n3. Captures output\n4. Passes output as context to next stage\n\n## Webhook Config\n```toml\n[notifications]\non_error = \"curl -X POST https://slack.webhook/...\"\non_complete = \"terminal-notifier -message 'Done'\"\non_rate_limit = \"echo 'Rate limited' \u003e\u003e ~/ntm-alerts.log\"\n```\n\n## File Context\n```bash\nntm send myproject --all \\\n  --file=src/auth.py \\\n  --file=src/models.py:10-50 \\\n  \"Refactor these files to use dependency injection\"\n```\n\nInjects files with formatting:\n```\n# File: src/auth.py\n\\`\\`\\`python\n\u003cfile contents\u003e\n\\`\\`\\`\n```\n\n## Cost Estimation\n- Count tokens in prompt using tiktoken or similar\n- Estimate based on known pricing (Claude, Codex, Gemini)\n- Show estimate, ask for confirmation on expensive prompts\n\n## User Value\n- Sophisticated multi-stage workflows\n- Stay informed without constant monitoring\n- Faster prompt construction with file injection\n- Budget awareness for API-heavy usage","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T02:38:05.291885-05:00","updated_at":"2025-12-10T02:38:05.291885-05:00"}
{"id":"ntm-8h3.1","title":"File Context Injection (--file flag)","description":"Add --file flag to ntm send to inject file contents into prompts.\n\n## Use Case\nInstead of manually copying file contents, specify files to include:\n```bash\nntm send myproject --all \\\n  --file=src/auth.py \\\n  --file=src/models.py \\\n  \"Refactor these to use dependency injection\"\n```\n\n## Prompt Injection Format\nFiles are prepended to prompt with clear formatting:\n```\n# File: src/auth.py\n\\`\\`\\`python\n\u003ccontents of src/auth.py\u003e\n\\`\\`\\`\n\n# File: src/models.py\n\\`\\`\\`python\n\u003ccontents of src/models.py\u003e\n\\`\\`\\`\n\n---\n\nRefactor these to use dependency injection\n```\n\n## Extended Syntax\n```bash\n--file=path                    # Entire file\n--file=path:10-50              # Lines 10-50\n--file=path:10-                # Line 10 to end\n--file=path:-50                # First 50 lines\n--file=path:func:my_function   # Extract function (future)\n```\n\n## Implementation\n```go\ntype FileSpec struct {\n    Path      string\n    StartLine int  // 0 = from beginning\n    EndLine   int  // 0 = to end\n}\n\nfunc ParseFileSpec(spec string) (FileSpec, error) {\n    // Parse \"path:start-end\" format\n}\n\nfunc InjectFiles(specs []FileSpec, prompt string) (string, error) {\n    var parts []string\n    \n    for _, spec := range specs {\n        content, err := readFileRange(spec)\n        if err != nil {\n            return \"\", fmt.Errorf(\"failed to read %s: %w\", spec.Path, err)\n        }\n        \n        lang := detectLanguage(spec.Path)\n        header := fmt.Sprintf(\"# File: %s\", spec.Path)\n        if spec.StartLine \u003e 0 || spec.EndLine \u003e 0 {\n            header += fmt.Sprintf(\" (lines %d-%d)\", spec.StartLine, spec.EndLine)\n        }\n        \n        parts = append(parts, fmt.Sprintf(\"%s\\n```%s\\n%s\\n```\", \n            header, lang, content))\n    }\n    \n    parts = append(parts, \"---\\n\\n\"+prompt)\n    return strings.Join(parts, \"\\n\\n\"), nil\n}\n```\n\n## Language Detection\nMap file extensions to markdown language tags:\n```go\nvar langMap = map[string]string{\n    \".py\":   \"python\",\n    \".go\":   \"go\",\n    \".js\":   \"javascript\",\n    \".ts\":   \"typescript\",\n    \".rs\":   \"rust\",\n    \".rb\":   \"ruby\",\n    \".java\": \"java\",\n    // etc.\n}\n```\n\n## Integration with Templates\nTemplates can reference {{file}} and {{files}}:\n```markdown\n---\nname: review\nvariables:\n  file: required\n---\nReview the following file for issues:\n\n{{file}}\n\nFocus on security and performance.\n```\n\n## Flags\n| Flag | Description |\n|------|-------------|\n| -f, --file | File to include (repeatable) |\n| --file-format | Format: markdown (default), raw, xml |\n| --no-file-header | Omit file path headers |\n\n## Edge Cases\n- File not found: Error with clear message\n- Binary files: Skip with warning\n- Very large files: Warn if \u003e 50KB, --force to override\n- Relative vs absolute paths: Resolve relative to cwd\n\n## Files to Modify\n- internal/cli/send.go - Add --file flag processing\n- internal/prompt/inject.go - File injection logic (new)","status":"closed","priority":1,"issue_type":"feature","assignee":"BlueLake","created_at":"2025-12-10T02:43:58.519465-05:00","updated_at":"2025-12-10T09:53:54.153461-05:00","closed_at":"2025-12-10T09:53:54.153461-05:00","dependencies":[{"issue_id":"ntm-8h3.1","depends_on_id":"ntm-8h3","type":"parent-child","created_at":"2025-12-10T02:43:58.520574-05:00","created_by":"daemon"}]}
{"id":"ntm-8js","title":"Implement ntm personas list/show commands","description":"# Implement ntm personas list/show Commands\n\n## Purpose\n\nAllow users to discover and inspect available personas.\n\n## Commands\n\n```bash\n# List all personas\nntm personas list\nntm personas list --json\n\n# Show specific persona\nntm personas show architect\nntm personas show architect --json\n```\n\n## List Output\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Available Personas                                         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Name         â”‚ Agent      â”‚ Description                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ architect    â”‚ claude     â”‚ Senior software architect      â”‚\nâ”‚ implementer  â”‚ claude     â”‚ Fast implementation engineer   â”‚\nâ”‚ reviewer     â”‚ claude     â”‚ Meticulous code reviewer       â”‚\nâ”‚ tester       â”‚ codex      â”‚ Test engineer                  â”‚\nâ”‚ documenter   â”‚ gemini     â”‚ Documentation writer           â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Source: 3 built-in, 2 user (~/.config/ntm/personas.toml)   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Show Output\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Persona: architect                                         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Agent Type:   claude                                       â”‚\nâ”‚ Model:        opus                                         â”‚\nâ”‚ Temperature:  0.7                                          â”‚\nâ”‚ Source:       built-in                                     â”‚\nâ”‚ Tags:         design, review                               â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ System Prompt:                                             â”‚\nâ”‚                                                            â”‚\nâ”‚ You are a senior software architect. Focus on:             â”‚\nâ”‚ - System design and high-level structure                   â”‚\nâ”‚ - Reviewing and guiding implementation                     â”‚\nâ”‚ - Identifying architectural risks                          â”‚\nâ”‚ - NOT writing implementation code (delegate that)          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Context Files:                                             â”‚\nâ”‚ - ARCHITECTURE.md                                          â”‚\nâ”‚ - docs/design/*.md                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## JSON Output\n\n```json\n{\n  \"name\": \"architect\",\n  \"description\": \"Senior software architect\",\n  \"agent_type\": \"claude\",\n  \"model\": \"opus\",\n  \"temperature\": 0.7,\n  \"system_prompt\": \"...\",\n  \"context_files\": [\"ARCHITECTURE.md\", \"docs/design/*.md\"],\n  \"tags\": [\"design\", \"review\"],\n  \"source\": \"built-in\"\n}\n```\n\n## Acceptance Criteria\n\n- [ ] ntm personas list shows all personas\n- [ ] ntm personas show displays details\n- [ ] Source indicator (built-in, user, project)\n- [ ] --json output for scripts\n- [ ] Filtering by tag or agent type","status":"closed","priority":2,"issue_type":"task","assignee":"WhiteStone","created_at":"2025-12-10T03:23:49.772792-05:00","updated_at":"2025-12-10T04:39:02.092809-05:00","closed_at":"2025-12-10T04:39:02.092809-05:00","dependencies":[{"issue_id":"ntm-8js","depends_on_id":"ntm-hzl","type":"blocks","created_at":"2025-12-10T03:24:01.048364-05:00","created_by":"daemon"}]}
{"id":"ntm-8ua","title":"Match idle agents to ready beads based on priority scores","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:25.890207-05:00","updated_at":"2025-12-10T03:32:06.28291-05:00","closed_at":"2025-12-10T03:32:06.28291-05:00","dependencies":[{"issue_id":"ntm-8ua","depends_on_id":"ntm-xmx","type":"blocks","created_at":"2025-12-10T03:28:05.464417-05:00","created_by":"daemon"}]}
{"id":"ntm-8zd","title":"Add critical path highlighting with keystone indicators","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:27:08.695214-05:00","updated_at":"2025-12-10T03:32:04.960375-05:00","closed_at":"2025-12-10T03:32:04.960375-05:00","dependencies":[{"issue_id":"ntm-8zd","depends_on_id":"ntm-9cs","type":"blocks","created_at":"2025-12-10T03:28:03.142918-05:00","created_by":"daemon"}]}
{"id":"ntm-946","title":"Implement two-phase startup architecture","description":"","status":"open","priority":1,"issue_type":"feature","assignee":"BlackCat","created_at":"2025-12-10T02:40:38.039595-05:00","updated_at":"2025-12-10T04:38:34.151145-05:00","comments":[{"id":4,"issue_id":"ntm-946","author":"jemanuel","text":"-","created_at":"2025-12-10T07:40:59Z"}]}
{"id":"ntm-97c5","title":"EPIC: IDE Integration (VS Code)","description":"# IDE Integration (VS Code Extension)\n\n## Background \u0026 Motivation\n\nMost developers work primarily in VS Code. IDE integration reduces context switching and enables unique value that terminal-only can't provide.\n\n## CRITICAL: Focus on Unique IDE Value\n\nThe terminal TUI is already excellent. Don't rebuild it in VS Code.\n\n**Unique IDE value:**\n1. **Editor context injection**: Send selected code/current file to agents\n2. **Quick access**: Status bar for at-a-glance info\n3. **File decorations**: Show lock status in explorer\n\n**NOT prioritized:**\n- Full dashboard webview (duplicates TUI)\n- Complex session management (use terminal)\n\n## What the Extension Provides\n\n### 1. Status Bar (High Value, Low Effort)\n```\n[NTM: myproject â— 4 agents]\n```\n- Click to open command palette\n- Shows session name, agent count\n- Color indicates status (green=ok, yellow=warning)\n\n### 2. Commands (High Value, Medium Effort)\n```\nNTM: Send Selection to Agent\nNTM: Send Current File to Agent\nNTM: Spawn Agents for Project\nNTM: Show Session Status\nNTM: Open Terminal (attach to session)\n```\n\n### 3. Context Injection (Killer Feature)\n```typescript\n// When user invokes \"Send Selection\"\nconst selection = editor.selection;\nconst text = editor.document.getText(selection);\nconst filePath = editor.document.fileName;\n\n// Construct context-aware prompt\nconst prompt = `\nFile: ${filePath}\nSelected code:\n\\`\\`\\`\n${text}\n\\`\\`\\`\n\n[User's instruction here]\n`;\n\n// Send via ntm send\nawait ntm.send(session, target, prompt);\n```\n\n### 4. File Decorations (Medium Value, Medium Effort)\nShow lock status in file explorer:\n- ğŸ”’ icon for locked files\n- Tooltip: \"Locked by GreenCastle (cc_1)\"\n- Requires Agent Mail integration\n\n### 5. Simple Session View (Optional)\nActivity bar panel with:\n- List of sessions\n- Agent count per session\n- Quick actions (attach, kill)\n\nNOT a full dashboard - just navigation.\n\n## What We're NOT Building\n\n- âŒ Full webview dashboard (use terminal TUI)\n- âŒ Inline agent chat (complex, scope creep)\n- âŒ Custom editor for prompts (overkill)\n\n## Technical Approach\n\n### CLI Wrapper\n```typescript\nclass NtmClient {\n    async getStatus(): Promise\u003cRobotStatus\u003e {\n        const result = await exec('ntm --robot-status');\n        return JSON.parse(result.stdout);\n    }\n    \n    async send(session: string, target: string, prompt: string): Promise\u003cvoid\u003e {\n        await exec(`ntm send ${session} ${target} ${quote(prompt)}`);\n    }\n}\n```\n\n### Extension Activation\nActivate when:\n- Workspace contains .ntm/ directory\n- User runs NTM command\n- NTM status bar clicked\n\n## Priority Order\n\n1. **P2**: Status bar + basic commands (NTM: Spawn, Send)\n2. **P2**: Context injection (Send Selection)\n3. **P3**: File decorations (requires Agent Mail)\n4. **P3**: Session tree view\n5. **P4**: Webview (if ever)\n\n## Success Criteria\n\n- [ ] Status bar shows current session\n- [ ] Commands in palette for common actions\n- [ ] \"Send Selection to Agent\" works with context\n- [ ] Extension published to marketplace\n- [ ] Minimal dependencies, fast activation\n- [ ] Degrades gracefully if ntm not installed","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T03:28:29.775574-05:00","updated_at":"2025-12-10T03:37:02.457909-05:00"}
{"id":"ntm-99v","title":"Refactor internal/tui/styles to use lipgloss.Width","description":"","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-10T03:03:06.802912-05:00","updated_at":"2025-12-10T03:13:10.42773-05:00","closed_at":"2025-12-10T03:13:10.42773-05:00"}
{"id":"ntm-9cs","title":"Create graph visualization component for dashboard","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:08.325024-05:00","updated_at":"2025-12-10T03:32:04.659596-05:00","closed_at":"2025-12-10T03:32:04.659596-05:00","dependencies":[{"issue_id":"ntm-9cs","depends_on_id":"ntm-ldy","type":"blocks","created_at":"2025-12-10T03:28:02.815351-05:00","created_by":"daemon"}]}
{"id":"ntm-9jj","title":"Include bead context in compaction recovery prompts","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:27:30.9117-05:00","updated_at":"2025-12-10T03:49:53.580288-05:00","closed_at":"2025-12-10T03:49:53.580288-05:00","dependencies":[{"issue_id":"ntm-9jj","depends_on_id":"ntm-26c","type":"blocks","created_at":"2025-12-10T03:28:05.78951-05:00","created_by":"daemon"},{"issue_id":"ntm-9jj","depends_on_id":"ntm-r2k","type":"blocks","created_at":"2025-12-10T03:28:05.877817-05:00","created_by":"daemon"},{"issue_id":"ntm-9jj","depends_on_id":"ntm-igpj","type":"blocks","created_at":"2025-12-10T03:32:50.639204-05:00","created_by":"daemon"}]}
{"id":"ntm-9sw","title":"Add --json flag to spawn, create, add commands","description":"","status":"closed","priority":1,"issue_type":"task","assignee":"WhiteStone","created_at":"2025-12-10T02:39:53.508861-05:00","updated_at":"2025-12-10T04:20:57.974153-05:00","closed_at":"2025-12-10T04:20:57.974153-05:00","dependencies":[{"issue_id":"ntm-9sw","depends_on_id":"ntm-517","type":"blocks","created_at":"2025-12-10T02:40:13.265774-05:00","created_by":"daemon"}]}
{"id":"ntm-a8q","title":"Implement --robot-ack for send confirmation","description":"Track and confirm message receipt by agents.\n\n## Rationale\nAfter --robot-send, I need to know:\n1. Did the agent receive the message?\n2. Did the agent acknowledge understanding?\n3. Is the agent actively working on it?\n\nWithout this, I'm blind after sending - I have to poll tail output and parse for confirmation patterns.\n\n## Proposal: Ack Tracking\nWhen sending with --robot-send --track, ntm:\n1. Watches pane output for acknowledgment patterns\n2. Returns structured confirmation\n\n## Output Structure\n```json\n{\n  \"session\": \"myproject\",\n  \"sent_at\": \"ISO8601\",\n  \"confirmations\": [\n    {\n      \"pane\": \"0.1\",\n      \"ack_type\": \"prompt_returned\",  // agent showed ready prompt\n      \"ack_at\": \"ISO8601\",\n      \"latency_ms\": 234\n    },\n    {\n      \"pane\": \"0.2\",\n      \"ack_type\": \"echo_detected\",    // agent echoed input\n      \"ack_at\": \"ISO8601\",\n      \"latency_ms\": 156\n    }\n  ],\n  \"pending\": [\"0.3\"],  // still waiting\n  \"failed\": []\n}\n```\n\n## Ack Detection Patterns\n- prompt_returned: Agent shows ready prompt after processing\n- echo_detected: Input echoed in pane (basic confirmation)\n- explicit_ack: Agent responds with understood/acknowledged\n- output_started: Agent begins producing output\n\n## Timeout Handling\n--timeout=30s - wait up to 30s for acks\nReturns partial result with pending list if timeout","status":"closed","priority":1,"issue_type":"task","assignee":"ChartreuseCat","created_at":"2025-12-10T02:58:03.223434-05:00","updated_at":"2025-12-10T09:05:10.318811-05:00","closed_at":"2025-12-10T09:05:10.318811-05:00"}
{"id":"ntm-a9nk","title":"Enable UBS dogfooding: run scans on NTM codebase","description":"## Overview\nNTM should eat its own dog food by using UBS to scan its own Go codebase, demonstrating the integration and catching real issues.\n\n## Background\nPer AGENTS.md: 'ubs \u003cchanged-files\u003e before every commit. Exit 0 = safe.'\n\nIf NTM integrates UBS, it should use it on itself. This:\n- Proves the integration works on real code\n- Catches bugs in NTM's Go code\n- Provides example output for documentation\n- Builds confidence in the tooling\n\n## Implementation\n\n### CI Integration\n- Add UBS scan step to any CI/CD pipeline\n- Fail PR if critical issues found\n- Cache UBS installation for speed\n\n### Developer Workflow  \n- Document in README: 'Run `ntm scan .` before commits'\n- Or just `ubs .` until ntm scan is implemented\n- Add to CONTRIBUTING guidelines (if we had one)\n\n### Initial Scan\n- Run full scan on current codebase\n- Triage and fix any critical/error findings\n- Document false positives for future reference\n\n## Acceptance Criteria\n- [ ] Initial full scan completed\n- [ ] Critical issues fixed or documented as false positives\n- [ ] CI integration (if applicable)\n- [ ] Developer workflow documented","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:39:09.927684-05:00","updated_at":"2025-12-10T03:52:19.449596-05:00","closed_at":"2025-12-10T03:52:19.449596-05:00","dependencies":[{"issue_id":"ntm-a9nk","depends_on_id":"ntm-lk66","type":"blocks","created_at":"2025-12-10T03:39:19.512658-05:00","created_by":"daemon"}]}
{"id":"ntm-ad3","title":"Integration Test: config loading and command behavior","description":"# Integration Test: Config â†’ Commands\n\n## Scope\nVerify configuration affects command behavior correctly.\n\n## Test Scenarios\n\n### Scenario 1: Custom Agent Commands\n- Create config with custom agent commands\n- Spawn session\n- Verify custom commands are used in panes\n\n### Scenario 2: Custom Projects Base\n- Set custom projects_base in config\n- Run ntm quick\n- Verify project created in custom location\n\n### Scenario 3: Palette from Config\n- Define [[palette]] entries in config\n- Open palette\n- Verify commands appear correctly\n\n### Scenario 4: Palette from Markdown\n- Create command_palette.md\n- Verify commands loaded from markdown\n\n### Scenario 5: Config Precedence\n- Set value in both config file and default\n- Verify file takes precedence\n\n## Implementation\n- tests/integration/config_test.go\n- Create temp config files per test\n- Use environment variables for paths\n- Cleanup temp dirs after test","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:23:17.049961-05:00","updated_at":"2025-12-10T03:23:17.049961-05:00","dependencies":[{"issue_id":"ntm-ad3","depends_on_id":"ntm-66c","type":"blocks","created_at":"2025-12-10T03:24:41.540817-05:00","created_by":"daemon"},{"issue_id":"ntm-ad3","depends_on_id":"ntm-7lk","type":"blocks","created_at":"2025-12-10T03:24:42.610247-05:00","created_by":"daemon"}]}
{"id":"ntm-aqqa","title":"Implement pre-commit hook for UBS quality gate","description":"## Overview\nCreate a pre-commit hook that runs UBS scans and blocks commits containing critical issues, ensuring code quality standards are maintained.\n\n## Background\nPre-commit hooks provide the last line of defense before code enters the repository. Integrating UBS here:\n- Catches issues before they're committed\n- Provides immediate feedback to developers/agents\n- Enforces quality standards consistently\n\n## Implementation Details\n\n### Hook Behavior\n1. On commit, run UBS on staged files only (fast path)\n2. Parse results and check against configurable thresholds\n3. Block commit if thresholds exceeded\n4. Output clear, actionable error messages\n\n### Configuration (.ntm.yaml or similar)\n```yaml\nscan:\n  pre_commit:\n    enabled: true\n    block_on:\n      critical: true  # Block on any critical\n      error: 5        # Block if \u003e5 errors\n      warning: false  # Don't block on warnings\n    timeout: 30s\n    exclude:\n      - \"*.test.go\"\n      - \"vendor/**\"\n```\n\n### Hook Installation\n- `ntm hooks install` - Install pre-commit hook\n- `ntm hooks uninstall` - Remove hook\n- Hook script delegates to `ntm scan --staged --strict`\n\n### Output Format\n```\nğŸš« Commit blocked by NTM quality gate\n\nFound 2 critical issues in staged files:\n\n  src/auth/login.go:45 [critical] SQL injection vulnerability\n  src/api/handler.go:123 [critical] Unhandled error return\n\nRun 'ntm scan --staged' for details.\nTo bypass: git commit --no-verify (not recommended)\n```\n\n### Files to Create/Modify\n- internal/hooks/precommit.go - Hook logic\n- internal/hooks/install.go - Hook installation\n- internal/cli/hooks.go - hooks subcommand\n- scripts/pre-commit.sh - Actual hook script template\n\n## Acceptance Criteria\n- [ ] Hook installs correctly in git repo\n- [ ] Only staged files are scanned (fast)\n- [ ] Configurable blocking thresholds\n- [ ] Clear error messages with file:line references\n- [ ] Bypass option documented but discouraged","status":"closed","priority":0,"issue_type":"task","assignee":"WhiteStone","created_at":"2025-12-10T03:33:34.385746-05:00","updated_at":"2025-12-10T03:56:22.357164-05:00","closed_at":"2025-12-10T03:56:22.357164-05:00","dependencies":[{"issue_id":"ntm-aqqa","depends_on_id":"ntm-p77j","type":"blocks","created_at":"2025-12-10T03:34:59.453887-05:00","created_by":"daemon"},{"issue_id":"ntm-aqqa","depends_on_id":"ntm-lk66","type":"blocks","created_at":"2025-12-10T03:35:16.639902-05:00","created_by":"daemon"}]}
{"id":"ntm-bcr","title":"EPIC: Session Presets (Recipes)","description":"","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T02:39:13.104435-05:00","updated_at":"2025-12-10T02:39:13.104435-05:00","comments":[{"id":6,"issue_id":"ntm-bcr","author":"jemanuel","text":"-","created_at":"2025-12-10T07:42:01Z"}]}
{"id":"ntm-bh5","title":"EPIC: Session Persistence \u0026 Recovery","description":"Sessions survive reboots and can be recreated from saved state.\n\n## Problem Statement\nTmux sessions are ephemeral - a reboot or accidental kill loses everything:\n- Agent counts, types, and arrangements must be manually recreated\n- Working directory and project context is lost\n- No way to 'bookmark' a useful session configuration\n- Users avoid rebooting to preserve valuable sessions\n\n## Goals\n1. Capture complete session state (agents, layout, cwd, env)\n2. Enable session recreation from saved state\n3. Support periodic auto-snapshots for safety\n4. Make session configs portable across machines\n\n## Success Criteria\n- `ntm session save` captures full session state to disk\n- `ntm session restore` recreates session exactly\n- Auto-snapshot on session creation (optional)\n- `ntm session list --saved` shows available saved sessions\n\n## Technical Approach\n- Session state stored as JSON in ~/.local/share/ntm/sessions/\n- Capture: session name, cwd, agent types/counts, layout, pane titles\n- Restore: create session, spawn agents, apply layout\n- Handle conflicts (session already exists) gracefully\n\n## State Schema\n```json\n{\n  \"name\": \"myproject\",\n  \"cwd\": \"/path/to/project\",\n  \"agents\": {\"cc\": 2, \"cod\": 1, \"gmi\": 1},\n  \"layout\": \"tiled\",\n  \"panes\": [{\"title\": \"myproject__cc_1\", \"command\": \"claude\"}],\n  \"created\": \"2025-12-10T10:00:00Z\",\n  \"saved\": \"2025-12-10T12:00:00Z\"\n}\n```\n\n## User Value\n- Fearless reboots - sessions are recoverable\n- Consistent project setups across machines\n- Reduced friction starting work each day\n- Backup for accidental session kills","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T02:37:01.748915-05:00","updated_at":"2025-12-10T02:37:01.748915-05:00"}
{"id":"ntm-bh5.1","title":"Session State Capture","description":"Capture complete session state to JSON for later restoration.\n\n## State to Capture\n```go\ntype SessionState struct {\n    // Identity\n    Name      string    `json:\"name\"`\n    SavedAt   time.Time `json:\"saved_at\"`\n    \n    // Context\n    WorkDir   string    `json:\"cwd\"`\n    GitBranch string    `json:\"git_branch,omitempty\"`\n    GitRemote string    `json:\"git_remote,omitempty\"`\n    \n    // Agent Configuration\n    Agents    AgentSpec `json:\"agents\"`  // {cc: 2, cod: 1, gmi: 1}\n    \n    // Pane Details (for exact recreation)\n    Panes     []PaneState `json:\"panes\"`\n    \n    // Layout\n    Layout    string    `json:\"layout\"`  // \"tiled\", \"even-horizontal\", etc.\n    \n    // Metadata\n    CreatedAt time.Time `json:\"created_at\"`  // Original session creation\n    Version   int       `json:\"version\"`     // Schema version for migrations\n}\n\ntype PaneState struct {\n    Title     string `json:\"title\"`      // e.g., \"myproject__cc_1\"\n    Index     int    `json:\"index\"`\n    AgentType string `json:\"agent_type\"` // \"cc\", \"cod\", \"gmi\", \"user\"\n    Command   string `json:\"command\"`    // The agent launch command\n    Active    bool   `json:\"active\"`     // Was this the active pane?\n}\n```\n\n## Capture Process\n1. Get session info from tmux\n2. Get all panes with metadata\n3. Detect working directory (from pane 0 or explicit)\n4. Get git context if in repo\n5. Serialize to JSON\n6. Write to storage location\n\n## Command Interface\n```bash\nntm session save                 # Save current session (in tmux)\nntm session save myproject       # Save specific session\nntm session save --name=alias    # Save with custom name\nntm session save --overwrite     # Overwrite existing save\n```\n\n## Storage\nLocation: ~/.local/share/ntm/sessions/\u003cname\u003e.json\n\nDirectory structure:\n```\n~/.local/share/ntm/sessions/\nâ”œâ”€â”€ myproject.json\nâ”œâ”€â”€ frontend.json\nâ””â”€â”€ backend.json\n```\n\n## Implementation\n```go\nfunc CaptureSessionState(sessionName string) (*SessionState, error) {\n    session, err := tmux.GetSession(sessionName)\n    if err \\!= nil {\n        return nil, err\n    }\n    \n    panes, err := tmux.GetPanes(sessionName)\n    if err \\!= nil {\n        return nil, err\n    }\n    \n    // Extract agent configuration from pane names\n    agents := countAgents(panes)\n    \n    // Get working directory\n    cwd := detectWorkDir(panes)\n    \n    // Get git info if applicable\n    gitBranch, gitRemote := getGitInfo(cwd)\n    \n    return \u0026SessionState{\n        Name:      sessionName,\n        SavedAt:   time.Now(),\n        WorkDir:   cwd,\n        GitBranch: gitBranch,\n        GitRemote: gitRemote,\n        Agents:    agents,\n        Panes:     mapPaneStates(panes),\n        Layout:    session.Layout,\n        CreatedAt: session.Created,\n        Version:   1,\n    }, nil\n}\n```\n\n## Files to Create\n- internal/session/state.go - State data structures\n- internal/session/capture.go - Capture logic\n- internal/session/storage.go - File I/O","status":"in_progress","priority":1,"issue_type":"feature","assignee":"BlueLake","created_at":"2025-12-10T02:41:31.459939-05:00","updated_at":"2025-12-10T09:55:02.697172-05:00","dependencies":[{"issue_id":"ntm-bh5.1","depends_on_id":"ntm-bh5","type":"parent-child","created_at":"2025-12-10T02:41:31.46201-05:00","created_by":"daemon"}]}
{"id":"ntm-bh5.2","title":"Session Restore Command","description":"Recreate sessions from saved state.\n\n## Command Interface\n```bash\nntm session restore myproject           # Restore saved session\nntm session restore myproject --force   # Overwrite if exists\nntm session restore myproject --attach  # Attach after restore\nntm session restore --list              # List available saves\n```\n\n## Restore Process\n1. Load saved state from JSON\n2. Check if session already exists\n   - If exists and no --force, error out\n   - If exists and --force, kill existing first\n3. Create new tmux session\n4. Create panes with correct agent commands\n5. Apply saved layout\n6. Optionally attach\n\n## Implementation\n```go\nfunc RestoreSession(state *SessionState, force bool) error {\n    // Check for existing session\n    if tmux.SessionExists(state.Name) {\n        if \\!force {\n            return fmt.Errorf(\"session '%s' already exists (use --force to overwrite)\", state.Name)\n        }\n        tmux.KillSession(state.Name)\n    }\n    \n    // Create session with first pane\n    err := tmux.CreateSession(state.Name, state.WorkDir)\n    if err \\!= nil {\n        return err\n    }\n    \n    // Create additional panes\n    for i, pane := range state.Panes[1:] {\n        err := tmux.CreatePane(state.Name, pane.Command)\n        if err \\!= nil {\n            return fmt.Errorf(\"failed to create pane %d: %w\", i+1, err)\n        }\n        tmux.RenamePane(state.Name, i+1, pane.Title)\n    }\n    \n    // Apply layout\n    tmux.ApplyLayout(state.Name, state.Layout)\n    \n    return nil\n}\n```\n\n## Edge Cases\n\n### Working Directory Missing\nIf saved cwd doesn't exist:\n- Warn user\n- Fall back to /Users/jemanuel\n- Or create directory if it looks like a project path\n\n### Agent Commands Changed\nConfig may have changed agent commands since save:\n- Use current config commands, not saved commands\n- Saved commands are for reference/debugging\n\n### Git State\nOptionally restore git context:\n- `--checkout` flag to checkout saved branch\n- Default: just warn if branch differs\n\n## Conflict Resolution\n```bash\n$ ntm session restore myproject\nError: session 'myproject' already exists\n\nOptions:\n  --force    Kill existing and restore\n  --rename   Restore as 'myproject-restored'\n  --merge    Add missing agents to existing (not implemented)\n```\n\n## List Saved Sessions\n```bash\n$ ntm session list --saved\nNAME         SAVED AT              AGENTS      CWD\nmyproject    2025-12-10 10:00:00   cc:2 cod:1  /home/user/myproject\nfrontend     2025-12-09 15:30:00   cc:3        /home/user/frontend\n```\n\n## Files to Create\n- internal/cli/session_restore.go - Command\n- internal/session/restore.go - Restore logic","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-10T02:41:55.093007-05:00","updated_at":"2025-12-10T02:41:55.093007-05:00","dependencies":[{"issue_id":"ntm-bh5.2","depends_on_id":"ntm-bh5","type":"parent-child","created_at":"2025-12-10T02:41:55.095108-05:00","created_by":"daemon"},{"issue_id":"ntm-bh5.2","depends_on_id":"ntm-bh5.1","type":"blocks","created_at":"2025-12-10T02:41:55.096413-05:00","created_by":"daemon"}]}
{"id":"ntm-bke","title":"EPIC: Per-Project Configuration","description":"Project-specific settings, defaults, and palettes via .ntm/ directory.\n\n## Problem Statement\nAll NTM configuration is global (~/.config/ntm/):\n- Different projects may need different agent mixes\n- Project-specific palette commands aren't discoverable\n- Team members can't share project NTM settings via git\n- No way to 'just clone and go' with project-specific agent setup\n\n## Goals\n1. Auto-detect .ntm/ directory in project roots\n2. Support project-specific config that overrides/merges with global\n3. Enable project palettes (command_palette.md in .ntm/)\n4. Make project NTM config git-committable for team sharing\n\n## Success Criteria\n- `ntm spawn` in project uses .ntm/config.toml defaults\n- `ntm palette` includes .ntm/palette.md commands\n- Config precedence: CLI flags \u003e project \u003e global \u003e defaults\n- `ntm config project init` creates .ntm/ scaffold\n\n## Directory Structure\n```\nmyproject/\nâ”œâ”€â”€ .ntm/\nâ”‚   â”œâ”€â”€ config.toml      # Project overrides\nâ”‚   â”œâ”€â”€ palette.md       # Project-specific commands\nâ”‚   â””â”€â”€ templates/       # Project templates\nâ”‚       â””â”€â”€ review.md\nâ”œâ”€â”€ src/\nâ””â”€â”€ ...\n```\n\n## Config Merge Rules\n1. Project config extends (not replaces) global config\n2. Explicit values in project override global\n3. Arrays (like palette commands) are merged\n4. CLI flags always win\n\n## Example .ntm/config.toml\n```toml\n[defaults]\nagents = { cc = 2, cod = 1 }  # No Gemini for this project\n\n[palette]\n# Extends global palette\nfile = \".ntm/palette.md\"\n\n[templates]\n# Project-specific templates\npr_review = \"Review this PR for our coding standards...\"\n```\n\n## User Value\n- Clone repo, run ntm spawn, get project-appropriate setup\n- Share team conventions via committed config\n- Different projects can have different agent strategies\n- Palette commands tailored to project needs","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T02:37:44.06523-05:00","updated_at":"2025-12-10T02:37:44.06523-05:00"}
{"id":"ntm-bke.1","title":"Project Config Discovery (.ntm/)","description":"Auto-detect and load .ntm/ directory configuration from project roots.\n\n## Overview\nWhen running NTM commands in a project directory, automatically discover and load .ntm/config.toml to customize behavior per-project.\n\n## Directory Structure\n```\nmyproject/\nâ”œâ”€â”€ .ntm/\nâ”‚   â”œâ”€â”€ config.toml      # Project settings\nâ”‚   â”œâ”€â”€ palette.md       # Project commands\nâ”‚   â””â”€â”€ templates/       # Project templates\nâ”œâ”€â”€ src/\nâ””â”€â”€ ...\n```\n\n## Discovery Algorithm\n```go\nfunc FindProjectConfig(startDir string) (*ProjectConfig, error) {\n    dir := startDir\n    for {\n        configPath := filepath.Join(dir, \".ntm\", \"config.toml\")\n        if fileExists(configPath) {\n            return LoadProjectConfig(configPath)\n        }\n        \n        parent := filepath.Dir(dir)\n        if parent == dir { // Reached root\n            return nil, nil // No project config\n        }\n        dir = parent\n    }\n}\n```\n\n## Config Merge Order\n1. Hardcoded defaults (in binary)\n2. Global config (~/.config/ntm/config.toml)\n3. Project config (.ntm/config.toml)\n4. CLI flags\n\nLater sources override earlier ones.\n\n```go\nfunc LoadMergedConfig() *Config {\n    cfg := DefaultConfig()\n    \n    if global, err := LoadGlobalConfig(); err == nil {\n        cfg = MergeConfig(cfg, global)\n    }\n    \n    if project, err := FindProjectConfig(cwd); err == nil \u0026\u0026 project != nil {\n        cfg = MergeConfig(cfg, project)\n    }\n    \n    return cfg\n}\n```\n\n## Project Config Schema\n```toml\n# .ntm/config.toml\n\n# Default agent counts when spawning\n[defaults]\nagents = { cc = 2, cod = 1 }  # No Gemini for this project\n\n# Project palette extends global\n[palette]\nfile = \"palette.md\"  # Relative to .ntm/\n\n# Project templates extend global\n[templates]\ndir = \"templates\"  # Relative to .ntm/\n\n# Custom agent commands for this project\n[agents]\n# Override default Claude command\nclaude = \"claude --project /path/to/claude-config\"\n```\n\n## Init Command\n```bash\nntm config project init           # Create .ntm/ scaffold\nntm config project init --force   # Overwrite existing\n```\n\nCreates:\n```\n.ntm/\nâ”œâ”€â”€ config.toml    # With comments explaining options\nâ”œâ”€â”€ palette.md     # Empty palette scaffold\nâ””â”€â”€ templates/     # Empty directory\n```\n\n## Detection in Commands\nAll commands that use config should call merged config:\n```go\nfunc newSpawnCmd() *cobra.Command {\n    return \u0026cobra.Command{\n        RunE: func(cmd *cobra.Command, args []string) error {\n            cfg := config.LoadMerged() // \u003c-- Uses project config if present\n            // ...\n        },\n    }\n}\n```\n\n## Files to Modify/Create\n- internal/config/project.go - Project config discovery\n- internal/config/merge.go - Config merging logic\n- internal/cli/config.go - Add 'project init' subcommand","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T02:43:23.935269-05:00","updated_at":"2025-12-10T02:43:23.935269-05:00","dependencies":[{"issue_id":"ntm-bke.1","depends_on_id":"ntm-bke","type":"parent-child","created_at":"2025-12-10T02:43:23.936439-05:00","created_by":"daemon"}]}
{"id":"ntm-bvn","title":"Display agent-to-bead assignments on graph nodes","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:27:08.565031-05:00","updated_at":"2025-12-10T03:32:04.836537-05:00","closed_at":"2025-12-10T03:32:04.836537-05:00","dependencies":[{"issue_id":"ntm-bvn","depends_on_id":"ntm-9cs","type":"blocks","created_at":"2025-12-10T03:28:03.062394-05:00","created_by":"daemon"}]}
{"id":"ntm-c2b","title":"EPIC: Plugin \u0026 Extension System","description":"Allow users to extend NTM with custom agents, commands, and hooks.\n\n## Problem Statement\n\nNTM currently supports three hardcoded agent types: Claude, Codex, Gemini.\nUsers may want to use other agents or customize behavior:\n\n1. **Other AI Agents**: Cursor, Aider, Continue, OpenAI API, local LLMs\n2. **Custom Workflows**: Project-specific commands and automation\n3. **Integration Hooks**: Run scripts before/after NTM operations\n4. **Team Customization**: Share agent configs across a team\n\nCurrently, users must fork NTM to add new agent types or modify behavior.\n\n## Goals\n\n1. Allow custom agent definitions via config files\n2. Support custom commands as executable scripts\n3. Provide hook system for pre/post command execution\n4. Make plugins discoverable and easy to install\n5. Document plugin development clearly\n\n## Why This Matters\n\nExtensibility enables:\n- Immediate support for any new AI coding agent\n- Project-specific workflows without code changes\n- Team-shared configurations and standards\n- Community plugin ecosystem\n- Future-proofing against agent landscape changes\n\n## Success Criteria\n\n- Users can define custom agents in ~/.config/ntm/agents/\n- ntm spawn myproject --cursor=2 (custom agent)\n- Users can add commands via ~/.config/ntm/commands/\n- ntm my-custom-command (runs script)\n- Hooks fire at defined extension points\n- ntm plugins list shows installed plugins\n\n## Plugin Types\n\n### 1. Agent Plugins (~/.config/ntm/agents/*.toml)\n\nDefine new agent types:\n\n# cursor.toml\n[agent]\nname = \"cursor\"\nalias = \"cur\"\ncommand = \"cursor --headless --ai-mode\"\ndescription = \"Cursor AI editor\"\ndefault_tags = [\"cursor\", \"editor\"]\n\nUsage: ntm spawn myproject --cursor=2\n\n### 2. Command Plugins (~/.config/ntm/commands/*)\n\nExecutable scripts become commands:\n\n#\\!/bin/bash\n# ~/.config/ntm/commands/sync-all\n# Description: Sync all agents with latest code\n\nfor session in $(ntm list --json | jq -r '.[].name'); do\n  ntm send \"$session\" --all \"git pull \u0026\u0026 review changes\"\ndone\n\nUsage: ntm sync-all\n\n### 3. Hook Plugins (~/.config/ntm/hooks/*)\n\nRun before/after NTM commands:\n\n# hooks.toml\n[hooks.pre_send]\ncommand = \"~/.config/ntm/hooks/log-prompt.sh\"\npass_args = true\n\n[hooks.post_spawn]\ncommand = \"notify-send 'NTM' 'Session created'\"\n\n## Technical Approach\n\nPlugin Discovery:\n- Scan known directories on startup\n- Cache plugin metadata for performance\n- Reload on ntm plugins refresh\n\nAgent Plugin Loading:\n- Parse TOML to AgentConfig struct\n- Register with spawn/add commands\n- Generate shell integration aliases\n\nCommand Plugin Execution:\n- Discover executables in commands/\n- Run with NTM context in environment\n- Pass JSON via stdin, capture stdout/stderr\n\nHook Execution:\n- Define extension points in each command\n- Run hooks synchronously (pre) or async (post)\n- Pass command context as JSON\n- Fail-safe: hook errors don't break NTM\n\n## Security Considerations\n\n- Plugins are user-installed, user-trusted\n- No automatic plugin download/installation\n- Clear documentation of execution context\n- Hooks can see all command arguments\n- Consider --no-hooks flag for sensitive operations\n\n## Interaction with Other Features\n\n- JSON Output: Plugin commands can use --json\n- Config: Plugins extend config schema\n- Remote: Plugins work locally, commands sent to remote\n- Tags: Custom agents can have default tags\n\n## Future Possibilities\n\n- Plugin registry/marketplace\n- Version pinning for plugins\n- Plugin dependencies\n- Programmatic plugin API (Go plugins)\n","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T02:45:26.227462-05:00","updated_at":"2025-12-10T02:45:26.227462-05:00"}
{"id":"ntm-c36","title":"Implement --robot-health for agent health matrix","description":"Focused health check returning responsiveness and activity metrics.\n\n## Rationale\n--robot-snapshot includes health data, but sometimes I just need a quick health check without the full state. This is the lightweight \"are things working\" query.\n\n## Output Structure\n```json\n{\n  \"checked_at\": \"ISO8601\",\n  \"system\": {\n    \"tmux_ok\": true,\n    \"disk_free_gb\": 42.5,\n    \"load_avg\": 1.2\n  },\n  \"sessions\": {\n    \"myproject\": {\n      \"healthy\": true,\n      \"agents\": {\n        \"0.1\": {\"responsive\": true, \"output_rate\": \"high\", \"last_activity_sec\": 2},\n        \"0.2\": {\"responsive\": true, \"output_rate\": \"low\", \"last_activity_sec\": 45},\n        \"0.3\": {\"responsive\": false, \"issue\": \"no_output_5min\"}\n      }\n    }\n  },\n  \"alerts\": [\"0.3: no output 5min\"]\n}\n```\n\n## Health Heuristics\n- responsive: has pane produced output recently AND is tmux pane alive\n- output_rate: high (\u003e1 line/sec), medium, low (\u003c1 line/min), none\n- last_activity_sec: time since last output line\n\n## Alert Conditions\n- No output for 5 minutes (configurable)\n- Pane process exited\n- High CPU in pane (if detectable)\n- Disk space low\n- Session unexpectedly killed\n\n## Use Cases\n1. Quick sanity check before sending batch instructions\n2. Detect stuck agents for restart\n3. System health monitoring\n4. Pre-flight check before spawning more agents","status":"closed","priority":1,"issue_type":"task","assignee":"BlackSnow","created_at":"2025-12-10T02:51:22.401882-05:00","updated_at":"2025-12-10T09:26:09.134385-05:00","closed_at":"2025-12-10T09:26:09.134385-05:00"}
{"id":"ntm-cbi","title":"Implement --robot-distribute for bv-based agent assignment","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:27:25.61131-05:00","updated_at":"2025-12-10T03:32:06.104599-05:00","closed_at":"2025-12-10T03:32:06.104599-05:00","dependencies":[{"issue_id":"ntm-cbi","depends_on_id":"ntm-peo","type":"blocks","created_at":"2025-12-10T03:28:05.085451-05:00","created_by":"daemon"}]}
{"id":"ntm-ceb","title":"Create internal/agentmail HTTP client package","description":"# Create internal/agentmail HTTP Client Package\n\n## Purpose\n\nFoundation for all Agent Mail integration. This package provides a clean Go interface to the MCP Agent Mail HTTP API.\n\n## Technical Details\n\n### Package Structure\n```\ninternal/agentmail/\nâ”œâ”€â”€ client.go       # HTTP client with connection pooling, retries\nâ”œâ”€â”€ types.go        # Go structs matching Agent Mail data model\nâ”œâ”€â”€ tools.go        # Methods for each MCP tool (send_message, fetch_inbox, etc.)\nâ”œâ”€â”€ resources.go    # Methods for MCP resources (resource://inbox, etc.)\nâ”œâ”€â”€ errors.go       # Error types with Agent Mail error codes\nâ””â”€â”€ client_test.go  # Unit tests with mock server\n```\n\n### Client Configuration\n```go\ntype Client struct {\n    baseURL     string       // Default: http://127.0.0.1:8765/mcp/\n    bearerToken string       // From AGENT_MAIL_TOKEN or config\n    httpClient  *http.Client // With timeouts, connection pooling\n    projectKey  string       // Cached project path\n}\n\nfunc NewClient(opts ...Option) (*Client, error)\nfunc (c *Client) IsAvailable() bool  // Health check\n```\n\n### Key Types (matching Agent Mail schema)\n```go\ntype Agent struct {\n    ID              int       `json:\"id\"`\n    Name            string    `json:\"name\"`            // e.g., \"GreenCastle\"\n    Program         string    `json:\"program\"`         // e.g., \"claude-code\"\n    Model           string    `json:\"model\"`           // e.g., \"opus-4.1\"\n    TaskDescription string    `json:\"task_description\"`\n    LastActiveTS    time.Time `json:\"last_active_ts\"`\n}\n\ntype Message struct {\n    ID          int       `json:\"id\"`\n    ThreadID    string    `json:\"thread_id\"`\n    Subject     string    `json:\"subject\"`\n    BodyMD      string    `json:\"body_md\"`\n    From        string    `json:\"from\"`\n    To          []string  `json:\"to\"`\n    Importance  string    `json:\"importance\"`  // normal, high, urgent\n    AckRequired bool      `json:\"ack_required\"`\n    CreatedTS   time.Time `json:\"created_ts\"`\n}\n\ntype FileReservation struct {\n    ID          int       `json:\"id\"`\n    PathPattern string    `json:\"path_pattern\"`\n    AgentName   string    `json:\"agent_name\"`\n    Exclusive   bool      `json:\"exclusive\"`\n    Reason      string    `json:\"reason\"`\n    ExpiresTS   time.Time `json:\"expires_ts\"`\n}\n```\n\n### JSON-RPC 2.0 Protocol\nAgent Mail uses JSON-RPC 2.0 over HTTP:\n```go\ntype JSONRPCRequest struct {\n    JSONRPC string      `json:\"jsonrpc\"` // \"2.0\"\n    ID      interface{} `json:\"id\"`\n    Method  string      `json:\"method\"`  // \"tools/call\"\n    Params  struct {\n        Name      string                 `json:\"name\"`\n        Arguments map[string]interface{} `json:\"arguments\"`\n    } `json:\"params\"`\n}\n\ntype JSONRPCResponse struct {\n    JSONRPC string          `json:\"jsonrpc\"`\n    ID      interface{}     `json:\"id\"`\n    Result  json.RawMessage `json:\"result,omitempty\"`\n    Error   *JSONRPCError   `json:\"error,omitempty\"`\n}\n```\n\n## Implementation Notes\n\n- **Connection pooling**: Reuse HTTP connections; Agent Mail may be called frequently\n- **Timeout handling**: 5s default for most operations, 30s for search/summarize\n- **Retry logic**: Exponential backoff for transient failures (503, timeouts)\n- **Bearer token**: Read from NTM config or AGENT_MAIL_TOKEN env var\n- **Graceful degradation**: All methods return (result, error); callers handle missing server\n\n## Acceptance Criteria\n\n- [ ] Client can connect to Agent Mail and verify health\n- [ ] All MCP tools mapped to Go methods with proper types\n- [ ] Error handling covers all Agent Mail error codes\n- [ ] Unit tests with mock HTTP server\n- [ ] Connection pooling verified with concurrent requests\n- [ ] Timeout and retry behavior documented and tested","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:17:29.953845-05:00","updated_at":"2025-12-10T03:26:20.670088-05:00","closed_at":"2025-12-10T03:26:20.670088-05:00"}
{"id":"ntm-cf8","title":"Add --json support to ntm deps command","description":"Implement JSON output for the deps (dependency check) command.\n\n## What This Task Does\n\nAdd JSON support to deps command for scripted dependency checking.\n\n## JSON Schema\n\n{\n  \"dependencies\": [\n    {\n      \"name\": \"tmux\",\n      \"required\": true,\n      \"found\": true,\n      \"version\": \"3.4\",\n      \"path\": \"/opt/homebrew/bin/tmux\"\n    },\n    {\n      \"name\": \"claude\",\n      \"required\": false,\n      \"found\": true,\n      \"version\": \"1.0.0\",\n      \"path\": \"/usr/local/bin/claude\"\n    }\n  ],\n  \"all_required_met\": true,\n  \"warnings\": []\n}\n\n## Implementation\n\n1. Create DepsOutput and DepInfo structs\n2. Structure existing dependency checks\n3. Include version detection where possible\n\n## Acceptance Criteria\n\n- [ ] ntm deps --json produces valid JSON\n- [ ] All dependencies listed with status\n- [ ] Versions included where detectable\n- [ ] Exit code reflects actual status\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:47:05.02396-05:00","updated_at":"2025-12-10T02:47:05.02396-05:00","dependencies":[{"issue_id":"ntm-cf8","depends_on_id":"ntm-ws2","type":"blocks","created_at":"2025-12-10T02:47:05.024428-05:00","created_by":"daemon"}]}
{"id":"ntm-cjx","title":"Add --robot-graph flag for bv insights passthrough","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:27:05.812142-05:00","updated_at":"2025-12-10T03:45:28.669998-05:00","closed_at":"2025-12-10T03:45:28.669998-05:00","dependencies":[{"issue_id":"ntm-cjx","depends_on_id":"ntm-r2k","type":"blocks","created_at":"2025-12-10T03:28:02.183046-05:00","created_by":"daemon"},{"issue_id":"ntm-cjx","depends_on_id":"ntm-igpj","type":"blocks","created_at":"2025-12-10T03:32:50.379971-05:00","created_by":"daemon"}]}
{"id":"ntm-cnb1","title":"Add alerts for cycle introductions and density growth","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:33.967423-05:00","updated_at":"2025-12-10T03:32:21.664167-05:00","closed_at":"2025-12-10T03:32:21.664167-05:00","dependencies":[{"issue_id":"ntm-cnb1","depends_on_id":"ntm-40fg","type":"blocks","created_at":"2025-12-10T03:28:07.574141-05:00","created_by":"daemon"}]}
{"id":"ntm-crj","title":"Add --robot-unified for complete AI agent context","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:06.193243-05:00","updated_at":"2025-12-10T03:32:22.027577-05:00","closed_at":"2025-12-10T03:32:22.027577-05:00","dependencies":[{"issue_id":"ntm-crj","depends_on_id":"ntm-4t3","type":"blocks","created_at":"2025-12-10T03:28:02.458052-05:00","created_by":"daemon"},{"issue_id":"ntm-crj","depends_on_id":"ntm-dxx","type":"blocks","created_at":"2025-12-10T03:28:02.559437-05:00","created_by":"daemon"}]}
{"id":"ntm-ctt","title":"Add --json support to spawn, create, add, send commands","description":"Implement JSON output for commands that perform actions.\n\n## What This Task Does\n\nAdd --json support to commands that modify state or perform actions:\n- ntm spawn: Return session details after creation\n- ntm create: Return session info after creation  \n- ntm add: Return pane info for newly added agents\n- ntm send: Return delivery confirmation for sent prompts\n\n## Why These Commands\n\nThese commands are commonly used in scripts and automation:\n- CI/CD pipelines spawn sessions and need session IDs\n- Scripts add agents and need pane indices\n- Automated workflows send prompts and need confirmation\n\n## JSON Schemas\n\n### ntm spawn --json\n{\n  \"session\": \"myproject\",\n  \"created\": true,\n  \"working_directory\": \"/path/to/project\",\n  \"panes\": [\n    {\"index\": 0, \"agent_type\": \"claude\", \"title\": \"myproject__cc_1\"},\n    {\"index\": 1, \"agent_type\": \"codex\", \"title\": \"myproject__cod_1\"}\n  ],\n  \"agent_counts\": {\"claude\": 2, \"codex\": 1}\n}\n\n### ntm send --json  \n{\n  \"session\": \"myproject\",\n  \"prompt_preview\": \"First 50 chars of prompt...\",\n  \"targets\": [0, 1, 2],\n  \"delivered\": 3,\n  \"failed\": 0\n}\n\n## Implementation\n\n1. Create output structs for each command\n2. Modify command to build struct before any output\n3. Use output formatter based on --json flag\n4. Ensure errors also return valid JSON when flag is set\n\n## Acceptance Criteria\n\n- [ ] ntm spawn --json returns session details\n- [ ] ntm create --json returns session info\n- [ ] ntm add --json returns new pane info\n- [ ] ntm send --json returns delivery confirmation\n- [ ] Errors produce valid JSON with error field\n","status":"closed","priority":1,"issue_type":"task","assignee":"WhiteStone","created_at":"2025-12-10T02:55:12.27919-05:00","updated_at":"2025-12-10T09:06:19.985995-05:00","closed_at":"2025-12-10T09:06:19.985995-05:00","dependencies":[{"issue_id":"ntm-ctt","depends_on_id":"ntm-ws2","type":"blocks","created_at":"2025-12-10T02:55:23.014807-05:00","created_by":"daemon"}]}
{"id":"ntm-cx7","title":"Add --json support to ntm list command","description":"Implement JSON output for the list command.\n\n## What This Task Does\n\nModify the ntm list command to support --json flag for structured output.\n\n## JSON Schema\n\n{\n  \"sessions\": [\n    {\n      \"name\": \"myproject\",\n      \"created_at\": \"2025-12-10T10:00:00Z\",\n      \"attached\": false,\n      \"pane_count\": 4,\n      \"agents\": {\n        \"claude\": 2,\n        \"codex\": 1,\n        \"gemini\": 1\n      },\n      \"working_directory\": \"/path/to/project\"\n    }\n  ],\n  \"count\": 1\n}\n\n## Implementation\n\n1. Import internal/output package\n2. Create SessionListOutput struct\n3. Modify runList to build struct instead of print directly\n4. Use formatter to output based on format flag\n5. Ensure all existing text output information is in JSON\n\n## Acceptance Criteria\n\n- [ ] ntm list --json produces valid JSON\n- [ ] JSON includes all session information\n- [ ] Agent counts are structured as object\n- [ ] Empty list produces {\"sessions\": [], \"count\": 0}\n- [ ] Text output unchanged (default behavior)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:46:43.927201-05:00","updated_at":"2025-12-10T03:22:38.670098-05:00","closed_at":"2025-12-10T03:22:38.670098-05:00","dependencies":[{"issue_id":"ntm-cx7","depends_on_id":"ntm-ws2","type":"blocks","created_at":"2025-12-10T02:46:43.9282-05:00","created_by":"daemon"}]}
{"id":"ntm-cyq","title":"Implement token estimation library","description":"# Implement Token Estimation Library\n\n## Purpose\n\nProvide rough token estimates for context usage visualization.\n\n## IMPORTANT: Estimation, Not Measurement\n\nWe're ESTIMATING tokens, not measuring actual usage. Be honest about this.\n\n## Approach: Character-Based Heuristic\n\nSimpler and more honest than pretending to have accurate tokenizers:\n\n```go\npackage tokens\n\n// EstimateTokens provides a rough token count estimate.\n// Uses ~3.5 characters per token heuristic for English text.\n// This is an ESTIMATE - actual token counts vary by model and content.\nfunc EstimateTokens(text string) int {\n    // ~3.5 chars per token for typical English\n    return len(text) * 10 / 35\n}\n\n// EstimateWithOverhead applies overhead multiplier for hidden context.\n// Overhead includes: system prompts, tool definitions, conversation structure.\nfunc EstimateWithOverhead(visibleText string, multiplier float64) int {\n    visible := EstimateTokens(visibleText)\n    return int(float64(visible) * multiplier)\n}\n```\n\n## Model Context Limits\n\nApproximate limits (may change, conservative estimates):\n```go\nvar ContextLimits = map[string]int{\n    \"opus\":   200000,\n    \"sonnet\": 200000,\n    \"haiku\":  200000,\n    \"gpt4\":   128000,\n    \"o1\":     128000,\n    \"pro\":    1000000,\n    \"flash\":  1000000,\n}\n\nfunc GetContextLimit(model string) int {\n    if limit, ok := ContextLimits[normalizeModel(model)]; ok {\n        return limit\n    }\n    return 128000 // Conservative default\n}\n```\n\n## Why Not Use tiktoken?\n\n1. tiktoken is for OpenAI tokenizers - Claude uses different tokenization\n2. Each model family has different tokenizers\n3. Character heuristic is 80% accurate and works for ALL models\n4. We're showing estimates anyway - precision is false confidence\n\n## Acceptance Criteria\n\n- [ ] EstimateTokens function with character heuristic\n- [ ] EstimateWithOverhead for total context estimate\n- [ ] Context limit lookup by model\n- [ ] Clear documentation that these are estimates\n- [ ] Unit tests validating reasonable estimates","status":"closed","priority":1,"issue_type":"task","assignee":"SapphireRiver","created_at":"2025-12-10T03:26:08.230758-05:00","updated_at":"2025-12-10T04:00:32.487543-05:00","closed_at":"2025-12-10T04:00:32.487543-05:00"}
{"id":"ntm-czp","title":"Add functional options pattern to watcher","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:43:47.432911-05:00","updated_at":"2025-12-10T02:43:47.432911-05:00","dependencies":[{"issue_id":"ntm-czp","depends_on_id":"ntm-r1l","type":"blocks","created_at":"2025-12-10T02:44:00.104967-05:00","created_by":"daemon"}]}
{"id":"ntm-czy","title":"EPIC: Remote Session Support","description":"Enable NTM to manage agents on remote machines via SSH.\n\n## Problem Statement\n\nAI coding agents are resource-intensive:\n- High CPU usage during inference\n- Significant memory for context windows\n- Can slow down local development machines\n- Laptop fans spinning constantly\n\nUsers want to run agents on powerful remote machines while keeping\ntheir local environment responsive. Tmux already supports remote\nsessions, but NTM doesn't expose this capability.\n\n## Goals\n\n1. Add --ssh flag to spawn, list, attach, send, status, kill\n2. Seamlessly manage remote sessions as if they were local\n3. Support SSH config hosts (~/.ssh/config)\n4. Handle connection failures gracefully\n5. Remember remote host association for sessions\n\n## Why This Matters\n\nPower users have access to:\n- Cloud VMs with high CPU/memory\n- Development servers with fast internet\n- Dedicated machines for agent workloads\n- GPU instances for local LLM agents\n\nNTM should leverage these resources without requiring users to\nmanually SSH and run commands.\n\n## Success Criteria\n\n- ntm spawn myproject --ssh devbox --cc=4\n- ntm list --ssh devbox\n- ntm attach myproject --ssh devbox\n- ntm send myproject --ssh devbox --all 'status'\n- ntm status myproject --ssh devbox --json\n- ntm kill myproject --ssh devbox\n\n## Technical Approach\n\nSSH wrapper for tmux commands:\n- Local: tmux new-session -d -s myproject\n- Remote: ssh devbox tmux new-session -d -s myproject\n\nConnection management:\n- Use user's SSH config and keys\n- Support ControlMaster for connection reuse\n- Timeout and retry on connection failures\n- Clear error messages for auth failures\n\nSession metadata:\n- Store remote host with session (in tmux environment variable)\n- Auto-detect remote host when operating on existing sessions\n- Allow explicit override with --ssh flag\n\n## Considerations\n\nSSH Key Management:\n- Rely on user's existing SSH setup\n- Don't store passwords or implement auth\n- Support ssh-agent for key passphrase caching\n\nNetwork Reliability:\n- Graceful handling of disconnects\n- Retry logic for transient failures\n- Clear feedback on connection status\n\nPerformance:\n- Each command requires SSH connection (acceptable)\n- Consider ControlMaster recommendation for users\n- Batch operations where possible\n\n## Interaction with Other Epics\n\n- Session Persistence (ntm-bh5): Saved sessions include remote host\n- Health Checks: Health monitoring works over SSH\n- Notifications: Webhook notifications work regardless of locality\n- Agent Tagging: Tags work the same locally and remotely\n\n## Future Possibilities\n\n- ntm ssh-setup: Help configure ControlMaster\n- Connection pooling within ntm process\n- Support for SSH jump hosts\n- Parallel operations across multiple remotes\n","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T02:44:47.398856-05:00","updated_at":"2025-12-10T02:44:47.398856-05:00"}
{"id":"ntm-d2t","title":"Implement --robot-send for batch messaging","description":"Send prompts to multiple agents atomically with structured result.\n\n## Rationale\nOrchestrating N agents often means broadcasting instructions (\"all agents: run tests\") or targeted multi-cast (\"agents 1,2: work on feature X while agent 3: does Y\"). Current approach requires N separate send commands. This consolidates into one atomic operation.\n\n## Usage\n```bash\nntm --robot-send myproject --all --msg=\"run tests and report results\"\nntm --robot-send myproject --panes=0.1,0.2 --msg=\"implement feature X\"\nntm --robot-send myproject --type=claude --msg=\"claude-specific instruction\"\n```\n\n## Output Structure\n```json\n{\n  \"session\": \"myproject\",\n  \"sent_at\": \"ISO8601\",\n  \"targets\": [\"0.1\", \"0.2\", \"1.0\"],\n  \"successful\": [\"0.1\", \"0.2\"],\n  \"failed\": [{\"pane\": \"1.0\", \"error\": \"pane not found\"}],\n  \"message_preview\": \"run tests and...\"\n}\n```\n\n## Features\n- --all: broadcast to all panes\n- --panes=X,Y,Z: specific pane IDs\n- --type=claude: filter by agent type\n- --exclude=0.3: exclude specific panes\n- --delay-ms=100: stagger sends to avoid thundering herd\n\n## Atomicity\nEither report all successes/failures - never partial state. If sending to 5 panes and 2 fail, I need to know which 2 and why.\n\n## Integration with Agent Mail\nConsider adding --via-mail flag that routes through agent-mail instead of direct tmux send. This provides audit trail and async handling.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T02:51:02.387174-05:00","updated_at":"2025-12-10T03:18:40.413531-05:00","closed_at":"2025-12-10T03:18:40.413531-05:00"}
{"id":"ntm-daa","title":"Integration Test: robot mode output validation","description":"# Integration Test: Robot Mode Output\n\n## Scope\nVerify --robot-* flags produce valid, parseable JSON that matches actual system state.\n\n## Test Scenarios\n\n### Scenario 1: --robot-status Empty\n- No sessions exist\n- Run ntm --robot-status\n- Verify empty sessions array, zeroed counts\n\n### Scenario 2: --robot-status With Sessions\n- Create 2 sessions with different agent configs\n- Run ntm --robot-status\n- Parse JSON\n- Verify session names, agent counts, pane IDs match reality\n\n### Scenario 3: --robot-plan Suggestions\n- Create session with idle agents\n- Run ntm --robot-plan\n- Verify suggested actions are valid\n\n### Scenario 4: --robot-version\n- Run ntm --robot-version\n- Verify fields: version, commit, date, built_by\n\n### Scenario 5: Schema Validation\n- Define expected JSON schemas\n- Validate all robot output against schemas\n- Test edge cases (long session names, special chars)\n\n## Implementation\n```go\ntype StatusOutput struct {\n    GeneratedAt time.Time     `json:\"generated_at\"`\n    Sessions    []SessionInfo `json:\"sessions\"`\n    Summary     Summary       `json:\"summary\"`\n}\n\nfunc TestRobotStatusSchema(t *testing.T) {\n    output := runNTM(\"--robot-status\")\n    var status StatusOutput\n    err := json.Unmarshal(output, \u0026status)\n    require.NoError(t, err)\n    // Validate fields...\n}\n```","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:23:15.719773-05:00","updated_at":"2025-12-10T03:23:15.719773-05:00","dependencies":[{"issue_id":"ntm-daa","depends_on_id":"ntm-66c","type":"blocks","created_at":"2025-12-10T03:24:41.416823-05:00","created_by":"daemon"},{"issue_id":"ntm-daa","depends_on_id":"ntm-7lk","type":"blocks","created_at":"2025-12-10T03:24:42.467264-05:00","created_by":"daemon"}]}
{"id":"ntm-dix","title":"Add mini-bar and rank badge visualizations","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T02:43:08.913656-05:00","updated_at":"2025-12-10T02:43:08.913656-05:00","dependencies":[{"issue_id":"ntm-dix","depends_on_id":"ntm-17s","type":"blocks","created_at":"2025-12-10T02:43:16.317589-05:00","created_by":"daemon"}]}
{"id":"ntm-dmu","title":"EPIC: Extensibility Hooks System","description":"","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T02:39:11.660118-05:00","updated_at":"2025-12-10T02:39:11.660118-05:00","comments":[{"id":5,"issue_id":"ntm-dmu","author":"jemanuel","text":"-","created_at":"2025-12-10T07:41:13Z"}]}
{"id":"ntm-dv1c","title":"Implement UBSâ†’Beads bridge for auto-issue creation","description":"## Overview\nCreate a bridge between UBS scan findings and the beads issue tracker to automatically generate issues from code quality findings.\n\n## Background\nUBS produces structured JSON output with findings categorized by severity. These findings should flow into beads as trackable issues, enabling:\n- Persistent tracking of code quality issues\n- Dependency analysis via bv (beads_viewer)\n- Agent coordination around fixes\n\n## Implementation Details\n\n### Core Bridge Logic\n- Parse UBS JSON output into structured findings\n- Map UBS severity levels to beads priority:\n  - critical â†’ P0\n  - error â†’ P1  \n  - warning â†’ P2\n  - info â†’ P3\n- Deduplicate findings against existing open beads (by file:line:rule signature)\n- Create beads with rich context (code snippet, rule explanation, suggested fix)\n\n### Bead Content Template\n```\nTitle: [{severity}] {rule_id}: {message} in {file}\nType: bug\nBody:\n  - File: {path}:{line}:{column}\n  - Rule: {rule_id} ({category})\n  - Scanner: {tool_name}\n  - Code context: {snippet}\n  - Suggested fix: {suggestion}\n  - Auto-created by UBS scan at {timestamp}\n```\n\n### CLI Integration\n- `ntm scan --create-beads` flag to auto-create issues\n- `ntm scan --update-beads` to close beads for fixed issues\n- Configurable severity threshold for auto-creation\n\n### Files to Create/Modify\n- internal/scanner/bridge.go - Core bridge logic\n- internal/scanner/dedup.go - Deduplication logic\n- internal/cli/scan.go - Add --create-beads, --update-beads flags\n\n## Acceptance Criteria\n- [ ] Findings auto-create beads with proper priority mapping\n- [ ] Duplicate findings don't create duplicate beads\n- [ ] Fixed issues can auto-close corresponding beads\n- [ ] Bridge respects severity threshold configuration","status":"in_progress","priority":2,"issue_type":"task","assignee":"BlackSnow","created_at":"2025-12-10T03:33:29.260527-05:00","updated_at":"2025-12-10T09:53:29.848644-05:00","dependencies":[{"issue_id":"ntm-dv1c","depends_on_id":"ntm-p77j","type":"blocks","created_at":"2025-12-10T03:34:54.356948-05:00","created_by":"daemon"}]}
{"id":"ntm-dvz","title":"Implement --robot-snapshot --since for delta updates","description":"Add delta/diff mode to snapshot that only returns changes since a timestamp.\n\n## Rationale\nIn a polling loop, re-reading full state every time wastes tokens massively. If I check every 5 seconds and only 1 agent produced 2 lines of output, I don't need the full 500-token snapshot - I need a 50-token delta.\n\n## Output Structure\n```json\n{\n  \"ts\": \"ISO8601\",\n  \"since\": \"ISO8601\",\n  \"changes\": [\n    {\"type\": \"agent_output\", \"session\": \"s\", \"pane\": \"0.1\", \"lines_added\": 12},\n    {\"type\": \"agent_state\", \"session\": \"s\", \"pane\": \"0.2\", \"from\": \"active\", \"to\": \"idle\"},\n    {\"type\": \"bead_closed\", \"id\": \"ntm-xxx\"},\n    {\"type\": \"bead_started\", \"id\": \"ntm-yyy\", \"agent\": \"0.1\"},\n    {\"type\": \"mail_received\", \"to\": \"AgentName\", \"count\": 1},\n    {\"type\": \"alert_new\", \"msg\": \"agent 0.3 stuck\"},\n    {\"type\": \"alert_resolved\", \"msg\": \"agent 0.3 stuck\"}\n  ]\n}\n```\n\n## Implementation Notes\n- Server must maintain a ring buffer of recent state changes\n- Changes are coalesced (10 output events become 1 with lines_added=10)\n- Empty changes array = nothing happened = immediate return\n- If since is too old, fall back to full snapshot with warning\n\n## Efficiency\nThis enables efficient polling: check every few seconds, act only on changes. 95% of polls will return near-empty diffs.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T02:50:26.267831-05:00","updated_at":"2025-12-10T03:29:01.115456-05:00","closed_at":"2025-12-10T03:29:01.115456-05:00","dependencies":[{"issue_id":"ntm-dvz","depends_on_id":"ntm-sim","type":"blocks","created_at":"2025-12-10T02:54:39.687164-05:00","created_by":"daemon"},{"issue_id":"ntm-dvz","depends_on_id":"ntm-hat","type":"blocks","created_at":"2025-12-10T02:54:39.743316-05:00","created_by":"daemon"}]}
{"id":"ntm-dxx","title":"Enhance --robot-status with bv graph metrics","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:05.948389-05:00","updated_at":"2025-12-10T03:56:22.300277-05:00","closed_at":"2025-12-10T03:56:22.300277-05:00","dependencies":[{"issue_id":"ntm-dxx","depends_on_id":"ntm-r2k","type":"blocks","created_at":"2025-12-10T03:28:02.259891-05:00","created_by":"daemon"},{"issue_id":"ntm-dxx","depends_on_id":"ntm-igpj","type":"blocks","created_at":"2025-12-10T03:32:50.478894-05:00","created_by":"daemon"}]}
{"id":"ntm-e12d","title":"Implement ntm git status command","description":"# Implement ntm git status Command\n\nShows coordination state: branches, locks, pending changes across agents.\nCombines git state with Agent Mail file reservations.\nDisplays per-agent uncommitted changes.","status":"closed","priority":1,"issue_type":"task","assignee":"SilverMountain","created_at":"2025-12-10T03:29:12.106649-05:00","updated_at":"2025-12-10T09:11:16.889469-05:00","closed_at":"2025-12-10T09:11:16.889469-05:00","dependencies":[{"issue_id":"ntm-e12d","depends_on_id":"ntm-1ts","type":"blocks","created_at":"2025-12-10T03:29:37.245895-05:00","created_by":"daemon"}]}
{"id":"ntm-ed5","title":"EPIC: Enhanced UI/Theme System","description":"","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T02:39:20.284079-05:00","updated_at":"2025-12-10T02:39:20.284079-05:00","comments":[{"id":7,"issue_id":"ntm-ed5","author":"jemanuel","text":"-","created_at":"2025-12-10T07:42:44Z"}]}
{"id":"ntm-egl","title":"Add model alias configuration schema","description":"# Add Model Alias Configuration Schema\n\n## Purpose\n\nDefine configuration for model aliases so users can use short names like \"opus\" instead of full model identifiers.\n\n## Config Schema\n\n```toml\n# ~/.config/ntm/config.toml\n\n[models]\n# Default models when no specifier given\ndefault_claude = \"claude-sonnet-4\"\ndefault_codex = \"gpt-4\"\ndefault_gemini = \"gemini-pro\"\n\n[models.claude]\nopus = \"claude-opus-4\"\nsonnet = \"claude-sonnet-4\"\nhaiku = \"claude-haiku\"\n# Custom aliases\narchitect = \"claude-opus-4\"\nfast = \"claude-sonnet-4\"\n\n[models.codex]\ngpt4 = \"gpt-4\"\no1 = \"o1\"\nturbo = \"gpt-4-turbo\"\n\n[models.gemini]\npro = \"gemini-pro\"\nflash = \"gemini-flash\"\n```\n\n## Go Types\n\n```go\ntype ModelsConfig struct {\n    DefaultClaude string                   `toml:\"default_claude\"`\n    DefaultCodex  string                   `toml:\"default_codex\"`\n    DefaultGemini string                   `toml:\"default_gemini\"`\n    Claude        map[string]string        `toml:\"claude\"`\n    Codex         map[string]string        `toml:\"codex\"`\n    Gemini        map[string]string        `toml:\"gemini\"`\n}\n```\n\n## Built-in Defaults\n\nIf no config exists, use sensible defaults:\n```go\nvar DefaultModels = ModelsConfig{\n    DefaultClaude: \"claude-sonnet-4\",\n    DefaultCodex:  \"gpt-4\",\n    DefaultGemini: \"gemini-pro\",\n    Claude: map[string]string{\n        \"opus\":   \"claude-opus-4\",\n        \"sonnet\": \"claude-sonnet-4\",\n        \"haiku\":  \"claude-haiku\",\n    },\n    // ...\n}\n```\n\n## Acceptance Criteria\n\n- [ ] Config schema defined in internal/config\n- [ ] TOML parsing for models section\n- [ ] Default values when config missing\n- [ ] Lookup function: GetModelName(agentType, alias) string\n- [ ] ntm config show displays model aliases\n- [ ] Documentation in config init template","status":"closed","priority":1,"issue_type":"task","assignee":"ChartreuseLake","created_at":"2025-12-10T03:21:37.096891-05:00","updated_at":"2025-12-10T04:00:54.464882-05:00","closed_at":"2025-12-10T04:00:54.464882-05:00"}
{"id":"ntm-eiv","title":"Implement system prompt injection for agents","description":"# Implement System Prompt Injection for Agents\n\n## Purpose\n\nInject persona system prompts when launching agents.\n\n## Challenge\n\nDifferent agent CLIs have different mechanisms:\n- **Claude Code**: --system-prompt flag or .claude/system-prompt.md\n- **Codex**: May use CODEX_SYSTEM_PROMPT env var\n- **Gemini**: --system-instruction flag\n\n## Strategy: Per-Agent Injection Templates\n\n```toml\n[agents]\nclaude = \"claude --dangerously-skip-permissions {{if .SystemPrompt}}--system-prompt-file {{.SystemPromptFile}}{{end}}\"\ncodex = \"{{if .SystemPrompt}}CODEX_SYSTEM_PROMPT={{.SystemPromptFile}}{{end}} codex -m {{.Model}}\"\ngemini = \"gemini {{if .SystemPrompt}}--system-instruction-file {{.SystemPromptFile}}{{end}} --yolo\"\n```\n\n## System Prompt File Generation\n\nFor agents requiring file-based prompts:\n```go\nfunc PrepareSystemPrompt(persona *Persona, sessionDir string) (string, error) {\n    if persona.SystemPrompt == \"\" {\n        return \"\", nil\n    }\n    \n    // Write to session-specific temp file\n    promptFile := filepath.Join(sessionDir, \".ntm\", \"prompts\", persona.Name+\".md\")\n    os.MkdirAll(filepath.Dir(promptFile), 0755)\n    \n    // Expand any template variables in prompt\n    content := expandPromptVars(persona.SystemPrompt, persona)\n    \n    if err := os.WriteFile(promptFile, []byte(content), 0644); err != nil {\n        return \"\", err\n    }\n    \n    return promptFile, nil\n}\n```\n\n## Context File Injection\n\nIf persona has context_files:\n```go\nfunc PrepareContextFiles(persona *Persona, projectDir string) (string, error) {\n    // Expand globs\n    var files []string\n    for _, pattern := range persona.ContextFiles {\n        matches, _ := filepath.Glob(filepath.Join(projectDir, pattern))\n        files = append(files, matches...)\n    }\n    \n    // Concatenate into context block\n    var context strings.Builder\n    for _, f := range files {\n        content, _ := os.ReadFile(f)\n        context.WriteString(fmt.Sprintf(\"## %s\\n\\n%s\\n\\n\", f, content))\n    }\n    \n    // Prepend to system prompt\n    return context.String() + persona.SystemPrompt, nil\n}\n```\n\n## Acceptance Criteria\n\n- [ ] System prompts injected for each agent type\n- [ ] Prompt files written to session directory\n- [ ] Context files expanded and concatenated\n- [ ] Template variables in prompts supported\n- [ ] Cleanup of prompt files on session kill\n- [ ] Works with all supported agent types","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:23:48.49601-05:00","updated_at":"2025-12-10T03:23:48.49601-05:00","dependencies":[{"issue_id":"ntm-eiv","depends_on_id":"ntm-iws","type":"blocks","created_at":"2025-12-10T03:24:00.937506-05:00","created_by":"daemon"},{"issue_id":"ntm-eiv","depends_on_id":"ntm-i0zz","type":"blocks","created_at":"2025-12-10T03:41:26.745653-05:00","created_by":"daemon"}]}
{"id":"ntm-eqs","title":"Add --tag filtering to ntm send and list","description":"Filter operations by agent tags.\n\n## What This Task Does\n\nAdd --tag flag to commands that operate on agents:\n- ntm send: Send to agents matching tag\n- ntm list: Show only sessions with matching agents\n- ntm status: Filter panes by tag\n- ntm kill: Kill only agents matching tag\n\n## Interface\n\n$ ntm send --tag=frontend 'Update the UI'\n# Sends to all agents tagged 'frontend' across all sessions\n\n$ ntm send myproject --tag=backend 'Run migrations'\n# Sends to 'backend' agents in myproject only\n\n$ ntm list --tag=frontend\n# Shows sessions that have at least one 'frontend' agent\n\n$ ntm status myproject --tag=backend\n# Shows only backend-tagged panes\n\n## Matching Logic\n\nSimple OR matching: agent matches if it has ANY of the specified tags.\n\n$ ntm send --tag=frontend,ui 'message'\n# Matches agents with 'frontend' OR 'ui' tag\n\nFuture: AND matching with special syntax\n$ ntm send --tag='frontend+urgent' 'message'\n# Matches agents with 'frontend' AND 'urgent'\n\n## Implementation\n\n1. Add --tag flag to send, list, status, kill commands\n2. Parse tags from flag (comma-separated)\n3. Filter pane list by tag match\n4. Include tag info in JSON output\n\n## Acceptance Criteria\n\n- [ ] --tag works on ntm send\n- [ ] --tag works on ntm list\n- [ ] --tag works on ntm status  \n- [ ] --tag works on ntm kill\n- [ ] OR matching for multiple tags\n- [ ] Tags included in JSON output\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:49:06.855378-05:00","updated_at":"2025-12-10T02:49:06.855378-05:00","dependencies":[{"issue_id":"ntm-eqs","depends_on_id":"ntm-61i","type":"blocks","created_at":"2025-12-10T02:49:06.856038-05:00","created_by":"daemon"},{"issue_id":"ntm-eqs","depends_on_id":"ntm-ws2","type":"blocks","created_at":"2025-12-10T02:49:06.857823-05:00","created_by":"daemon"},{"issue_id":"ntm-eqs","depends_on_id":"ntm-y7l","type":"blocks","created_at":"2025-12-10T02:52:41.615685-05:00","created_by":"daemon"}]}
{"id":"ntm-f5ur","title":"Implement ntm git sync command","description":"# Implement ntm git sync Command\n\nRuns git pull/push in all agent panes.\nHandles conflicts gracefully with user prompts.\nShows sync status per agent.","status":"closed","priority":1,"issue_type":"task","assignee":"SilverMountain","created_at":"2025-12-10T03:29:12.237009-05:00","updated_at":"2025-12-10T09:15:45.186887-05:00","closed_at":"2025-12-10T09:15:45.186887-05:00","dependencies":[{"issue_id":"ntm-f5ur","depends_on_id":"ntm-e12d","type":"blocks","created_at":"2025-12-10T03:29:37.332318-05:00","created_by":"daemon"}]}
{"id":"ntm-fpb","title":"Implement command history tracking","description":"Track and expose history of commands sent to agents.\n\n## Rationale\nFor debugging, auditing, and understanding agent behavior, I need to know:\n- What was sent to each agent and when?\n- What was the response?\n- How long did each command take?\n\nThis creates an audit trail and enables analysis.\n\n## Storage\n```go\ntype CommandEntry struct {\n    ID        uint64\n    Session   string\n    Pane      string\n    Command   string\n    SentAt    time.Time\n    AckAt     *time.Time       // when agent acked\n    OutputLen int              // lines of output produced\n    Duration  *time.Duration   // if completed\n}\n```\n\n## Query Interface\n```bash\nntm --robot-history myproject                    # all history\nntm --robot-history myproject --pane=0.1         # specific pane\nntm --robot-history myproject --last=10          # last N entries\nntm --robot-history myproject --since=\"1h ago\"   # time-based\n```\n\n## Output Structure\n```json\n{\n  \"session\": \"myproject\",\n  \"entries\": [\n    {\n      \"id\": 1,\n      \"pane\": \"0.1\",\n      \"command\": \"implement feature X\",\n      \"sent_at\": \"ISO8601\",\n      \"ack_at\": \"ISO8601\",\n      \"output_lines\": 150,\n      \"duration_sec\": 45\n    }\n  ],\n  \"total\": 25\n}\n```\n\n## Persistence\nStore in SQLite DB per session:\n~/.local/share/ntm/history/{session}.db\n\n## Privacy Consideration\nCommands may contain sensitive info. Consider:\n- Optional encryption\n- Configurable retention period\n- Explicit --no-history flag","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:58:36.580871-05:00","updated_at":"2025-12-10T02:58:36.580871-05:00"}
{"id":"ntm-fsub","title":"Add scan status indicators to dashboard TUI","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:30:37.777073-05:00","updated_at":"2025-12-10T03:30:37.777073-05:00","dependencies":[{"issue_id":"ntm-fsub","depends_on_id":"ntm-p77j","type":"blocks","created_at":"2025-12-10T03:34:50.097741-05:00","created_by":"daemon"}]}
{"id":"ntm-gcv","title":"Implement notification system with desktop and webhook support","description":"Create a notification system that can alert users via multiple channels.\n\n## What This Task Does\n\nBuild infrastructure to send notifications when events occur:\n- Desktop notifications (native OS)\n- Webhook POST (Slack, Discord, custom)\n- Shell command execution\n- Log file appending\n\n## Notification Events\n\n- agent.error - Agent hit error state\n- agent.crashed - Agent process exited\n- agent.restarted - Agent was auto-restarted\n- agent.idle - Agent waiting for input\n- session.created - New session spawned\n- session.killed - Session terminated\n- health.degraded - Overall health dropped\n\n## Configuration\n\n[notifications]\nenabled = true\nevents = [\"agent.error\", \"agent.crashed\", \"agent.restarted\"]\n\n[notifications.desktop]\nenabled = true\n\n[notifications.webhook]\nurl = \"https://hooks.slack.com/services/XXX/YYY/ZZZ\"\n# Payload template (Go template syntax)\ntemplate = '''\n{\"text\": \"NTM: {{.Event}} - {{.Message}}\"}\n'''\n\n[notifications.shell]\ncommand = \"~/.config/ntm/notify.sh\"\npass_json = true\n\n[notifications.log]\npath = \"~/.local/share/ntm/notifications.jsonl\"\n\n## Implementation\n\nCreate internal/notify package:\n\ntype Event struct {\n    Type      string\n    Session   string\n    Agent     string\n    Message   string\n    Timestamp time.Time\n    Data      map[string]interface{}\n}\n\ntype Notifier interface {\n    Notify(event Event) error\n}\n\nImplementations:\n- DesktopNotifier: osascript (macOS), notify-send (Linux)\n- WebhookNotifier: HTTP POST with template rendering\n- ShellNotifier: exec.Command with JSON stdin\n- LogNotifier: Append to JSONL file\n\n## Desktop Notifications\n\nmacOS:\nosascript -e 'display notification \"message\" with title \"NTM\"'\n\nLinux (notify-send):\nnotify-send \"NTM\" \"message\"\n\nWindows/WSL:\npowershell.exe -Command \"[Windows.UI.Notifications...]\"\n\n## ntm notify command\n\nManual notification for testing/scripting:\n\n$ ntm notify \"Build complete\" --session myproject\n$ ntm notify --event agent.error --message \"Rate limit hit\"\n\n## Acceptance Criteria\n\n- [ ] Desktop notifications work on macOS and Linux\n- [ ] Webhook POST sends correctly formatted payload\n- [ ] Shell command receives event as JSON\n- [ ] Events can be filtered in config\n- [ ] ntm notify command for manual triggers\n- [ ] Errors in notification don't break NTM\n","status":"closed","priority":1,"issue_type":"task","assignee":"BlueBear","created_at":"2025-12-10T02:48:38.877783-05:00","updated_at":"2025-12-10T09:56:20.51297-05:00","closed_at":"2025-12-10T09:56:20.51297-05:00","dependencies":[{"issue_id":"ntm-gcv","depends_on_id":"ntm-laa","type":"blocks","created_at":"2025-12-10T02:48:38.87882-05:00","created_by":"daemon"},{"issue_id":"ntm-gcv","depends_on_id":"ntm-ws2","type":"blocks","created_at":"2025-12-10T02:55:23.116964-05:00","created_by":"daemon"}]}
{"id":"ntm-ghq9","title":"Add --robot-scan flag for JSON scan output","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:30:12.311312-05:00","updated_at":"2025-12-10T03:54:45.056429-05:00","closed_at":"2025-12-10T03:54:45.056429-05:00","dependencies":[{"issue_id":"ntm-ghq9","depends_on_id":"ntm-lk66","type":"blocks","created_at":"2025-12-10T03:34:48.674363-05:00","created_by":"daemon"}]}
{"id":"ntm-gin","title":"Add --profile-startup flag to root command","description":"","status":"closed","priority":1,"issue_type":"task","assignee":"FuchsiaHill","created_at":"2025-12-10T02:40:36.853361-05:00","updated_at":"2025-12-10T08:55:58.750462-05:00","closed_at":"2025-12-10T08:55:58.750462-05:00","dependencies":[{"issue_id":"ntm-gin","depends_on_id":"ntm-1rz","type":"blocks","created_at":"2025-12-10T02:40:48.317617-05:00","created_by":"daemon"}]}
{"id":"ntm-gk5","title":"Integrate agent-mail into robot snapshot","description":"Include agent-mail status in unified snapshot.\n\n## Rationale\nAgent-mail is how agents coordinate. The snapshot needs to include mail status so orchestrator knows about pending communications.\n\n## Integration Points\n1. Check if agent-mail project exists for current working dir\n2. Query agent-mail for registered agents\n3. Map tmux panes to agent-mail identities\n4. Include unread counts and pending ack counts\n\n## Snapshot Extension\n```json\n{\n  \"...\": \"existing fields\",\n  \"agent_mail\": {\n    \"project\": \"/path/to/project\",\n    \"agents\": {\n      \"BlueLake\": {\"pane\": \"0.1\", \"unread\": 2, \"pending_ack\": 1},\n      \"GreenCastle\": {\"pane\": \"0.2\", \"unread\": 0, \"pending_ack\": 0}\n    },\n    \"total_unread\": 2,\n    \"threads_active\": 3\n  }\n}\n```\n\n## Challenges\n- Agent names in mail != pane identifiers (need mapping)\n- Agent-mail may not be installed/configured\n- Multiple projects may be active\n\n## Graceful Degradation\nIf agent-mail not available, include:\n```json\n{\"agent_mail\": {\"available\": false, \"reason\": \"not configured\"}}\n```","status":"open","priority":1,"issue_type":"task","assignee":"FuchsiaHill","created_at":"2025-12-10T02:53:09.926646-05:00","updated_at":"2025-12-10T04:27:49.182774-05:00"}
{"id":"ntm-gmz","title":"Add built-in recipes (quick-claude, full-stack, minimal)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:42:20.5716-05:00","updated_at":"2025-12-10T03:59:05.408657-05:00","closed_at":"2025-12-10T03:59:05.408657-05:00","dependencies":[{"issue_id":"ntm-gmz","depends_on_id":"ntm-y93","type":"blocks","created_at":"2025-12-10T02:42:31.186941-05:00","created_by":"daemon"}]}
{"id":"ntm-gon","title":"EPIC: Clipboard Integration","description":"Seamless copy/paste between agents and system clipboard.\n\n## Problem Statement\n\nCopying content from agents requires manual tmux operations:\n1. Enter tmux copy mode (prefix + [)\n2. Navigate to content start\n3. Start selection\n4. Navigate to content end\n5. Copy to tmux buffer\n6. Exit copy mode\n7. Paste to system clipboard (separate step)\n\nThis friction discourages quick capture of agent outputs, code snippets,\nand error messages. Users often retype or screenshot instead.\n\n## Goals\n\n1. One-command copy from any pane to system clipboard\n2. Support filtering (last N lines, code blocks only, regex match)\n3. Pipe clipboard contents to agents easily\n4. Cross-platform clipboard support (macOS, Linux, WSL)\n\n## Why This Matters\n\nFast copy/paste enables:\n- Quick extraction of generated code\n- Easy sharing of agent outputs\n- Rapid iteration on prompts (copy response, modify, resend)\n- Documentation capture\n- Error reporting workflows\n\nThe goal is zero-friction capture: see something useful, capture it instantly.\n\n## Success Criteria\n\n- ntm copy myproject:1 copies pane 1 to clipboard\n- ntm copy myproject --last 50 copies last 50 lines\n- ntm copy myproject --pattern 'ERROR.*' copies matching lines\n- ntm copy myproject:1 --code extracts code blocks only\n- pbpaste | ntm send myproject --cc sends clipboard to agent\n- Works on macOS (pbcopy), Linux (xclip/xsel), and WSL (clip.exe)\n\n## Technical Approach\n\nPlatform Detection:\n- macOS: pbcopy/pbpaste\n- Linux X11: xclip -selection clipboard\n- Linux Wayland: wl-copy/wl-paste\n- WSL: clip.exe / powershell.exe Get-Clipboard\n- Fallback: tmux's built-in clipboard with warning\n\nCopy Pipeline:\n1. Capture pane content (existing CapturePaneOutput)\n2. Apply filters (line limit, regex, code extraction)\n3. Pipe to platform clipboard command\n\nCode Block Extraction:\n- Parse markdown code fences from agent output\n- Extract language hint if present\n- Option to include/exclude fence markers\n- Future: integrate with ntm-jar (Output Intelligence)\n\n## Example Workflows\n\nCapture last command output:\n$ ntm copy myproject:1 --last 100\n\nCapture only code blocks from agent response:\n$ ntm copy myproject:1 --code\n# Copies: function authenticate(token) { ... }\n\nSend clipboard as prompt context:\n$ pbpaste | ntm send myproject --cc 'Review this code:'\n\n## Interaction with Other Epics\n\n- Output Intelligence (ntm-jar): Advanced code extraction\n- JSON Output: Clipboard content in JSON mode\n- Remote Sessions: Clipboard is local, content comes from remote\n\n## Design Decisions\n\nWhy shell out to clipboard commands?\n- Cross-platform compatibility\n- Leverages user's existing clipboard setup\n- No CGo or native dependencies\n- Works with clipboard managers\n\nWhy not integrate directly with tmux clipboard?\n- Tmux buffer is separate from system clipboard\n- Extra step to sync to system clipboard\n- Direct approach is more user-friendly\n\n## Future Possibilities\n\n- ntm paste: Insert clipboard content into active pane\n- Clipboard history integration\n- Smart content detection (JSON, URL, file path)\n- IDE integration (copy to editor's clipboard)\n","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-10T02:45:55.677916-05:00","updated_at":"2025-12-10T02:45:55.677916-05:00"}
{"id":"ntm-hat","title":"Implement state change ring buffer for delta tracking","description":"Track state changes over time to support delta snapshot queries.\n\n## Rationale\n--robot-snapshot --since needs to know what changed. This requires maintaining a history of state changes with timestamps.\n\n## Design\nRing buffer of state change events:\n```go\ntype StateChange struct {\n    Timestamp time.Time\n    Type      string // agent_output, agent_state, bead_update, mail_received, alert\n    Session   string\n    Pane      string // if applicable\n    Details   map[string]interface{}\n}\n\ntype StateTracker struct {\n    changes []StateChange\n    maxAge  time.Duration // prune changes older than this\n    maxSize int           // max buffer size\n    mu      sync.RWMutex\n}\n```\n\n## Operations\n- Record(change StateChange): Add new change\n- Since(ts time.Time) []StateChange: Get changes since timestamp\n- Coalesce(): Merge multiple output events into one summary\n\n## Persistence\nConsider optional file-based persistence for tracking across ntm invocations. Without persistence, delta tracking only works within single long-running session.\n\n## Memory Bound\n- Default max 1000 changes or 5 minutes of history\n- Configurable via config file","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T02:53:57.473297-05:00","updated_at":"2025-12-10T03:20:36.650095-05:00","closed_at":"2025-12-10T03:20:36.650095-05:00","comments":[{"id":12,"issue_id":"ntm-hat","author":"jemanuel","text":"## Ring Buffer Design\n\n### Event Types\n```go\nconst (\n    ChangeAgentOutput  = \"agent_output\"   // New lines in pane\n    ChangeAgentState   = \"agent_state\"    // activeâ†’idle, etc.\n    ChangeBeadUpdate   = \"bead_update\"    // Status change\n    ChangeMailReceived = \"mail_received\"  // New message\n    ChangeAlertNew     = \"alert_new\"      // Alert triggered\n    ChangeAlertResolved = \"alert_resolved\" // Alert cleared\n)\n\ntype StateChange struct {\n    ID        uint64\n    Timestamp time.Time\n    Type      string\n    Session   string\n    Pane      string\n    Data      json.RawMessage  // Type-specific payload\n}\n```\n\n### Coalescing Rules\nMultiple rapid events should be coalesced:\n- 10 agent_output events in 1 second â†’ 1 event with lines_added=10\n- Multiple bead_update for same bead â†’ keep latest\n- Alert new + resolved quickly â†’ can optionally suppress both\n\n### Memory Management\n```go\ntype RingBuffer struct {\n    changes  []StateChange\n    head     int\n    tail     int\n    capacity int  // default 1000\n    maxAge   time.Duration // default 5 min\n}\n```\n\n### Query Optimization\nMaintain index by timestamp for fast Since() queries:\n```go\nfunc (rb *RingBuffer) Since(ts time.Time) []StateChange {\n    // Binary search to find starting point\n    // Linear scan from there\n}\n```","created_at":"2025-12-10T07:56:02Z"}]}
{"id":"ntm-hlek","title":"EPIC: Output Deduplication \u0026 Comparison","description":"# Output Deduplication \u0026 Comparison\n\n## Background \u0026 Motivation\n\nWhen broadcasting the same prompt to multiple agents, users need to understand:\n- Did agents produce similar or different results?\n- Which files did each agent modify?\n- Are there conflicts (same file, different changes)?\n\n## CRITICAL REFRAME: Focus on FILE Changes, Not Text\n\nOriginal approach: Compare scrollback text with similarity algorithms.\n**Problem**: Scrollback is noisy (tool calls, errors, chatter). Comparing it is not useful.\n\n**Better approach**: Compare WHAT AGENTS PRODUCED (file changes).\n\n## What This Feature Actually Provides\n\n### 1. File Modification Tracking\nTrack which files each agent modified:\n```bash\nntm changes myproject\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ File Changes by Agent                                       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ src/api/users.py                                            â”‚\nâ”‚   Modified by: cc_1, cc_2 (potential conflict!)             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ src/api/auth.py                                             â”‚\nâ”‚   Modified by: cc_1 only                                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ tests/test_users.py                                         â”‚\nâ”‚   Modified by: cod_1, cod_2                                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 2. Conflict Detection\n```bash\nntm conflicts myproject\nâš ï¸ Conflict detected: src/api/users.py\n  cc_1: +25 -10 lines (added caching)\n  cc_2: +18 -8 lines (added validation)\n  \n  View diff: ntm diff myproject cc_1 cc_2 src/api/users.py\n```\n\n### 3. File-Level Diff\n```bash\nntm diff myproject cc_1 cc_2\n# Shows git diff between uncommitted changes from each agent\n# Uses git stash or worktrees if available\n```\n\n### 4. Unique Contributions\n```bash\nntm contributions myproject\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Unique Contributions                                        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ cc_1: src/api/auth.py (only agent to touch this)           â”‚\nâ”‚ cod_1: tests/integration/* (only agent on tests)           â”‚\nâ”‚ cod_2: docs/api.md (only agent on docs)                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Implementation Approach\n\n### File Change Detection\nOption A: Parse git status per pane (if each pane has isolated changes)\nOption B: Track file mtimes before/after prompts\nOption C: Use git stash snapshots per agent\n\n**Recommended**: Option A/B hybrid\n- Snapshot file mtimes before broadcast\n- After agents settle, compare to detect changes\n- Attribute changes to agents based on timing\n\n### Conflict Detection\n```go\ntype FileChange struct {\n    Path      string\n    Agent     string\n    Timestamp time.Time\n    LinesAdded int\n    LinesRemoved int\n}\n\nfunc DetectConflicts(changes []FileChange) []Conflict {\n    byPath := groupByPath(changes)\n    var conflicts []Conflict\n    for path, agents := range byPath {\n        if len(agents) \u003e 1 {\n            conflicts = append(conflicts, Conflict{Path: path, Agents: agents})\n        }\n    }\n    return conflicts\n}\n```\n\n## What We're NOT Doing\n\n- NOT comparing scrollback text similarity (too noisy)\n- NOT semantic analysis of code (too complex)\n- NOT LLM-based summarization (expensive, unreliable)\n\nFocus on concrete, observable file changes.\n\n## Success Criteria\n\n- [ ] Track file modifications per agent\n- [ ] Detect same-file conflicts across agents\n- [ ] ntm changes shows file attribution\n- [ ] ntm conflicts highlights issues\n- [ ] ntm diff shows file-level differences\n- [ ] Works with git-based workflows","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T03:27:32.763201-05:00","updated_at":"2025-12-10T03:35:34.953352-05:00"}
{"id":"ntm-hzl","title":"Define persona configuration schema","description":"# Define Persona Configuration Schema\n\n## Purpose\n\nCreate the TOML schema for defining agent personas.\n\n## Schema Definition\n\n```toml\n# ~/.config/ntm/personas.toml (or in config.toml)\n\n[[personas]]\nname = \"architect\"\ndescription = \"Senior software architect focused on system design\"\nagent_type = \"claude\"      # cc, cod, gmi\nmodel = \"opus\"             # Model alias or full name\nsystem_prompt = \"\"\"\nYou are a senior software architect...\n\"\"\"\ntemperature = 0.7          # Optional, agent-specific\ncontext_files = [          # Optional, files to include in context\n    \"ARCHITECTURE.md\",\n    \"docs/design/*.md\"\n]\ntags = [\"design\", \"review\"]  # For filtering/discovery\n\n[[personas]]\nname = \"implementer\"\ndescription = \"Fast implementation engineer\"\nagent_type = \"claude\"\nmodel = \"sonnet\"\nsystem_prompt = \"\"\"\nYou are an implementation engineer...\n\"\"\"\ntemperature = 0.3\n```\n\n## Go Types\n\n```go\ntype Persona struct {\n    Name          string   `toml:\"name\"`\n    Description   string   `toml:\"description\"`\n    AgentType     string   `toml:\"agent_type\"`\n    Model         string   `toml:\"model\"`\n    SystemPrompt  string   `toml:\"system_prompt\"`\n    Temperature   *float64 `toml:\"temperature,omitempty\"`\n    ContextFiles  []string `toml:\"context_files,omitempty\"`\n    Tags          []string `toml:\"tags,omitempty\"`\n}\n\ntype PersonasConfig struct {\n    Personas []Persona `toml:\"personas\"`\n}\n```\n\n## Loading Strategy\n\n1. Load built-in personas (compiled in)\n2. Load user personas from ~/.config/ntm/personas.toml\n3. Load project personas from .ntm/personas.toml\n4. Later definitions override earlier (project \u003e user \u003e builtin)\n\n## Built-in Personas\n\nInclude 5 default personas:\n- architect\n- implementer\n- reviewer\n- tester\n- documenter\n\n## Acceptance Criteria\n\n- [ ] TOML schema defined and documented\n- [ ] Go types with proper validation\n- [ ] Multi-source loading with override semantics\n- [ ] Built-in personas compiled in\n- [ ] ntm config init includes persona examples","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:23:45.54837-05:00","updated_at":"2025-12-10T04:32:58.545336-05:00","closed_at":"2025-12-10T04:32:58.545336-05:00"}
{"id":"ntm-i0zz","title":"Research agent CLI capabilities for prompt/model injection","description":"# Research Agent CLI Capabilities\n\n## Purpose\n\nBefore implementing Personas and Multi-Model, we need to understand what each agent CLI actually supports.\n\n## Questions to Answer\n\n### Claude Code\n- [ ] How to specify model? (--model flag?)\n- [ ] How to inject system prompt? (--system-prompt, file-based?)\n- [ ] Does it support temperature control?\n- [ ] What environment variables affect behavior?\n\n### Codex CLI  \n- [ ] How to specify model? (-m flag)\n- [ ] System prompt support?\n- [ ] Temperature or other parameters?\n- [ ] Environment variables?\n\n### Gemini CLI\n- [ ] How to specify model? (--model flag?)\n- [ ] System prompt support? (--system-instruction?)\n- [ ] Other parameters?\n\n## Research Method\n\n1. Check CLI --help output\n2. Read documentation\n3. Test with actual commands\n4. Document findings\n\n## Output\n\nCreate reference document:\n```markdown\n# Agent CLI Reference\n\n## Claude Code\n- Model: `--model \u003cname\u003e` or CLAUDE_MODEL env var\n- System prompt: `--system-prompt \u003ctext\u003e` or `.claude/system-prompt.md`\n- Temperature: Not supported\n- Other: ...\n\n## Codex\n...\n\n## Gemini\n...\n```\n\n## Why This Matters\n\n- Personas need to inject system prompts - only works if CLI supports it\n- Multi-Model needs to specify models - need correct flag\n- Can't implement features for capabilities that don't exist\n\n## Acceptance Criteria\n\n- [ ] Claude Code capabilities documented\n- [ ] Codex capabilities documented\n- [ ] Gemini capabilities documented\n- [ ] Limitations clearly identified\n- [ ] Reference document created","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:41:11.699998-05:00","updated_at":"2025-12-10T04:28:18.770992-05:00","closed_at":"2025-12-10T04:28:18.770992-05:00"}
{"id":"ntm-i5m","title":"Generate recommended next actions from bv priority","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:27:31.366791-05:00","updated_at":"2025-12-10T03:47:53.924106-05:00","closed_at":"2025-12-10T03:47:53.924106-05:00","dependencies":[{"issue_id":"ntm-i5m","depends_on_id":"ntm-r2k","type":"blocks","created_at":"2025-12-10T03:28:06.11395-05:00","created_by":"daemon"},{"issue_id":"ntm-i5m","depends_on_id":"ntm-igpj","type":"blocks","created_at":"2025-12-10T03:32:50.736302-05:00","created_by":"daemon"}]}
{"id":"ntm-i5x","title":"Implement --robot-graph for cross-tool correlation map","description":"Map relationships between agents, beads, and mail threads.\n\n## Rationale\nIn a complex project, an orchestrator needs to understand HOW things are connected:\n- Which agent is working on which bead?\n- What mail threads relate to which work?\n- What's the dependency graph of in-progress work?\n\nThis correlation enables intelligent orchestration decisions.\n\n## Output Structure\n```json\n{\n  \"generated_at\": \"ISO8601\",\n  \"assignments\": [\n    {\n      \"agent\": \"myproject:0.1\",\n      \"agent_type\": \"claude\",\n      \"beads\": [\"ntm-1rz\"],\n      \"mail_threads\": [\"TKT-45\", \"TKT-52\"]\n    }\n  ],\n  \"bead_graph\": {\n    \"ntm-1rz\": {\n      \"status\": \"in_progress\",\n      \"assigned_to\": \"0.1\",\n      \"blocked_by\": [],\n      \"blocking\": [\"ntm-abc\", \"ntm-def\"]\n    },\n    \"ntm-abc\": {\n      \"status\": \"open\",\n      \"assigned_to\": null,\n      \"blocked_by\": [\"ntm-1rz\"],\n      \"blocking\": []\n    }\n  },\n  \"mail_summary\": {\n    \"TKT-45\": {\n      \"subject\": \"Profiler implementation\",\n      \"participants\": [\"BlueLake\", \"GreenCastle\"],\n      \"last_activity\": \"ISO8601\",\n      \"unread\": 2\n    }\n  },\n  \"orphan_beads\": [\"ntm-xyz\"],  // beads with no agent assigned\n  \"orphan_threads\": []           // threads not linked to any bead\n}\n```\n\n## Data Sources\n- Agent assignments: parse bead comments/updates for agent mentions\n- Mail threads: agent-mail project queries\n- Bead graph: bd dep show\n\n## Use Cases\n1. Visualize project state at a glance\n2. Find orphaned work (unassigned beads)\n3. Trace communication around specific tasks\n4. Identify bottleneck dependencies","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T02:52:09.202568-05:00","updated_at":"2025-12-10T02:52:09.202568-05:00","dependencies":[{"issue_id":"ntm-i5x","depends_on_id":"ntm-gk5","type":"blocks","created_at":"2025-12-10T02:54:40.010225-05:00","created_by":"daemon"},{"issue_id":"ntm-i5x","depends_on_id":"ntm-l5y","type":"blocks","created_at":"2025-12-10T02:54:40.075257-05:00","created_by":"daemon"}]}
{"id":"ntm-idx","title":"SUB-EPIC: Unit Test Coverage","description":"# SUB-EPIC: Unit Test Coverage\n\n## Scope\nUnit tests for ALL packages in NTM, targeting 80%+ coverage on non-TUI and 60%+ on TUI packages.\n\n## Philosophy: No Mocks Where Possible\n- **tmux package**: Use real tmux sessions (create test sessions, destroy after)\n- **config package**: Use real temp files and directories\n- **output package**: Use real io.Writers\n- **status package**: Use real output strings\n- **watcher package**: Use real file events\n\n## Coverage Targets by Package\n\n### Critical Priority (0% currently)\n1. internal/cli - All 20+ commands need basic execution tests\n2. internal/robot - JSON output verification\n3. internal/palette - Model/Update/View cycle tests\n4. internal/tui/* - Component rendering tests\n\n### High Priority (low coverage)\n5. internal/tmux - Session/Pane operations (5.4% â†’ 80%)\n6. internal/config - Config loading/parsing (16.2% â†’ 80%)\n\n### Medium Priority (decent coverage)\n7. internal/output - Formatting functions (55.1% â†’ 85%)\n8. internal/status - Pattern detection (69.6% â†’ 85%)\n\n### Lower Priority (but still needed)\n9. internal/tutorial - Slide navigation\n10. internal/updater - Version comparison\n11. internal/watcher - Debouncer behavior\n\n## Test Structure\nEach package should have:\n- `*_test.go` file co-located with source\n- Table-driven tests where applicable\n- Helper functions for test setup/teardown\n- Skip conditions for environment-specific tests\n\n## Blocking\nThis epic blocks the Integration and E2E test epics.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:18:19.451033-05:00","updated_at":"2025-12-10T03:18:19.451033-05:00","dependencies":[{"issue_id":"ntm-idx","depends_on_id":"ntm-l5h","type":"blocks","created_at":"2025-12-10T03:19:05.855961-05:00","created_by":"daemon"}]}
{"id":"ntm-ign","title":"Implement --robot-tail for multi-pane output streaming","description":"Tail recent output from all panes in a session, structured for AI consumption.\n\n## Rationale\nKnowing agents EXIST isn't enough - I need to see what they're DOING. Current approach requires separate tmux capture-pane calls per pane, each returning raw terminal output. This consolidates into one structured query.\n\n## Usage\n```bash\nntm --robot-tail myproject --lines=20\nntm --robot-tail myproject --panes=0.1,0.2 --lines=50\n```\n\n## Output Structure\n```json\n{\n  \"session\": \"myproject\",\n  \"captured_at\": \"ISO8601\",\n  \"panes\": {\n    \"0.1\": {\n      \"type\": \"claude\",\n      \"state\": \"active\",\n      \"lines\": [\"line1\", \"line2\", ...],\n      \"truncated\": false\n    },\n    \"0.2\": {\n      \"type\": \"codex\",  \n      \"state\": \"idle\",\n      \"lines\": [...],\n      \"truncated\": true\n    }\n  }\n}\n```\n\n## Design Decisions\n- Lines are raw strings (preserve formatting for context)\n- Include agent type/state metadata inline (no second query needed)\n- truncated=true means more output exists beyond --lines limit\n- Empty panes return empty lines array (not omitted)\n- Filter out ANSI codes but preserve newlines\n\n## Use Cases\n1. Check if agent is making progress\n2. See error messages without attaching\n3. Validate agent understood instructions\n4. Detect stuck/looping agents","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T02:50:44.336167-05:00","updated_at":"2025-12-10T03:17:07.432795-05:00","closed_at":"2025-12-10T03:17:07.432795-05:00"}
{"id":"ntm-igpj","title":"Add bv helper function to exec and parse robot mode output","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:32:36.220311-05:00","updated_at":"2025-12-10T03:41:26.034823-05:00","closed_at":"2025-12-10T03:41:26.034823-05:00","dependencies":[{"issue_id":"ntm-igpj","depends_on_id":"ntm-26o","type":"blocks","created_at":"2025-12-10T03:32:50.312236-05:00","created_by":"daemon"}]}
{"id":"ntm-ijua","title":"Integrate bv graph analysis with scan findings","description":"## Overview\nConnect UBS scan findings with beads_viewer (bv) graph analysis to surface insights about how code quality issues relate to task dependencies.\n\n## Background\nbv provides powerful graph analysis of beads. When scan findings become beads, we can:\n- See which critical issues block the most work\n- Identify quality hotspots via graph centrality\n- Prioritize fixes by downstream impact\n\n## Implementation Details\n\n### Integration Points\n\n1. **Finding Impact Analysis**\n   - When a finding becomes a bead, analyze its position in dependency graph\n   - Surface findings that block other work\n   - `ntm scan --analyze-impact` shows findings sorted by graph impact\n\n2. **Quality Hotspot Detection**  \n   - Files with many findings that are central to the codebase\n   - Use bv's centrality metrics on file-based grouping\n   - `ntm scan --hotspots` shows most impactful files\n\n3. **Fix Prioritization**\n   - Combine severity + graph centrality for smart priority\n   - Critical issues blocking 5 tasks \u003e critical issues blocking 0\n   - `ntm scan --priority-report` generates actionable list\n\n### Output Format\n```\nğŸ“Š Scan Impact Analysis\n\nHigh-Impact Findings (by downstream blockers):\n  1. [P0] SQL injection in auth.go:45 - blocks 3 tasks\n  2. [P1] Unhandled error in api.go:89 - blocks 2 tasks\n  \nQuality Hotspots:\n  1. internal/auth/login.go - 5 findings, centrality: 0.82\n  2. internal/api/handler.go - 3 findings, centrality: 0.71\n\nRecommended Fix Order:\n  1. auth.go:45 (impact score: 9.5)\n  2. api.go:89 (impact score: 7.2)\n  ...\n```\n\n### Files to Create/Modify\n- internal/scanner/analysis.go - Graph analysis integration\n- internal/scanner/priority.go - Smart prioritization\n- internal/cli/scan.go - Add --analyze-impact, --hotspots flags\n\n## Dependencies\n- Requires beads bridge (ntm-dv1c) to create beads from findings\n- Uses bv CLI or library for graph metrics\n\n## Acceptance Criteria\n- [ ] Impact analysis shows blocking relationships\n- [ ] Hotspots correctly identified\n- [ ] Priority combines severity and graph position\n- [ ] Output is actionable and clear","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:34:14.71218-05:00","updated_at":"2025-12-10T03:34:14.71218-05:00","dependencies":[{"issue_id":"ntm-ijua","depends_on_id":"ntm-dv1c","type":"blocks","created_at":"2025-12-10T03:35:05.386005-05:00","created_by":"daemon"}]}
{"id":"ntm-iq1l","title":"Implement ntm analytics command","description":"# Implement ntm analytics Command\n\nSummary view: sessions, agents, prompts, token estimates.\nTime period filtering (--days, --since).\nPer-agent-type breakdown.\nExport to CSV/JSON.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:17.659279-05:00","updated_at":"2025-12-10T03:29:17.659279-05:00","dependencies":[{"issue_id":"ntm-iq1l","depends_on_id":"ntm-vttg","type":"blocks","created_at":"2025-12-10T03:29:37.939042-05:00","created_by":"daemon"}]}
{"id":"ntm-ivt","title":"Add --json support to ntm version command","description":"Implement JSON output for the version command.\n\n## What This Task Does\n\nSimple task: add JSON support to version output.\n\n## JSON Schema\n\n{\n  \"version\": \"1.0.0\",\n  \"commit\": \"abc123\",\n  \"built_at\": \"2025-12-10T10:00:00Z\",\n  \"built_by\": \"goreleaser\",\n  \"go_version\": \"go1.21\",\n  \"platform\": \"darwin/arm64\"\n}\n\n## Implementation\n\n1. Create VersionOutput struct\n2. Add format handling to version command\n3. Include runtime information (Go version, GOOS, GOARCH)\n\n## Acceptance Criteria\n\n- [ ] ntm version --json produces valid JSON\n- [ ] All build info included\n- [ ] Platform info included\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:47:04.933834-05:00","updated_at":"2025-12-10T02:47:04.933834-05:00","dependencies":[{"issue_id":"ntm-ivt","depends_on_id":"ntm-ws2","type":"blocks","created_at":"2025-12-10T02:47:04.934332-05:00","created_by":"daemon"}]}
{"id":"ntm-iws","title":"Implement --persona flag for spawn/add","description":"# Implement --persona Flag for spawn/add\n\n## Purpose\n\nAllow spawning agents using persona definitions.\n\n## Syntax\n\n```bash\nntm spawn myproject --persona=architect --persona=implementer:2\nntm add myproject --persona=reviewer\n```\n\n## Flag Parsing\n\n```go\ntype PersonaSpec struct {\n    Name  string\n    Count int  // Default 1\n}\n\nfunc ParsePersonaSpec(value string) PersonaSpec {\n    parts := strings.SplitN(value, \":\", 2)\n    spec := PersonaSpec{Name: parts[0], Count: 1}\n    if len(parts) \u003e 1 {\n        spec.Count, _ = strconv.Atoi(parts[1])\n    }\n    return spec\n}\n```\n\n## Persona Resolution\n\n```go\nfunc ResolvePersona(name string) (*Persona, error) {\n    // 1. Check project personas (.ntm/personas.toml)\n    // 2. Check user personas (~/.config/ntm/personas.toml)\n    // 3. Check built-in personas\n    // 4. Return error if not found\n}\n```\n\n## Spawn Integration\n\nWhen spawning with --persona:\n1. Resolve persona definition\n2. Map agent_type to spawn flag (--cc, --cod, --gmi)\n3. Set model from persona\n4. Prepare system prompt for injection\n5. Create pane with persona name in title\n\n## Pane Naming with Persona\n\n```\nmyproject__cc_architect_1\nmyproject__cc_implementer_1\nmyproject__cc_implementer_2\n```\n\n## Compatibility with Other Flags\n\n```bash\n# Persona + extra count\nntm spawn myproject --persona=architect --cc=2:sonnet\n\n# Persona overrides model\nntm spawn myproject --persona=architect  # Uses opus from persona\n```\n\n## Acceptance Criteria\n\n- [ ] --persona flag parsed in spawn command\n- [ ] --persona flag parsed in add command\n- [ ] Persona resolved from config\n- [ ] Agent type and model derived from persona\n- [ ] Pane names include persona\n- [ ] Error messages for unknown personas\n- [ ] Works alongside explicit --cc/--cod/--gmi flags","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:23:47.899357-05:00","updated_at":"2025-12-10T03:23:47.899357-05:00","dependencies":[{"issue_id":"ntm-iws","depends_on_id":"ntm-hzl","type":"blocks","created_at":"2025-12-10T03:24:00.719552-05:00","created_by":"daemon"},{"issue_id":"ntm-iws","depends_on_id":"ntm-5zc","type":"blocks","created_at":"2025-12-10T03:24:00.82547-05:00","created_by":"daemon"}]}
{"id":"ntm-j2c","title":"Add pre-spawn and post-spawn hooks to spawn command","description":"","status":"closed","priority":1,"issue_type":"task","assignee":"SilverMountain","created_at":"2025-12-10T02:41:31.76783-05:00","updated_at":"2025-12-10T09:06:13.121984-05:00","closed_at":"2025-12-10T09:06:13.121984-05:00","dependencies":[{"issue_id":"ntm-j2c","depends_on_id":"ntm-85b","type":"blocks","created_at":"2025-12-10T02:41:44.497544-05:00","created_by":"daemon"}]}
{"id":"ntm-jar","title":"EPIC: Output Intelligence \u0026 Search","description":"Search, extract, diff, and archive agent outputs intelligently.\n\n## Problem Statement\nAgent outputs are trapped in tmux pane buffers with limited tooling:\n- Can only capture point-in-time snapshots via `ntm save`\n- No search across historical outputs\n- Code blocks in agent responses must be manually copied\n- Can't compare responses when multiple agents answer the same question\n- No persistent archive of valuable agent outputs\n\n## Goals\n1. Enable regex search across all pane buffers (`ntm grep`)\n2. Parse and extract code blocks from agent markdown output\n3. Compare outputs when sending same prompt to multiple agents\n4. Create persistent, searchable output archives\n\n## Success Criteria\n- `ntm grep 'pattern'` searches all panes with context\n- `ntm extract` pulls code blocks with file path detection\n- `ntm diff` shows side-by-side agent response comparison\n- Output logs are timestamped and searchable\n\n## Technical Approach\n- Leverage existing CapturePaneOutput() for buffer access\n- Implement markdown code fence parser for extraction\n- Use diff algorithm for output comparison\n- JSONL-based output logging with rotation\n\n## Code Block Extraction\n```\nAgent output:\nHere's the implementation:\n\\`\\`\\`python\n# src/auth.py\ndef authenticate(token):\n    return validate(token)\n\\`\\`\\`\n\nExtracted:\n- Language: python\n- Path hint: src/auth.py\n- Content: def authenticate...\n```\n\n## User Value\n- Find information across all agents quickly\n- Extract and apply code without manual copy/paste\n- Make informed decisions by comparing agent approaches\n- Build searchable knowledge base from agent interactions","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T02:37:21.823529-05:00","updated_at":"2025-12-10T02:37:21.823529-05:00"}
{"id":"ntm-jar.1","title":"Output Search (ntm grep)","description":"Search across all pane output buffers with regex support.\n\n## Command Interface\n```bash\nntm grep 'pattern' myproject          # Search all panes\nntm grep 'error' myproject --cc       # Only Claude panes\nntm grep 'def.*auth' myproject -i     # Case insensitive\nntm grep 'TODO' myproject -C 3        # 3 lines context\nntm grep 'pattern' myproject -n 100   # Search last 100 lines\nntm grep 'pattern' --all              # Search all sessions\n```\n\n## Output Format\n```\nmyproject/cc_1:42: def authenticate(user, token):\nmyproject/cc_1:43:     if not validate(token):\nmyproject/cc_1:44:         raise AuthError(\"Invalid token\")\n--\nmyproject/cod_1:15: # TODO: Add authentication middleware\n```\n\n## Implementation\n```go\nfunc GrepPanes(session, pattern string, opts GrepOptions) ([]Match, error) {\n    re, err := regexp.Compile(pattern)\n    if err \\!= nil {\n        return nil, fmt.Errorf(\"invalid pattern: %w\", err)\n    }\n    \n    panes, err := tmux.GetPanes(session)\n    if err \\!= nil {\n        return nil, err\n    }\n    \n    var matches []Match\n    for _, pane := range panes {\n        if \\!matchesFilter(pane, opts.Filter) {\n            continue\n        }\n        \n        output := tmux.CapturePaneOutput(pane.ID, opts.Lines)\n        lines := strings.Split(output, \"\\n\")\n        \n        for i, line := range lines {\n            if re.MatchString(line) {\n                matches = append(matches, Match{\n                    Session: session,\n                    Pane:    pane.Title,\n                    Line:    i + 1,\n                    Content: line,\n                    Context: getContext(lines, i, opts.Context),\n                })\n            }\n        }\n    }\n    \n    return matches, nil\n}\n```\n\n## Flags\n| Flag | Description |\n|------|-------------|\n| -i | Case insensitive |\n| -v | Invert match |\n| -C N | Show N lines context |\n| -A N | Show N lines after |\n| -B N | Show N lines before |\n| -n N | Search last N lines (default: all captured) |\n| -l | List matching panes only |\n| --cc, --cod, --gmi | Filter by agent type |\n| --json | Output as JSON |\n\n## Color Output\n- Match highlighted in yellow/bold\n- Pane name in blue\n- Line numbers in grey\n- Context separator (--) in dim\n\n## Performance Considerations\n- Capture is O(lines) per pane\n- Pattern matching is O(chars)\n- For large outputs, consider streaming\n- Limit default capture to last 1000 lines\n\n## Files to Create\n- internal/cli/grep.go - Command implementation\n- internal/output/search.go - Search logic\n- internal/output/match.go - Match data structures","status":"closed","priority":1,"issue_type":"feature","assignee":"BlueLake","created_at":"2025-12-10T02:42:21.59932-05:00","updated_at":"2025-12-10T09:20:38.911255-05:00","closed_at":"2025-12-10T09:20:38.911255-05:00","dependencies":[{"issue_id":"ntm-jar.1","depends_on_id":"ntm-jar","type":"parent-child","created_at":"2025-12-10T02:42:21.59983-05:00","created_by":"daemon"}]}
{"id":"ntm-jar.2","title":"Code Block Extraction","description":"Parse markdown code blocks from agent output for easy extraction.\n\n## Problem\nAgents often output code in markdown format. Manually copying code blocks is tedious and error-prone.\n\n## Command Interface\n```bash\nntm extract myproject                  # Extract from all panes\nntm extract myproject cc_1             # From specific pane\nntm extract myproject --last           # From most recent active pane\nntm extract myproject --lang=python    # Only Python blocks\nntm extract myproject --copy           # Copy to clipboard\nntm extract myproject --apply          # Apply to files (with confirmation)\nntm extract myproject --json           # Output as JSON\n```\n\n## Output\n```\nFound 3 code blocks in myproject/cc_1:\n\n[1] python (detected: src/auth.py)\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    â”‚ def authenticate(user, token):\n    â”‚     \"\"\"Authenticate user with token.\"\"\"\n    â”‚     if not validate(token):\n    â”‚         raise AuthError(\"Invalid\")\n    â”‚     return get_user(token)\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n[2] python (new file)\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    â”‚ class AuthService:\n    â”‚     def __init__(self, secret):\n    â”‚         self.secret = secret\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n[3] bash (command)\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    â”‚ pytest tests/ -v\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nActions: [c]opy [a]pply [s]kip [q]uit\n```\n\n## Code Block Detection\n\n### Markdown Fence Parsing\n```go\ntype CodeBlock struct {\n    Language  string   // From fence (python, bash, etc.)\n    Content   string   // The code itself\n    StartLine int      // Where in output\n    FilePath  string   // Detected file path (if any)\n    IsNew     bool     // Appears to be new file vs modification\n}\n\nfunc ParseCodeBlocks(output string) []CodeBlock {\n    // Match \n    re := regexp.MustCompile(\"(?ms)^```(\\\\w*)\\n(.*?)^```\")\n    matches := re.FindAllStringSubmatch(output, -1)\n    \n    var blocks []CodeBlock\n    for _, m := range matches {\n        block := CodeBlock{\n            Language: m[1],\n            Content:  m[2],\n        }\n        block.FilePath = detectFilePath(block.Content)\n        blocks = append(blocks, block)\n    }\n    return blocks\n}\n```\n\n### File Path Detection\nLook for hints in the code or surrounding context:\n```go\nfunc detectFilePath(content string) string {\n    // Check first line for path comment\n    // # src/auth.py\n    // // path/to/file.js\n    // \u003c!-- file.html --\u003e\n    \n    // Check for module/package declarations\n    // package main -\u003e could be main.go\n    // from fastapi import -\u003e *.py\n    \n    return \"\" // If can't determine\n}\n```\n\n## Apply Mode\nWhen --apply is used:\n1. For each block with detected path:\n   - Show diff if file exists\n   - Confirm before writing\n2. For blocks without path:\n   - Prompt for destination\n   - Or skip\n\n```\nApply [1] to src/auth.py?\n  --- existing\n  +++ new\n  @@ -15,4 +15,8 @@\n    def authenticate(...)\n  +     if not validate(token):\n  +         raise AuthError\n  [y]es [n]o [d]iff [e]dit [s]kip all: \n```\n\n## Interactive Mode (default)\nIf no action flags, enter interactive mode:\n- Arrow keys to navigate blocks\n- Enter to select action\n- c=copy, a=apply, s=skip\n\n## Files to Create\n- internal/cli/extract.go - Command\n- internal/output/codeblock.go - Parsing logic\n- internal/output/apply.go - File application","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T02:42:55.483856-05:00","updated_at":"2025-12-10T02:42:55.483856-05:00","dependencies":[{"issue_id":"ntm-jar.2","depends_on_id":"ntm-jar","type":"parent-child","created_at":"2025-12-10T02:42:55.485658-05:00","created_by":"daemon"}]}
{"id":"ntm-jar.3","title":"Output Diff \u0026 Comparison","description":"# Output Diff \u0026 Comparison\n\nCompare outputs from different agents to see how they approached the same prompt differently.\n\n## Use Cases\n1. **Same prompt, multiple agents**: Send \"implement auth\" to Claude and Codex, compare approaches\n2. **Verification**: Send same question to multiple agents, diff responses for consistency\n3. **Learning**: See how different AI models solve problems\n\n## Command Interface\n```bash\n# Compare latest output from two panes\nntm diff myproject cc_1 cod_1\n\n# Compare specific outputs by timestamp\nntm diff myproject cc_1@10:30 cc_1@10:35\n\n# Side-by-side view\nntm diff myproject cc_1 cod_1 --side-by-side\n\n# Output as unified diff\nntm diff myproject cc_1 cod_1 --unified\n\n# Focus on code blocks only\nntm diff myproject cc_1 cod_1 --code-only\n```\n\n## Output Modes\n\n### Default (Summary)\n```\nComparing cc_1 vs cod_1:\n  Lines: 45 vs 52\n  Code blocks: 2 vs 3\n  Similarity: 78%\n  \nKey differences:\n  - cc_1 uses JWT tokens\n  - cod_1 uses session cookies\n  \nUse --unified or --side-by-side for full diff\n```\n\n### Unified Diff\n```diff\n--- cc_1\n+++ cod_1\n@@ -10,6 +10,8 @@\n func authenticate(user, pass) {\n-    token := jwt.Sign(user)\n+    session := createSession(user)\n+    cookie := session.ToCookie()\n     return token\n }\n```\n\n### Side-by-Side\n```\ncc_1                          â”‚ cod_1\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunc authenticate(user) {     â”‚ func authenticate(user) {\n  token := jwt.Sign(user)     â”‚   session := createSession()\n  return token                â”‚   return session.Cookie()\n}                             â”‚ }\n```\n\n## Implementation\n```go\ntype DiffResult struct {\n    Pane1       string\n    Pane2       string\n    LineCount1  int\n    LineCount2  int\n    CodeBlocks1 int\n    CodeBlocks2 int\n    Similarity  float64\n    UnifiedDiff string\n    KeyDiffs    []string\n}\n\nfunc ComputeDiff(output1, output2 string) *DiffResult {\n    // Use go-diff or similar library\n    // Extract code blocks for --code-only\n    // Compute similarity score\n}\n```\n\n## Files to Create\n- internal/cli/diff.go - Command implementation\n- internal/output/diff.go - Diff computation logic\n- internal/output/similarity.go - Text similarity scoring\n\n## Dependencies\nRequires output capture to have stored outputs to diff.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T02:55:39.860173-05:00","updated_at":"2025-12-10T02:55:39.860173-05:00","dependencies":[{"issue_id":"ntm-jar.3","depends_on_id":"ntm-jar","type":"parent-child","created_at":"2025-12-10T02:55:39.860525-05:00","created_by":"daemon"}]}
{"id":"ntm-jda","title":"Implement context usage tracking for agents","description":"# Implement Context Usage Tracking for Agents\n\n## Purpose\n\nTrack estimated context usage per agent for visualization.\n\n## Approach\n\n1. Capture pane scrollback (visible conversation)\n2. Apply token estimation\n3. Apply overhead multiplier\n4. Store with confidence indicator\n\n```go\npackage context\n\ntype AgentContext struct {\n    PaneID        string\n    Model         string\n    VisibleTokens int       // From scrollback\n    EstimatedUsed int       // With overhead\n    ContextLimit  int       // Model's limit\n    Confidence    string    // \"low\", \"medium\" - never \"high\"\n    LastUpdated   time.Time\n}\n\ntype Tracker struct {\n    contexts map[string]*AgentContext\n    mu       sync.RWMutex\n}\n\nfunc (t *Tracker) Update(paneID, model string, scrollback string) *AgentContext {\n    visible := tokens.EstimateTokens(scrollback)\n    \n    // Conservative overhead: 2.5x visible\n    // System prompts, tool defs, hidden context\n    estimated := tokens.EstimateWithOverhead(scrollback, 2.5)\n    \n    ctx := \u0026AgentContext{\n        PaneID:        paneID,\n        Model:         model,\n        VisibleTokens: visible,\n        EstimatedUsed: estimated,\n        ContextLimit:  tokens.GetContextLimit(model),\n        Confidence:    \"low\", // Always low - we're estimating\n        LastUpdated:   time.Now(),\n    }\n    \n    t.mu.Lock()\n    t.contexts[paneID] = ctx\n    t.mu.Unlock()\n    \n    return ctx\n}\n```\n\n## Scrollback Capture\n\n```go\nfunc CaptureScrollback(paneID string, maxLines int) (string, error) {\n    // tmux capture-pane -t {paneID} -p -S -{maxLines}\n    cmd := exec.Command(\"tmux\", \"capture-pane\", \n        \"-t\", paneID, \"-p\", \"-S\", fmt.Sprintf(\"-%d\", maxLines))\n    output, err := cmd.Output()\n    return string(output), err\n}\n```\n\n## Usage Levels\n\nInstead of exact percentages, use qualitative levels:\n```go\nfunc (c *AgentContext) UsageLevel() string {\n    pct := float64(c.EstimatedUsed) / float64(c.ContextLimit) * 100\n    switch {\n    case pct \u003c 40:\n        return \"Low\"\n    case pct \u003c 70:\n        return \"Medium\"\n    case pct \u003c 85:\n        return \"High\"\n    default:\n        return \"Critical\"\n    }\n}\n```\n\n## Acceptance Criteria\n\n- [ ] Scrollback capture via tmux\n- [ ] Token estimation applied\n- [ ] Overhead multiplier (configurable, default 2.5x)\n- [ ] Qualitative usage levels (Low/Medium/High/Critical)\n- [ ] Confidence always \"low\" (honest about estimates)\n- [ ] Thread-safe tracker","status":"closed","priority":1,"issue_type":"task","assignee":"SapphireRiver","created_at":"2025-12-10T03:26:10.903539-05:00","updated_at":"2025-12-10T04:20:37.674483-05:00","closed_at":"2025-12-10T04:20:37.674483-05:00","dependencies":[{"issue_id":"ntm-jda","depends_on_id":"ntm-cyq","type":"blocks","created_at":"2025-12-10T03:26:23.324989-05:00","created_by":"daemon"}]}
{"id":"ntm-je6","title":"EPIC: Git Coordination Layer","description":"# Git Coordination Layer\n\n## Background \u0026 Motivation\n\nWhen multiple agents edit the same codebase concurrently, git conflicts are inevitable:\n- Agent A modifies src/api/users.py\n- Agent B simultaneously modifies the same file\n- One commit overwrites the other, or merge conflicts arise\n\n## Integration Levels\n\nThis EPIC has TWO levels:\n\n### Level 1: Basic Git Visibility (No Agent Mail Required)\n- `ntm git status`: Show git state per agent pane\n- `ntm git sync`: Pull/push across panes\n- Works without Agent Mail\n\n### Level 2: Coordinated Locking (Requires Agent Mail)\n- `ntm lock`: Reserve files via Agent Mail\n- `ntm unlock`: Release reservations\n- Conflict detection before spawn\n- Pre-commit guard integration\n\n## Commands\n\n### ntm git status (Level 1)\n```bash\nntm git status myproject\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Git Status: myproject                                       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Branch: feature/auth                                        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Pane      â”‚ Modified â”‚ Staged â”‚ Status                     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ cc_1      â”‚ 3 files  â”‚ 1 file â”‚ uncommitted changes       â”‚\nâ”‚ cc_2      â”‚ 0 files  â”‚ 0 filesâ”‚ clean                      â”‚\nâ”‚ cod_1     â”‚ 2 files  â”‚ 0 filesâ”‚ uncommitted changes       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### ntm git sync (Level 1)\n```bash\nntm git sync myproject\n# Pulls latest in all panes (with user confirmation)\n# Shows conflicts if any\n\nntm git sync myproject --check\n# Preview what would happen, don't execute\n```\n\n### ntm lock / ntm unlock (Level 2 - Requires Agent Mail)\n```bash\nntm lock myproject \"src/api/**\" --reason \"Refactoring\"\nntm unlock myproject --all\nntm locks myproject  # Show all reservations\n```\n\nIf Agent Mail unavailable:\n```\nâš ï¸ File locking requires Agent Mail (not detected)\n  Start Agent Mail: mcp-agent-mail serve\n  Or continue without locking (not recommended for multi-agent work)\n```\n\n## Graceful Degradation\n\n| Feature | Agent Mail Available | Agent Mail Unavailable |\n|---------|---------------------|----------------------|\n| ntm git status | Full (with locks) | Basic (git only) |\n| ntm git sync | Full | Full |\n| ntm lock/unlock | Works | Error with help |\n| Conflict prevention | Works | Not available |\n\n## Success Criteria\n\n- [ ] ntm git status shows per-pane git state\n- [ ] ntm git sync pulls across panes safely\n- [ ] Level 2 features require Agent Mail (with helpful errors)\n- [ ] Graceful degradation documented\n- [ ] Pre-commit guard optional","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:27:30.523699-05:00","updated_at":"2025-12-10T03:41:49.038113-05:00","dependencies":[{"issue_id":"ntm-je6","depends_on_id":"ntm-vum","type":"blocks","created_at":"2025-12-10T03:29:38.953187-05:00","created_by":"daemon"}]}
{"id":"ntm-jeb","title":"Add --robot-help flag with AI agent documentation","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:39:49.857287-05:00","updated_at":"2025-12-10T03:16:33.485983-05:00","closed_at":"2025-12-10T03:16:33.485983-05:00","dependencies":[{"issue_id":"ntm-jeb","depends_on_id":"ntm-517","type":"blocks","created_at":"2025-12-10T02:40:13.058801-05:00","created_by":"daemon"}]}
{"id":"ntm-jld","title":"Feature: Dashboard Dependency Graph Visualization","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-10T03:26:09.419723-05:00","updated_at":"2025-12-10T03:32:24.464532-05:00","closed_at":"2025-12-10T03:32:24.464532-05:00","dependencies":[{"issue_id":"ntm-jld","depends_on_id":"ntm-mxa","type":"blocks","created_at":"2025-12-10T03:26:28.34195-05:00","created_by":"daemon"},{"issue_id":"ntm-jld","depends_on_id":"ntm-r2k","type":"blocks","created_at":"2025-12-10T03:28:07.93031-05:00","created_by":"daemon"}]}
{"id":"ntm-jskq","title":"Implement ntm rollback command","description":"# Implement ntm rollback Command\n\nRestore session to checkpoint state.\nStash current git changes before rollback.\nRestore git state from patch.\nOptionally restore session layout.\n--dry-run preview mode.\n--last for quick rollback.","status":"closed","priority":1,"issue_type":"task","assignee":"LilacMountain","created_at":"2025-12-10T03:29:20.087996-05:00","updated_at":"2025-12-10T04:38:11.240935-05:00","closed_at":"2025-12-10T04:38:11.240935-05:00","dependencies":[{"issue_id":"ntm-jskq","depends_on_id":"ntm-tvux","type":"blocks","created_at":"2025-12-10T03:29:38.326282-05:00","created_by":"daemon"}]}
{"id":"ntm-k7o","title":"Integrate --ssh flag with all session commands","description":"Add --ssh support to spawn, list, attach, send, status, kill.\n\n## What This Task Does\n\nAfter the SSH wrapper (ntm-5zs) is complete, integrate --ssh flag\nwith all commands that operate on sessions.\n\n## Commands to Update\n\n- ntm spawn --ssh host: Create session on remote\n- ntm list --ssh host: List remote sessions\n- ntm attach --ssh host: Attach to remote session\n- ntm send --ssh host: Send prompt to remote agents\n- ntm status --ssh host: Get remote session status\n- ntm kill --ssh host: Kill remote session\n\n## Implementation Pattern\n\nFor each command:\n1. Add --ssh flag (string, optional)\n2. Pass to TmuxClient constructor\n3. All tmux operations use client abstraction\n\nfunc runSpawn(cmd *cobra.Command, args []string) error {\n    sshHost, _ := cmd.Flags().GetString(\"ssh\")\n    client := tmux.NewClient(sshHost)\n    \n    // All operations use client\n    if err := client.CreateSession(session); err != nil {\n        return err\n    }\n    ...\n}\n\n## Session Host Persistence\n\nWhen spawning remotely, store host in tmux environment:\nclient.SetEnvironment(session, \"NTM_REMOTE_HOST\", sshHost)\n\nWhen operating on existing session without --ssh:\n1. Get session's NTM_REMOTE_HOST\n2. If set, use it\n3. If not, assume local\n\n## Error Handling\n\n- Connection timeout: Clear message, suggest checking connectivity\n- Auth failure: Suggest ssh-agent or key path\n- Remote tmux not found: Suggest installing tmux on remote\n\n## Acceptance Criteria\n\n- [ ] --ssh works on spawn\n- [ ] --ssh works on list  \n- [ ] --ssh works on attach\n- [ ] --ssh works on send\n- [ ] --ssh works on status\n- [ ] --ssh works on kill\n- [ ] Remote host auto-detected for existing sessions\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:56:01.24624-05:00","updated_at":"2025-12-10T02:56:01.24624-05:00","dependencies":[{"issue_id":"ntm-k7o","depends_on_id":"ntm-5zs","type":"blocks","created_at":"2025-12-10T02:56:07.493545-05:00","created_by":"daemon"}]}
{"id":"ntm-l4fp","title":"Add Agent Mail notifications for scan results","description":"## Overview\nIntegrate UBS scan results with Agent Mail to notify coordinating agents about code quality findings, enabling proactive collaboration on fixes.\n\n## Background\nWhen multiple AI agents work on a codebase, scan results are valuable coordination signals:\n- New critical findings need immediate attention\n- Findings in files an agent is editing should be surfaced\n- Scan summaries help agents prioritize work\n\n## Implementation Details\n\n### Notification Types\n1. **Scan Summary** - After each scan, send digest to all active agents\n   - Total findings by severity\n   - New vs. existing findings\n   - Files with most issues\n\n2. **Targeted Alerts** - Notify specific agents about relevant findings\n   - Match findings to file reservations\n   - Agent editing auth.go gets auth-related findings\n   - Importance: high for critical, normal for others\n\n3. **Fix Confirmations** - When findings are resolved\n   - Notify original reporter\n   - Update thread if findings were discussed\n\n### Message Templates\n```markdown\nSubject: [Scan] {n} new findings in {project}\n\n## Scan Summary\n- Critical: {critical_count}\n- Errors: {error_count}  \n- Warnings: {warning_count}\n\n## New Findings\n{finding_list}\n\n## Your Files\nThe following findings affect files you're working on:\n{agent_relevant_findings}\n```\n\n### Files to Create/Modify\n- internal/scanner/notify.go - Notification logic\n- internal/scanner/matcher.go - File reservation matching\n- internal/cli/scan.go - Add --notify flag\n\n## Acceptance Criteria\n- [ ] Scan summaries sent to registered agents\n- [ ] Findings matched to file reservations\n- [ ] Appropriate importance levels set\n- [ ] Notifications are concise and actionable","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T03:33:31.76544-05:00","updated_at":"2025-12-10T03:38:41.640981-05:00","dependencies":[{"issue_id":"ntm-l4fp","depends_on_id":"ntm-p77j","type":"blocks","created_at":"2025-12-10T03:34:58.079729-05:00","created_by":"daemon"},{"issue_id":"ntm-l4fp","depends_on_id":"ntm-lk66","type":"blocks","created_at":"2025-12-10T03:35:13.789853-05:00","created_by":"daemon"}]}
{"id":"ntm-l5h","title":"EPIC: Comprehensive Testing Infrastructure","description":"# EPIC: Comprehensive Testing Infrastructure\n\n## Background \u0026 Rationale\n\nNTM (Named Tmux Manager) currently has very low test coverage across most packages. This EPIC addresses the need for:\n\n1. **Full Unit Test Coverage** - Testing each function/method in isolation WITHOUT mocks or fakes where possible, using real dependencies\n2. **Integration Tests** - Testing component interactions (CLI â†’ tmux, config â†’ commands, etc.)\n3. **End-to-End (E2E) Tests** - Full workflow tests with detailed logging for debugging\n\n## Current Coverage Analysis\n\n| Package | Current Coverage | Status |\n|---------|-----------------|--------|\n| cmd/ntm | 0.0% | ğŸ”´ Critical |\n| internal/cli | 0.0% | ğŸ”´ Critical |\n| internal/config | 16.2% | ğŸŸ¡ Needs improvement |\n| internal/output | 55.1% | ğŸŸ¡ Good start |\n| internal/palette | 0.0% | ğŸ”´ Critical |\n| internal/robot | 0.0% | ğŸ”´ Critical |\n| internal/status | 69.6% | ğŸŸ¢ Good (has failures) |\n| internal/tmux | 5.4% | ğŸ”´ Critical |\n| internal/tui/* | 0.0% | ğŸ”´ Critical |\n| internal/tutorial | 0.0% | ğŸ”´ Critical |\n| internal/updater | 0.0% | ğŸ”´ Critical |\n| internal/watcher | 0.0% | ğŸ”´ Critical |\n\n## Testing Philosophy\n\n### No Mocks/Fakes Policy\n- Use REAL tmux sessions for tmux tests (create/destroy per test)\n- Use REAL file system for config tests\n- Use REAL HTTP calls where applicable\n- Only mock external services that are impractical (GitHub API rate limits, etc.)\n\n### Detailed Logging Strategy\n- All E2E tests output structured logs with timestamps\n- Log file per test run with full command output\n- Capture stderr/stdout separately\n- Include system state before/after each test\n\n## Success Criteria\n- 80%+ coverage on all non-TUI packages\n- 60%+ coverage on TUI packages (harder to test without mocks)\n- All E2E tests pass on macOS and Linux\n- Tests complete in \u003c5 minutes total\n- No flaky tests (3 consecutive passes required)\n\n## Technical Considerations\n- Tests requiring tmux must be skipped in CI without tmux\n- Use Go's testing.Short() for quick vs full test modes\n- Parallelize where safe (different tmux sessions)\n- Clean up resources even on test failure","status":"open","priority":0,"issue_type":"epic","created_at":"2025-12-10T03:17:38.345103-05:00","updated_at":"2025-12-10T03:18:03.068304-05:00"}
{"id":"ntm-l5y","title":"Integrate beads into robot snapshot","description":"Include beads project status in unified snapshot.\n\n## Rationale\nBeads is how we track work. The snapshot needs to include bead summary so orchestrator knows what work is available, blocked, and in-progress.\n\n## Integration Points\n1. Detect if .beads/ directory exists\n2. Run bd stats or equivalent query\n3. Include summary counts and optionally ready list\n\n## Snapshot Extension\n```json\n{\n  \"...\": \"existing fields\",\n  \"beads\": {\n    \"project\": \"/path/to/project\",\n    \"summary\": {\n      \"total\": 58,\n      \"open\": 45,\n      \"in_progress\": 3,\n      \"blocked\": 15,\n      \"ready\": 27,\n      \"closed\": 13\n    },\n    \"ready_preview\": [\n      {\"id\": \"ntm-1rz\", \"title\": \"Create profiler package\", \"priority\": \"P0\"},\n      {\"id\": \"ntm-7mg\", \"title\": \"Add design tokens\", \"priority\": \"P1\"}\n    ],\n    \"in_progress\": [\n      {\"id\": \"ntm-abc\", \"title\": \"Implement feature X\", \"assigned\": \"BlueLake\"}\n    ]\n  }\n}\n```\n\n## Ready Preview Limit\n- Default 5 items\n- --robot-snapshot --bead-limit=10 to change\n- Sorted by priority then age\n\n## Graceful Degradation\n```json\n{\"beads\": {\"available\": false, \"reason\": \"no .beads/ directory\"}}\n```","status":"closed","priority":1,"issue_type":"task","assignee":"GreenCastle","created_at":"2025-12-10T02:53:26.959482-05:00","updated_at":"2025-12-10T03:58:54.711742-05:00","closed_at":"2025-12-10T03:58:54.711742-05:00"}
{"id":"ntm-laa","title":"EPIC: Resilience \u0026 Reliability","description":"Make NTM self-healing: detect failures, recover automatically, and notify users.\n\n## Problem Statement\n\nWhen running multiple AI agents over extended periods, failures are inevitable:\n\n1. **Agent Crashes**: Agents can crash, exit unexpectedly, or hang\n2. **Rate Limits**: API rate limits cause temporary failures (429 errors)\n3. **Silent Failures**: Users don't notice problems until manually checking\n4. **Manual Recovery**: Every failure requires human intervention to restart\n5. **Lost Work**: Crashed agents lose context and must start fresh\n\nCurrently, NTM provides no visibility into agent health and no recovery mechanisms.\nUsers must constantly monitor tmux panes to catch problems.\n\n## Goals\n\n1. Detect agent health issues (crashes, rate limits, errors, hangs)\n2. Automatically restart crashed agents with configurable policies\n3. Implement smart backoff for rate-limited agents\n4. Push notifications when events occur (desktop, webhook, Slack)\n5. Provide ntm health command for manual health checks\n\n## Why This Matters\n\nReliability is the difference between a toy and a tool. Users need to trust that:\n- If they start 4 agents at night, they'll still be running in the morning\n- Problems are detected and reported, not silently ignored\n- Recovery happens automatically when possible\n- They're notified when intervention is truly needed\n\nThis transforms NTM from 'launch and babysit' to 'launch and trust'.\n\n## Success Criteria\n\n- ntm health shows status of all agents with clear indicators\n- --auto-restart flag enables automatic crash recovery\n- Rate limit detection triggers backoff, not crash\n- Notifications fire on configurable events\n- Agents survive transient failures without user intervention\n\n## Technical Approach\n\nHealth detection via tmux output analysis:\n- Process status: tmux list-panes shows if command is running\n- Activity monitoring: Compare pane content over time\n- Error patterns: Regex match for known error signatures\n- Idle detection: Prompt pattern visible = waiting for input\n\nRecovery mechanisms:\n- Restart: Re-run agent command in same pane\n- Backoff: Exponential delay on rate limit detection\n- Limits: Max restart count to prevent infinite loops\n- Alerting: Notify after N failures\n\n## Notification Channels\n\n- Desktop: osascript (macOS), notify-send (Linux)\n- Webhook: HTTP POST to configurable URL (Slack, Discord, custom)\n- Shell: Run custom command with event data\n- Log: Append to file for later review\n\n## Relation to ntm-4pp (Observability)\n\nntm-4pp focuses on OBSERVABILITY: seeing what agents are doing.\nThis epic focuses on RELIABILITY: keeping agents running.\n\nThey are complementary:\n- ntm-4pp: 'Agent 3 hit a rate limit' (observation)\n- This epic: 'Agent 3 hit a rate limit, backing off 60s, will retry' (action)\n\n## Configuration\n\n[resilience]\nauto_restart = true\nmax_restarts = 3\nrestart_delay_seconds = 30\nrate_limit_backoff = true\nbackoff_multiplier = 2.0\nmax_backoff_seconds = 300\n\n[notifications]\nenabled = true\nevents = [\"agent.error\", \"agent.restarted\", \"session.unhealthy\"]\n\n[notifications.desktop]\nenabled = true\n\n[notifications.webhook]\nurl = \"https://hooks.slack.com/...\"\n","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T02:44:02.500136-05:00","updated_at":"2025-12-10T02:44:02.500136-05:00"}
{"id":"ntm-lb9b","title":"Create VS Code extension scaffold","description":"# Create VS Code extension scaffold\n\nInitialize extension with yo code generator.\nConfigure package.json with commands, activation events.\nSet up TypeScript compilation.\nBasic extension activation and deactivation.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:22.283113-05:00","updated_at":"2025-12-10T03:29:22.283113-05:00"}
{"id":"ntm-ldy","title":"Parse bv Mermaid DAG output for TUI rendering","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:08.158338-05:00","updated_at":"2025-12-10T03:32:04.580306-05:00","closed_at":"2025-12-10T03:32:04.580306-05:00","dependencies":[{"issue_id":"ntm-ldy","depends_on_id":"ntm-jld","type":"blocks","created_at":"2025-12-10T03:28:02.66103-05:00","created_by":"daemon"}]}
{"id":"ntm-lk66","title":"Implement ntm scan command for UBS execution","description":"","status":"closed","priority":0,"issue_type":"task","assignee":"ChartreuseLake","created_at":"2025-12-10T03:29:46.862501-05:00","updated_at":"2025-12-10T03:51:37.60504-05:00","closed_at":"2025-12-10T03:51:37.60504-05:00","dependencies":[{"issue_id":"ntm-lk66","depends_on_id":"ntm-p77j","type":"blocks","created_at":"2025-12-10T03:34:47.111906-05:00","created_by":"daemon"}]}
{"id":"ntm-lla","title":"Implement session state save/restore","description":"Save and restore session state for disaster recovery.\n\n## Rationale\nIf I'm orchestrating 8 agents on a complex task and:\n- System crashes\n- Network disconnects\n- Need to pause and resume later\n\nI need to be able to save the current state and restore it.\n\n## Save Operation\n```bash\nntm --robot-save myproject --output=state.json\nntm --robot-save myproject  # auto-saves to ~/.local/share/ntm/saves/\n```\n\n## State Includes\n```json\n{\n  \"saved_at\": \"ISO8601\",\n  \"session\": \"myproject\",\n  \"working_dir\": \"/path/to/project\",\n  \"agents\": [\n    {\n      \"pane\": \"0.1\",\n      \"type\": \"claude\",\n      \"command\": \"claude\",\n      \"recent_context\": [\"last 50 lines...\"]\n    }\n  ],\n  \"layout\": \"tiled\",\n  \"active_pane\": \"0.1\",\n  \"command_history\": [...],\n  \"beads_state\": {...}  // if beads integration available\n}\n```\n\n## Restore Operation\n```bash\nntm --robot-restore state.json\nntm --robot-restore state.json --dry-run  # show what would happen\n```\n\n## Restore Process\n1. Create session with same name\n2. Create panes with correct layout\n3. Start agents in each pane\n4. Optionally replay context (send last N lines as context)\n\n## Limitations\n- Cannot restore exact agent state (no agent-side state)\n- Context replay is best-effort\n- External state (files changed) not tracked","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:59:00.354106-05:00","updated_at":"2025-12-10T02:59:00.354106-05:00"}
{"id":"ntm-mxa","title":"EPIC: Deep bv Integration - Intelligent Agent Orchestration","description":"","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T03:25:39.612339-05:00","updated_at":"2025-12-10T03:39:02.185189-05:00"}
{"id":"ntm-mzr","title":"Add agent capacity and workload balancing","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:27:26.282141-05:00","updated_at":"2025-12-10T03:32:06.364523-05:00","closed_at":"2025-12-10T03:32:06.364523-05:00","dependencies":[{"issue_id":"ntm-mzr","depends_on_id":"ntm-8ua","type":"blocks","created_at":"2025-12-10T03:28:05.563493-05:00","created_by":"daemon"}]}
{"id":"ntm-n8h","title":"Add bottleneck highlighting with betweenness scores","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:27:08.442557-05:00","updated_at":"2025-12-10T03:32:04.745248-05:00","closed_at":"2025-12-10T03:32:04.745248-05:00","dependencies":[{"issue_id":"ntm-n8h","depends_on_id":"ntm-9cs","type":"blocks","created_at":"2025-12-10T03:28:02.968151-05:00","created_by":"daemon"}]}
{"id":"ntm-n95","title":"Update agent command templates for model injection","description":"# Update Agent Command Templates for Model Injection\n\n## Purpose\n\nModify the agent launch commands to inject the selected model.\n\n## Current Approach\n\nConfig defines fixed commands:\n```toml\n[agents]\nclaude = \"claude --dangerously-skip-permissions\"\ncodex = \"codex -m gpt-4\"\ngemini = \"gemini --yolo\"\n```\n\n## New Template Approach\n\nUse Go template syntax for model injection:\n```toml\n[agents]\nclaude = \"claude --dangerously-skip-permissions {{if .Model}}--model {{.Model}}{{end}}\"\ncodex = \"codex -m {{.Model | default \\\"gpt-4\\\"}} --dangerously-bypass-approvals-and-sandbox\"\ngemini = \"gemini {{if eq .Model \\\"flash\\\"}}--fast{{end}} --yolo\"\n```\n\n## Template Variables\n\n```go\ntype AgentTemplateVars struct {\n    Model       string  // Resolved model name\n    ModelAlias  string  // Original alias (opus, sonnet)\n    SessionName string  // NTM session name\n    PaneIndex   int     // Pane number\n    AgentType   string  // cc, cod, gmi\n}\n```\n\n## Template Functions\n\n- `default`: Fallback value if empty\n- `eq`, `ne`: Comparison\n- `contains`: String contains\n\n## Command Generation\n\n```go\nfunc GenerateAgentCommand(tmpl string, vars AgentTemplateVars) (string, error) {\n    t, err := template.New(\"agent\").Funcs(templateFuncs).Parse(tmpl)\n    if err != nil {\n        return \"\", err\n    }\n    var buf bytes.Buffer\n    if err := t.Execute(\u0026buf, vars); err != nil {\n        return \"\", err\n    }\n    return buf.String(), nil\n}\n```\n\n## Backwards Compatibility\n\nIf template contains no `{{}}`, use as-is (legacy mode).\n\n## Acceptance Criteria\n\n- [ ] Agent commands support Go templates\n- [ ] Model injected via template variable\n- [ ] Default function for fallbacks\n- [ ] Template errors surface clearly\n- [ ] Backwards compatible with plain commands\n- [ ] Examples in config init output","status":"in_progress","priority":1,"issue_type":"task","assignee":"SilverStone","created_at":"2025-12-10T03:21:42.04627-05:00","updated_at":"2025-12-10T09:57:09.584915-05:00","dependencies":[{"issue_id":"ntm-n95","depends_on_id":"ntm-egl","type":"blocks","created_at":"2025-12-10T03:21:53.868007-05:00","created_by":"daemon"},{"issue_id":"ntm-n95","depends_on_id":"ntm-i0zz","type":"blocks","created_at":"2025-12-10T03:41:26.623893-05:00","created_by":"daemon"}]}
{"id":"ntm-nes","title":"Add --robot-status flag for session JSON output","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:39:50.88226-05:00","updated_at":"2025-12-10T03:35:55.25988-05:00","closed_at":"2025-12-10T03:35:55.25988-05:00","dependencies":[{"issue_id":"ntm-nes","depends_on_id":"ntm-517","type":"blocks","created_at":"2025-12-10T02:40:13.127055-05:00","created_by":"daemon"}]}
{"id":"ntm-nm1","title":"EPIC: AI Agent Interoperability (Robot Output)","description":"","status":"open","priority":0,"issue_type":"epic","created_at":"2025-12-10T02:39:08.243198-05:00","updated_at":"2025-12-10T02:39:08.243198-05:00","comments":[{"id":1,"issue_id":"ntm-nm1","author":"jemanuel","text":"-","created_at":"2025-12-10T07:39:36Z"}]}
{"id":"ntm-nts","title":"Add Agent Mail to robot mode output","description":"# Add Agent Mail to Robot Mode Output\n\n## Purpose\n\nExtend --robot-status and add --robot-mail for AI orchestrators to access Agent Mail state programmatically.\n\n## Enhanced --robot-status\n\nAdd agent_mail section to existing robot status:\n```json\n{\n  \"sessions\": [...],\n  \"summary\": {...},\n  \"agent_mail\": {\n    \"available\": true,\n    \"server_url\": \"http://127.0.0.1:8765/mcp/\",\n    \"sessions_registered\": 3,\n    \"total_unread\": 7,\n    \"total_locks\": 5,\n    \"urgent_messages\": 2\n  }\n}\n```\n\n## New --robot-mail Flag\n\n```bash\nntm --robot-mail [session]\n```\n\nOutput:\n```json\n{\n  \"session\": \"myproject\",\n  \"agent_mail\": {\n    \"connected\": true,\n    \"session_agent\": {\n      \"name\": \"ntm_myproject\",\n      \"project_key\": \"/path/to/myproject\",\n      \"registered_at\": \"2025-12-10T10:00:00Z\",\n      \"last_active\": \"2025-12-10T15:30:00Z\"\n    },\n    \"agents\": [\n      {\n        \"pane\": \"cc_1\",\n        \"agent_name\": \"GreenCastle\",\n        \"program\": \"claude-code\",\n        \"model\": \"opus-4.1\",\n        \"unread_count\": 2,\n        \"urgent_count\": 1\n      }\n    ],\n    \"messages\": {\n      \"total\": 15,\n      \"unread\": 3,\n      \"urgent\": 1,\n      \"pending_ack\": 2\n    },\n    \"file_reservations\": [\n      {\n        \"id\": 42,\n        \"pattern\": \"src/api/**\",\n        \"agent\": \"GreenCastle\",\n        \"exclusive\": true,\n        \"expires_in_seconds\": 2700,\n        \"reason\": \"Implementing endpoints\"\n      }\n    ],\n    \"conflicts\": []\n  }\n}\n```\n\n## Use Cases for AI Orchestrators\n\n1. **Check before sending work**: Are there conflicts? Who has locks?\n2. **Monitor coordination**: Are agents communicating? Any pending acks?\n3. **Detect stale locks**: Reservations expiring soon\n4. **Route messages**: Know which agent to send to based on locks\n\n## Acceptance Criteria\n\n- [ ] --robot-status includes agent_mail summary\n- [ ] --robot-mail provides detailed per-session state\n- [ ] Includes all registered agents with pane mapping\n- [ ] Message counts by status (unread, urgent, pending_ack)\n- [ ] File reservations with expiry info\n- [ ] Conflict detection included","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:19:45.615031-05:00","updated_at":"2025-12-10T03:19:45.615031-05:00","dependencies":[{"issue_id":"ntm-nts","depends_on_id":"ntm-161","type":"blocks","created_at":"2025-12-10T03:19:56.365366-05:00","created_by":"daemon"},{"issue_id":"ntm-nts","depends_on_id":"ntm-1ts","type":"blocks","created_at":"2025-12-10T03:19:56.463319-05:00","created_by":"daemon"}]}
{"id":"ntm-nuf","title":"E2E Test: Full Agent Workflow","description":"# E2E Test: Full Agent Workflow\n\n## Scenario\nComplete lifecycle of spawning, using, and killing an agent session.\n\n## Steps\n1. ntm spawn testproject --cc=2 --cod=1\n2. Verify session exists with 4 panes\n3. ntm send testproject --cc 'echo hello'\n4. Verify 'echo hello' appears in Claude panes\n5. ntm send testproject --cod 'echo world'\n6. Verify 'echo world' appears in Codex pane\n7. ntm interrupt testproject\n8. Verify Ctrl+C sent to all panes\n9. ntm status testproject --json\n10. Verify JSON is valid and accurate\n11. ntm kill -f testproject\n12. Verify session no longer exists\n\n## Logging Requirements\n```\n[2025-12-10T10:30:45Z] TEST START: TestFullAgentWorkflow\n[2025-12-10T10:30:45Z] SETUP: Environment check\n[2025-12-10T10:30:45Z]   tmux version: 3.3a\n[2025-12-10T10:30:45Z]   ntm version: dev\n[2025-12-10T10:30:45Z]   existing sessions: 0\n[2025-12-10T10:30:45Z] STEP 1: Spawn session\n[2025-12-10T10:30:45Z]   EXEC: ntm spawn ntm_e2e_12345 --cc=2 --cod=1\n[2025-12-10T10:30:46Z]   STDOUT: Session 'ntm_e2e_12345' created (4 panes)\n[2025-12-10T10:30:46Z]   EXIT: 0\n[2025-12-10T10:30:46Z] STEP 2: Verify session\n[2025-12-10T10:30:46Z]   VERIFY: tmux has-session -t ntm_e2e_12345\n[2025-12-10T10:30:46Z]   RESULT: exists\n[2025-12-10T10:30:46Z]   VERIFY: pane count == 4\n[2025-12-10T10:30:46Z]   RESULT: PASS\n...\n[2025-12-10T10:30:50Z] TEARDOWN: Killing test session\n[2025-12-10T10:30:50Z] TEST END: PASS (5.2s)\n```\n\n## Implementation\n- tests/e2e/agent_workflow_test.go\n- Custom test harness with logging\n- Unique session names per run\n- Full cleanup even on failure","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:23:54.575845-05:00","updated_at":"2025-12-10T03:23:54.575845-05:00","dependencies":[{"issue_id":"ntm-nuf","depends_on_id":"ntm-66c","type":"blocks","created_at":"2025-12-10T03:24:41.867795-05:00","created_by":"daemon"},{"issue_id":"ntm-nuf","depends_on_id":"ntm-vr2","type":"blocks","created_at":"2025-12-10T03:24:42.979512-05:00","created_by":"daemon"}]}
{"id":"ntm-nxf","title":"Integrate context status into dashboard","description":"# Integrate Context Status into Dashboard\n\n## Purpose\n\nShow context usage in the dashboard view for at-a-glance monitoring.\n\n## Dashboard Enhancement\n\nAdd context bar to each pane card:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Panes (4)                                                   â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â— cc_1   opus      working    [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 62%              â”‚\nâ”‚ â— cc_2   sonnet    idle       [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 89% âš ï¸           â”‚\nâ”‚ â— cod_1  gpt4      working    [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 31%              â”‚\nâ”‚ â— gmi_1  pro       idle       [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  5%              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Implementation\n\nAdd context field to pane model in dashboard:\n```go\ntype PaneCard struct {\n    // Existing fields...\n    ContextUsed int\n    ContextMax  int\n    ContextPct  float64\n}\n```\n\nRender context bar:\n```go\nfunc (p PaneCard) ContextBar(width int) string {\n    filled := int(p.ContextPct * float64(width) / 100)\n    empty := width - filled\n    \n    color := theme.Green\n    if p.ContextPct \u003e 80 {\n        color = theme.Red\n    } else if p.ContextPct \u003e 60 {\n        color = theme.Yellow\n    }\n    \n    return color.Render(strings.Repeat(\"â–ˆ\", filled)) + \n           theme.Dim.Render(strings.Repeat(\"â–‘\", empty))\n}\n```\n\n## Refresh Strategy\n\n- Context data cached for 60s\n- Press 'c' to force context refresh\n- Background refresh if dashboard open \u003e60s\n\n## Keyboard Shortcut\n\n| Key | Action |\n|-----|--------|\n| c | Refresh context data |\n| C | Open full context view |\n\n## Acceptance Criteria\n\n- [ ] Context bar displayed per pane\n- [ ] Color coding (green/yellow/red)\n- [ ] Warning icon for \u003e80%\n- [ ] Keyboard shortcut for refresh\n- [ ] Graceful handling when data unavailable","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:26:13.013354-05:00","updated_at":"2025-12-10T03:26:13.013354-05:00","dependencies":[{"issue_id":"ntm-nxf","depends_on_id":"ntm-jda","type":"blocks","created_at":"2025-12-10T03:26:23.526527-05:00","created_by":"daemon"}]}
{"id":"ntm-oba","title":"Implement --robot-terse for ultra-compact output","description":"Single-line encoded state for extremely token-constrained scenarios.\n\n## Rationale\nSometimes I need just the essentials in minimum tokens. A full snapshot might be 500+ tokens; terse mode gives me the critical state in \u003c50 tokens.\n\n## Usage\n```bash\nntm --robot-terse\nntm --robot-snapshot --terse  # terse snapshot\n```\n\n## Output Format\n```\nS:myproject|A:3/3|R:30|B:27|I:3|M:5|!:2\n```\n\nDecoded:\n- S: Session name\n- A: Agents (active/total)\n- R: Ready beads\n- B: Blocked beads  \n- I: In-progress beads\n- M: Unread mail\n- !: Alert count\n\n## Multi-Session\n```\nS:proj1|A:2/2|R:15|B:10|I:1|M:2|!:0;S:proj2|A:3/3|R:20|B:5|I:2|M:0|!:1\n```\n\n## Use Cases\n1. Polling in tight loops\n2. Embedding in prompts with strict token limits\n3. Quick health checks\n4. Dashboard status bars\n\n## Parsing\nProvide parsing utilities in robot package:\n```go\nfunc ParseTerse(s string) *TerseState\n```","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:52:39.009743-05:00","updated_at":"2025-12-10T02:52:39.009743-05:00","dependencies":[{"issue_id":"ntm-oba","depends_on_id":"ntm-sim","type":"blocks","created_at":"2025-12-10T02:54:39.818091-05:00","created_by":"daemon"}]}
{"id":"ntm-ola","title":"EPIC: File Watching \u0026 Live Reload","description":"","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T02:39:23.378412-05:00","updated_at":"2025-12-10T02:39:23.378412-05:00","comments":[{"id":8,"issue_id":"ntm-ola","author":"jemanuel","text":"-","created_at":"2025-12-10T07:43:29Z"}]}
{"id":"ntm-oln","title":"Implement --robot-spawn for structured session creation","description":"Create session with preset and return structured result.\n\n## Rationale\nCurrent spawn returns human-readable output. For orchestration, I need structured confirmation of exactly what was created.\n\n## Usage\n```bash\nntm --robot-spawn myproject --preset=fullstack\nntm --robot-spawn myproject --cc=2 --cod=1\n```\n\n## Output Structure\n```json\n{\n  \"session\": \"myproject\",\n  \"created_at\": \"ISO8601\",\n  \"preset_used\": \"fullstack\",\n  \"working_dir\": \"/path/to/project\",\n  \"agents\": [\n    {\"pane\": \"0.0\", \"type\": \"claude\", \"ready\": true, \"startup_ms\": 234},\n    {\"pane\": \"0.1\", \"type\": \"claude\", \"ready\": true, \"startup_ms\": 198},\n    {\"pane\": \"0.2\", \"type\": \"codex\", \"ready\": true, \"startup_ms\": 312}\n  ],\n  \"layout\": \"tiled\",\n  \"total_startup_ms\": 512\n}\n```\n\n## Ready Detection\n- Parse pane output for agent prompt/ready indicator\n- Timeout after configurable wait (default 30s)\n- Report ready=false with reason if agent didn't start\n\n## Integration\nWorks with recipe system when implemented. Preset name maps to recipe definition.","status":"closed","priority":1,"issue_type":"task","assignee":"PinkCreek","created_at":"2025-12-10T02:52:55.090595-05:00","updated_at":"2025-12-10T09:05:35.50312-05:00","closed_at":"2025-12-10T09:05:35.50312-05:00"}
{"id":"ntm-oloz","title":"Implement token usage aggregation","description":"# Implement token usage aggregation\n\nAggregate token estimates across sessions.\nGroup by model, agent type, time period.\nTrack input vs output tokens separately.\nIntegration with context window tracking.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:17.785818-05:00","updated_at":"2025-12-10T03:29:17.785818-05:00","dependencies":[{"issue_id":"ntm-oloz","depends_on_id":"ntm-cyq","type":"blocks","created_at":"2025-12-10T03:29:38.053693-05:00","created_by":"daemon"},{"issue_id":"ntm-oloz","depends_on_id":"ntm-vttg","type":"blocks","created_at":"2025-12-10T03:29:38.148534-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj","title":"EPIC: Deep CASS Integration - Cross-Agent Session Search","description":"Transform NTM from a session manager into an intelligent AI agent orchestration platform by deeply integrating CASS (Coding Agent Session Search). This enables agents to learn from past sessions, avoid duplicate work, surface institutional knowledge, and provide operators with actionable insights on agent activity.\n\n## Vision\nCASS indexes 10+ AI agent conversation histories into a unified, sub-50ms searchable index. Combined with NTM's session management:\n- Before solving: Query CASS for similar issues â†’ avoid re-solving\n- While working: Surface relevant context from past sessions  \n- After solving: New session auto-indexed for future reference\n- For operators: Dashboard showing agent activity, trends, insights\n\n## Architecture\n- internal/cass/ - Go client for CASS robot mode\n- ntm cass \u003csubcommand\u003e - CLI commands for search, status, insights\n- --robot-cass-* flags - Machine-readable output\n- TUI widgets - CASS search in dashboard\n\n## Success Metrics\n- Agents can query CASS in \u003c100ms\n- 30% reduction in duplicate problem-solving\n- Operators see unified agent activity view","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T03:29:27.867341-05:00","updated_at":"2025-12-10T03:39:02.250344-05:00"}
{"id":"ntm-ozcj.1","title":"CASS Infrastructure: Create internal/cass Go client package","description":"Create the foundational Go client package for CASS integration.\n\n## Overview\nThis package provides a Go interface to CASS robot mode, enabling NTM to query past agent sessions, check health, and retrieve insights.\n\n## Files to Create\n- internal/cass/client.go - Main client with exec wrapper\n- internal/cass/types.go - Response types (SearchHit, Status, Capabilities, etc.)\n- internal/cass/search.go - Search API wrapper\n- internal/cass/health.go - Health check integration\n- internal/cass/timeline.go - Timeline API wrapper\n- internal/cass/client_test.go - Unit tests with mocks\n\n## Key Design Decisions\n\n### Execution Model\nUse os/exec to call cass CLI (not HTTP) because:\n- CASS is a local tool, not a server\n- Robot mode is designed for CLI consumption\n- No need for daemon/socket infrastructure\n\n### Error Handling\n- CASS exit codes map to Go errors\n- Retry on transient errors (timeout, busy)\n- Graceful degradation when CASS not installed\n\n### Response Types\nMirror CASS robot mode JSON schemas:\n```go\ntype SearchHit struct {\n    SourcePath  string  `json:\"source_path\"`\n    LineNumber  *int    `json:\"line_number,omitempty\"`\n    Agent       string  `json:\"agent\"`\n    Workspace   string  `json:\"workspace\"`\n    Title       string  `json:\"title\"`\n    Score       float64 `json:\"score\"`\n    Snippet     string  `json:\"snippet\"`\n    CreatedAt   *int64  `json:\"created_at,omitempty\"`\n    MatchType   string  `json:\"match_type\"`\n    Content     string  `json:\"content,omitempty\"`\n}\n\ntype SearchResponse struct {\n    Query        string       `json:\"query\"`\n    Limit        int          `json:\"limit\"`\n    Offset       int          `json:\"offset\"`\n    Count        int          `json:\"count\"`\n    TotalMatches int          `json:\"total_matches\"`\n    Hits         []SearchHit  `json:\"hits\"`\n    Meta         *Meta        `json:\"_meta,omitempty\"`\n    Aggregations *Aggregations `json:\"aggregations,omitempty\"`\n}\n```\n\n## Acceptance Criteria\n- [ ] Client detects if CASS is installed\n- [ ] Search returns parsed results\n- [ ] Health check works\n- [ ] Timeout and retry logic\n- [ ] All error codes mapped\n- [ ] Tests pass with mock CASS output","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-10T03:29:49.800387-05:00","updated_at":"2025-12-10T03:42:47.427671-05:00","closed_at":"2025-12-10T03:42:47.427671-05:00","dependencies":[{"issue_id":"ntm-ozcj.1","depends_on_id":"ntm-ozcj","type":"parent-child","created_at":"2025-12-10T03:29:49.800822-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.1.1","title":"CASS Client: Implement types.go with all response schemas","description":"Create Go types for all CASS robot mode response schemas.\n\n## Types to Implement\n\n### Core Response Types\n```go\npackage cass\n\n// SearchHit represents a single search result\ntype SearchHit struct {\n    SourcePath  string  `json:\"source_path\"`\n    LineNumber  *int    `json:\"line_number,omitempty\"`\n    Agent       string  `json:\"agent\"`\n    Workspace   string  `json:\"workspace\"`\n    Title       string  `json:\"title\"`\n    Score       float64 `json:\"score\"`\n    Snippet     string  `json:\"snippet\"`\n    CreatedAt   *int64  `json:\"created_at,omitempty\"`\n    MatchType   string  `json:\"match_type\"`\n    Content     string  `json:\"content,omitempty\"`\n}\n\n// Meta contains response metadata\ntype Meta struct {\n    ElapsedMs        int             `json:\"elapsed_ms\"`\n    WildcardFallback bool            `json:\"wildcard_fallback\"`\n    CacheStats       *CacheStats     `json:\"cache_stats,omitempty\"`\n    NextCursor       string          `json:\"next_cursor,omitempty\"`\n    RequestID        string          `json:\"request_id,omitempty\"`\n    IndexFreshness   *IndexFreshness `json:\"index_freshness,omitempty\"`\n    Warnings         []string        `json:\"warnings,omitempty\"`\n}\n\n// SearchResponse represents CASS search results\ntype SearchResponse struct {\n    Query        string        `json:\"query\"`\n    Limit        int           `json:\"limit\"`\n    Offset       int           `json:\"offset\"`\n    Count        int           `json:\"count\"`\n    TotalMatches int           `json:\"total_matches\"`\n    Hits         []SearchHit   `json:\"hits\"`\n    Meta         *Meta         `json:\"_meta,omitempty\"`\n    Aggregations *Aggregations `json:\"aggregations,omitempty\"`\n}\n\n// StatusResponse represents CASS health status\ntype StatusResponse struct {\n    Healthy           bool      `json:\"healthy\"`\n    RecommendedAction string    `json:\"recommended_action\"`\n    Index             IndexInfo `json:\"index\"`\n    Database          DBInfo    `json:\"database\"`\n    Pending           Pending   `json:\"pending\"`\n    Meta              *Meta     `json:\"_meta,omitempty\"`\n}\n\n// Capabilities represents CASS feature discovery\ntype Capabilities struct {\n    CrateVersion    string   `json:\"crate_version\"`\n    APIVersion      int      `json:\"api_version\"`\n    ContractVersion string   `json:\"contract_version\"`\n    Features        []string `json:\"features\"`\n    Connectors      []string `json:\"connectors\"`\n    Limits          Limits   `json:\"limits\"`\n}\n\n// ErrorResponse for CASS errors\ntype ErrorResponse struct {\n    Error CASSError `json:\"error\"`\n}\n\ntype CASSError struct {\n    Code      int    `json:\"code\"`\n    Kind      string `json:\"kind\"`\n    Message   string `json:\"message\"`\n    Hint      string `json:\"hint,omitempty\"`\n    Retryable bool   `json:\"retryable\"`\n}\n```\n\n## Acceptance Criteria\n- [ ] All CASS response types defined\n- [ ] JSON tags match CASS robot mode output\n- [ ] Helper methods (IsHealthy, HasMore, etc.)\n- [ ] Godoc comments on all types\n- [ ] Unit tests for JSON unmarshaling","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:32:24.109611-05:00","updated_at":"2025-12-10T03:41:41.576345-05:00","closed_at":"2025-12-10T03:41:41.576345-05:00","dependencies":[{"issue_id":"ntm-ozcj.1.1","depends_on_id":"ntm-ozcj.1","type":"parent-child","created_at":"2025-12-10T03:32:24.109999-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.1.2","title":"CASS Client: Implement client.go with exec wrapper and error handling","description":"Create the main CASS client with exec-based invocation and error handling.\n\n## Implementation\n\n```go\npackage cass\n\nimport (\n    \"bytes\"\n    \"context\"\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"os/exec\"\n    \"time\"\n)\n\n// Client provides access to CASS robot mode\ntype Client struct {\n    binaryPath string\n    timeout    time.Duration\n}\n\n// NewClient creates a CASS client\nfunc NewClient() (*Client, error) {\n    path, err := exec.LookPath(\"cass\")\n    if err != nil {\n        return nil, fmt.Errorf(\"cass not found in PATH: %w\", err)\n    }\n    return \u0026Client{\n        binaryPath: path,\n        timeout:    30 * time.Second,\n    }, nil\n}\n\n// IsAvailable returns true if CASS is installed\nfunc IsAvailable() bool {\n    _, err := exec.LookPath(\"cass\")\n    return err == nil\n}\n\n// run executes a CASS command and returns parsed JSON\nfunc (c *Client) run(ctx context.Context, args ...string) ([]byte, error) {\n    ctx, cancel := context.WithTimeout(ctx, c.timeout)\n    defer cancel()\n    \n    cmd := exec.CommandContext(ctx, c.binaryPath, args...)\n    var stdout, stderr bytes.Buffer\n    cmd.Stdout = \u0026stdout\n    cmd.Stderr = \u0026stderr\n    \n    err := cmd.Run()\n    if err != nil {\n        // Parse exit code and return appropriate error\n        if exitErr, ok := err.(*exec.ExitError); ok {\n            return nil, c.parseError(exitErr.ExitCode(), stderr.Bytes())\n        }\n        return nil, err\n    }\n    \n    return stdout.Bytes(), nil\n}\n\n// parseError maps CASS exit codes to Go errors\nfunc (c *Client) parseError(code int, stderr []byte) error {\n    switch code {\n    case 2:\n        return ErrUsage\n    case 3:\n        return ErrIndexMissing\n    case 4:\n        return ErrNetwork\n    case 5:\n        return ErrCorrupt\n    case 7:\n        return ErrBusy\n    case 8:\n        return ErrPartialResults\n    case 10:\n        return ErrTimeout\n    default:\n        return fmt.Errorf(\"cass error (code %d): %s\", code, string(stderr))\n    }\n}\n\n// Error types\nvar (\n    ErrNotInstalled   = errors.New(\"cass is not installed\")\n    ErrUsage          = errors.New(\"usage error\")\n    ErrIndexMissing   = errors.New(\"index not found - run 'cass index --full'\")\n    ErrNetwork        = errors.New(\"network error\")\n    ErrCorrupt        = errors.New(\"data corruption detected\")\n    ErrBusy           = errors.New(\"index is busy\")\n    ErrPartialResults = errors.New(\"partial results due to timeout\")\n    ErrTimeout        = errors.New(\"operation timed out\")\n)\n```\n\n## Acceptance Criteria\n- [ ] Client detects CASS installation\n- [ ] Timeout support with context\n- [ ] All exit codes mapped to errors\n- [ ] Stderr captured for debugging\n- [ ] IsAvailable() for quick checks\n- [ ] Configurable timeout","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:32:48.263728-05:00","updated_at":"2025-12-10T03:53:53.01306-05:00","closed_at":"2025-12-10T03:53:53.01306-05:00","dependencies":[{"issue_id":"ntm-ozcj.1.2","depends_on_id":"ntm-ozcj.1","type":"parent-child","created_at":"2025-12-10T03:32:48.264732-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.1.2","depends_on_id":"ntm-ozcj.1.1","type":"blocks","created_at":"2025-12-10T03:32:48.266634-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.1.3","title":"CASS Client: Implement search.go with full query support","description":"Implement search functionality with all CASS query options.\n\n## Implementation\n\n```go\npackage cass\n\nimport (\n    \"context\"\n    \"encoding/json\"\n    \"fmt\"\n)\n\n// SearchOptions configures a CASS search\ntype SearchOptions struct {\n    Agent       string // Filter by agent slug\n    Workspace   string // Filter by workspace path\n    Since       string // Time filter (7d, 2w, 2025-01-01)\n    Until       string // End time filter\n    Limit       int    // Max results (default 10)\n    Offset      int    // Pagination offset\n    Cursor      string // Cursor-based pagination\n    Fields      string // Field selection (minimal, summary, custom list)\n    MaxTokens   int    // Token budget for response\n    Aggregate   string // Aggregation fields (agent, workspace, date)\n    Explain     bool   // Include query explanation\n    Highlight   bool   // Highlight matches\n}\n\n// Search performs a full-text search in CASS\nfunc (c *Client) Search(ctx context.Context, query string, opts *SearchOptions) (*SearchResponse, error) {\n    args := []string{\"search\", query, \"--robot\"}\n    \n    if opts != nil {\n        if opts.Agent != \"\" {\n            args = append(args, \"--agent\", opts.Agent)\n        }\n        if opts.Workspace != \"\" {\n            args = append(args, \"--workspace\", opts.Workspace)\n        }\n        if opts.Since != \"\" {\n            args = append(args, \"--since\", opts.Since)\n        }\n        if opts.Until != \"\" {\n            args = append(args, \"--until\", opts.Until)\n        }\n        if opts.Limit \u003e 0 {\n            args = append(args, \"--limit\", fmt.Sprintf(\"%d\", opts.Limit))\n        }\n        if opts.Offset \u003e 0 {\n            args = append(args, \"--offset\", fmt.Sprintf(\"%d\", opts.Offset))\n        }\n        if opts.Cursor != \"\" {\n            args = append(args, \"--cursor\", opts.Cursor)\n        }\n        if opts.Fields != \"\" {\n            args = append(args, \"--fields\", opts.Fields)\n        }\n        if opts.MaxTokens \u003e 0 {\n            args = append(args, \"--max-tokens\", fmt.Sprintf(\"%d\", opts.MaxTokens))\n        }\n        if opts.Aggregate != \"\" {\n            args = append(args, \"--aggregate\", opts.Aggregate)\n        }\n        if opts.Explain {\n            args = append(args, \"--explain\")\n        }\n        if opts.Highlight {\n            args = append(args, \"--highlight\")\n        }\n    }\n    \n    args = append(args, \"--robot-meta\")\n    \n    output, err := c.run(ctx, args...)\n    if err != nil {\n        return nil, err\n    }\n    \n    var resp SearchResponse\n    if err := json.Unmarshal(output, \u0026resp); err != nil {\n        return nil, fmt.Errorf(\"failed to parse search response: %w\", err)\n    }\n    \n    return \u0026resp, nil\n}\n\n// SearchQuick performs a simple search with defaults\nfunc (c *Client) SearchQuick(ctx context.Context, query string) (*SearchResponse, error) {\n    return c.Search(ctx, query, \u0026SearchOptions{\n        Limit:  10,\n        Fields: \"summary\",\n    })\n}\n\n// SearchForContext searches for relevant past context\nfunc (c *Client) SearchForContext(ctx context.Context, query, workspace string) (*SearchResponse, error) {\n    return c.Search(ctx, query, \u0026SearchOptions{\n        Workspace: workspace,\n        Since:     \"30d\",\n        Limit:     5,\n        Fields:    \"summary\",\n    })\n}\n```\n\n## Acceptance Criteria\n- [ ] All search options supported\n- [ ] Proper JSON parsing\n- [ ] Helper methods for common use cases\n- [ ] Context support for cancellation\n- [ ] Error handling for invalid queries","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:33:17.475313-05:00","updated_at":"2025-12-10T03:39:42.216933-05:00","dependencies":[{"issue_id":"ntm-ozcj.1.3","depends_on_id":"ntm-ozcj.1","type":"parent-child","created_at":"2025-12-10T03:33:17.479458-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.1.3","depends_on_id":"ntm-ozcj.1.2","type":"blocks","created_at":"2025-12-10T03:33:17.482444-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.1.4","title":"CASS Client: Implement health.go and status.go","description":"Implement health check and status retrieval for CASS integration.\n\n## Implementation\n\n```go\npackage cass\n\nimport (\n    \"context\"\n    \"encoding/json\"\n)\n\n// Health performs a quick health check (\u003c50ms)\nfunc (c *Client) Health(ctx context.Context) (*StatusResponse, error) {\n    output, err := c.run(ctx, \"health\", \"--json\")\n    if err != nil {\n        return nil, err\n    }\n    \n    var resp StatusResponse\n    if err := json.Unmarshal(output, \u0026resp); err != nil {\n        return nil, err\n    }\n    \n    return \u0026resp, nil\n}\n\n// Status returns full index status\nfunc (c *Client) Status(ctx context.Context) (*StatusResponse, error) {\n    output, err := c.run(ctx, \"status\", \"--json\")\n    if err != nil {\n        return nil, err\n    }\n    \n    var resp StatusResponse\n    if err := json.Unmarshal(output, \u0026resp); err != nil {\n        return nil, err\n    }\n    \n    return \u0026resp, nil\n}\n\n// Capabilities returns CASS feature discovery\nfunc (c *Client) Capabilities(ctx context.Context) (*Capabilities, error) {\n    output, err := c.run(ctx, \"capabilities\", \"--json\")\n    if err != nil {\n        return nil, err\n    }\n    \n    var resp Capabilities\n    if err := json.Unmarshal(output, \u0026resp); err != nil {\n        return nil, err\n    }\n    \n    return \u0026resp, nil\n}\n\n// IsHealthy returns true if CASS is healthy and index is fresh\nfunc (c *Client) IsHealthy(ctx context.Context) bool {\n    status, err := c.Health(ctx)\n    if err != nil {\n        return false\n    }\n    return status.Healthy \u0026\u0026 status.Index.Fresh\n}\n\n// NeedsReindex returns true if index is stale or missing\nfunc (c *Client) NeedsReindex(ctx context.Context) (bool, string) {\n    status, err := c.Status(ctx)\n    if err != nil {\n        return true, \"CASS unavailable\"\n    }\n    if !status.Index.Exists {\n        return true, \"Index not found - run 'cass index --full'\"\n    }\n    if !status.Index.Fresh {\n        return true, fmt.Sprintf(\"Index stale (last updated %s)\", \n            time.Since(time.Unix(status.Index.LastIndexedAt/1000, 0)))\n    }\n    return false, \"\"\n}\n```\n\n## Acceptance Criteria\n- [ ] Health check is fast (\u003c100ms)\n- [ ] Status returns full index info\n- [ ] Capabilities discovery works\n- [ ] Helper methods for common checks\n- [ ] Graceful handling of unavailable CASS","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:33:42.917356-05:00","updated_at":"2025-12-10T03:39:42.289288-05:00","dependencies":[{"issue_id":"ntm-ozcj.1.4","depends_on_id":"ntm-ozcj.1","type":"parent-child","created_at":"2025-12-10T03:33:42.918513-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.1.4","depends_on_id":"ntm-ozcj.1.2","type":"blocks","created_at":"2025-12-10T03:33:42.920212-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.1.5","title":"CASS Client: Implement timeline.go for activity analysis","description":"Implement timeline API for agent activity analysis.\n\n## Implementation\n\n```go\npackage cass\n\nimport (\n    \"context\"\n    \"encoding/json\"\n)\n\n// TimelineOptions configures a timeline query\ntype TimelineOptions struct {\n    Agent    string // Filter by agent\n    Workspace string // Filter by workspace\n    Since    string // Start time\n    Until    string // End time\n    GroupBy  string // hour, day, none\n}\n\n// TimelineBucket represents activity in a time period\ntype TimelineBucket struct {\n    Timestamp int64  `json:\"timestamp\"`\n    Count     int    `json:\"count\"`\n    Agents    map[string]int `json:\"agents,omitempty\"`\n}\n\n// TimelineResponse represents timeline analysis\ntype TimelineResponse struct {\n    Period   string           `json:\"period\"`\n    GroupBy  string           `json:\"group_by\"`\n    Buckets  []TimelineBucket `json:\"buckets\"`\n    Total    int              `json:\"total\"`\n    Meta     *Meta            `json:\"_meta,omitempty\"`\n}\n\n// Timeline returns agent activity over time\nfunc (c *Client) Timeline(ctx context.Context, opts *TimelineOptions) (*TimelineResponse, error) {\n    args := []string{\"timeline\", \"--json\"}\n    \n    if opts != nil {\n        if opts.Agent != \"\" {\n            args = append(args, \"--agent\", opts.Agent)\n        }\n        if opts.Since != \"\" {\n            args = append(args, \"--since\", opts.Since)\n        }\n        if opts.Until != \"\" {\n            args = append(args, \"--until\", opts.Until)\n        }\n        if opts.GroupBy != \"\" {\n            args = append(args, \"--group-by\", opts.GroupBy)\n        }\n    }\n    \n    output, err := c.run(ctx, args...)\n    if err != nil {\n        return nil, err\n    }\n    \n    var resp TimelineResponse\n    if err := json.Unmarshal(output, \u0026resp); err != nil {\n        return nil, err\n    }\n    \n    return \u0026resp, nil\n}\n\n// TimelineToday returns today's activity\nfunc (c *Client) TimelineToday(ctx context.Context) (*TimelineResponse, error) {\n    return c.Timeline(ctx, \u0026TimelineOptions{\n        Since:   \"today\",\n        GroupBy: \"hour\",\n    })\n}\n\n// TimelineWeek returns last week's activity\nfunc (c *Client) TimelineWeek(ctx context.Context) (*TimelineResponse, error) {\n    return c.Timeline(ctx, \u0026TimelineOptions{\n        Since:   \"7d\",\n        GroupBy: \"day\",\n    })\n}\n```\n\n## Acceptance Criteria\n- [ ] Timeline queries work\n- [ ] Grouping by hour/day\n- [ ] Agent filtering\n- [ ] Helper methods for common periods\n- [ ] Used by insights and TUI sparkline","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:34:00.563216-05:00","updated_at":"2025-12-10T03:56:01.045442-05:00","closed_at":"2025-12-10T03:56:01.045442-05:00","dependencies":[{"issue_id":"ntm-ozcj.1.5","depends_on_id":"ntm-ozcj.1","type":"parent-child","created_at":"2025-12-10T03:34:00.564195-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.1.5","depends_on_id":"ntm-ozcj.1.2","type":"blocks","created_at":"2025-12-10T03:34:00.565657-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.1.6","title":"CASS Client: Comprehensive unit tests with mock CASS output","description":"Create comprehensive unit tests for the CASS client package.\n\n## Testing Philosophy\n\n**Tests should be written alongside code, not after.** Each implementation task (types.go, client.go, search.go, health.go, timeline.go) should include its own tests in the same PR.\n\nThis task exists to:\n1. Ensure test infrastructure is ready (mock helpers)\n2. Document testing patterns\n3. Track overall test coverage goal\n\n## Test Infrastructure\n\n### Mock CASS Runner\n```go\n// mockRunner simulates CASS CLI for testing\ntype mockRunner struct {\n    responses map[string][]byte\n    exitCodes map[string]int\n}\n\nfunc newMockRunner() *mockRunner {\n    return \u0026mockRunner{\n        responses: make(map[string][]byte),\n        exitCodes: make(map[string]int),\n    }\n}\n\nfunc (m *mockRunner) SetResponse(args string, response []byte) {\n    m.responses[args] = response\n}\n\nfunc (m *mockRunner) SetError(args string, code int) {\n    m.exitCodes[args] = code\n}\n```\n\n### Sample Response Fixtures\nStore sample CASS responses in testdata/:\n```\ninternal/cass/testdata/\nâ”œâ”€â”€ search_response.json\nâ”œâ”€â”€ status_response.json\nâ”œâ”€â”€ capabilities_response.json\nâ”œâ”€â”€ timeline_response.json\nâ””â”€â”€ error_responses/\n    â”œâ”€â”€ index_missing.json\n    â”œâ”€â”€ timeout.json\n    â””â”€â”€ usage_error.json\n```\n\n## Coverage Goals\n\n| File | Minimum Coverage |\n|------|-----------------|\n| types.go | 90% (marshaling) |\n| client.go | 80% (error paths) |\n| search.go | 85% |\n| health.go | 85% |\n| timeline.go | 85% |\n\n## Test Cases Per File\n\n### types_test.go\n- JSON unmarshaling for all response types\n- Null field handling\n- Empty array handling\n- Helper method tests\n\n### client_test.go\n- IsAvailable() detection\n- Error code mapping\n- Timeout handling\n- Context cancellation\n\n### search_test.go\n- Query building with all options\n- Response parsing\n- Pagination handling\n- Aggregation parsing\n\n### health_test.go\n- Health check parsing\n- Status response parsing\n- Capabilities parsing\n- Helper methods (IsHealthy, NeedsReindex)\n\n### timeline_test.go\n- Timeline response parsing\n- Bucketing logic\n- Filter building\n\n## Acceptance Criteria\n- [ ] Mock infrastructure ready for all tests\n- [ ] Test fixtures created\n- [ ] Each implementation file has corresponding test file\n- [ ] 80%+ overall coverage\n- [ ] Tests run in CI without real CASS","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T03:34:14.843786-05:00","updated_at":"2025-12-10T03:58:57.873824-05:00","closed_at":"2025-12-10T03:58:57.873824-05:00","dependencies":[{"issue_id":"ntm-ozcj.1.6","depends_on_id":"ntm-ozcj.1","type":"parent-child","created_at":"2025-12-10T03:34:14.84465-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.1.7","title":"CASS Graceful Degradation: Ensure NTM works perfectly without CASS","description":"Ensure NTM works perfectly when CASS is not installed or unavailable.\n\n## Overview\nThis is critical for user experience. Most users won't have CASS installed initially, so NTM must:\n1. Work normally without CASS\n2. Show helpful guidance when CASS features are requested\n3. Never block or error on missing CASS\n\n## Implementation\n\n### Detection\n```go\n// Check once at startup, cache result\nvar cassAvailable = sync.OnceValue(func() bool {\n    _, err := exec.LookPath(\"cass\")\n    return err == nil\n})\n\nfunc IsCASSAvailable() bool {\n    return cassAvailable()\n}\n```\n\n### Skip CASS Features\n```go\nfunc (c *Client) Search(ctx context.Context, query string, opts *SearchOptions) (*SearchResponse, error) {\n    if \\!IsCASSAvailable() {\n        return nil, ErrNotInstalled\n    }\n    // ... rest of search\n}\n```\n\n### User-Facing Messages\nWhen CASS features are requested without CASS:\n```\nCASS is not installed. To enable cross-agent session search:\n\n  brew install cass    # macOS\n  cargo install cass   # From source\n\nThen index your sessions:\n  cass index --full\n\nLearn more: https://github.com/...\n```\n\n### Configuration\n```toml\n[cass]\nenabled = true           # Can disable even if installed\nshow_install_hints = true  # Show installation guidance\n```\n\n### Feature Behavior Without CASS\n\n| Feature | Behavior Without CASS |\n|---------|----------------------|\n| ntm cass * | Shows install guidance |\n| --robot-cass-* | Returns {\"cass_available\": false, \"hint\": \"...\"} |\n| Context injection | Skipped silently |\n| Duplicate detection | Skipped silently |\n| TUI widgets | Hidden or show \"CASS not installed\" |\n| Status bar | No CASS indicator |\n\n## Acceptance Criteria\n- [ ] NTM launches normally without CASS\n- [ ] No errors/panics when CASS missing\n- [ ] Helpful install guidance shown\n- [ ] Can disable CASS in config\n- [ ] Robot mode returns structured \"unavailable\" response\n- [ ] TUI gracefully degrades","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:35:51.476746-05:00","updated_at":"2025-12-10T03:39:42.358258-05:00","dependencies":[{"issue_id":"ntm-ozcj.1.7","depends_on_id":"ntm-ozcj.1","type":"parent-child","created_at":"2025-12-10T03:35:51.478784-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.2","title":"CASS CLI: Add ntm cass subcommand with search, status, insights","description":"Add ntm cass subcommand family for CASS interaction.\n\n## Commands\n\n### ntm cass status\nShow CASS index health and statistics.\n```\nCASS Index Status\n  Healthy:        âœ“\n  Conversations:  1,250\n  Messages:       45,000\n  Last Indexed:   5 minutes ago\n  \nAgent Coverage:\n  claude_code:    523 sessions\n  codex:          312 sessions\n  gemini:         189 sessions\n  cursor:         156 sessions\n  chatgpt:        70 sessions\n```\n\n### ntm cass search \u003cquery\u003e\nSearch past sessions with optional filters.\n```\nntm cass search \"authentication error\"\nntm cass search \"auth*\" --agent claude --since 7d\nntm cass search --workspace /path/to/project\n```\n\nFlags:\n- --agent \u003cslug\u003e: Filter by agent type\n- --workspace \u003cpath\u003e: Filter by project\n- --since \u003cdate\u003e: Time filter (7d, 2w, 2025-01-01)\n- --limit \u003cn\u003e: Max results (default 10)\n- --json: JSON output\n\n### ntm cass insights\nShow AI-powered insights on agent activity.\n```\nntm cass insights\nntm cass insights --today\nntm cass insights --week\n```\n\nUses CASS aggregations to show:\n- Most active agents\n- Common topics\n- Error patterns\n- Workspace activity\n\n### ntm cass timeline\nShow agent activity over time.\n```\nntm cass timeline --today --group-by hour\nntm cass timeline --week --group-by day\n```\n\n## Implementation\n- Add cass.go to internal/cli\n- Register as subcommand of root\n- Use internal/cass client package\n- Support --json for all subcommands\n\n## Acceptance Criteria\n- [ ] ntm cass status shows index health\n- [ ] ntm cass search returns relevant results\n- [ ] ntm cass insights shows aggregated data\n- [ ] ntm cass timeline shows activity over time\n- [ ] All commands have --json support\n- [ ] Help text is comprehensive","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T03:30:10.90041-05:00","updated_at":"2025-12-10T03:39:41.758605-05:00","dependencies":[{"issue_id":"ntm-ozcj.2","depends_on_id":"ntm-ozcj","type":"parent-child","created_at":"2025-12-10T03:30:10.900825-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.2","depends_on_id":"ntm-ozcj.1","type":"blocks","created_at":"2025-12-10T03:30:10.902054-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.3","title":"CASS Robot Mode: Add --robot-cass-* flags for AI agent consumption","description":"Add robot mode flags for CASS integration, enabling AI agents to consume CASS data in structured JSON format.\n\n## Flags\n\n### --robot-cass-status\nReturns CASS health in JSON format:\n```json\n{\n  \"cass_available\": true,\n  \"healthy\": true,\n  \"index\": {\n    \"exists\": true,\n    \"fresh\": true,\n    \"last_indexed_at\": 1702569600000,\n    \"conversations\": 1250,\n    \"messages\": 45000\n  },\n  \"agents\": {\n    \"claude_code\": 523,\n    \"codex\": 312,\n    \"gemini\": 189\n  }\n}\n```\n\n### --robot-cass-search \u003cquery\u003e\nReturns search results in JSON:\n```json\n{\n  \"query\": \"authentication error\",\n  \"count\": 5,\n  \"total_matches\": 142,\n  \"hits\": [\n    {\n      \"source_path\": \"/path/to/session.jsonl\",\n      \"agent\": \"claude_code\",\n      \"title\": \"Debug auth flow\",\n      \"score\": 8.75,\n      \"snippet\": \"...authentication error in OAuth...\",\n      \"created_at\": 1702569600000\n    }\n  ]\n}\n```\n\nAdditional flags:\n- --cass-agent \u003cslug\u003e: Filter by agent\n- --cass-workspace \u003cpath\u003e: Filter by workspace\n- --cass-since \u003cdate\u003e: Time filter\n- --cass-limit \u003cn\u003e: Max results\n\n### --robot-cass-insights\nReturns aggregated insights:\n```json\n{\n  \"period\": \"today\",\n  \"agents\": {\n    \"buckets\": [\n      {\"key\": \"claude_code\", \"count\": 45},\n      {\"key\": \"codex\", \"count\": 23}\n    ]\n  },\n  \"topics\": [\n    {\"term\": \"authentication\", \"count\": 12},\n    {\"term\": \"database\", \"count\": 8}\n  ],\n  \"errors\": [\n    {\"type\": \"rate_limit\", \"count\": 3}\n  ]\n}\n```\n\n### --robot-cass-context \u003cquery\u003e\nReturns relevant past context for spawning agents:\n```json\n{\n  \"query\": \"implement user auth\",\n  \"relevant_sessions\": [\n    {\n      \"summary\": \"Previous auth implementation in this project\",\n      \"key_points\": [\"Used OAuth2\", \"JWT tokens\", \"Redis sessions\"],\n      \"source\": \"/path/to/session.jsonl\",\n      \"agent\": \"claude_code\",\n      \"when\": \"3 days ago\"\n    }\n  ],\n  \"suggested_context\": \"When implementing auth, consider: OAuth2 flow from session X, JWT patterns from session Y\"\n}\n```\n\n## Implementation\n- Add flags to root.go\n- Add handlers in robot.go\n- Use internal/cass client\n- Error handling with proper exit codes\n\n## Acceptance Criteria\n- [ ] All flags produce valid JSON\n- [ ] Errors are structured JSON\n- [ ] Graceful degradation if CASS unavailable\n- [ ] Response includes _meta block\n- [ ] Works with other robot flags","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T03:30:35.028307-05:00","updated_at":"2025-12-10T03:39:41.839072-05:00","dependencies":[{"issue_id":"ntm-ozcj.3","depends_on_id":"ntm-ozcj","type":"parent-child","created_at":"2025-12-10T03:30:35.0289-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.3","depends_on_id":"ntm-ozcj.1","type":"blocks","created_at":"2025-12-10T03:30:35.030016-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.4","title":"CASS TUI Integration: Search widget and activity timeline in dashboard","description":"Integrate CASS into the NTM TUI dashboard for interactive exploration of past sessions.\n\n## Widgets\n\n### CASS Search Palette\nAdd keyboard shortcut (Ctrl+S) to open CASS search palette:\n- Live search-as-you-type\n- Results show agent icon, title, timestamp\n- Enter to view details in pane\n- Tab to filter by agent\n\n### Activity Sparkline\nAdd agent activity sparkline to status bar:\n```\nğŸ“Š [â–â–‚â–ƒâ–…â–†â–‡â–ˆâ–†â–„â–‚â–] 24h activity | 45 sessions today\n```\n\n### Past Conversation Browser\nAdd panel (toggle with F9) showing:\n- Recent sessions across all agents\n- Filter by agent, workspace\n- Click to expand conversation\n- Link to open in CASS TUI\n\n### CASS Status Indicator\nIn status bar, show CASS health:\n- ğŸ” CASS: âœ“ (healthy, fresh index)\n- ğŸ” CASS: âš  (stale index)\n- ğŸ” CASS: âœ— (not available)\n\n## Implementation\n- Add cass widget to internal/tui/components\n- Integrate with existing dashboard model\n- Use async loading to avoid blocking\n- Cache results for performance\n\n## Acceptance Criteria\n- [ ] Search palette opens with Ctrl+S\n- [ ] Activity sparkline updates live\n- [ ] Conversation browser shows recent sessions\n- [ ] Status indicator in status bar\n- [ ] Smooth transitions, no flicker\n- [ ] Works without CASS (graceful degradation)","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-10T03:30:54.05798-05:00","updated_at":"2025-12-10T03:30:54.05798-05:00","dependencies":[{"issue_id":"ntm-ozcj.4","depends_on_id":"ntm-ozcj","type":"parent-child","created_at":"2025-12-10T03:30:54.058486-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.4","depends_on_id":"ntm-ozcj.1","type":"blocks","created_at":"2025-12-10T03:30:54.060262-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.4","depends_on_id":"ntm-ozcj.2","type":"blocks","created_at":"2025-12-10T03:30:54.061408-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.5","title":"CASS Context Injection: Provide relevant past context when spawning agents","description":"Automatically inject relevant past context when spawning new agents, reducing duplicate problem-solving.\n\n## Overview\nWhen `ntm spawn` or `ntm add` creates a new agent pane, query CASS for relevant past sessions based on:\n- Current project/workspace\n- Prompt content (if provided)\n- Recent activity in the session\n\n## Implementation\n\n### Spawn with Context\n```bash\n# Auto-context mode (default when CASS available)\nntm spawn myproject --cc=2 --prompt=\"implement OAuth\"\n# CASS query: workspace:/path/to/myproject AND \"OAuth\"\n# Injects: \"Previous OAuth work in this project: [summary]\"\n\n# Explicit context query\nntm spawn myproject --cc=1 --cass-context=\"authentication patterns\"\n# Injects relevant past sessions about auth\n\n# Disable context\nntm spawn myproject --cc=1 --no-cass-context\n```\n\n### Context Injection Format\n```\n## Relevant Past Sessions\n\nThis project has prior work on similar topics:\n\n1. **OAuth Implementation** (3 days ago, claude_code)\n   - Used passport.js with OAuth2 strategy\n   - JWT tokens stored in Redis\n   - Key file: src/auth/oauth.ts\n   \n2. **Session Management** (1 week ago, codex)\n   - Express sessions with Redis store\n   - CORS configuration for cookies\n   \nConsider reviewing these before re-implementing.\n```\n\n### Flags\n- --cass-context \u003cquery\u003e: Explicit context query\n- --no-cass-context: Disable auto-context\n- --cass-context-limit \u003cn\u003e: Max sessions to include (default 3)\n- --cass-context-days \u003cn\u003e: Look back N days (default 30)\n\n### Robot Mode\n```bash\nntm --robot-spawn-context myproject --prompt=\"implement OAuth\"\n# Returns JSON with suggested context\n{\n  \"workspace\": \"/path/to/myproject\",\n  \"prompt\": \"implement OAuth\",\n  \"relevant_sessions\": [...],\n  \"suggested_injection\": \"...\"\n}\n```\n\n## Acceptance Criteria\n- [ ] Spawn queries CASS for relevant context\n- [ ] Context injected into agent prompt\n- [ ] Can disable with --no-cass-context\n- [ ] Works with spawn, add, send commands\n- [ ] Graceful when CASS unavailable\n- [ ] Robot mode returns context JSON","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T03:31:17.45423-05:00","updated_at":"2025-12-10T03:39:41.922912-05:00","dependencies":[{"issue_id":"ntm-ozcj.5","depends_on_id":"ntm-ozcj","type":"parent-child","created_at":"2025-12-10T03:31:17.455375-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.5","depends_on_id":"ntm-ozcj.1","type":"blocks","created_at":"2025-12-10T03:31:17.457942-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.5","depends_on_id":"ntm-ozcj.3","type":"blocks","created_at":"2025-12-10T03:31:17.458831-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.6","title":"CASS Duplicate Detection: Warn before solving already-solved problems","description":"Detect and warn when an agent is about to work on something that was already solved in a past session.\n\n## Overview\nWhen sending prompts to agents, check CASS for similar past work and optionally:\n- Show warning to user\n- Inject \"check this first\" context to agent\n- Link to past session for reference\n\n## Implementation\n\n### Send with Duplicate Check\n```bash\nntm send myproject --all \"fix the authentication bug\"\n# CASS check: \"fix authentication bug\" in recent sessions\n# If found:\nâš  Similar work found in past sessions:\n  1. \"Debug auth flow\" (2 days ago, claude_code)\n     Preview: Fixed JWT validation issue in middleware\n     \n  Continue anyway? [y/N/view]\n  - y: Send as-is\n  - N: Cancel\n  - view: Open past session in \n```\n\n### Flags\n- --cass-check: Force duplicate check (default: on)\n- --no-cass-check: Skip duplicate check\n- --cass-similarity \u003cn\u003e: Similarity threshold (0-100, default 70)\n- --cass-check-days \u003cn\u003e: Look back N days (default 7)\n\n### Robot Mode\n```bash\nntm --robot-check-duplicates myproject --msg=\"fix auth bug\"\n{\n  \"query\": \"fix auth bug\",\n  \"duplicates_found\": true,\n  \"similar_sessions\": [\n    {\n      \"source_path\": \"/path/to/session.jsonl\",\n      \"title\": \"Debug auth flow\",\n      \"similarity\": 0.85,\n      \"agent\": \"claude_code\",\n      \"when\": \"2 days ago\",\n      \"preview\": \"Fixed JWT validation...\"\n    }\n  ],\n  \"recommendation\": \"review_before_proceeding\"\n}\n```\n\n### Integration Points\n- ntm send: Check before broadcasting\n- ntm prompt (if added): Check before sending\n- TUI: Show warning in palette before confirming send\n\n## Acceptance Criteria\n- [ ] Duplicate check on send command\n- [ ] User can view, skip, or proceed\n- [ ] Configurable similarity threshold\n- [ ] Robot mode returns check results\n- [ ] Works in TUI palette\n- [ ] Fast (\u003c200ms) check time","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T03:31:37.267835-05:00","updated_at":"2025-12-10T03:39:41.995486-05:00","dependencies":[{"issue_id":"ntm-ozcj.6","depends_on_id":"ntm-ozcj","type":"parent-child","created_at":"2025-12-10T03:31:37.269444-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.6","depends_on_id":"ntm-ozcj.1","type":"blocks","created_at":"2025-12-10T03:31:37.270998-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.7","title":"CASS + MCP Agent Mail: Cross-agent knowledge sharing","description":"Integrate CASS with MCP Agent Mail for intelligent cross-agent coordination.\n\n## Overview\nEnable agents to check CASS before starting work and share findings via Agent Mail, creating a knowledge-sharing loop.\n\n## Use Cases\n\n### Before Starting Work\nWhen agent claims a task:\n1. Query CASS for similar past work\n2. If found, include in agent context\n3. Agent can decide to reuse vs. re-implement\n\n### After Completing Work\nWhen agent finishes:\n1. New session auto-indexed by CASS\n2. Summary posted to Agent Mail thread\n3. Other agents can reference it\n\n### Cross-Project Knowledge\nWhen working on similar problems across projects:\n1. Query CASS without workspace filter\n2. Find solutions from other projects\n3. Adapt patterns (not copy code)\n\n## Implementation\n\n### Agent Mail Integration\n```go\n// Before claiming task\nfunc (c *Coordinator) CheckCASSBeforeWork(task string) (*CASSContext, error) {\n    results, err := c.cass.Search(task, \u0026SearchOptions{\n        Limit: 5,\n        Since: \"30d\",\n    })\n    if err != nil {\n        return nil, err\n    }\n    \n    if len(results.Hits) \u003e 0 {\n        return \u0026CASSContext{\n            RelevantSessions: results.Hits,\n            Suggestion: \"Review these before re-implementing\",\n        }, nil\n    }\n    return nil, nil\n}\n\n// After completing work\nfunc (c *Coordinator) NotifyCompletionWithCASSRef(taskID, sessionPath string) error {\n    // Post to Agent Mail with CASS reference\n    return c.mail.SendMessage(Message{\n        Subject: fmt.Sprintf(\"Completed: %s\", taskID),\n        Body: fmt.Sprintf(\"Work completed. Session indexed in CASS: %s\", sessionPath),\n        ThreadID: taskID,\n    })\n}\n```\n\n### Workflow Example\n```\n1. Agent claims beads task \"implement rate limiting\"\n2. NTM queries CASS: \"rate limiting\" in last 30 days\n3. Found: Session from 2 weeks ago implementing rate limiting\n4. Agent receives context: \"Past implementation used token bucket...\"\n5. Agent adapts pattern, completes faster\n6. Posts to Agent Mail: \"Completed. Improved on past approach.\"\n7. New session indexed, available for future agents\n```\n\n## Acceptance Criteria\n- [ ] Agents receive CASS context when claiming tasks\n- [ ] Completed work notified via Agent Mail\n- [ ] Cross-project search works\n- [ ] Integration with beads workflow\n- [ ] Configurable via config file","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-10T03:31:59.271289-05:00","updated_at":"2025-12-10T03:31:59.271289-05:00","dependencies":[{"issue_id":"ntm-ozcj.7","depends_on_id":"ntm-ozcj","type":"parent-child","created_at":"2025-12-10T03:31:59.272709-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.7","depends_on_id":"ntm-ozcj.1","type":"blocks","created_at":"2025-12-10T03:31:59.273997-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.7","depends_on_id":"ntm-vum","type":"blocks","created_at":"2025-12-10T03:31:59.275255-05:00","created_by":"daemon"}]}
{"id":"ntm-ozcj.8","title":"CASS Configuration: Add config options for CASS integration","description":"Add configuration options for CASS integration.\n\n## Config Schema\n\nAdd to ~/.config/ntm/config.toml:\n\n```toml\n[cass]\n# Master switch - disable all CASS features\nenabled = true\n\n# Show installation hints when CASS not found\nshow_install_hints = true\n\n# Path to cass binary (auto-detect from PATH if not set)\nbinary_path = \"\"\n\n# Timeout for CASS operations (seconds)\ntimeout = 30\n\n# Context injection settings\n[cass.context]\nenabled = true          # Auto-inject context when spawning\nmax_sessions = 3        # Max past sessions to include\nlookback_days = 30      # How far back to search\nmax_tokens = 2000       # Token budget for context\n\n# Duplicate detection settings\n[cass.duplicates]\nenabled = true          # Check for duplicates before sending\nsimilarity_threshold = 0.7  # 0-1, higher = stricter\nlookback_days = 7       # How far back to check\nprompt_on_match = true  # Ask user before proceeding\n\n# Search defaults\n[cass.search]\ndefault_limit = 10\ndefault_fields = \"summary\"\ninclude_meta = true\n\n# TUI settings\n[cass.tui]\nshow_activity_sparkline = true\nshow_status_indicator = true\n```\n\n## Implementation\n\n### Config Structure\n```go\ntype CASSConfig struct {\n    Enabled          bool   `toml:\"enabled\"`\n    ShowInstallHints bool   `toml:\"show_install_hints\"`\n    BinaryPath       string `toml:\"binary_path\"`\n    Timeout          int    `toml:\"timeout\"`\n    \n    Context    CASSContextConfig    `toml:\"context\"`\n    Duplicates CASSDuplicateConfig  `toml:\"duplicates\"`\n    Search     CASSSearchConfig     `toml:\"search\"`\n    TUI        CASSTUIConfig        `toml:\"tui\"`\n}\n```\n\n### Defaults\nAll features enabled by default for good out-of-box experience.\nUsers can disable individual features as needed.\n\n### Environment Variables\n```bash\nNTM_CASS_ENABLED=false       # Override config\nNTM_CASS_TIMEOUT=60          # Override timeout\nNTM_CASS_BINARY=/path/to/cass  # Override binary path\n```\n\n## Acceptance Criteria\n- [ ] Config schema defined\n- [ ] Defaults are user-friendly\n- [ ] Environment variable overrides work\n- [ ] Config validation on load\n- [ ] Changes take effect without restart (where possible)\n- [ ] ntm config show includes CASS section","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-10T03:36:22.932371-05:00","updated_at":"2025-12-10T09:23:41.583495-05:00","dependencies":[{"issue_id":"ntm-ozcj.8","depends_on_id":"ntm-ozcj","type":"parent-child","created_at":"2025-12-10T03:36:22.933068-05:00","created_by":"daemon"},{"issue_id":"ntm-ozcj.8","depends_on_id":"ntm-ozcj.1","type":"blocks","created_at":"2025-12-10T03:36:22.935128-05:00","created_by":"daemon"}]}
{"id":"ntm-p77j","title":"Create internal/scanner package for UBS integration","description":"","status":"closed","priority":0,"issue_type":"task","assignee":"ChartreuseLake","created_at":"2025-12-10T03:29:25.383916-05:00","updated_at":"2025-12-10T03:45:49.298647-05:00","closed_at":"2025-12-10T03:45:49.298647-05:00"}
{"id":"ntm-pb3","title":"Implement --robot-interrupt for priority course correction","description":"Interrupt an agent with high-priority instruction.\n\n## Rationale\nSometimes I need to redirect an agent urgently - stop what you're doing, do this instead. Regular send just queues; interrupt needs to actually break the agent's current flow.\n\n## Usage\n```bash\nntm --robot-interrupt myproject --pane=0.1 --msg=\"STOP: critical bug found, fix X first\"\nntm --robot-interrupt myproject --all --msg=\"Halt all work, sync for team discussion\"\n```\n\n## Output Structure\n```json\n{\n  \"session\": \"myproject\",\n  \"interrupted\": [\"0.1\"],\n  \"method\": \"ctrl_c_then_send\",\n  \"previous_states\": {\n    \"0.1\": {\"state\": \"active\", \"last_output\": \"...\"}\n  },\n  \"message_sent\": true,\n  \"ready_for_input\": true\n}\n```\n\n## Interrupt Methods\n1. Send Ctrl+C to break current operation\n2. Wait for prompt/ready state\n3. Send the interrupt message\n\n## Options\n- --force: Send Ctrl+C even if agent appears idle\n- --no-wait: Don't wait for ready state\n- --preserve-context: Try to save agent's context before interrupting\n\n## Safety Considerations\n- Log interrupted state for potential resume\n- Avoid interrupting mid-file-write\n- Rate limit to prevent interrupt storms","status":"closed","priority":1,"issue_type":"task","assignee":"BlueBear","created_at":"2025-12-10T02:52:24.290441-05:00","updated_at":"2025-12-10T09:18:58.646914-05:00","closed_at":"2025-12-10T09:18:58.646914-05:00"}
{"id":"ntm-peo","title":"Feature: Smart Agent Work Distribution via bv Tracks","description":"","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-10T03:26:14.311803-05:00","updated_at":"2025-12-10T03:32:24.566889-05:00","closed_at":"2025-12-10T03:32:24.566889-05:00","dependencies":[{"issue_id":"ntm-peo","depends_on_id":"ntm-mxa","type":"blocks","created_at":"2025-12-10T03:26:28.44355-05:00","created_by":"daemon"}]}
{"id":"ntm-plr","title":"Implement custom agent definitions via plugin files","description":"Allow users to define custom agent types in config files.\n\n## What This Task Does\n\nEnable users to add new agent types without modifying NTM code.\nAgent definitions are TOML files in ~/.config/ntm/agents/.\n\n## Plugin Location\n\n~/.config/ntm/agents/\nâ”œâ”€â”€ cursor.toml\nâ”œâ”€â”€ aider.toml\nâ””â”€â”€ local-llm.toml\n\n## File Format\n\n# ~/.config/ntm/agents/cursor.toml\n[agent]\nname = \"cursor\"           # Used in --cursor=N flag\nalias = \"cur\"             # Short form\ncommand = \"cursor --headless --ai-mode\"\ndescription = \"Cursor AI editor in headless mode\"\n\n[agent.env]\nCURSOR_HEADLESS = \"1\"\n\n[agent.defaults]\ntags = [\"cursor\", \"editor\"]\n\n## Loading Plugins\n\nOn startup:\n1. Scan ~/.config/ntm/agents/*.toml\n2. Parse each file into AgentPlugin struct\n3. Register with spawn/add commands\n4. Generate aliases for shell integration\n\ntype AgentPlugin struct {\n    Name        string\n    Alias       string\n    Command     string\n    Description string\n    Env         map[string]string\n    DefaultTags []string\n}\n\n## Integration with spawn\n\n$ ntm spawn myproject --cursor=2\n# Spawns 2 panes running: cursor --headless --ai-mode\n\n$ ntm spawn myproject --cur=1\n# Same, using alias\n\n## Shell Integration\n\n'ntm init zsh' generates aliases for plugins:\nalias cur='cursor --headless --ai-mode'\n\n## Discovery\n\n$ ntm plugins list\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Name    â”‚ Alias â”‚ Description                     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ cursor  â”‚ cur   â”‚ Cursor AI editor in headless... â”‚\nâ”‚ aider   â”‚ aid   â”‚ Aider coding assistant          â”‚\nâ”‚ local   â”‚ loc   â”‚ Local Ollama LLM                â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n## Acceptance Criteria\n\n- [ ] Agent TOML files parsed correctly\n- [ ] Custom agents work with spawn\n- [ ] Custom agents work with add\n- [ ] Aliases generated in shell init\n- [ ] ntm plugins list shows custom agents\n- [ ] Environment variables applied\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:49:44.529363-05:00","updated_at":"2025-12-10T02:49:44.529363-05:00","dependencies":[{"issue_id":"ntm-plr","depends_on_id":"ntm-c2b","type":"blocks","created_at":"2025-12-10T02:49:44.530586-05:00","created_by":"daemon"}]}
{"id":"ntm-pp5","title":"EPIC: Prompt Management \u0026 History","description":"Track, replay, and template prompts for reproducibility and efficiency.\n\n## Problem Statement\nEvery prompt sent via `ntm send` vanishes into the void:\n- No record of what was sent, when, or to which agents\n- Can't replay a successful prompt without retyping it\n- No way to build a library of reusable prompts with variables\n- Hard to reproduce multi-agent workflows across projects\n\n## Goals\n1. Log all prompts with full metadata (timestamp, session, targets, content)\n2. Enable replay of previous prompts with optional modifications\n3. Support named templates with variable substitution\n4. Enable prompt sharing and reuse across projects\n\n## Success Criteria\n- `ntm history` shows chronological prompt log with filtering\n- `ntm replay \u003cid\u003e` re-sends any historical prompt\n- `ntm send --template=name` uses named template with variables\n- Templates support {{file}}, {{selection}}, custom variables\n\n## Technical Approach\n- Store history in ~/.local/share/ntm/history.jsonl (append-only)\n- Templates stored in ~/.config/ntm/templates/*.md\n- Template syntax: {{variable}} with built-in and custom variables\n- File content injection via --file flag\n\n## Design Decisions\n- JSONL for history (append-only, greppable, no DB needed)\n- Markdown for templates (human-readable, easy to edit)\n- Variable syntax matches common templating (Mustache-like)\n- History is local-only (no sync) but exportable\n\n## User Value\n- Reproducible workflows for consistent results\n- Faster iteration by replaying successful prompts\n- Team knowledge sharing via template libraries\n- Reduced typing for common operations","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T02:36:42.844416-05:00","updated_at":"2025-12-10T02:36:42.844416-05:00"}
{"id":"ntm-pp5.1","title":"Prompt History Logging","description":"Log all prompts sent via `ntm send` with full metadata.\n\n## Overview\nEvery prompt sent through NTM should be recorded for later reference, replay, and analysis.\n\n## Data Model\n```go\ntype HistoryEntry struct {\n    ID        string    `json:\"id\"`        // Unique ID (ulid or uuid)\n    Timestamp time.Time `json:\"ts\"`        // When sent\n    Session   string    `json:\"session\"`   // Session name\n    Targets   []string  `json:\"targets\"`   // Pane names sent to\n    Prompt    string    `json:\"prompt\"`    // Full prompt text\n    Source    string    `json:\"source\"`    // \"cli\", \"palette\", \"replay\"\n    Template  string    `json:\"template\"`  // Template name if used\n    Success   bool      `json:\"success\"`   // Whether send succeeded\n    Error     string    `json:\"error\"`     // Error message if failed\n}\n```\n\n## Storage\nLocation: ~/.local/share/ntm/history.jsonl\n\nFormat: JSON Lines (one JSON object per line)\n- Append-only for simplicity\n- Greppable with standard tools\n- Easy to backup/sync\n\n```jsonl\n{\"id\":\"01HXYZ...\",\"ts\":\"2025-12-10T10:30:00Z\",\"session\":\"myproject\",\"targets\":[\"cc_1\",\"cc_2\"],\"prompt\":\"implement auth\",\"source\":\"cli\",\"success\":true}\n{\"id\":\"01HXYZ...\",\"ts\":\"2025-12-10T10:31:00Z\",\"session\":\"myproject\",\"targets\":[\"cod_1\"],\"prompt\":\"run tests\",\"source\":\"palette\",\"template\":\"run_tests\",\"success\":true}\n```\n\n## Integration Points\n\n### ntm send\n```go\nfunc runSend(cmd *cobra.Command, args []string) error {\n    // ... existing send logic ...\n    \n    entry := history.Entry{\n        ID:        ulid.New(),\n        Timestamp: time.Now(),\n        Session:   sessionName,\n        Targets:   targetPanes,\n        Prompt:    promptText,\n        Source:    \"cli\",\n    }\n    \n    err := sendToPane(pane, promptText)\n    entry.Success = err == nil\n    if err \\!= nil {\n        entry.Error = err.Error()\n    }\n    \n    history.Append(entry)\n    return err\n}\n```\n\n### Palette Send\nSame pattern - log after send with source=\"palette\"\n\n## Rotation/Cleanup\n- Default: keep last 10,000 entries\n- `ntm history prune --keep=N` to manually clean\n- Or: rotate files monthly (history-2025-12.jsonl)\n\n## Privacy Considerations\n- Prompts may contain sensitive data\n- History is local-only (not synced)\n- `ntm history clear` to wipe all history\n- Consider: --no-history flag on send for sensitive prompts\n\n## Files to Create\n- internal/history/storage.go - JSONL append/read\n- internal/history/entry.go - Data model\n- internal/history/prune.go - Cleanup logic","status":"closed","priority":1,"issue_type":"feature","assignee":"GreenCastle","created_at":"2025-12-10T02:40:13.244444-05:00","updated_at":"2025-12-10T04:28:53.78993-05:00","closed_at":"2025-12-10T04:28:53.78993-05:00","dependencies":[{"issue_id":"ntm-pp5.1","depends_on_id":"ntm-pp5","type":"parent-child","created_at":"2025-12-10T02:40:13.246293-05:00","created_by":"daemon"}]}
{"id":"ntm-pp5.1.1","title":"Create internal/history package with JSONL storage","description":"Implement the history storage layer using JSONL format.\n\n## Package Structure\n```\ninternal/history/\nâ”œâ”€â”€ entry.go      # HistoryEntry struct\nâ”œâ”€â”€ storage.go    # File I/O operations\nâ””â”€â”€ query.go      # Search/filter functions\n```\n\n## HistoryEntry Type\n```go\n// internal/history/entry.go\npackage history\n\nimport \"time\"\n\ntype HistoryEntry struct {\n    ID        string    `json:\"id\"`\n    Timestamp time.Time `json:\"ts\"`\n    Session   string    `json:\"session\"`\n    Targets   []string  `json:\"targets\"`\n    Prompt    string    `json:\"prompt\"`\n    Source    string    `json:\"source\"`    // cli, palette, replay\n    Template  string    `json:\"template,omitempty\"`\n    Success   bool      `json:\"success\"`\n    Error     string    `json:\"error,omitempty\"`\n}\n```\n\n## Storage Functions\n```go\n// internal/history/storage.go\npackage history\n\nimport (\n    \"encoding/json\"\n    \"os\"\n    \"path/filepath\"\n)\n\nconst historyFile = \"history.jsonl\"\n\n// StoragePath returns ~/.local/share/ntm/history.jsonl\nfunc StoragePath() string {\n    dataDir := os.Getenv(\"XDG_DATA_HOME\")\n    if dataDir == \"\" {\n        home, _ := os.UserHomeDir()\n        dataDir = filepath.Join(home, \".local\", \"share\")\n    }\n    return filepath.Join(dataDir, \"ntm\", historyFile)\n}\n\n// Append adds an entry to history\nfunc Append(entry HistoryEntry) error {\n    path := StoragePath()\n    \n    // Ensure directory exists\n    if err := os.MkdirAll(filepath.Dir(path), 0755); err \\!= nil {\n        return err\n    }\n    \n    f, err := os.OpenFile(path, os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)\n    if err \\!= nil {\n        return err\n    }\n    defer f.Close()\n    \n    data, err := json.Marshal(entry)\n    if err \\!= nil {\n        return err\n    }\n    \n    _, err = f.Write(append(data, '\\n'))\n    return err\n}\n\n// ReadAll reads all history entries\nfunc ReadAll() ([]HistoryEntry, error) {\n    // Read file line by line, parse JSON\n}\n\n// ReadRecent reads last N entries (efficient: read from end)\nfunc ReadRecent(n int) ([]HistoryEntry, error) {\n    // Use tail-like reading for efficiency\n}\n```\n\n## ID Generation\nUse ULID for sortable, unique IDs:\n```go\nimport \"github.com/oklog/ulid/v2\"\n\nfunc NewID() string {\n    return ulid.Make().String()\n}\n```\n\n## Acceptance Criteria\n- [ ] Append is atomic (no partial writes)\n- [ ] ReadRecent is efficient (doesn't read entire file)\n- [ ] Handles missing file gracefully\n- [ ] Creates directory if needed\n- [ ] JSON is valid per line","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:47:12.096526-05:00","updated_at":"2025-12-10T04:20:15.543518-05:00","closed_at":"2025-12-10T04:20:15.543518-05:00","dependencies":[{"issue_id":"ntm-pp5.1.1","depends_on_id":"ntm-pp5.1","type":"parent-child","created_at":"2025-12-10T02:47:12.09686-05:00","created_by":"daemon"}]}
{"id":"ntm-pp5.1.2","title":"Integrate history logging into ntm send command","description":"Modify the send command to log all prompts to history.\n\n## Current State\ninternal/cli/send.go sends prompts but doesn't log them.\n\n## Changes Required\n\n### Import history package\n```go\nimport \"github.com/Dicklesworthstone/ntm/internal/history\"\n```\n\n### Log after sending\n```go\nfunc runSend(cmd *cobra.Command, args []string) error {\n    // ... existing setup ...\n    \n    // Prepare history entry\n    entry := history.HistoryEntry{\n        ID:        history.NewID(),\n        Timestamp: time.Now(),\n        Session:   sessionName,\n        Prompt:    prompt,\n        Source:    \"cli\",\n    }\n    \n    // Collect targets as we send\n    var targets []string\n    var sendErr error\n    \n    for _, pane := range selectedPanes {\n        targets = append(targets, pane.Title)\n        if err := sendToPane(pane, prompt); err \\!= nil {\n            sendErr = err\n            // Don't break - continue to other panes\n        }\n    }\n    \n    // Complete entry\n    entry.Targets = targets\n    entry.Success = sendErr == nil\n    if sendErr \\!= nil {\n        entry.Error = sendErr.Error()\n    }\n    \n    // Log to history (ignore errors - don't fail send for history)\n    if err := history.Append(entry); err \\!= nil {\n        // Log warning but don't fail\n        fmt.Fprintf(os.Stderr, \"Warning: failed to log to history: %v\\n\", err)\n    }\n    \n    return sendErr\n}\n```\n\n### Add --no-history flag\n```go\ncmd.Flags().Bool(\"no-history\", false, \"Don't log this prompt to history\")\n```\n\n### Template Integration\nIf using --template, record template name:\n```go\nif templateName \\!= \"\" {\n    entry.Template = templateName\n}\n```\n\n## Also Update Palette Send\ninternal/palette/model.go or wherever palette sends prompts:\n- Same pattern: create entry, send, log\n- Source = \"palette\"\n\n## Testing\n- Verify history.jsonl is created on first send\n- Verify entry format matches schema\n- Verify --no-history suppresses logging\n- Verify errors are recorded but send continues\n\n## Acceptance Criteria\n- [ ] Every ntm send logs to history\n- [ ] Palette sends also log to history  \n- [ ] --no-history flag works\n- [ ] Failed sends are logged with error\n- [ ] Template name recorded when used","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:47:34.225928-05:00","updated_at":"2025-12-10T04:27:36.819182-05:00","closed_at":"2025-12-10T04:27:36.819182-05:00","dependencies":[{"issue_id":"ntm-pp5.1.2","depends_on_id":"ntm-pp5.1","type":"parent-child","created_at":"2025-12-10T02:47:34.227579-05:00","created_by":"daemon"},{"issue_id":"ntm-pp5.1.2","depends_on_id":"ntm-pp5.1.1","type":"blocks","created_at":"2025-12-10T02:47:34.228462-05:00","created_by":"daemon"}]}
{"id":"ntm-pp5.2","title":"Prompt Replay Command","description":"New `ntm replay` command to re-send historical prompts.\n\n## Command Interface\n```bash\nntm replay 5                     # Re-send prompt #5 (from history)\nntm replay 01HXYZ...             # Re-send by ID\nntm replay --last                # Re-send most recent prompt\nntm replay 5 --to=cod            # Send to different targets\nntm replay 5 --session=other     # Send to different session\nntm replay 5 --edit              # Edit before sending\nntm replay 5 --dry-run           # Show what would be sent\n```\n\n## Lookup Behavior\n1. If arg is a number, treat as index (1 = most recent)\n2. If arg is a string, treat as ID prefix (match start)\n3. `--last` is sugar for index 1\n\n## Example Flow\n```\n$ ntm history\n #  TIME        SESSION      TARGETS         PROMPT (truncated)\n 1  10:31:00    myproject    cc_1,cc_2       implement JWT authentication...\n 2  10:30:00    myproject    cod_1           run all tests and fix failures\n 3  10:25:00    otherproject gmi_1           analyze this codebase for...\n\n$ ntm replay 1\nRe-sending to myproject (cc_1, cc_2):\n  \"implement JWT authentication...\"\nSent to 2 agents.\n\n$ ntm replay 2 --to=cc --session=myproject\nRe-sending to myproject (cc_1, cc_2):\n  \"run all tests and fix failures\"\nSent to 2 agents.\n```\n\n## Edit Mode\nWhen --edit is specified:\n1. Write prompt to temp file\n2. Open in \n3. Read modified content\n4. Confirm and send\n\n```go\nfunc editPrompt(original string) (string, error) {\n    f, _ := os.CreateTemp(\"\", \"ntm-prompt-*.md\")\n    f.WriteString(original)\n    f.Close()\n    \n    editor := os.Getenv(\"EDITOR\")\n    if editor == \"\" { editor = \"vim\" }\n    \n    cmd := exec.Command(editor, f.Name())\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.Run()\n    \n    modified, _ := os.ReadFile(f.Name())\n    return string(modified), nil\n}\n```\n\n## Flags\n| Flag | Description |\n|------|-------------|\n| --last | Replay most recent prompt |\n| --to | Override targets (--cc, --cod, --gmi, or pane names) |\n| --session | Send to different session |\n| --edit | Edit prompt before sending |\n| --dry-run | Show what would be sent |\n| --no-history | Don't log this replay |\n\n## Files to Create\n- internal/cli/replay.go - Command implementation\n\n## Dependencies\n- Requires: Prompt History Logging (ntm-pp5.1)","status":"in_progress","priority":1,"issue_type":"feature","assignee":"GreenCastle","created_at":"2025-12-10T02:40:40.784716-05:00","updated_at":"2025-12-10T04:33:06.335177-05:00","dependencies":[{"issue_id":"ntm-pp5.2","depends_on_id":"ntm-pp5","type":"parent-child","created_at":"2025-12-10T02:40:40.785071-05:00","created_by":"daemon"},{"issue_id":"ntm-pp5.2","depends_on_id":"ntm-pp5.1","type":"blocks","created_at":"2025-12-10T02:40:40.785692-05:00","created_by":"daemon"}]}
{"id":"ntm-pp5.3","title":"Prompt Templates with Variables","description":"Named templates with variable substitution for reusable prompts.\n\n## Overview\nTemplates are named, parameterized prompts stored in files.\nUsers can invoke them via `ntm send --template=name`.\n\n## Storage Locations\n1. Global: ~/.config/ntm/templates/*.md\n2. Project: .ntm/templates/*.md (if Per-Project Config enabled)\n\n## Template Format\n```markdown\n---\nname: code_review\ndescription: Review code for quality issues\nvariables:\n  file: File path to review\n  focus: What to focus on (optional)\n---\n\nReview the file {{file}} for:\n- Code quality issues\n- Potential bugs\n- Performance concerns\n{{#focus}}\nFocus especially on: {{focus}}\n{{/focus}}\n\nBe thorough but concise.\n```\n\n## Variable Types\n\n### Required Variables\n`{{variable}}` - Must be provided via --var\n\n### Optional Variables (with conditionals)\n`{{#variable}}...{{/variable}}` - Section only included if variable provided\n\n### Built-in Variables\n| Variable | Value |\n|----------|-------|\n| `{{file}}` | Content of --file argument |\n| `{{files}}` | Content of all --file arguments |\n| `{{selection}}` | Current editor selection (if available) |\n| `{{clipboard}}` | Clipboard content |\n| `{{cwd}}` | Current working directory |\n| `{{session}}` | Session name |\n| `{{date}}` | Current date |\n| `{{time}}` | Current time |\n\n## Command Interface\n```bash\n# Use template\nntm send myproject --template=code_review --var file=src/auth.py\n\n# Use with file injection\nntm send myproject -t code_review --file=src/auth.py\n# {{file}} auto-populated with file contents\n\n# List available templates\nntm template list\n\n# Show template content\nntm template show code_review\n\n# Create new template\nntm template create my_template\n# Opens editor with scaffold\n```\n\n## Template Resolution\n1. Look in project templates (.ntm/templates/)\n2. Look in global templates (~/.config/ntm/templates/)\n3. Look in built-in templates (embedded in binary)\n\n## Built-in Templates\nShip with sensible defaults:\n- code_review: Review code for issues\n- explain: Explain how code works\n- refactor: Refactor code\n- test: Write tests\n- document: Add documentation\n\n## Parsing Implementation\n```go\nfunc ParseTemplate(content string, vars map[string]string) (string, error) {\n    // Parse frontmatter\n    meta, body := splitFrontmatter(content)\n    \n    // Check required variables\n    for _, v := range meta.Variables {\n        if _, ok := vars[v.Name]; \\!ok \u0026\u0026 v.Required {\n            return \"\", fmt.Errorf(\"missing required variable: %s\", v.Name)\n        }\n    }\n    \n    // Expand conditionals\n    body = expandConditionals(body, vars)\n    \n    // Substitute variables\n    body = substituteVariables(body, vars)\n    \n    return body, nil\n}\n```\n\n## Files to Create\n- internal/templates/loader.go - Find and load templates\n- internal/templates/parser.go - Parse template syntax\n- internal/templates/builtin.go - Embedded default templates\n- internal/cli/template.go - Template management commands","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-10T02:41:04.28723-05:00","updated_at":"2025-12-10T02:41:04.28723-05:00","dependencies":[{"issue_id":"ntm-pp5.3","depends_on_id":"ntm-pp5","type":"parent-child","created_at":"2025-12-10T02:41:04.287592-05:00","created_by":"daemon"}]}
{"id":"ntm-pp5.4","title":"History Command (ntm history)","description":"CLI command to view and search prompt history.\n\n## Command Interface\n```bash\nntm history                          # Show recent prompts\nntm history --session=myproject      # Filter by session\nntm history --limit=50               # Show last 50\nntm history --since=1h               # Last hour\nntm history --search='auth'          # Search prompt text\nntm history --json                   # Output as JSON\nntm history clear                    # Clear all history\nntm history clear --before=7d        # Clear older than 7 days\n```\n\n## Default Output\n```\n #  TIME        SESSION      TARGETS     PROMPT\n 1  10:31:00    myproject    cc_1,cc_2   implement JWT authentication for the API...\n 2  10:30:00    myproject    cod_1       run all tests and fix any failures that...\n 3  10:25:00    backend      gmi_1       analyze this codebase for security vulne...\n 4  10:20:00    myproject    all (5)     review the changes and suggest improveme...\n 5  10:15:00    frontend     cc_1        create a React component for user login...\n\nShowing 5 of 127 entries. Use --limit for more.\n```\n\n## Detailed View\n```bash\nntm history show 1\n```\n```\nID:       01HXYZ...\nTime:     2025-12-10 10:31:00\nSession:  myproject\nTargets:  cc_1, cc_2\nSource:   cli\nTemplate: (none)\n\nPrompt:\n  implement JWT authentication for the API. Include:\n  - Token generation\n  - Token validation\n  - Refresh token flow\n  - Middleware for protected routes\n\nStatus: Success\n```\n\n## Flags\n| Flag | Description |\n|------|-------------|\n| --limit, -n | Number of entries (default: 20) |\n| --session, -s | Filter by session name |\n| --since | Time filter (1h, 1d, 1w) |\n| --search | Search prompt text |\n| --source | Filter by source (cli, palette, replay) |\n| --json | JSON output |\n\n## Subcommands\n- `ntm history` - List (default)\n- `ntm history show \u003cid\u003e` - Show details\n- `ntm history clear` - Clear history\n- `ntm history export` - Export to file\n\n## Implementation\n```go\nfunc newHistoryCmd() *cobra.Command {\n    cmd := \u0026cobra.Command{\n        Use:   \"history\",\n        Short: \"View prompt history\",\n        RunE:  runHistoryList,\n    }\n    \n    cmd.AddCommand(\n        \u0026cobra.Command{Use: \"show\", RunE: runHistoryShow},\n        \u0026cobra.Command{Use: \"clear\", RunE: runHistoryClear},\n        \u0026cobra.Command{Use: \"export\", RunE: runHistoryExport},\n    )\n    \n    return cmd\n}\n```\n\n## Files to Create\n- internal/cli/history.go - Command implementation","status":"closed","priority":1,"issue_type":"feature","assignee":"BlueLake","created_at":"2025-12-10T02:44:25.719579-05:00","updated_at":"2025-12-10T09:26:58.4436-05:00","closed_at":"2025-12-10T09:26:58.4436-05:00","dependencies":[{"issue_id":"ntm-pp5.4","depends_on_id":"ntm-pp5","type":"parent-child","created_at":"2025-12-10T02:44:25.720029-05:00","created_by":"daemon"},{"issue_id":"ntm-pp5.4","depends_on_id":"ntm-pp5.1","type":"blocks","created_at":"2025-12-10T02:44:25.721211-05:00","created_by":"daemon"}]}
{"id":"ntm-qen","title":"Add pre-send and post-send hooks to send command","description":"","status":"closed","priority":2,"issue_type":"task","assignee":"BlueSnow","created_at":"2025-12-10T02:41:34.072844-05:00","updated_at":"2025-12-10T09:08:20.430285-05:00","closed_at":"2025-12-10T09:08:20.430285-05:00","dependencies":[{"issue_id":"ntm-qen","depends_on_id":"ntm-85b","type":"blocks","created_at":"2025-12-10T02:41:44.550818-05:00","created_by":"daemon"}]}
{"id":"ntm-qft","title":"Add --robot-recipes flag for JSON recipe listing","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:42:24.636883-05:00","updated_at":"2025-12-10T02:42:24.636883-05:00","dependencies":[{"issue_id":"ntm-qft","depends_on_id":"ntm-y93","type":"blocks","created_at":"2025-12-10T02:42:31.372211-05:00","created_by":"daemon"},{"issue_id":"ntm-qft","depends_on_id":"ntm-517","type":"blocks","created_at":"2025-12-10T02:42:31.439486-05:00","created_by":"daemon"}]}
{"id":"ntm-qxp","title":"Implement command plugins as executable scripts","description":"Allow users to add custom commands via executable scripts.\n\n## What This Task Does\n\nEnable users to create custom NTM commands by placing executable\nscripts in ~/.config/ntm/commands/. Any executable becomes a subcommand.\n\n## Plugin Location\n\n~/.config/ntm/commands/\nâ”œâ”€â”€ sync-all*         # ntm sync-all\nâ”œâ”€â”€ morning-setup*    # ntm morning-setup  \nâ””â”€â”€ deploy*           # ntm deploy\n\n## Script Interface\n\nScripts receive NTM context via environment variables:\n- NTM_SESSION: Current/specified session name\n- NTM_JSON: Set to '1' if --json flag passed\n- NTM_CONFIG_PATH: Path to NTM config file\n- NTM_VERSION: NTM version string\n\nScripts can use ntm commands internally:\n#\\!/bin/bash\n# ~/.config/ntm/commands/sync-all\nfor session in $(ntm list --json | jq -r '.[].name'); do\n  ntm send \"$session\" --all \"git pull \u0026\u0026 npm install\"\ndone\n\n## Command Discovery\n\nOn startup:\n1. Scan ~/.config/ntm/commands/\n2. Check each file is executable\n3. Register as cobra subcommand\n4. Extract description from script header comment\n\nScript description convention:\n#\\!/bin/bash\n# Description: Sync all agents with latest code\n# Usage: ntm sync-all [--force]\n\n## Integration with Help\n\n$ ntm --help\n...\nPlugin Commands:\n  sync-all      Sync all agents with latest code\n  morning-setup Set up morning development session\n  deploy        Deploy current branch to staging\n\n$ ntm sync-all --help\n# Runs: script --help\n\n## Arguments and Flags\n\nPass through all arguments to script:\n$ ntm deploy --env staging --force\n# Runs: ~/.config/ntm/commands/deploy --env staging --force\n\n## Acceptance Criteria\n\n- [ ] Executables in commands/ become subcommands\n- [ ] Environment variables passed to scripts\n- [ ] Arguments passed through\n- [ ] Description parsed from header\n- [ ] Help shows plugin commands\n- [ ] Non-executable files ignored with warning\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:50:30.283061-05:00","updated_at":"2025-12-10T02:50:30.283061-05:00","dependencies":[{"issue_id":"ntm-qxp","depends_on_id":"ntm-c2b","type":"blocks","created_at":"2025-12-10T02:50:30.283522-05:00","created_by":"daemon"}]}
{"id":"ntm-r1l","title":"Add fsnotify-based file watcher to internal/watcher","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:43:40.366481-05:00","updated_at":"2025-12-10T02:43:40.366481-05:00"}
{"id":"ntm-r2k","title":"Create internal/bv package for bv command integration","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:27:05.685162-05:00","updated_at":"2025-12-10T03:32:04.494344-05:00","closed_at":"2025-12-10T03:32:04.494344-05:00","dependencies":[{"issue_id":"ntm-r2k","depends_on_id":"ntm-26o","type":"blocks","created_at":"2025-12-10T03:28:02.103251-05:00","created_by":"daemon"}]}
{"id":"ntm-r9y","title":"Unit Tests: internal/output package (55.1% â†’ 85%)","description":"# Unit Tests: internal/output Package\n\n## Current State\n- Coverage: 55.1%\n- Tests: 12 existing (format, JSON, text, error, table, etc.)\n\n## Test Approach\nThis package is mostly pure functions - easy to test without external dependencies.\n\n## Existing Tests (expand coverage)\n- [x] TestFormatString\n- [x] TestFormatterJSON\n- [x] TestFormatterText\n- [x] TestFormatterIsJSON\n- [x] TestDetectFormat\n- [x] TestErrorResponse\n- [x] TestSuccessResponse\n- [x] TestTruncate\n- [x] TestPluralize\n- [x] TestCountStr\n- [x] TestTable\n- [x] TestFormatterOutputData\n\n## Additional Test Cases\n\n### format.go\n- [ ] TestDetectFormatPiped - non-terminal detection\n- [ ] TestWithWriter - custom writer option\n- [ ] TestWithPretty - pretty print option\n- [ ] TestWithFormat - format option\n\n### json.go\n- [ ] TestWriteJSONPretty - indented output\n- [ ] TestWriteJSONCompact - no indentation\n- [ ] TestMarshalJSON - bytes output\n- [ ] TestTimestamp - UTC formatting\n- [ ] TestFormatTime - ISO 8601 format\n- [ ] TestParseTime - parse ISO 8601\n\n### text.go\n- [ ] TestTextln - newline output\n- [ ] TestLine - blank line\n- [ ] TestPrint - basic print\n- [ ] TestPrintf - formatted print\n- [ ] TestTableEmpty - table with no rows\n- [ ] TestTableWideColumns - column width calculation\n- [ ] TestTruncateEdgeCases - maxLen \u003c 3\n\n### errors.go\n- [ ] TestFormatterError - error in JSON mode\n- [ ] TestFormatterErrorText - error in text mode\n- [ ] TestErrorWithCode - error with code\n- [ ] TestPrintError - stderr output\n- [ ] TestFatal - exit behavior (tricky)\n\n### schema.go\n- [ ] TestNewTimestamped - timestamp field set\n- [ ] TestSessionResponse - all fields\n- [ ] TestPaneResponse - all fields\n- [ ] TestAgentCountsResponse - all fields\n- [ ] TestSpawnResponse - embedding works\n- [ ] TestSendResponse - all fields\n- [ ] TestListResponse - session list\n- [ ] TestStatusResponse - status fields\n- [ ] TestDepsResponse - dependency check","status":"closed","priority":1,"issue_type":"task","assignee":"LilacMountain","created_at":"2025-12-10T03:21:18.97843-05:00","updated_at":"2025-12-10T04:16:29.075844-05:00","closed_at":"2025-12-10T04:16:29.075844-05:00","dependencies":[{"issue_id":"ntm-r9y","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:22:34.16512-05:00","created_by":"daemon"}]}
{"id":"ntm-rlp","title":"Implement alert generation and tracking","description":"Generate actionable alerts from state analysis.\n\n## Rationale\nAlerts surface problems proactively. Instead of polling and analyzing raw state, the orchestrator gets pre-computed alerts.\n\n## Alert Types\n1. **Agent Stuck**: No output for N minutes\n2. **Agent Crashed**: Pane process exited\n3. **High CPU**: Agent consuming excessive resources\n4. **Disk Low**: Running low on disk space\n5. **Bead Stale**: In-progress bead with no activity\n6. **Mail Backlog**: Many unread messages\n7. **Dependency Cycle**: Bead dependency loop detected\n\n## Alert Structure\n```go\ntype Alert struct {\n    ID        string    // unique alert ID\n    Type      string    // agent_stuck, disk_low, etc.\n    Severity  string    // info, warning, error, critical\n    Message   string    // human-readable description\n    Context   map[string]interface{} // relevant data\n    CreatedAt time.Time\n    ResolvedAt *time.Time\n}\n```\n\n## Alert Lifecycle\n1. Condition detected â†’ Alert created\n2. Alert included in snapshot/health output\n3. Condition resolved â†’ Alert marked resolved\n4. Resolved alerts pruned after configurable time\n\n## Configurable Thresholds\nVia config file:\n```toml\n[alerts]\nagent_stuck_minutes = 5\ndisk_low_threshold_gb = 5\nmail_backlog_threshold = 10\n```","status":"closed","priority":1,"issue_type":"task","assignee":"OrangeSnow","created_at":"2025-12-10T02:54:13.05345-05:00","updated_at":"2025-12-10T09:19:25.988777-05:00","closed_at":"2025-12-10T09:19:25.988777-05:00"}
{"id":"ntm-rm4","title":"Add --json support to ntm status command","description":"Implement JSON output for the status command.\n\n## What This Task Does\n\nModify the ntm status command to support --json flag for detailed session state.\n\n## JSON Schema\n\n{\n  \"session\": \"myproject\",\n  \"exists\": true,\n  \"attached\": false,\n  \"window_count\": 1,\n  \"panes\": [\n    {\n      \"index\": 0,\n      \"title\": \"myproject__cc_1\",\n      \"agent_type\": \"claude\",\n      \"agent_number\": 1,\n      \"dimensions\": {\"width\": 80, \"height\": 24},\n      \"pid\": 12345,\n      \"command\": \"claude --dangerously-skip-permissions\",\n      \"active\": true\n    }\n  ],\n  \"agents\": {\n    \"claude\": 2,\n    \"codex\": 1,\n    \"gemini\": 0\n  },\n  \"working_directory\": \"/path/to/project\",\n  \"created_at\": \"2025-12-10T10:00:00Z\"\n}\n\n## Implementation\n\n1. Import internal/output package\n2. Create SessionStatusOutput and PaneInfo structs\n3. Modify runStatus to build structured data\n4. Include all pane details in JSON\n5. Parse agent type from pane titles\n\n## Acceptance Criteria\n\n- [ ] ntm status myproject --json produces valid JSON\n- [ ] All pane information is included\n- [ ] Agent type parsed from title\n- [ ] Non-existent session returns error JSON\n- [ ] Text output unchanged\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:47:04.853845-05:00","updated_at":"2025-12-10T09:12:05.793238-05:00","closed_at":"2025-12-10T09:12:05.793238-05:00","dependencies":[{"issue_id":"ntm-rm4","depends_on_id":"ntm-ws2","type":"blocks","created_at":"2025-12-10T02:47:04.854834-05:00","created_by":"daemon"}]}
{"id":"ntm-rmj","title":"E2E Test: Quick Setup Workflow","description":"# E2E Test: Quick Setup Workflow\n\n## Scenario\nTest ntm quick command creates complete project scaffolding.\n\n## Steps\n1. ntm quick testproject --template=go\n2. Verify directory exists at $PROJECTS_BASE/testproject\n3. Verify .git directory exists (git init)\n4. Verify .gitignore contains Go patterns\n5. Verify main.go exists\n6. Verify .vscode/settings.json exists\n7. Verify .claude/settings.toml exists\n8. Verify .claude/commands/review.md exists\n\n## Test All Templates\n- [ ] go template\n- [ ] python template\n- [ ] node template\n- [ ] rust template\n\n## Logging\n```\n[2025-12-10T10:30:45Z] TEST START: TestQuickSetupWorkflow\n[2025-12-10T10:30:45Z] STEP 1: Create project\n[2025-12-10T10:30:45Z]   EXEC: ntm quick testproject --template=go\n[2025-12-10T10:30:46Z]   STDOUT: Created project at /tmp/ntm_test/testproject\n[2025-12-10T10:30:46Z] STEP 2: Verify directory structure\n[2025-12-10T10:30:46Z]   CHECK: .git exists -\u003e PASS\n[2025-12-10T10:30:46Z]   CHECK: main.go exists -\u003e PASS\n[2025-12-10T10:30:46Z]   CHECK: .gitignore contains '*.exe' -\u003e PASS\n...\n```\n\n## Cleanup\n- Remove created project directory\n- Reset any environment changes","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:23:56.667184-05:00","updated_at":"2025-12-10T03:23:56.667184-05:00","dependencies":[{"issue_id":"ntm-rmj","depends_on_id":"ntm-66c","type":"blocks","created_at":"2025-12-10T03:24:42.066941-05:00","created_by":"daemon"},{"issue_id":"ntm-rmj","depends_on_id":"ntm-vr2","type":"blocks","created_at":"2025-12-10T03:24:43.133095-05:00","created_by":"daemon"}]}
{"id":"ntm-rpg","title":"Unit Tests: internal/robot package (0% â†’ 80%)","description":"# Unit Tests: internal/robot Package\n\n## Current State\n- Coverage: 0.0%\n- Purpose: Machine-readable JSON output for AI agents\n\n## Test Approach\nTest JSON output structure and correctness. Create real sessions to test status output.\n\n## Test Cases\n\n### robot.go\n\n#### Status Output\n- [ ] TestRobotStatusEmpty - no sessions returns empty array\n- [ ] TestRobotStatusSingleSession - one session with agents\n- [ ] TestRobotStatusMultipleSessions - multiple sessions\n- [ ] TestRobotStatusAgentCounts - correct agent type counts\n- [ ] TestRobotStatusAttachmentState - attached vs detached\n\n#### Plan Output\n- [ ] TestRobotPlanEmpty - no sessions suggests spawn\n- [ ] TestRobotPlanWithSessions - suggests appropriate actions\n- [ ] TestRobotPlanMultipleOptions - returns ranked suggestions\n\n#### Version Output\n- [ ] TestRobotVersion - returns valid JSON with version fields\n- [ ] TestRobotVersionFields - all expected fields present\n\n#### Help Output\n- [ ] TestRobotHelp - returns valid documentation\n- [ ] TestRobotHelpFormat - proper formatting\n\n#### Beads Integration\n- [ ] TestRobotBeadsStatus - includes bead summary if bd available\n- [ ] TestRobotBeadsMissing - handles missing bd gracefully\n\n### JSON Schema Validation\n- [ ] TestStatusOutputSchema - validates against expected schema\n- [ ] TestPlanOutputSchema - validates plan structure\n- [ ] TestAgentInfoSchema - validates agent info structure\n\n## Implementation Notes\n- Use json.Unmarshal to verify output is valid JSON\n- Define expected schema structs\n- Test with real tmux sessions where applicable","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:20:04.779421-05:00","updated_at":"2025-12-10T03:26:39.094943-05:00","closed_at":"2025-12-10T03:26:39.094943-05:00","dependencies":[{"issue_id":"ntm-rpg","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:22:33.722548-05:00","created_by":"daemon"}]}
{"id":"ntm-sc6","title":"Implement agent progress detection","description":"Detect and report agent progress through work items.\n\n## Rationale\nWhen an agent is working on a task, I need to understand progress:\n- Is it just starting?\n- Is it midway through?\n- Is it finishing up?\n- Has it encountered a blocker?\n\nThis enables smarter orchestration (don't interrupt agents near completion, reassign stuck work, etc.)\n\n## Progress Indicators\nDetect progress from pane output patterns:\n\n### Starting Indicators\n- 'Let me', 'I'll', 'Starting'\n- File reads, searches\n- Planning/analysis output\n\n### Working Indicators\n- File edits\n- Code blocks being written\n- Test runs\n- Build commands\n\n### Finishing Indicators\n- 'Done', 'Complete', 'Finished'\n- Summary output\n- Return to prompt\n- Commit messages\n\n### Stuck Indicators\n- 'Error', 'Failed', 'Cannot'\n- Repeated attempts\n- Questions asked\n- Long pauses\n\n## Output in Snapshot\n```json\n{\n  \"agents\": [{\n    \"pane\": \"0.1\",\n    \"progress\": {\n      \"stage\": \"working\",     // starting, working, finishing, stuck\n      \"confidence\": 0.75,\n      \"indicators\": [\"file_edits\", \"code_blocks\"],\n      \"time_in_stage_sec\": 120\n    }\n  }]\n}\n```\n\n## Future: ML-based Detection\nCould train a classifier on agent outputs to detect progress more accurately. For now, heuristic-based is sufficient.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:58:19.308214-05:00","updated_at":"2025-12-10T02:58:19.308214-05:00"}
{"id":"ntm-sim","title":"Implement --robot-snapshot for unified state query","description":"Core orchestration primitive: single command returns complete system state including all sessions, agent health, bead summary, mail status, and alerts. This is THE most important flag because it eliminates the need for multiple queries.\n\n## Rationale\nWhen orchestrating N agents across M sessions working on P beads with Q mail threads, I currently need separate queries for each dimension. This compounds latency (4-6 tool calls) and burns tokens on redundant parsing. A unified snapshot gives me complete situational awareness in one atomic read.\n\n## Output Structure\n```json\n{\n  \"ts\": \"ISO8601\",\n  \"sessions\": [{\n    \"name\": \"string\",\n    \"agents\": [{\n      \"pane\": \"window.pane\",\n      \"type\": \"claude|codex|gemini|cursor|windsurf|aider\",\n      \"state\": \"active|idle|stuck|waiting\",\n      \"last_output_age_sec\": number,\n      \"output_tail_lines\": number,\n      \"current_bead\": \"bead-id|null\",\n      \"pending_mail\": number\n    }]\n  }],\n  \"beads_summary\": {\"open\": N, \"in_progress\": N, \"blocked\": N, \"ready\": N},\n  \"mail_unread\": number,\n  \"alerts\": [\"string\"]\n}\n```\n\n## Key Design Decisions\n- Always include everything (no optional fields that require follow-up)\n- Use compact field names (abbreviations OK for frequently-accessed data)\n- Include computed fields (last_output_age_sec vs raw timestamp)\n- Alerts are pre-filtered to actionable items only\n\n## Integration Points\n- tmux: session/pane enumeration, output capture\n- beads: bd list --json integration  \n- agent-mail: inbox count per agent\n- pane title parsing for agent type detection","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T02:50:07.458116-05:00","updated_at":"2025-12-10T03:20:34.255328-05:00","closed_at":"2025-12-10T03:20:34.255328-05:00","comments":[{"id":10,"issue_id":"ntm-sim","author":"jemanuel","text":"## Implementation Architecture\n\n### File Structure\n```\ninternal/robot/\nâ”œâ”€â”€ robot.go          # Existing - add Snapshot type and function\nâ”œâ”€â”€ snapshot.go       # NEW - SnapshotOutput, BuildSnapshot()\nâ”œâ”€â”€ integrations.go   # NEW - BeadsIntegration, MailIntegration\nâ””â”€â”€ alerts.go         # NEW - AlertManager, Alert types\n```\n\n### Core Type\n```go\ntype SnapshotOutput struct {\n    Timestamp   time.Time              `json:\"ts\"`\n    Sessions    []SessionSnapshot      `json:\"sessions\"`\n    Beads       *BeadsSnapshot         `json:\"beads,omitempty\"`\n    AgentMail   *MailSnapshot          `json:\"agent_mail,omitempty\"`\n    Alerts      []Alert                `json:\"alerts\"`\n    Summary     SnapshotSummary        `json:\"summary\"`\n}\n```\n\n### Flag Registration\nIn root.go init():\n```go\nrootCmd.Flags().Bool(\"robot-snapshot\", false, \"Output complete system state as JSON\")\nrootCmd.Flags().String(\"since\", \"\", \"Return only changes since timestamp (ISO8601)\")\n```\n\n### Performance Target\n- Cold snapshot: \u003c100ms\n- With caching: \u003c20ms\n- Memory: \u003c5MB for 10 sessions with 50 panes","created_at":"2025-12-10T07:55:34Z"}]}
{"id":"ntm-smh8","title":"Implement NTM CLI wrapper for VS Code","description":"# Implement NTM CLI wrapper for VS Code\n\nTypeScript class wrapping ntm CLI commands.\nParse JSON robot mode output.\nHandle errors and timeouts.\nCache status for performance.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:22.443962-05:00","updated_at":"2025-12-10T03:29:22.443962-05:00","dependencies":[{"issue_id":"ntm-smh8","depends_on_id":"ntm-lb9b","type":"blocks","created_at":"2025-12-10T03:29:38.594528-05:00","created_by":"daemon"}]}
{"id":"ntm-spa","title":"Create internal/hooks package with config loader","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:41:28.298189-05:00","updated_at":"2025-12-10T04:37:34.138205-05:00","closed_at":"2025-12-10T04:37:34.138205-05:00"}
{"id":"ntm-t0ch","title":"Implement file conflict detection","description":"# Implement File Conflict Detection\n\n## Purpose\n\nDetect when multiple agents modify the same file, potentially creating conflicts.\n\n## Detection Logic\n\n```go\ntype Conflict struct {\n    Path   string\n    Agents []AgentChange\n}\n\nfunc DetectConflicts(changes []AgentChange) []Conflict {\n    byPath := make(map[string][]AgentChange)\n    for _, c := range changes {\n        byPath[c.File] = append(byPath[c.File], c)\n    }\n    \n    var conflicts []Conflict\n    for path, agents := range byPath {\n        if len(agents) \u003e 1 {\n            conflicts = append(conflicts, Conflict{\n                Path:   path,\n                Agents: agents,\n            })\n        }\n    }\n    return conflicts\n}\n```\n\n## Severity Levels\n\n- **Warning**: Same file modified by 2+ agents (may or may not conflict)\n- **Critical**: Same lines modified (if we can detect via git diff)\n\n## Integration with ntm send --all\n\nAfter broadcast completes:\n```\nntm send myproject --all \"Implement the feature\"\n# ... agents work ...\n# On completion:\nâš ï¸ Potential conflict: src/api/users.py modified by cc_1, cc_2\n  Run `ntm conflicts myproject` for details\n```\n\n## Acceptance Criteria\n\n- [ ] Detect same-file modifications across agents\n- [ ] Warn user after broadcasts\n- [ ] ntm conflicts command shows details\n- [ ] Severity classification (warning vs critical)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:14.387332-05:00","updated_at":"2025-12-10T03:40:18.276326-05:00","dependencies":[{"issue_id":"ntm-t0ch","depends_on_id":"ntm-xkvu","type":"blocks","created_at":"2025-12-10T03:29:37.60962-05:00","created_by":"daemon"}]}
{"id":"ntm-t897","title":"Integrate UBS with file watcher for auto-scan","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:31:02.812841-05:00","updated_at":"2025-12-10T03:31:02.812841-05:00","dependencies":[{"issue_id":"ntm-t897","depends_on_id":"ntm-p77j","type":"blocks","created_at":"2025-12-10T03:34:52.372785-05:00","created_by":"daemon"},{"issue_id":"ntm-t897","depends_on_id":"ntm-lk66","type":"blocks","created_at":"2025-12-10T03:35:09.251572-05:00","created_by":"daemon"}]}
{"id":"ntm-tf71","title":"EPIC: Ultimate Bug Scanner (UBS) Deep Integration","description":"","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:29:05.56777-05:00","updated_at":"2025-12-10T03:39:43.693621-05:00"}
{"id":"ntm-tvux","title":"Implement ntm checkpoint command","description":"# Implement ntm checkpoint Command\n\nCreate named checkpoints with optional description.\nCapture git state, session state, scrollback.\nList checkpoints with ntm checkpoints.\nShow checkpoint details with ntm checkpoint show.","status":"closed","priority":1,"issue_type":"task","assignee":"LilacMountain","created_at":"2025-12-10T03:29:19.960938-05:00","updated_at":"2025-12-10T04:33:01.570008-05:00","closed_at":"2025-12-10T04:33:01.570008-05:00","dependencies":[{"issue_id":"ntm-tvux","depends_on_id":"ntm-3ja0","type":"blocks","created_at":"2025-12-10T03:29:38.235246-05:00","created_by":"daemon"}]}
{"id":"ntm-ube","title":"Add adaptive theme support for light/dark terminals","description":"","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T02:43:02.924968-05:00","updated_at":"2025-12-10T02:43:02.924968-05:00","dependencies":[{"issue_id":"ntm-ube","depends_on_id":"ntm-81e","type":"blocks","created_at":"2025-12-10T02:43:16.266728-05:00","created_by":"daemon"}]}
{"id":"ntm-uwa","title":"Implement Agent Mail server detection and config","description":"# Implement Agent Mail Server Detection and Config\n\n## Purpose\n\nBefore using any Agent Mail features, NTM needs to detect if the server is running and load configuration.\n\n## Configuration Schema\n\nAdd to ~/.config/ntm/config.toml:\n```toml\n[agent_mail]\nenabled = true                              # Master toggle\nurl = \"http://127.0.0.1:8765/mcp/\"          # Server endpoint\ntoken = \"\"                                  # Bearer token (or use env var)\nauto_register = true                        # Auto-register sessions as agents\nprogram_name = \"ntm\"                        # Program identifier for registration\n```\n\nEnvironment variable overrides:\n- AGENT_MAIL_URL\n- AGENT_MAIL_TOKEN\n- AGENT_MAIL_ENABLED (0/1)\n\n## Detection Logic\n\n```go\nfunc (c *Client) IsAvailable() bool {\n    // 1. Check if enabled in config\n    // 2. Attempt health_check() with 2s timeout\n    // 3. Cache result for 30s to avoid repeated checks\n}\n\nfunc (c *Client) RequireAvailable() error {\n    if !c.IsAvailable() {\n        return ErrAgentMailUnavailable\n    }\n    return nil\n}\n```\n\n## Integration Points\n\n1. **ntm deps**: Show Agent Mail status\n   ```\n   Agent Mail: âœ“ running (http://127.0.0.1:8765/mcp/)\n   Agent Mail: âœ— not detected (optional)\n   ```\n\n2. **Config loading**: internal/config loads agent_mail section\n3. **Lazy initialization**: Client created on first use, not at startup\n4. **Status command**: Show connection status in ntm status\n\n## Acceptance Criteria\n\n- [ ] Config schema added with sensible defaults\n- [ ] Environment variables override config\n- [ ] Detection is fast (\u003c2s timeout) and cached\n- [ ] ntm deps shows Agent Mail status\n- [ ] Graceful behavior when server unavailable","status":"closed","priority":0,"issue_type":"task","assignee":"LilacLake","created_at":"2025-12-10T03:18:01.67162-05:00","updated_at":"2025-12-10T03:32:32.28481-05:00","closed_at":"2025-12-10T03:32:32.28481-05:00","dependencies":[{"issue_id":"ntm-uwa","depends_on_id":"ntm-ceb","type":"blocks","created_at":"2025-12-10T03:19:55.651713-05:00","created_by":"daemon"}]}
{"id":"ntm-uzvw","title":"Implement status bar item","description":"# Implement status bar item\n\nShow session name and agent count.\nColor coding for status.\nClick to open command palette.\nAuto-update on status change.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:22.64605-05:00","updated_at":"2025-12-10T03:29:22.64605-05:00","dependencies":[{"issue_id":"ntm-uzvw","depends_on_id":"ntm-smh8","type":"blocks","created_at":"2025-12-10T03:29:38.706908-05:00","created_by":"daemon"}]}
{"id":"ntm-vcu","title":"Add --robot-plan flag for execution recommendations","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:39:52.089157-05:00","updated_at":"2025-12-10T03:35:56.536068-05:00","closed_at":"2025-12-10T03:35:56.536068-05:00","dependencies":[{"issue_id":"ntm-vcu","depends_on_id":"ntm-517","type":"blocks","created_at":"2025-12-10T02:40:13.192166-05:00","created_by":"daemon"}]}
{"id":"ntm-vq83","title":"Implement git pre-commit guard integration","description":"# Implement git pre-commit guard integration\n\nInstalls .git/hooks/pre-commit that checks Agent Mail reservations.\nBlocks commits if files are locked by other agents.\nOptional warn-only mode.\nUses Agent Mail's install_precommit_guard MCP tool.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:12.395045-05:00","updated_at":"2025-12-10T03:29:12.395045-05:00","dependencies":[{"issue_id":"ntm-vq83","depends_on_id":"ntm-1ts","type":"blocks","created_at":"2025-12-10T03:29:37.454939-05:00","created_by":"daemon"}]}
{"id":"ntm-vr2","title":"SUB-EPIC: E2E Tests with Detailed Logging","description":"# SUB-EPIC: End-to-End (E2E) Tests with Detailed Logging\n\n## Scope\nComplete workflow tests that exercise NTM from CLI invocation to tmux state verification.\n\n## E2E Test Scenarios\n\n### Scenario 1: Full Agent Workflow\n1. ntm spawn project --cc=2 --cod=1\n2. Verify session created with 4 panes (3 agents + 1 user)\n3. ntm send project --cc 'hello world'\n4. Verify prompt delivered to Claude panes only\n5. ntm interrupt project\n6. Verify Ctrl+C sent\n7. ntm kill -f project\n8. Verify session destroyed\n\n### Scenario 2: Command Palette Workflow\n1. Create session with agents\n2. Invoke palette (programmatic, not TUI)\n3. Select command\n4. Verify prompt sent to targets\n\n### Scenario 3: Quick Setup Workflow\n1. ntm quick testproject --template=go\n2. Verify directory structure created\n3. Verify git initialized\n4. Verify .vscode and .claude dirs created\n\n### Scenario 4: Session Persistence\n1. Create session, add agents\n2. Detach\n3. Re-attach\n4. Verify state preserved\n\n### Scenario 5: Robot Mode Output\n1. Create various session states\n2. Run --robot-status, --robot-plan\n3. Verify JSON output matches actual state\n4. Parse and validate JSON schema\n\n## Logging Requirements\n\n### Per-Test Log File\n```\ntest_logs/\nâ”œâ”€â”€ TestFullAgentWorkflow_20251210_103045.log\nâ”œâ”€â”€ TestCommandPaletteWorkflow_20251210_103047.log\nâ””â”€â”€ ...\n```\n\n### Log Content Structure\n```\n[2025-12-10T10:30:45Z] TEST START: TestFullAgentWorkflow\n[2025-12-10T10:30:45Z] SETUP: Creating test session 'ntm_test_abc123'\n[2025-12-10T10:30:45Z] EXEC: ntm spawn ntm_test_abc123 --cc=2 --cod=1\n[2025-12-10T10:30:45Z] STDOUT: Session created: ntm_test_abc123 (4 panes)\n[2025-12-10T10:30:45Z] VERIFY: Checking pane count...\n[2025-12-10T10:30:45Z] ASSERT PASS: pane_count == 4\n[2025-12-10T10:30:46Z] EXEC: ntm send ntm_test_abc123 --cc 'hello'\n...\n[2025-12-10T10:30:48Z] TEARDOWN: Killing session ntm_test_abc123\n[2025-12-10T10:30:48Z] TEST END: PASS (3.2s)\n```\n\n### System State Capture\nBefore and after each test:\n- tmux list-sessions\n- tmux list-panes (for test session)\n- Environment variables\n- Working directory\n\n## Implementation\n- tests/e2e/ directory for all E2E tests\n- Shared test harness with logging\n- CI-compatible (skip if tmux unavailable)\n- Parallel execution with unique session names","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T03:18:52.553331-05:00","updated_at":"2025-12-10T03:18:52.553331-05:00","dependencies":[{"issue_id":"ntm-vr2","depends_on_id":"ntm-l5h","type":"blocks","created_at":"2025-12-10T03:19:06.044553-05:00","created_by":"daemon"},{"issue_id":"ntm-vr2","depends_on_id":"ntm-7lk","type":"blocks","created_at":"2025-12-10T03:19:06.232148-05:00","created_by":"daemon"}]}
{"id":"ntm-vttg","title":"Implement event logging framework","description":"# Implement event logging framework\n\nJSONL append-only log for session events.\nEvent types: session_create, agent_spawn, prompt_send, etc.\nAutomatic rotation (30 days retention).\nLocation: ~/.config/ntm/analytics/events.jsonl","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:17.546148-05:00","updated_at":"2025-12-10T03:29:17.546148-05:00"}
{"id":"ntm-vum","title":"EPIC: MCP Agent Mail Integration","description":"# MCP Agent Mail Integration\n\n## Background \u0026 Motivation\n\nNTM orchestrates multiple AI coding agents (Claude, Codex, Gemini) in parallel tmux panes. Currently, these agents operate in isolation - they can see the same filesystem but cannot:\n- Communicate with each other directly\n- Know what others are working on\n- Coordinate file access to avoid conflicts\n- Share status or hand off work\n\nMCP Agent Mail provides exactly this coordination layer.\n\n## CRITICAL CLARIFICATION: NTM's Role\n\n**NTM is a COORDINATOR and BRIDGE, not an agent replacement.**\n\nThe agents running in panes (Claude Code, Codex, etc.) may or may not have their own Agent Mail integration:\n- If they DO have Agent Mail support: NTM provides unified visibility (aggregate inbox, lock status)\n- If they DON'T: NTM acts as coordinator, sending messages on behalf of the user\n\n**Key insight**: NTM doesn't pretend to BE the agents. It's the orchestration layer that:\n1. Provides a unified view of all agent mail activity\n2. Allows the USER to send messages to/between agents\n3. Shows file reservation status across all agents\n4. Detects conflicts before spawning new agents\n\n## What NTM's Agent Mail Integration Provides\n\n### 1. Visibility Layer\n- Aggregate inbox view: See messages across all registered agents\n- File lock status: Who has reserved what files\n- Agent directory: Which agents are active in the project\n\n### 2. User-to-Agent Communication\n```bash\nntm mail send myproject --to cc_1 \"Please focus on the API endpoint\"\n```\nThis sends FROM the NTM coordinator TO the specified agent. It's the user speaking through NTM.\n\n### 3. Session Coordination\n```bash\nntm lock myproject \"src/api/**\" --reason \"User-directed refactor\"\n```\nNTM can reserve files on behalf of the session, signaling to all agents that these files are being coordinated.\n\n### 4. Conflict Prevention\n```bash\nntm spawn myproject --cc=2\n# Warning: src/api/** is reserved by GreenCastle (cc_1 in session 'other')\n# Proceed? [y/N]\n```\n\n## Technical Approach\n\nMCP Agent Mail runs as an HTTP server (default port 8765) with JSON-RPC 2.0.\n\nNTM will:\n1. **Create internal/agentmail package**: HTTP client for Agent Mail MCP tools\n2. **Register as coordinator**: `ntm_\u003csession\u003e` identity for user-initiated actions\n3. **Aggregate views**: Fetch inbox/locks from all known agents\n4. **Expose commands**: ntm mail, ntm lock, ntm locks\n5. **Dashboard integration**: Show mail and lock status\n6. **Graceful degradation**: All features optional if Agent Mail unavailable\n\n## Key Design Decisions\n\n- **NTM is a coordinator**: Sends messages as `ntm_\u003csession\u003e`, not as individual agents\n- **Agents own their mail**: If Claude Code has Agent Mail support, it handles its own inbox\n- **NTM aggregates and visualizes**: Unified view across all project agents\n- **Optional integration**: Works without Agent Mail; features degrade gracefully\n- **No duplication**: Don't re-implement what agents already do\n\n## What This Is NOT\n\n- NOT a replacement for agent-side Agent Mail integration\n- NOT pretending NTM \"is\" the Claude/Codex/Gemini agent\n- NOT required for basic NTM functionality\n\n## Success Criteria\n\n- [ ] NTM can detect if Agent Mail server is running\n- [ ] NTM registers coordinator identity per session\n- [ ] Aggregate inbox shows messages across all project agents\n- [ ] File reservation status visible in status/dashboard\n- [ ] Conflicts detected before spawning in reserved areas\n- [ ] Graceful degradation when Agent Mail unavailable","status":"open","priority":0,"issue_type":"epic","created_at":"2025-12-10T03:17:05.78207-05:00","updated_at":"2025-12-10T03:33:21.628729-05:00"}
{"id":"ntm-vz9","title":"Implement ntm copy command with filtering","description":"Copy pane content to system clipboard with filtering options.\n\n## What This Task Does\n\nCreate 'ntm copy' command to copy pane output to system clipboard.\n\n## Interface\n\n# Copy entire pane output\n$ ntm copy myproject:1\n\n# Copy last N lines\n$ ntm copy myproject:1 --last 50\n\n# Copy lines matching pattern\n$ ntm copy myproject:1 --pattern 'ERROR.*'\n\n# Copy only code blocks (markdown fences)\n$ ntm copy myproject:1 --code\n\n# Copy to file instead of clipboard\n$ ntm copy myproject:1 --output result.txt\n\n# Quiet mode (no confirmation message)\n$ ntm copy myproject:1 --quiet\n\n## Content Filtering\n\n--last N: Capture last N lines of pane output\n--pattern: Filter to lines matching regex\n--code: Extract markdown code blocks only\n\nCode block extraction:\n```python\ndef hello():\n    print('world')\n```\n\nBecomes:\ndef hello():\n    print('world')\n\nMultiple code blocks concatenated with newlines.\n\n## Implementation\n\n1. Capture pane content (existing CapturePaneOutput)\n2. Apply filters in order:\n   a. --last (if specified)\n   b. --pattern (if specified)\n   c. --code (if specified)\n3. Copy to clipboard or file\n4. Show confirmation unless --quiet\n\n## JSON Output\n\n$ ntm copy myproject:1 --json\n{\n  \"source\": \"myproject:1\",\n  \"lines\": 42,\n  \"bytes\": 1234,\n  \"destination\": \"clipboard\"\n}\n\n## Acceptance Criteria\n\n- [ ] Basic copy to clipboard works\n- [ ] --last N limits lines\n- [ ] --pattern filters by regex\n- [ ] --code extracts code blocks\n- [ ] --output writes to file\n- [ ] --quiet suppresses output\n- [ ] --json shows copy metadata\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T02:50:58.264359-05:00","updated_at":"2025-12-10T02:50:58.264359-05:00","dependencies":[{"issue_id":"ntm-vz9","depends_on_id":"ntm-gon","type":"blocks","created_at":"2025-12-10T02:50:58.264834-05:00","created_by":"daemon"},{"issue_id":"ntm-vz9","depends_on_id":"ntm-xle","type":"blocks","created_at":"2025-12-10T02:52:42.088514-05:00","created_by":"daemon"},{"issue_id":"ntm-vz9","depends_on_id":"ntm-ws2","type":"blocks","created_at":"2025-12-10T02:52:42.143318-05:00","created_by":"daemon"}]}
{"id":"ntm-w6p","title":"Unit Tests: internal/config package (16.2% â†’ 80%)","description":"# Unit Tests: internal/config Package\n\n## Current State\n- Coverage: 16.2%\n- Tests: 5 existing (default, getProjectDir, tilde expansion, nonexistent, categories)\n\n## Test Approach\nUse real temp files and directories. No mocks.\n\n## Test Cases\n\n### config.go\n\n#### Config Loading\n- [x] TestDefault - existing\n- [ ] TestLoadFromFile - load valid TOML config\n- [ ] TestLoadFromFileInvalid - malformed TOML\n- [ ] TestLoadFromFileMissing - handles missing file\n- [ ] TestLoadFromEnvVar - NTM_CONFIG_FILE env var\n- [ ] TestLoadPrecedence - file \u003e default\n\n#### Config Paths\n- [x] TestGetProjectDir - existing\n- [x] TestGetProjectDirWithTilde - existing\n- [ ] TestConfigFileLocations - check all search paths\n- [ ] TestXDGConfigDir - XDG_CONFIG_HOME support\n\n#### Agent Commands\n- [ ] TestDefaultAgentCommands - default cc, cod, gmi\n- [ ] TestCustomAgentCommands - override in config\n- [ ] TestAgentCommandEnvVars - environment variable support\n\n#### Tmux Settings\n- [ ] TestDefaultTmuxSettings - default panes, palette key\n- [ ] TestCustomTmuxSettings - override in config\n\n### palette.go (palette loading)\n\n#### Palette Loading\n- [x] TestDefaultPaletteCategories - existing\n- [ ] TestLoadPaletteFromTOML - [[palette]] entries\n- [ ] TestLoadPaletteFromMarkdown - command_palette.md\n- [ ] TestPalettePrecedence - file \u003e TOML \u003e defaults\n- [ ] TestPaletteMarkdownFormat - ## Category, ### key | Label\n- [ ] TestPaletteCommentsIgnored - # lines skipped\n\n#### Palette Content\n- [ ] TestPalettePromptContent - prompt text captured\n- [ ] TestPaletteCategoryGrouping - commands grouped correctly\n- [ ] TestPaletteKeyUniqueness - duplicate keys handled\n\n## Test Helpers\n```go\nfunc createTempConfig(t *testing.T, content string) string {\n    f, _ := os.CreateTemp(\"\", \"ntm-config-*.toml\")\n    f.WriteString(content)\n    f.Close()\n    t.Cleanup(func() { os.Remove(f.Name()) })\n    return f.Name()\n}\n```","status":"closed","priority":1,"issue_type":"task","assignee":"PurpleCreek","created_at":"2025-12-10T03:20:41.079062-05:00","updated_at":"2025-12-10T04:35:21.396192-05:00","closed_at":"2025-12-10T04:35:21.396192-05:00","dependencies":[{"issue_id":"ntm-w6p","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:22:33.873236-05:00","created_by":"daemon"}]}
{"id":"ntm-ws2","title":"Create internal/output package with JSON/text formatters","description":"Create a unified output formatting system that all commands will use.\n\n## What This Task Does\n\nCreate a new internal/output package that provides:\n1. OutputFormat type (JSON, Text, Table)\n2. Formatter interface that commands implement\n3. Root-level --json flag handling\n4. Consistent JSON schema patterns\n\n## Why This Is First\n\nThis is the foundation for all JSON output. Every command will use this\npackage, so it needs to be designed well upfront.\n\n## Technical Details\n\nPackage structure:\ninternal/output/\nâ”œâ”€â”€ format.go      # OutputFormat enum, Formatter interface\nâ”œâ”€â”€ json.go        # JSON-specific formatting helpers\nâ”œâ”€â”€ text.go        # Text-specific formatting (existing patterns)\nâ””â”€â”€ schema.go      # Common JSON schema types\n\nKey types:\ntype OutputFormat int\nconst (\n    FormatText OutputFormat = iota\n    FormatJSON\n)\n\ntype Formatter interface {\n    Format(data interface{}, format OutputFormat, w io.Writer) error\n}\n\nCommon JSON patterns:\n- Timestamps as ISO 8601 strings\n- Errors include 'error' field with message\n- Lists are always arrays (even empty)\n- Nested objects for complex data\n\n## Implementation Steps\n\n1. Create internal/output directory\n2. Define OutputFormat enum and detection logic\n3. Create Formatter interface\n4. Add JSON helper functions (marshal with indent, error wrapping)\n5. Add root --json flag to cobra root command\n6. Create context passing for format flag\n\n## Acceptance Criteria\n\n- [ ] internal/output package exists with clean API\n- [ ] --json flag added to root command\n- [ ] Format detection works (flag, env var, pipe detection)\n- [ ] JSON output is consistently formatted\n- [ ] Package is documented with examples\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:46:30.003885-05:00","updated_at":"2025-12-10T03:19:04.29506-05:00","closed_at":"2025-12-10T03:19:04.29506-05:00","dependencies":[{"issue_id":"ntm-ws2","depends_on_id":"ntm-6pd","type":"blocks","created_at":"2025-12-10T02:46:30.004746-05:00","created_by":"daemon"}]}
{"id":"ntm-x0h","title":"Unit Tests: internal/tmux package (5.4% â†’ 80%)","description":"# Unit Tests: internal/tmux Package\n\n## Current State\n- Coverage: 5.4%\n- Tests: 4 existing (session name validation, agent type detection)\n\n## Test Approach\nUse REAL tmux sessions. Each test creates a unique session and cleans up after.\n\n## Test Cases\n\n### session.go\n\n#### Session Management\n- [ ] TestCreateSession - creates real session, verifies it exists\n- [ ] TestCreateSessionWithDir - verifies working directory is set\n- [ ] TestCreateSessionDuplicate - error handling for existing session\n- [ ] TestKillSession - kills session, verifies gone\n- [ ] TestSessionExists - true/false for existing/non-existing\n\n#### Pane Operations\n- [ ] TestSplitWindow - creates new pane, returns correct ID\n- [ ] TestSplitWindowMultiple - creates 5 panes, verifies indices\n- [ ] TestSetPaneTitle - sets title, verifies with list-panes\n- [ ] TestGetPanes - lists all panes with correct metadata\n- [ ] TestCapturePaneOutput - captures recent output\n\n#### Layout Operations\n- [ ] TestApplyTiledLayout - tiles panes, verifies layout\n- [ ] TestSelectPane - selects specific pane\n- [ ] TestZoomPane - zooms and unzooms\n\n#### Key Sending\n- [ ] TestSendKeys - sends text, verifies in pane output\n- [ ] TestSendKeysWithEnter - sends text with enter key\n- [ ] TestSendInterrupt - sends Ctrl+C\n\n#### Agent Type Detection\n- [x] TestAgentTypeFromTitle - existing test, expand coverage\n- [ ] TestAgentTypeFromTitle_EdgeCases - empty, special chars\n\n#### Attachment\n- [ ] TestAttachSession - attach to session (difficult to test)\n- [ ] TestSwitchToSession - switch client to session\n\n### Helper Functions\n- [ ] TestInTmux - detect if running in tmux\n- [ ] TestIsInstalled - detect tmux installation\n\n## Test Helpers Needed\n```go\nfunc createTestSession(t *testing.T) string {\n    name := fmt.Sprintf(\"ntm_test_%d\", time.Now().UnixNano())\n    t.Cleanup(func() { KillSession(name) })\n    CreateSession(name, os.TempDir())\n    return name\n}\n```\n\n## Skip Conditions\n- Skip all tmux tests if tmux not installed\n- Skip attach tests if not in tmux","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:20:02.989397-05:00","updated_at":"2025-12-10T03:26:55.911298-05:00","closed_at":"2025-12-10T03:26:55.911298-05:00","dependencies":[{"issue_id":"ntm-x0h","depends_on_id":"ntm-idx","type":"blocks","created_at":"2025-12-10T03:22:33.599967-05:00","created_by":"daemon"}]}
{"id":"ntm-xkvu","title":"Implement file modification tracking per agent","description":"# Implement File Modification Tracking Per Agent\n\n## Purpose\n\nTrack which files each agent modifies, enabling conflict detection and contribution attribution.\n\n## Approach\n\n### Method 1: File Mtime Tracking\n```go\ntype FileSnapshot struct {\n    Path  string\n    Mtime time.Time\n    Size  int64\n}\n\nfunc SnapshotDirectory(dir string) map[string]FileSnapshot {\n    // Walk directory, record mtime/size for each file\n}\n\nfunc DetectChanges(before, after map[string]FileSnapshot) []FileChange {\n    // Compare snapshots, return changed files\n}\n```\n\n### Method 2: Git Status Parsing\n```go\nfunc GetUncommittedChanges() ([]string, error) {\n    // git status --porcelain\n    // Parse output for modified/added/deleted files\n}\n```\n\n### Attribution to Agents\nTrack changes with timestamps:\n```go\ntype AgentChange struct {\n    Agent     string    // Pane identifier\n    File      string\n    Timestamp time.Time\n    ChangeType string  // modified, added, deleted\n}\n```\n\nWhen `ntm send` completes, snapshot files again and attribute changes to the targeted agents.\n\n## Limitations\n\n- Can't perfectly attribute if multiple agents running simultaneously\n- Best-effort: attribute to agent(s) that were sent prompts most recently\n- Works best with sequential workflows\n\n## Acceptance Criteria\n\n- [ ] Snapshot file state before prompts\n- [ ] Detect changes after prompts complete\n- [ ] Attribute changes to agents (best-effort)\n- [ ] Store change history for comparison\n- [ ] Handle git-ignored files appropriately","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:29:14.145569-05:00","updated_at":"2025-12-10T03:40:18.116835-05:00"}
{"id":"ntm-xle","title":"Implement cross-platform clipboard detection and access","description":"Create internal/clipboard package for cross-platform clipboard access.\n\n## What This Task Does\n\nCreate a clipboard abstraction that works on macOS, Linux (X11/Wayland),\nand WSL. This provides the foundation for clipboard-related features.\n\n## Platform Detection\n\nDetect platform and available clipboard tools:\n\nmacOS:\n- pbcopy / pbpaste (always available)\n\nLinux X11:\n- xclip -selection clipboard\n- xsel --clipboard\n\nLinux Wayland:\n- wl-copy / wl-paste\n\nWSL:\n- clip.exe (write only)\n- powershell.exe Get-Clipboard (read)\n\nFallback:\n- tmux's internal clipboard (with warning about limitations)\n\n## Implementation\n\npackage clipboard\n\ntype Clipboard interface {\n    Copy(content string) error\n    Paste() (string, error)\n    Available() bool\n}\n\nfunc New() (Clipboard, error) {\n    switch runtime.GOOS {\n    case \"darwin\":\n        return \u0026macOSClipboard{}, nil\n    case \"linux\":\n        if isWSL() {\n            return \u0026wslClipboard{}, nil\n        }\n        if isWayland() {\n            return \u0026waylandClipboard{}, nil\n        }\n        return \u0026x11Clipboard{}, nil\n    }\n    return \u0026tmuxClipboard{}, nil\n}\n\n## Error Handling\n\n- Tool not found: Clear error with installation suggestion\n- Permission denied: Suggest running with appropriate access\n- Empty clipboard: Return empty string, not error\n\n## Testing\n\nNeed to handle:\n- CI environments (no display, no clipboard)\n- SSH sessions (no local clipboard)\n- Container environments\n\nSkip clipboard tests or mock in these environments.\n\n## Acceptance Criteria\n\n- [ ] Clipboard works on macOS\n- [ ] Clipboard works on Linux X11\n- [ ] Clipboard works on Linux Wayland\n- [ ] Clipboard works on WSL\n- [ ] Graceful fallback when tools missing\n- [ ] Clear error messages\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T02:50:58.143326-05:00","updated_at":"2025-12-10T02:50:58.143326-05:00","dependencies":[{"issue_id":"ntm-xle","depends_on_id":"ntm-gon","type":"blocks","created_at":"2025-12-10T02:50:58.144227-05:00","created_by":"daemon"}]}
{"id":"ntm-xmx","title":"Create work distribution algorithm using bv tracks","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-10T03:27:25.757899-05:00","updated_at":"2025-12-10T03:32:06.199111-05:00","closed_at":"2025-12-10T03:32:06.199111-05:00","dependencies":[{"issue_id":"ntm-xmx","depends_on_id":"ntm-cbi","type":"blocks","created_at":"2025-12-10T03:28:05.182504-05:00","created_by":"daemon"},{"issue_id":"ntm-xmx","depends_on_id":"ntm-r2k","type":"blocks","created_at":"2025-12-10T03:28:05.291636-05:00","created_by":"daemon"}]}
{"id":"ntm-y44","title":"EPIC: Advanced Robot Orchestration Flags","description":"Comprehensive robot mode flags for AI orchestrator control. Enables unified state queries, delta updates, batch operations, and cross-tool correlation. Priority based on orchestration value.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T02:49:44.994993-05:00","updated_at":"2025-12-10T02:49:44.994993-05:00","comments":[{"id":9,"issue_id":"ntm-y44","author":"jemanuel","text":"## Orchestrator's Perspective: Why These Flags Matter\n\nThis epic represents a fundamental shift in how NTM serves AI orchestrators. The existing --robot-status flag is just the beginning. Here's the complete vision:\n\n### Core Philosophy\nAn AI orchestrator managing 10+ agents across multiple sessions needs:\n1. **Complete situational awareness** in a single query\n2. **Token efficiency** to maximize useful work vs overhead\n3. **Fast feedback loops** for responsive orchestration\n4. **Cross-tool correlation** (tmux â†” beads â†” agent-mail)\n\n### The Token Economics\nConsider orchestrating 8 agents:\n- Current approach: 8+ tool calls, ~2000 tokens of output to parse\n- With --robot-snapshot: 1 call, ~500 tokens, everything I need\n- With --since delta: 1 call, ~50 tokens for incremental updates\n\nThis is a 40x improvement in polling scenarios.\n\n### Dependency Structure\nThe implementation follows a logical build-up:\n1. **Foundation**: Agent detection (ntm-3n9) + Alert system (ntm-rlp)\n2. **Integrations**: Agent-mail (ntm-gk5) + Beads (ntm-l5y)\n3. **Core**: Unified snapshot (ntm-sim)\n4. **Extensions**: Delta mode (ntm-dvz), Terse (ntm-oba), Health (ntm-c36)\n5. **Advanced**: Graph (ntm-i5x), Assign (ntm-20n), Interrupt (ntm-pb3)\n\n### Success Criteria\n- Single --robot-snapshot call provides complete state\n- Delta queries return only changes (95% token savings)\n- All output is structured JSON, no parsing human text\n- Cross-tool correlation works (know which agent â†’ which bead â†’ which thread)\n- Batch operations support multi-agent commands","created_at":"2025-12-10T07:55:21Z"},{"id":13,"issue_id":"ntm-y44","author":"jemanuel","text":"## Revised Architecture: Minimal Dependencies\n\nAfter review, the dependency structure has been revised. Core robot flags should work IMMEDIATELY without requiring integrations. Integrations ENHANCE but don't BLOCK.\n\n### Tier 1: Core (No blockers - implement first)\n- **ntm-sim**: --robot-snapshot - unified state query\n- **ntm-ign**: --robot-tail - multi-pane output\n- **ntm-d2t**: --robot-send - batch messaging  \n- **ntm-c36**: --robot-health - health matrix\n- **ntm-oln**: --robot-spawn - structured session creation\n- **ntm-pb3**: --robot-interrupt - priority course correction\n\n### Tier 2: Extensions (depend on Tier 1)\n- **ntm-dvz**: --robot-snapshot --since - delta updates (needs ntm-sim + ntm-hat)\n- **ntm-oba**: --robot-terse - compact output (needs ntm-sim)\n- **ntm-a8q**: --robot-ack - send confirmation\n\n### Tier 3: Enhancements (enhance Tier 1 but don't block)\n- **ntm-3n9**: Agent detection (improves accuracy of all queries)\n- **ntm-rlp**: Alert generation (adds alerts to snapshot/health)\n- **ntm-gk5**: Agent-mail integration (adds mail data to snapshot)\n- **ntm-l5y**: Beads integration (adds bead data to snapshot)\n- **ntm-hat**: State tracking ring buffer (enables delta mode)\n\n### Tier 4: Advanced Features\n- **ntm-20n**: --robot-assign - work distribution recommendations\n- **ntm-i5x**: --robot-graph - cross-tool correlation\n- **ntm-sc6**: Progress detection\n- **ntm-fpb**: Command history tracking\n- **ntm-lla**: Session save/restore\n\n### Implementation Order Recommendation\n1. Core Tier 1 flags (can be implemented in parallel)\n2. State tracking (ntm-hat) for delta support\n3. Delta mode (ntm-dvz) \n4. Enhancements as needed\n5. Advanced features based on user demand","created_at":"2025-12-10T07:59:37Z"},{"id":14,"issue_id":"ntm-y44","author":"jemanuel","text":"## Child Tasks\n\nThis epic tracks the following tasks:\n\n### Core Robot Flags (Tier 1 - No blockers)\n- ntm-sim: --robot-snapshot (unified state query)\n- ntm-ign: --robot-tail (multi-pane output)\n- ntm-d2t: --robot-send (batch messaging)\n- ntm-c36: --robot-health (health matrix)\n- ntm-oln: --robot-spawn (structured session creation)\n- ntm-pb3: --robot-interrupt (priority course correction)\n\n### Extensions (Tier 2)\n- ntm-dvz: --robot-snapshot --since (delta updates)\n- ntm-oba: --robot-terse (ultra-compact output)\n- ntm-a8q: --robot-ack (send confirmation)\n\n### Enhancements (Tier 3)\n- ntm-3n9: Agent type detection\n- ntm-rlp: Alert generation and tracking\n- ntm-gk5: Agent-mail integration\n- ntm-l5y: Beads integration\n- ntm-hat: State change ring buffer\n\n### Advanced Features (Tier 4)\n- ntm-20n: --robot-assign (work distribution)\n- ntm-i5x: --robot-graph (correlation map)\n- ntm-sc6: Progress detection\n- ntm-fpb: Command history tracking\n- ntm-lla: Session save/restore\n\nTotal: 19 tasks across 4 tiers","created_at":"2025-12-10T08:00:30Z"}]}
{"id":"ntm-y7l","title":"Implement agent tagging in pane titles","description":"Store and parse agent tags in tmux pane titles.\n\n## What This Task Does\n\nExtend the pane title format to include user-defined tags:\n- Current: session__cc_1\n- New: session__cc_1[frontend,refactor]\n\n## Tag Storage Format\n\nTags are comma-separated within square brackets at the end of pane title.\n\nExamples:\n- myproject__cc_1[frontend]\n- myproject__cod_1[backend,api,urgent]\n- myproject__gmi_1[] (no tags, explicit empty)\n\n## Implementation\n\nAdd to internal/tmux package:\n\nfunc SetPaneTags(session string, paneIndex int, tags []string) error {\n    currentTitle := GetPaneTitle(session, paneIndex)\n    baseTitle := stripTags(currentTitle)\n    newTitle := baseTitle + \"[\" + strings.Join(tags, \",\") + \"]\"\n    return exec.Command(\"tmux\", \"select-pane\", \"-t\", target, \"-T\", newTitle).Run()\n}\n\nfunc GetPaneTags(session string, paneIndex int) []string {\n    title := GetPaneTitle(session, paneIndex)\n    // Parse [tag1,tag2] from end of title\n    ...\n}\n\n## Integration with spawn/add\n\n$ ntm spawn myproject --cc=2 --tags=frontend\n# Creates: myproject__cc_1[frontend], myproject__cc_2[frontend]\n\n$ ntm add myproject --cod=1 --tags=backend,api\n# Creates: myproject__cod_1[backend,api]\n\n## Tag modification\n\n$ ntm tag myproject:1 --add=urgent\n$ ntm tag myproject:1 --remove=frontend\n$ ntm tag myproject:1 --set=backend,api\n\n## Acceptance Criteria\n\n- [ ] Tags stored in pane title\n- [ ] Tags parsed correctly from title\n- [ ] --tags flag works on spawn command\n- [ ] --tags flag works on add command\n- [ ] ntm tag command for modification\n- [ ] Tags survive session detach/reattach\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:49:06.760979-05:00","updated_at":"2025-12-10T02:49:06.760979-05:00","dependencies":[{"issue_id":"ntm-y7l","depends_on_id":"ntm-61i","type":"blocks","created_at":"2025-12-10T02:49:06.762064-05:00","created_by":"daemon"}]}
{"id":"ntm-y93","title":"Create internal/recipe package with types and loader","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T02:42:15.97323-05:00","updated_at":"2025-12-10T03:55:05.503571-05:00","closed_at":"2025-12-10T03:55:05.503571-05:00"}
{"id":"ntm-yxa","title":"Implement session agent registration","description":"# Implement Session Coordinator Registration\n\n## Purpose\n\nRegister NTM as a COORDINATOR agent with Agent Mail - not as a replacement for the actual agents, but as the orchestration layer.\n\n## IMPORTANT CLARIFICATION\n\nNTM registers as a **coordinator**, not as the agents themselves:\n- Identity: `ntm_\u003csession\u003e` (e.g., `ntm_myproject`)\n- Program: `ntm`\n- Role: Coordinator/orchestrator\n- Purpose: User-initiated messages, session-level file reservations\n\nThe actual Claude/Codex/Gemini agents may have their own Agent Mail identities (e.g., `GreenCastle`, `BlueLake`). NTM doesn't impersonate them.\n\n## Registration Flow\n\n```go\nfunc RegisterSessionCoordinator(client *agentmail.Client, sessionName, projectDir string) (*agentmail.Agent, error) {\n    // 1. Ensure project exists\n    if _, err := client.EnsureProject(projectDir); err != nil {\n        return nil, err\n    }\n    \n    // 2. Register coordinator identity\n    return client.RegisterAgent(RegisterAgentInput{\n        ProjectKey:      projectDir,\n        Program:         \"ntm\",\n        Model:           \"coordinator\",\n        Name:            fmt.Sprintf(\"ntm_%s\", sanitize(sessionName)),\n        TaskDescription: \"NTM session coordinator - user-initiated actions\",\n    })\n}\n```\n\n## When Registration Happens\n\n- **On spawn**: Register coordinator after session creation\n- **On attach**: Update last_active_ts (agent already exists)\n- **Optional**: Can skip if Agent Mail unavailable\n\n## Discovering Other Agents\n\nAfter registration, NTM can discover other agents in the project:\n```go\nagents, _ := client.ListAgents(projectDir)\n// Returns: GreenCastle (claude-code), BlueLake (claude-code), RedStone (codex-cli), etc.\n```\n\nThis enables the aggregate inbox view.\n\n## Acceptance Criteria\n\n- [ ] Coordinator registered as `ntm_\u003csession\u003e` on spawn\n- [ ] Registration is idempotent (attach doesn't create duplicate)\n- [ ] Other project agents discoverable via ListAgents\n- [ ] Registration failures don't block session creation\n- [ ] Clear distinction: NTM is coordinator, not the agents","status":"closed","priority":0,"issue_type":"task","assignee":"ChartreuseLake","created_at":"2025-12-10T03:18:03.476453-05:00","updated_at":"2025-12-10T03:36:01.613618-05:00","closed_at":"2025-12-10T03:36:01.613618-05:00","dependencies":[{"issue_id":"ntm-yxa","depends_on_id":"ntm-uwa","type":"blocks","created_at":"2025-12-10T03:19:55.757544-05:00","created_by":"daemon"}]}
{"id":"ntm-yyh","title":"Integration Test: status detection with real panes","description":"# Integration Test: Status Detection\n\n## Scope\nVerify agent status detection works with real tmux pane output.\n\n## Test Scenarios\n\n### Scenario 1: Idle Detection\n- Create pane with shell prompt\n- Run status detection\n- Verify detected as idle\n\n### Scenario 2: Working Detection\n- Create pane with active output\n- Run status detection\n- Verify detected as working\n\n### Scenario 3: Error Detection\n- Create pane with error message (rate limit, auth, etc.)\n- Run status detection\n- Verify error detected and classified\n\n### Scenario 4: Agent Type Detection\n- Create panes with different agent titles\n- Run type detection\n- Verify Claude, Codex, Gemini correctly identified\n\n### Scenario 5: ANSI Handling\n- Create pane with colored output\n- Run detection\n- Verify ANSI codes don't interfere\n\n## Implementation\n- tests/integration/status_test.go\n- Create real tmux panes\n- Send specific content via tmux send-keys\n- Run detection functions\n- Verify results","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:23:18.827555-05:00","updated_at":"2025-12-10T03:23:18.827555-05:00","dependencies":[{"issue_id":"ntm-yyh","depends_on_id":"ntm-66c","type":"blocks","created_at":"2025-12-10T03:24:41.737081-05:00","created_by":"daemon"},{"issue_id":"ntm-yyh","depends_on_id":"ntm-7lk","type":"blocks","created_at":"2025-12-10T03:24:42.80065-05:00","created_by":"daemon"}]}
{"id":"ntm-z2k","title":"Update pane naming to include model identifier","description":"# Update Pane Naming to Include Variant Identifier\n\n## Purpose\n\nEnhance pane titles to include model OR persona information for identification and filtering.\n\n## CRITICAL: Resolving Naming Conflict\n\nBoth Multi-Model and Personas want to add info to pane names. We need ONE consistent scheme.\n\n**Decision: Use \"variant\" as a unified concept**\n- Variant = persona name (if persona specified)\n- Variant = model alias (if only model specified)\n- Variant = empty (if neither, for backwards compatibility)\n\n## Naming Format\n\n`{session}__{type}_{index}[_{variant}]`\n\nExamples:\n```\nmyproject__cc_1              # No variant (default model, no persona)\nmyproject__cc_1_opus         # Model variant (--cc=1:opus)\nmyproject__cc_1_architect    # Persona variant (--persona=architect)\nmyproject__cod_2_gpt4        # Model variant\nmyproject__gmi_1_reviewer    # Persona variant\n```\n\n## Priority Rules\n\n1. If --persona specified: Use persona name as variant\n2. Else if model specified: Use model alias as variant\n3. Else: No variant (backwards compatible)\n\nRationale: Persona implies model (persona includes model setting), so persona takes precedence.\n\n## Parsing Logic\n\n```go\n// Regex: session__type_index[_variant]\nvar paneNameRegex = regexp.MustCompile(`^(.+)__(\\w+)_(\\d+)(?:_(\\w+))?$`)\n\ntype PaneInfo struct {\n    Session string\n    Type    AgentType  // cc, cod, gmi\n    Index   int\n    Variant string     // model alias OR persona name, may be empty\n}\n\nfunc ParsePaneName(title string) (*PaneInfo, error) {\n    matches := paneNameRegex.FindStringSubmatch(title)\n    if matches == nil {\n        return nil, ErrInvalidPaneName\n    }\n    return \u0026PaneInfo{\n        Session: matches[1],\n        Type:    AgentType(matches[2]),\n        Index:   parseInt(matches[3]),\n        Variant: matches[4], // May be empty string\n    }, nil\n}\n```\n\n## Variant Type Detection\n\nTo know if variant is persona or model:\n```go\nfunc (p *PaneInfo) VariantType() VariantType {\n    if p.Variant == \"\" {\n        return VariantNone\n    }\n    if cfg.IsPersonaName(p.Variant) {\n        return VariantPersona\n    }\n    return VariantModel\n}\n```\n\n## Filtering Support\n\n```bash\nntm send myproject --cc:opus \"...\"      # Filter by model\nntm send myproject --cc:architect \"...\" # Filter by persona\nntm send myproject --cc \"...\"           # All Claude agents\n```\n\n## Acceptance Criteria\n\n- [ ] Pane names include variant when persona or model specified\n- [ ] Persona takes precedence over model for variant\n- [ ] Backwards compatible with existing panes (no variant)\n- [ ] ParsePaneName handles all formats\n- [ ] Filtering works by variant (model or persona)\n- [ ] Dashboard and status show variant info","status":"closed","priority":1,"issue_type":"task","assignee":"WhiteMountain","created_at":"2025-12-10T03:21:43.467199-05:00","updated_at":"2025-12-10T09:29:28.223694-05:00","closed_at":"2025-12-10T09:29:28.223694-05:00","dependencies":[{"issue_id":"ntm-z2k","depends_on_id":"ntm-057","type":"blocks","created_at":"2025-12-10T03:21:53.966599-05:00","created_by":"daemon"}]}
{"id":"ntm-zcu","title":"Integrate watcher with config for live reload","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T02:43:48.555783-05:00","updated_at":"2025-12-10T02:43:48.555783-05:00","dependencies":[{"issue_id":"ntm-zcu","depends_on_id":"ntm-r1l","type":"blocks","created_at":"2025-12-10T02:44:00.166199-05:00","created_by":"daemon"},{"issue_id":"ntm-zcu","depends_on_id":"ntm-czp","type":"blocks","created_at":"2025-12-10T02:44:00.237696-05:00","created_by":"daemon"}]}
{"id":"ntm-zh1e","title":"Add scanner configuration system (.ntm.yaml)","description":"## Overview\nCreate a configuration system for UBS scanner integration, allowing customization of scan behavior, thresholds, and tool selection.\n\n## Background\nDifferent projects have different needs - some want strict scanning, others more lenient. A configuration system enables:\n- Per-project customization\n- Consistent behavior across team\n- Easy toggling of features\n\n## Implementation Details\n\n### Config File Location\nSearch order:\n1. .ntm.yaml in project root\n2. ~/.config/ntm/config.yaml (global defaults)\n3. Built-in defaults\n\n### Config Schema\n```yaml\nscanner:\n  # UBS executable path (auto-detected if not set)\n  ubs_path: ~/projects/ultimate_bug_scanner/ubs\n  \n  # Default scan settings\n  defaults:\n    timeout: 60s\n    parallel: true\n    exclude:\n      - vendor/**\n      - node_modules/**\n      - \"*.test.go\"\n  \n  # Severity thresholds for different contexts\n  thresholds:\n    pre_commit:\n      block_critical: true\n      block_errors: 5\n    ci:\n      fail_critical: true\n      fail_errors: 0\n    dashboard:\n      show_warnings: true\n      show_info: false\n  \n  # Tool selection (which UBS tools to run)\n  tools:\n    enabled:\n      - semgrep\n      - gosec\n      - staticcheck\n    disabled:\n      - bandit  # Python not used in this project\n  \n  # Auto-bead creation settings\n  beads:\n    auto_create: true\n    min_severity: error\n    auto_close: true\n    \n  # Notification settings\n  notifications:\n    enabled: true\n    on_new_critical: true\n    summary_after_scan: true\n```\n\n### Files to Create/Modify\n- internal/config/scanner.go - Scanner config types\n- internal/config/loader.go - Config loading logic\n- internal/scanner/config.go - Config integration\n\n## Acceptance Criteria\n- [ ] Config file parsed correctly\n- [ ] Defaults applied when config missing\n- [ ] Config validation with helpful errors\n- [ ] Environment variable overrides supported","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:34:11.668449-05:00","updated_at":"2025-12-10T03:38:43.48092-05:00","dependencies":[{"issue_id":"ntm-zh1e","depends_on_id":"ntm-p77j","type":"blocks","created_at":"2025-12-10T03:35:03.091094-05:00","created_by":"daemon"}]}
{"id":"ntm-zi3","title":"EPIC: Performance \u0026 Profiling Infrastructure","description":"","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-10T02:39:09.625524-05:00","updated_at":"2025-12-10T02:39:09.625524-05:00","comments":[{"id":3,"issue_id":"ntm-zi3","author":"jemanuel","text":"-","created_at":"2025-12-10T07:40:26Z"}]}
{"id":"ntm-zi5r","title":"EPIC: Session Analytics \u0026 Metrics","description":"# Session Analytics \u0026 Metrics\n\n## Background \u0026 Motivation\n\nPower users running many sessions need insights into their NTM usage patterns.\n\n## CRITICAL: Honest About What We Can Track\n\n**We can ONLY track NTM-initiated actions.** We cannot see:\n- Agent-side API calls\n- Actual token consumption\n- What agents do between our prompts\n- Agent \"success\" or \"failure\" (subjective)\n\n**What we CAN track:**\n- NTM commands executed\n- Sessions created/destroyed\n- Agents spawned/crashed\n- Prompts sent via `ntm send`\n- Session durations\n- Pane activity (tmux data)\n\n## What This Feature Provides\n\n### 1. NTM Usage Statistics\n```bash\nntm analytics\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ NTM Usage (Last 7 days)                                     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Sessions created:     42                                    â”‚\nâ”‚ Avg session duration: 2.3 hours                             â”‚\nâ”‚ Agents spawned:       168                                   â”‚\nâ”‚ Prompts sent (ntm send): 347                               â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ By Agent Type:                                              â”‚\nâ”‚   Claude:  89 spawned â”‚ 203 prompts sent                   â”‚\nâ”‚   Codex:   52 spawned â”‚ 98 prompts sent                    â”‚\nâ”‚   Gemini:  27 spawned â”‚ 46 prompts sent                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Peak usage: Weekdays 9-11am, 2-4pm                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 2. Session History\n```bash\nntm analytics sessions\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Recent Sessions                                             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ api-refactor    â”‚ 4h 12m â”‚ 8 agents â”‚ 42 prompts â”‚ today  â”‚\nâ”‚ auth-feature    â”‚ 2h 45m â”‚ 6 agents â”‚ 23 prompts â”‚ today  â”‚\nâ”‚ test-coverage   â”‚ 1h 30m â”‚ 4 agents â”‚ 15 prompts â”‚ yday   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 3. Context Estimate Trends (Optional)\nIf Context Window Intelligence is enabled, show trends:\n```bash\nntm analytics context\n# Average context usage at session end: ~65%\n# Sessions ended due to high context: 3\n```\n\n## What We're NOT Tracking\n\n- âŒ Actual API token usage (we don't have access)\n- âŒ Agent \"success rate\" (undefined metric)\n- âŒ Code quality metrics (subjective)\n- âŒ Prompt content (privacy, unless opted in)\n\n## Storage\n\n~/.config/ntm/analytics/events.jsonl\n```json\n{\"ts\":\"2025-12-10T10:00:00Z\",\"event\":\"session_create\",\"session\":\"myproject\"}\n{\"ts\":\"2025-12-10T10:01:00Z\",\"event\":\"agent_spawn\",\"session\":\"myproject\",\"type\":\"cc\",\"model\":\"opus\"}\n{\"ts\":\"2025-12-10T10:05:00Z\",\"event\":\"prompt_send\",\"session\":\"myproject\",\"target\":\"cc\",\"chars\":150}\n```\n\n30-day retention, automatic rotation.\n\n## Success Criteria\n\n- [ ] Event logging for NTM actions\n- [ ] ntm analytics shows usage summary\n- [ ] Per-agent-type breakdowns\n- [ ] Session history with duration\n- [ ] Export to JSON/CSV\n- [ ] Clear about what's tracked vs not\n- [ ] 30-day retention policy","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-10T03:27:34.878202-05:00","updated_at":"2025-12-10T03:36:04.340541-05:00"}
{"id":"ntm-zu7j","title":"Add simple health badge to dashboard (calls bv --check-drift)","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T03:32:36.364248-05:00","updated_at":"2025-12-10T03:32:36.364248-05:00","dependencies":[{"issue_id":"ntm-zu7j","depends_on_id":"ntm-igpj","type":"blocks","created_at":"2025-12-10T03:32:50.912828-05:00","created_by":"daemon"}]}
{"id":"ntm-zxv","title":"Integrate Agent Mail into ntm status and dashboard","description":"# Integrate Agent Mail into ntm status and Dashboard\n\n## Purpose\n\nShow Agent Mail state (messages, locks) in the existing status and dashboard views for unified visibility.\n\n## ntm status Enhancement\n\n```\nSession: myproject\nâ”œâ”€ Panes: 5 (2 Claude, 2 Codex, 1 User)\nâ”œâ”€ Created: 2 hours ago\nâ”œâ”€ Attached: Yes\nâ”‚\nâ”œâ”€ Agent Mail: Connected âœ“\nâ”‚  â”œâ”€ Session Agent: ntm_myproject\nâ”‚  â”œâ”€ Unread Messages: 3 (1 urgent)\nâ”‚  â””â”€ Active Locks: 2 patterns\nâ”‚\nâ””â”€ Pane Status:\n   â”œâ”€ cc_1 (GreenCastle): ğŸ”’ src/api/** â”‚ ğŸ“¬ 2 unread\n   â”œâ”€ cc_2 (BlueLake): idle\n   â”œâ”€ cod_1 (RedStone): ğŸ”’ tests/** â”‚ ğŸ“­ no messages\n   â””â”€ ...\n```\n\n## Dashboard Integration\n\nAdd Agent Mail panel to dashboard view:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Panes (5)                           â”‚ Agent Mail              â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â— cc_1  GreenCastle  working        â”‚ ğŸ“¬ Messages             â”‚\nâ”‚ â— cc_2  BlueLake     idle           â”‚  3 unread (1 urgent)    â”‚\nâ”‚ â— cod_1 RedStone     working        â”‚                         â”‚\nâ”‚ â—‹ cod_2 -            -              â”‚ ğŸ”’ File Locks           â”‚\nâ”‚ â— user  -            -              â”‚  2 active reservations  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚\nâ”‚ [r]efresh [z]oom [m]ail [l]ocks     â”‚ Press [m] for inbox     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Keyboard Shortcuts in Dashboard\n\n| Key | Action |\n|-----|--------|\n| m | Open mail inbox overlay |\n| l | Show file locks overlay |\n| M | Compose new message |\n| L | Create new lock |\n\n## Implementation Notes\n\n- **Lazy loading**: Only fetch Agent Mail data if server available\n- **Caching**: Cache inbox/locks for 30s to avoid excessive API calls\n- **Badges**: Show unread count as badge on pane cards\n- **Graceful degradation**: If Agent Mail unavailable, hide related UI\n\n## Acceptance Criteria\n\n- [ ] ntm status shows Agent Mail connection status\n- [ ] Per-pane agent name and message count displayed\n- [ ] Dashboard has Agent Mail panel\n- [ ] Keyboard shortcuts for mail and locks\n- [ ] Graceful handling when Agent Mail unavailable\n- [ ] Cached data with refresh capability","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-10T03:19:43.880254-05:00","updated_at":"2025-12-10T03:19:43.880254-05:00","dependencies":[{"issue_id":"ntm-zxv","depends_on_id":"ntm-161","type":"blocks","created_at":"2025-12-10T03:19:56.191622-05:00","created_by":"daemon"},{"issue_id":"ntm-zxv","depends_on_id":"ntm-1ts","type":"blocks","created_at":"2025-12-10T03:19:56.27531-05:00","created_by":"daemon"}]}
